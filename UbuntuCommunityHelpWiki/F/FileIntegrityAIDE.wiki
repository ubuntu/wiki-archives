{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==
One of the many possible layers of security which may be applied to your Ubuntu computer is known as ''file integrity monitoring'' or ''file integrity verification''. The purpose of monitoring and/or verifying the integrity of key files, including system binaries and configuration files is to ensure that the files have not been altered by unauthorized means. The unauthorized alteration of certain system files is one of the symptoms of an active attack or compromise upon a system.

Using file integrity monitoring is a pro-active means of being aware of any changes to critical system files. As with most tools, and utilities in the GNU/Linux community, there are many different applications for use in monitoring and verifying the integrity of files on your Ubuntu system. This guide will discuss the installation, configuration, and usage of some of these tools on an Ubuntu system.  

== Available Tools ==
While there are literally a dozen or more solutions for monitoring and verifying the integrity of critical files on a GNU/Linux computer system, this guide will focus only on the '''Advanced Intrusion Detection Environment''' ('''AIDE''') utility. Other possible tools, and utilities for monitoring and/or verifying file integrity will be listed in the '''Resources''' section. The exploration and use of these tools is left as an exercise for the reader of this guide.

== AIDE ==
The Advanced Intrusion Detection Environment (AIDE) is a ''free'' replacement for the popular file integrity verification tool known as '''Tripwire'''. It creates a database from regular expression rules that it finds in a configuration file. Once this database is initialized, it can be used to verify the integrity of critical system and user files.

AIDE uses most of the popular message digest algorithms (md5, sha1, rmd160, tiger, haval, etc.) for checking file integrity. Additional algorithms may also be easily added. All of the traditional file system attributes may be checked for inconsistencies as well.

=== Installing AIDE ===
To install AIDE from a terminal prompt, ensure that your Internet connection is working, and enter the following command:

<pre>
sudo apt-get install aide
</pre>

Enter your password. Upon successful authentication, the AIDE package should be fetched and installed.

During installation, an '''Ubuntu Configuration''' window will appear notifying you that daily reports are mailed to the ''root'' user by default, and that this behavior may be changed by editing the <code>/etc/default/aide</code> configuration file. Press the '''Enter''' key to acknowledge this message. You will then be asked if the AIDE database should be initialized. Select '''Yes''' here, and press the '''Enter''' key. The next confirmation dialog will ask you to examine <code>/var/lib/aide/aide.db.new</code> before replacing any existing database. If this is your first time installing AIDE on the system in question, select '''Yes''' here, and press the '''Enter''' key.

=== Configuring AIDE ===

'''(The following instructions do not apply to newer versions of Ubuntu, such as 14.04.  For details, see the section <nowiki>[[#AIDE with the aide-common package|AIDE with the aide-common package]]</nowiki> below.)'''

There are two primary configuration files for AIDE:

{| class="wikitable"
|-
| <code>/etc/default/aide</code>
| The AIDE general configuration file.
|-
| <code>/etc/aide/aide.conf</code>
| The AIDE rules configuration file.
|}

==== /etc/default/aide ====

Some general settings and behaviors for AIDE may be modified by editing the <code>{/etc/default/aide</code> configuration file. For example, if you would like to have all of AIDE's daily reports emailed to the user <code>breandon</code> instead of the default root user, simply use <code>sudo</code> with your favorite editor, and modify the line <code>MAILTO=root</code> to reflect your choice of user, e.g.: <code>MAILTO=breandon</code>. You can also mail to an ordinary address, e.g., <code>MAILTO=me@example.com</code>.

Read the comments in <code>/etc/default/aide</code> to see what the other configuration directives control.

==== /etc/aide/aide.conf ====

<code>/etc/aide/aide.conf</code> controls scanning and reporting rules. Files and directories can change in many ways: some you may not consider important, but others you will want reported. <code>/etc/aide/aide.conf</code> determines whether and how AIDE should report a file or directory as having changed, and which attributes AIDE should consider when scanning. For example, in the default <code>/etc/aide/aide.conf</code> file, all member directories and files of the Group definition <code>BinLib</code> are checked for permissions, inode, number of links, user, group, size, block count, mtime, ctime, md5 checksum, and sha1 checksum (p+i+n+u+g+s+b+m+c+md5+sha1), whereas all member directories and files in the Group definition Databases are checked only for permissions, number of links, user, and group (p+n+u+g).

The member directories of a particular Group definition are added by specifying one entry per line, in the form of:

{| class="wikitable"
|-
| <code>directory</code> <code>Group definition</code>
|}

For example, to make the directory <code>/opt/local/bin</code> part of the <code>BinLib</code> Group definition, a line would be added in the appropriate section of the <code>/etc/aide/aide.conf</code> configuration file resembling the following:

{| class="wikitable"
|-
| <code>/opt/local/bin BinLib</code>
|}

Another example of a clever use for AIDE is to monitor the system's crontabs. System crontabs control the scheduled system activities which are executed on a schedule by the cron daemon. To ensure that these files are not altered in such a way as to introduce the automatic, scheduled execution of a malicious application, simply use the <code>sudo</code> command to edit the <code>/etc/aide/aide.conf</code> file with your favorite editor and locate the following section of the file:

{| class="wikitable"
|-
| <code># Check crontabs</code>
|}

Uncomment all of the lines beginning with <code>#/var/spool</code> under the <code># Check crontabs</code> heading, and save the file. You should examine the <code>/etc/aide/aide.conf</code> file closely, observing the commented sections in particular, for other possible uses of AIDE. Also read the <code>aide.conf</code> manual page, in addition to reading the HTML version of the AIDE manual, for further uses of AIDE which may be specified in this configuration file.

After making configuration changes, issue the following command at the terminal prompt to update the AIDE configuration:

<pre>
sudo update-aide.conf
</pre>

=== Using AIDE ===
To begin using AIDE, you must make sure the database is present:

<pre>
ls /var/lib/aide
</pre>

If you see the file <code>aide.db</code> in the output of the <code>ls</code> command, then proceed to the initialization step. If, instead, you see the file <code>aide.db.new</code>, then you need to rename the <code>aide.db.new</code> file to <code>aide.db</code> using this command:

<pre>
sudo mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db
</pre>

Once the AIDE database is in place, you can initialize the database with the following command from a terminal prompt:

<pre>
sudo aide --init
</pre>

At the end of this process, you should see the line:

{| class="wikitable"
|-
| <code>### AIDE database initialized</code>
|}

You may run an initial check of the directories and files as defined in <code>/etc/aide/aide.conf</code> by entering the following command at a terminal prompt:

<pre>
sudo aide --check
</pre>

If all is well in the directories, and files being monitored, you will see this message when the check completes:

{| class="wikitable"
|-
| <code>### All files match AIDE database. Looks okay!</code>
|}

AIDE will also run each day from the <code>/etc/cron.daily/aide</code> crontab, and the output of this run will be mailed to the user specified in the <code>MAILTO=</code> directive of the <code>/etc/default/aide</code> configuration file as detailed above.

== AIDE with the aide-common package ==

Newer versions of Ubuntu (including 14.04) come with two packages for AIDE:
** <code>aide</code>, with the <code>aide</code> command and manual page, and little else
** <code>aide-common</code>, with a wrapper around that command, configuration files with rules, and <code>cron</code> configuration files that will cause AIDE to be run nightly

If your AIDE is bundled like this, attempts to run the <code>aide</code> command directly will fail with the message:
<pre>
Couldn't open file /var/lib/aide/please-dont-call-aide-without-parameters/aide.db for reading
</pre>
even when parameters are supplied.

The configuration files are in different places, and to configure and use AIDE, the executables from  <code>aide-common</code> must be used instead: <code>aideinit</code>, <code>aide.wrapper</code>, <code>update-aide.conf</code>, and <code>aide-attributes</code>.

== Resources ==
Additional information on AIDE, and file integrity monitoring and verification is available via the following resources:

=== Local System Resources ===

{| class="wikitable"
|-
| <style="background:#F1F1ED;"><code>man aide</code>
| System manual page for the <code>aide</code> command.
|-
| <style="background:#F1F1ED;"><code>man aide.conf</code>
| System manual page for the <code>aide.conf</code> configuration file.
|-
| <style="background:#F1F1ED;"><code>man aideinit</code>
| System manual page for the <code>aideinit</code> command.
|-
| <style="background:#F1F1ED;"><code>man update-aide.conf</code>
| System manual page for the <code>update-aide.conf</code> command.
|-
| <style="background:#F1F1ED;"><code>/usr/share/doc/aide/manual.html</code>
| The AIDE manual in HTML format.
|-
| <style="background:#F1F1ED;"><code>/etc/default/aide</code>
| The AIDE general configuration file.
|-
| <style="background:#F1F1ED;"><code>/etc/aide/aide.conf</code>
| The AIDE rules configuration file.
|-
| <style="background:#F1F1ED;"><code>/etc/cron.daily/aide</code>
| Daily AIDE cron scripts.
|}

=== Other File Integrity Monitoring and Verification Tools ===

* '''BSign''' : Corruption and Intrusion Detection using embedded hashes.
* '''Integrit''' : Small footprint, unattended monitoring of file integrity with cascading rulesets.
* '''Samhain''' : Standalone, or Client-Server file integrity monitoring solution.
* '''Systraq''' : Monitors, and alerts on file changes.
 
== External Links ==

* <nowiki>[[http://sourceforge.net/projects/aide]]</nowiki> - AIDE web site.
* <nowiki>[[http://www.linuxsecurity.com/content/view/101882/49/]]</nowiki> - Guide for CHKROOTKIT and AIDE.
* <nowiki>[[http://la-samhna.de/samhain/]]</nowiki> - Samhain home page.
* <nowiki>[[http://mdcc.cx/systraq/]]</nowiki> - Systraq home page.

----
CategorySecurity
