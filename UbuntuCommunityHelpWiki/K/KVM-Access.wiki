{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__



== Direct terminal access via Serial Console ==

It is possible to access a KVM Guest directly using the Serial Console interface, in which case setting up bridged networking, SSH, and similar is not necessary. Access via the Serial Console provides an alternate way of accessing your servers to compliment or replace the default VNC access.

This is done using the <nowiki>[[http://linux.die.net/man/1/virsh|virsh]]</nowiki> utility which is a shell interface for <nowiki>[[http://libvirt.org/|libvirt]]</nowiki>.

=== Define a console device for the Guest ===

Check whether a console device had been defined:
<pre>
virsh ttyconsole my_vm
</pre>
If the output is shown(e.g. /dev/pts/41), it indicates the Guest has a console device already.

Otherwise, define one with <code>virsh edit</code>. Here is an example to be added inside <device></device>. Refer to <nowiki>[[http://libvirt.org/formatdomain.html#elementsConsole|libvirt XML format]]</nowiki> for details.
<pre>
<console type='pty'>
  <target port='0'/>
</console>
</pre>

=== Configure a Serial Console in the Guest ===

First, we need to configure a serial console in the guest, in order that it will accept a connection:

If the version of your guest Ubuntu OS is 15.04 (Vivid) or later, run the following systemctl commands to enable the serial console:

<pre>
systemctl enable serial-getty@ttyS0.service
systemctl start serial-getty@ttyS0.service
</pre>

-----

The following configuration method works for (guest) Ubuntu 9.10 (Karmic) until Ubuntu 14.10 (Utopic):

<pre>
sudo editor /etc/init/ttyS0.conf
</pre>
Add the configuration:
<pre>

start on stopped rc RUNLEVEL=[2345]
stop on runlevel [!2345]

respawn
exec /sbin/getty -L 115200 ttyS0 xterm
</pre>
Run the following command to initiate the Serial Console (or restart the VM):
<pre>
sudo start ttyS0
</pre>
Here we are using "xterm" as the terminal type, which works well if we are connecting using a gnome-terminal (or xterm) instance.
It is likely preferable to set this to match the terminal type which will be used to connect. This can be found using this command in the '''host/client''' terminal you will be using to connect:
<pre>
echo $TERM
</pre>
For example, if you are running screen it is "screen", for byobu "screen-bce", etc.

You can also set the variable temporarily when you are '''already connected''' to the console:
<pre>
export TERM=screen
</pre>

-----

If you are using an earlier version of Ubuntu see SerialConsoleHowto for instructions.

=== Connect using virsh ===

First we connect to the (local) qemu session:
<pre>
virsh -c qemu:///session
</pre>
Now in the virsh shell, start the virtual machine:
<pre>
start my_vm
</pre>
When it has started connect to the console:
<pre>
console my_vm
</pre>
Press Return to get the login prompt, and login as usual (note that username input works even if the login promt is not shown).

You're in!

=== Misc notes ===

Use Ctrl + ] to exit the console.

If the console acts strangely or displays incorrectly, check that the TERM variable is set correctly (see above).

If the terminal seems to cut off the top of the output, change it to have 80x24 of '''viewing area''', e.g. in byobu this means you will need to account for the statusbar and have the window itself at 80x26

This page seems to be missing part of the procedure for console access. The instructions do not include configuring the host machine for serial access. You may need to search google if you see "No console available for domain".

----
CategoryVirtualization
