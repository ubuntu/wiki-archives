{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

=== Introduction ===

If you experience jumpy DVD playback, slow CD ripping, or a general slow down when accessing optical drive(s) it may be because DMA is not enabled. DMA, or Direct Memory Access, lets hard drives and CD/DVD drives access the system memory.

Ubuntu 6.06 (Dapper Drake) has DMA '''automatically''' enabled for drives that support it.

<nowiki>[[File:IconsPage/warning.png]]</nowiki> '''Warning:''' Enabling DMA can be dangerous in some cases. Usually issues are directly related to faulty hardware, poorly written drivers, or using settings that are unsupported by your system. 

'''USING HDPARM INCORRECTLY CAN CAUSE MAJOR DATA CORRUPTION AND/OR LOSS. Most systems since 2002 support DMA.'''

=== Finding your CD/DVD player ===

With a disk in the drive, issue the command `mount | egrep 'udf|iso9660'` and you should see a line like

<pre>
/dev/scd0 on /media/cdrom0 type udf (ro,nosuid,nodev,utf8,user=you)
</pre>

This shows the device and where it is mounted in the file system.  In this case, the device is `/dev/scd0` which indicates you should skip down to the "ATAPI" section.

If the device has a name like `/dev/hdc` you can continue reading the `hdparm` section.

=== Enabling DMA with `hdparm` ===

To enable DMA, you need to use the <code>hdparm</code> command and the configuration file <code>hdparm.conf</code>. 

These instructions assume that you are trying to enable DMA on `hdc`, usually the CD-rom drive.

 1. See the what the settings are on `/dev/hdc`
   <pre>
   sudo hdparm /dev/hdc
   }}}
# If you get a line like <code> using_dma    =  1 (on)</code>, DMA is already enabled. Skip to step 4 to see if it has been enabled at boot time.
# Enable DMA on `/dev/hdc`
   {{{
   sudo hdparm -d1 /dev/hdc
   }}}
 1. You have now enabled DMA for the drive. However, in order for the settings to be automatically applied at boot there you need to edit the <code>/etc/hdparm.conf</code> script. To do this use this command: <code>gksudo gedit /etc/hdparm.conf</code>

Add the following to the end of your hdparm.conf
{{{
/dev/hdc {
dma = on
}
</pre>

(another way of avoiding editing of the hdparm.conf file is to simply run <code>sudo hdparm -d1 -k1 /dev/hdc</code> to keep the DMA flag).

=== ATAPI DVD drives ===
If you have an ATAPI DVD drive on a later (>=8.4) version of Ubuntu it is likely to be treated as a virtual SCSI device. DMA is generally turned on by default, but sometimes the generic ATA module doesn't work. If this is the case you see the following symptom when typing:
{{{ 
dmesg | grep ata
}}}
One of the lines will be:
<pre>
ata2.00: simplex DMA is claimed by other device, disabling DMA
</pre>

If this is the case type the following:
<pre>
sudo gedit /etc/modprobe.d/aliases
</pre>

And add the following lines to the bottom of the file:
<pre>
alias ata_generic off
alias pata_atiixp on
</pre>

Reboot and DMA should work. You can verify this by typing:
<pre>
dmesg | grep ata
</pre>

Two of the lines will resemble this:
<pre>
[   23.937141] ata2.00: ATAPI: MATSHITAUJ-845D, D100, max UDMA/33
[   24.108846] ata2.00: configured for UDMA/33
</pre>

=== Troubleshooting ===

If your drives are configured in [Cable Select] mode and while running `hdparm` commands you receive errors related to timeouts or drive not ready, try changing the drive to be a master or slave device depending on your system configuration. This does require opening the case and as far as I know most drives are set to Cable Select from the manufacturer.

Sometimes step 3 above can fail with an "Operation Not Permitted" message. You can fix this by editing the file /etc/modules:
For an Intel CPU put the lines
<pre>
piix
ide-core
</pre>
above the line
<code>ide-cd</code>

For an AMD CPU put the line
<code>amd74xx</code>
above
<code>ide-cd</code>

For a VIA Chipset put
<code>via82cxxx</code>
above
<code>ide-cd</code>

Then reboot and try steps 3-4 again....

If the problem still persists, and you're using a SATA hard drive, then the SATA module has to be loaded first before the ide-cd. Add <code>sata_sil </code> to the beginning of your /etc/modules file then reboot.

=== Further reading ===

The hdparm has further options that may be more risky. They can be seen using the <code>man hdparm</code> command in the terminal.

For a detailed description of DMA visit the IEEE 
http://standards.ieee.org/reading/ieee/std_public/description/busarch/1212.1-1993_desc.html

IDE, EIDE and UDMA http://www.spcug.org/reviews/bl0108.htm

----
