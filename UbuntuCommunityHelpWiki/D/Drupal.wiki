{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==

<nowiki>[[http://drupal.org|Drupal]]</nowiki> is a robust Content Management System that runs on a LAMP server. The LAMP server uses MySQL by default, but PostgreSQL can also be used with Drupal.

It can host blogs, forums, and a variety of other content. It has a huge selection of add-ons <nowiki>[[http://drupal.org/project/Modules|modules]]</nowiki> for other functionality, such as advertising, chatbox, e-commerce, multimedia tools, instant messenger, customer relationship management, printer-friendly pages, and web-cams.

Recent releases of Ubuntu include both Drupal6 and Drupal7 in the repositories, which are the only two supported releases of Drupal. Please <nowiki>[[http://drupal.org/documentation/version-info|read this]]</nowiki> if you need help choosing a Drupal version.

Accessory Drupal add-ons <nowiki>[[http://drupal.org/project/Modules|modules]]</nowiki> are not included in the Ubuntu packages however and must be installed manually after initial installation.

Please refer to the <nowiki>[[http://drupal.org/documentation/install|Drupal installation guide]]</nowiki> for more advanced hosting features.

== LAMP server installation ==

Use <nowiki>[[InstallingSoftware| any method]]</nowiki> to install the LAMP stack packages. Visit <nowiki>[[ApacheMySQLPHP|Apache PHP MySQL]]</nowiki> for more information on LAMP.

=== Easy LAMP server installation ===

The easiest method is to use a single command from the command-line terminal, which installs the entire LAMP stack in an integrated package:

<pre>
sudo tasksel install lamp-server
</pre>

If your system doesn't provide the tasksel command, then install it:

<pre>
sudo apt-get install tasksel
</pre>

I also (optionally) recommend enabling the rewrite functions of Apache2, which helps with many modules in Drupal and with the correct redirection of web-pages on your Apache server:

Edit the file "/etc/apache2/sites-available/default" and replace every occurrence of "AllowOverride none" with "AllowOverride All", then run:

<pre>
sudo nano /etc/apache2/sites-available/default
</pre>

<pre>
sudo a2enmod rewrite
sudo service apache2 restart
</pre>

== Drupal Installation ==

Note: The two methods listed below are not compatible. The Ubuntu package (from the repositories) installs Drupal6 in different directories from the manual method. Choose one method or the other, but do not attempt to use both. You cannot switch back and forth between the two methods.

=== Install Drupal package from the Ubuntu repositories ===
You can choose whether to install Drupal6 or Drupal7 from the repositories. As always, repository version are not the most current versions, but they can be updated easily.
<pre>
sudo apt-get install drupal6
</pre>

or

<pre>
sudo apt-get install drupal7
</pre>

Allow dbconfig-common to configure your database (by default: MySQL)

Then, register the Drupal module with Apache:

<pre>
sudo cp /etc/drupal/6/apache2.conf /etc/apache2/mods-enabled/drupal.conf
</pre>

or

<pre>
sudo cp /etc/drupal/7/apache2.conf /etc/apache2/mods-enabled/drupal.conf
</pre>

Finally, restart Apache:

<pre>
sudo service apache2 restart
</pre>

=== Manual installation of Drupal ===
The following instructions are for version 7.25 of the Drupal 7 branch, which was the most current version at the time of writing. (A similar method can be used for the most current version of Drupal  6). This installation does not install Drupal in directories that are compatible with the repository packages.

<pre>
wget http://ftp.drupal.org/files/projects/drupal-7.25.tar.gz
tar -xvzf drupal-7.25.tar.gz
sudo mkdir /var/www/drupal
sudo mv drupal-7.25/* drupal-7.25/.htaccess drupal-7.25/.gitignore /var/www/drupal
</pre>

It is required to create a ''files'' subdirectory in your drupal default site installation directory.  It will be used for files such as custom logos, user avatars, and other media associated with your new site.

<pre>
sudo mkdir /var/www/drupal/sites/default/files
sudo chown www-data:www-data /var/www/drupal/sites/default/files
</pre>

It is also required to create the initial configuration file for the default site.

<pre>
sudo cp /var/www/drupal/sites/default/default.settings.php /var/www/drupal/sites/default/settings.php
sudo chown www-data:www-data /var/www/drupal/sites/default/settings.php
</pre>

==== Manually configure the MySQL database for Drupal ====

You need to create a MySQL drupal database and then load the database schema into it.  You can do this with <nowiki>[[https://help.ubuntu.com/community/phpMyAdmin|phpMyAdmin]]</nowiki> or via the command line:

<pre>
mysqladmin -u root -p create drupal
</pre>

Where ''drupal'' is the name you picked for the mysql database that Drupal will use.  You can call it anything you want.

<pre>
mysql -u root -p

mysql> GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES ON drupal.* TO 'drupaluser'@'localhost' IDENTIFIED BY 'drupalpass';
</pre>

You do not want to have Drupal use the mysql root user to access the database.  The above command creates a mysql user (other than the mysql root user) with some priviledges to use the ''drupal'' database.  You should pick something different than ''drupaluser'' and ''drupalpass''.  If the command was successful, activate the new permissions:

<pre>
mysql> FLUSH PRIVILEGES;
</pre>

Quit the mysql prompt:

<pre>
mysql> \q
</pre>

==== Manually configure the PostgreSQL database for Drupal ====
Edit the /var/www/drupal/sites/default/settings.php file so that Drupal can know what user, password and database to use.

<pre>
sudo nano /var/www/drupal/sites/default/settings.php
</pre>

<pre>
* Database URL format:
	$db_url = 'pgsql://username:password@localhost/databasename';
	where username = drupaluser  password = drupaluserpass databasename = drupaldb
</pre>

==== Reload Apache ====

Finally, reload Apache2.

<pre>
sudo service apache2 restart
</pre>

=== Complete the Drupal Installation through a Browser ===

Finally, point your browser to <nowiki>[[http://localhost/drupal/install.php]]</nowiki> (or perhaps <nowiki>[[http://localhost/drupal6/install.php]]</nowiki> or <nowiki>[[http://localhost/drupal7/install.php]]</nowiki> if you installed the package from the official repository), create an account, login, and follow the installation instructions to finish loading the database and configuring the site.

<nowiki>[[File:drupal.jpg]]</nowiki>

The first account will automatically become the main administrator account with total control.

<nowiki>[[File:drupal1.jpg]]</nowiki>

== Issues specific to Drupal 7 ==
When installing Drupal 7 on a local machine you may encounter problems with installing "Modules" and Themes", with "Email authentication" and also with "cron" maintenance jobs.

=== Adding modules ===

<nowiki>[[http://drupal.org/documentation/install/modules-themes/modules-7|Howto Install Modules]]</nowiki> 
When trying to install a module this error may be displayed 
<pre>
"WARNING: You are not using an encrypted connection, so your password will be sent in plain text. Learn more." 

"To continue, provide your server connection details"
</pre>
The warning message is a bit misleading, The problem is write access to directory's on the web server.

==== Write Access ====
If you not to worried about security then changing write access is the quick method

When the user is www-data:
<pre>
sudo chown www-data:www-data -R /var/www/drupal/sites
</pre>

==== Command Line ====
From a security point of view it appears that the preferred method is to manually install modules over SSH with command line. This method will be slower but more secure. see <nowiki>[[http://drupal.org/documentation/install/modules-themes/modules-7|Install Modules]]</nowiki> 

Example:
Install ''Wysiwyg''
<pre>
wget http://ftp.drupal.org/files/projects/wysiwyg-7.x-2.1.tar.gz
tar -xvzf wysiwyg-7.x-2.1.tar.gz
sudo mkdir -p /var/www/drupal/sites/all/modules/wysiwyg
sudo mv wysiwyg/*  /var/www/drupal/sites/all/modules/wysiwyg
</pre>
Wysiwvg requires a client-side editors, for CKEditor run the following
<pre>
wget http://download.cksource.com/CKEditor/CKEditor/CKEditor%203.6.1/ckeditor_3.6.1.tar.gz
tar -xvzf ckeditor_3.6.1.tar.gz
sudo mkdir -p /var/www/drupal/sites/all/libraries/ckeditor
sudo mv ckeditor/*  /var/www/drupal/sites/all/libraries/ckeditor
</pre>

=== Email Authentication ===
For email authentication the server email may need to be set-up. This example routes the mail through GMail SMTP servers. Make sure you have a gmail account setup with POP/IMAP enabled.

<pre>
sudo apt-get install exim4
</pre>
<pre>
sudo dpkg-reconfigure exim4-config
</pre>

* Choose '''mail sent by smarthost; received via SMTP or fetchmail'''
* Type System Mail Name: e.g. '''company.com''' (Any name will do)
* Type IP Adresses to listen on for incoming SMTP connections: '''127.0.0.1'''
* Leave Other destinations for which mail is accepted ''blank''
* Leave Machines to relay mail for: ''blank''
* Type Machine handling outgoing mail for this host (smarthost): '''smtp.gmail.com::587'''
* Choose '''NO''', don’t hide local mail name in outgoing mail.
* Chose '''NO''', don’t keep number of DNS-queries minimal (Dial-on-Demand).
* Choose '''mbox'''
* Choose '''YES''', split configuration into small files
* Mail for postmaster. Leaving blank will not cause any problems though it is not recommended

<pre>
sudo nano /etc/exim4/passwd.client
</pre>
And add the following lines, substituting yourAccountName and y0uRpaSsw0RD as appropriate
<pre>
gmail-smtp.l.google.com:yourAccountName@gmail.com:y0uRpaSsw0RD 
* .google.com:yourAccountName@gmail.com:y0uRpaSsw0RD
smtp.gmail.com:yourAccountName@gmail.com:y0uRpaSsw0RD
</pre>

Finally for all versions of Debian, run 
<pre>
sudo update-exim4.conf
</pre>

<pre>
sudo /etc/init.d/exim4 restart
</pre>

That should be it. You can test by using the command line mail client.
* Run 
<pre>
mail user@example.com
</pre>
* Give a subject and press enter
* Type something and press enter
* Type a single . (dot) and press enter
* Press enter for a blank CC:

=== "Cron" maintenance jobs ===
The URL of the <code>cron.php</code> page requires a "cron key" which is automatically generated during installation. The full URL of the page, with the cron key, is available in the "Cron maintenance tasks" section of the Status report page at Administration > Reports > Status
report.

If you installed the package from the official repository, add the cron key from the report above to the $cron_key variable in site's <code>settings.php</code> or in <code>cronkey.php</code> under <code>/etc/drupal/7/sites/default</code>.

Look at
<pre>
/etc/cron.d/drupal7
</pre>
and
<pre>
/usr/share/drupal7/scripts/cron.sh
</pre>
to see how things work.

If the "cron key" is not properly configured, warnings will be emailed to <code>www-data</code> user. You can read them with:
<pre>
mail -f /var/mail/www-data
</pre>

== Optional settings ==
=== Clean URLs ===
To get <nowiki>[[http://drupal.org/node/15365|Clean URLs]]</nowiki> working, you need to uncomment and change the value of RewriteBase in the htaccess file in your drupal folder to '/drupal':

Modify the RewriteBase if you are using Drupal in a subdirectory or in a VirtualDocumentRoot and the rewrite rules are not working properly. For example if your site is at http://example.com/drupal uncomment and modify the following line:
<pre>
sudo nano /var/www/drupal/.htaccess
</pre>
<pre>
## RewriteBase /drupal
</pre>
to
<pre>
    RewriteBase /drupal
</pre>
or maybe (configuration dependant)
<pre>
sudo sed -i 's/# RewriteBase \/drupal/ RewriteBase \/drupal6/' /etc/drupal/6/htaccess
</pre>

=== Adjust PHP memory limit ===
You should increase the default PHP memory limit value (the amount of memory dedicated to running scripts), since the default 8 MB is not sufficient. Use 96 MB (or even 160M) if you intend to use graphics (although for simple uses 32 MB may be sufficient).

In newer versions of Drupal6, you can simply edit the settings.php file and add the line:
<pre>
ini_set('memory_limit', '96M');
</pre>

In older versions of Drupal5, or if using PHP for many different uses, it is best to increase the amount of PHP memory using this method:

Edit the /etc/php5/apache2/php.ini file and increase the memory_limit value to 96M (or another value of your choice).

If using PostgreSQL, you can also edit the /etc/php5/apache2/php.ini file to accommodate PostgreSQL options by adding the line:

<pre>
extensions=pgsql.so;
</pre>

=== Adjust PHP Error Reporting ===
An adjustment to the error reporting is required for the install.php page to come up properly.  Edit your settings.php file (e.g., /etc/drupal/6/sites/default/settings.php) and add the following ini_set line after the existing ini_set lines:
<pre>
ini_set('error_reporting',          4096);
</pre>

This is based upon the recommendations from the drupal.org forms:  http://drupal.org/node/514334#comment-1912924

=== Adjust PHP extensions (Drupal 7 only) ===

Drupal 7 will only support MySQL 5.0.15 or higher, and requires the PDO database extension for PHP.
The PHP extension for connecting to your chosen database must be installed and enabled. Drupal's currently supported database connectors are: mysql  (the original MySQL extension), mysqli  (an improved connector for newer MySQL installations), and pgsql  (for PostgreSQL). Note: PHP 5.x no longer enables the mysql extension by default. Please read the links above for installing and enabling your chosen connector. Additionally, Drupal 6.x does not provide the option to select the mysql connector if mysqli is enabled in your PHP configuration.
<pre>
sudo apt-get install php5-gd
</pre>
For more details see http://drupal.org/requirements

== Other Resources ==
* <nowiki>[[http://ubuntuguide.org/wiki/Drupal7_tips|Ubuntuguide Drupal tips]]</nowiki> -- installation tips for installing Drupal 7 in Ubuntu. Includes advanced configuration options.

* <nowiki>[[http://ubuntuguide.org/wiki/Kubuntu_Trusty|Ubuntuguide for Kubuntu]]</nowiki> -- general guide for Kubuntu

== TurnKey Drupal Appliance ==

Some users may prefer to skip manual installation by using the unofficial pre-integrated <nowiki>[[http://www.turnkeylinux.org/drupal6|TurnKey Drupal Appliance]]</nowiki> based on Ubuntu LTS.

== Drubuntu minimal cd ==

If you like to use a premade ubuntu user thatis still under development and made for Drupal beginners and Drupal Pros you could try <nowiki>[[http://www.drubuntu.info|Drubuntu]]</nowiki> This includes Drupal 7 currently.

----
CategoryInternet CategoryDevelopment CategoryScience
