{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

Danbooru is a powerful image board system which uses tagging extensively.

It is built on RubyOnRails.

This HOWTO explains how to install it on Ubuntu and other Debian-like distros; it has been tested with Ubuntu 6.06 and Ubuntu Feisty.

==== Prerequisites ====

Install this and more.
There used to be a more complete list on the wiki, most of which I had already installed. Additions are welcome.

Note: Ensure that you have the Universe repository enabled in your /etc/sources.list. See <nowiki>[[https://wiki.ubuntu.com/AddingRepositoriesHowto]]</nowiki>.

<pre>
sudo apt-get install rails postgresql-8.1 postgresql-8.1-plruby rubygems libgd2-xpm-dev
sudo gem install diff-lcs acts_as_versioned
</pre>

==== Get the source ====
<pre>
svn co svn://donmai.us/danbooru/trunk danbooru
cd danbooru
</pre>

Tell it where rails is installed system-wide
<pre>
ln -sf /usr/share/rails vendor/
</pre>

Rebuild the image resizer binary.
<pre>
rm -f lib/resizer/resizer
make -C lib/resizer resizer
</pre>

==== Set up the database ====
Create a self-contained postgresql runtime
<pre>
export PATH=$PATH:/usr/lib/postgresql/8.1/bin
export LOCAL_DB=$PWD/var-db
export PGDATA=$LOCAL_DB/data
initdb
export PGHOST=$LOCAL_DB
pg_ctl -w -l $LOCAL_DB/server.log start -o "-c listen_addresses= -c unix_socket_directory=$LOCAL_DB"
for i in dev test prod; do createdb danbooru-$i; done
createuser -sDR danbooru-dbuser
</pre>

Load a schema into the DB - I had some errors, but it still worked.

For a real life example, use the schema recently published on http://mapored.net/dump.db.bz2
<pre>
psql danbooru-dev danbooru-dbuser -f db/postgres.sql 
</pre>

Optionally, play around with your new database
<pre>
psql danbooru-dev danbooru-dbuser
</pre>

Stop the database
<pre>
LOCAL_DB=~+/var-db eval 'PGDATA=$LOCAL_DB/data /usr/lib/postgresql/8.1/bin/pg_ctl -w stop'
</pre>

Write a DB config file for RubyOnRails
<pre>
cat <<EOF > config/database.yml
common: &common
  adapter: postgresql
  host: $PGHOST
  username: danbooru-dbuser

development:
  database: danbooru-dev
  <<: *common

test:
  database: danbooru-test
  <<: *common

production:
  database: danbooru-prod
  <<: *common
EOF
</pre>

==== Setup the website, and test it ====
Edit the website settings

You will probably change the e-mail address and the server address, where image and previews are found.

<pre>
cp config/config_local.yml{.example,}
sensible-editor config/config_local.yml
</pre>

Run a few tests. Don't run just «rake» right now, you won't get meaningful error messages. First test with a specific target like test:functionals
<pre>
rake test:functionals 
rake
</pre>

==== Start a server ====

Start a database
<pre>
LOCAL_DB=~+/var-db eval 'PGHOST=$LOCAL_DB PGDATA=$LOCAL_DB/data /usr/lib/postgresql/8.1/bin/pg_ctl -w -l $LOCAL_DB/server.log start -o "-c listen_addresses= -c unix_socket_directory=$LOCAL_DB"'
</pre>

Start a local web server until you type Ctrl-C
<pre>
ruby script/server
</pre>

Visit it, create the first user (who automagically becomes admin)
<pre>
sensible-browser http://localhost:3000
</pre>

Enjoy your danbooru!
