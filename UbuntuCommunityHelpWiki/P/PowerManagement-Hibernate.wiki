{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

{| class="wikitable"
|-
| <tablestyle="float:right; font-size: 0.9em; width:40%; background:#F1F1ED; margin: 0 0 1em 1em;" style="padding:0.5em;"><<BR>>
|}

== Introduction ==

Hibernation is a function allowing one to save the current state of their computer to the hard drive, with the computer completely powering down. When the computer is subsequently powered back on, the prior state is restored as if one had not powered down at all. Having hibernation available is a preferred benefit for many reasons:
* For travelers who want the convenience of saving their last computer session, without risking hardware damage when putting either a still running, or suspended computer into a travel bag.
* For those who do not want to setup complicated rules for opening up programs upon first start.
* Better power savings in comparison to suspending or leaving the computer on overnight, or when one goes home for the day.

There are three methods of hibernation:
* '''kernel''' (aka suspend or swsusp): The linux kernel includes built-in support for hibernation. This method is triggered by modifying <code>/sys/power/state</code>.   
* '''uswsusp''': uswsusp is a rewrite of swsusp that does not rely on the kernel. Thus, uswsusp is a "userspace" tool because it is run entirely as a program separate from the kernel. It can be used by installing the package <code>uswsusp</code> and running <code>sudo s2disk</code>. This is reported to work in many situations where swsusp does not. It also supports encryption and compression for hibernation.
* '''!TuxOnIce''' (formerly suspend2): <nowiki>[[http://www.tuxonice.net|TuxOnIce]]</nowiki> has more features and works with more hardware than the other two. Unfortunately, it requires building and patching your own kernel.

Here is a <nowiki>[[http://www.tuxonice.net/features|comparison table]]</nowiki> of the various hibernation methods. The general impression is that swsusp was first, so is in the main kernel trunk, uswsusp is userspace based, while TuxOnIce is not integrated into the kernel. There is a <nowiki>[[http://kerneltrap.org/node/6766/196022|discussion between the authors]]</nowiki>, in that although many users greatly prefer TuxOnIce when they try it out ('it just works'), it has yet to be merged into the kernel.

== swsusp ==

In Ubuntu, the default method of hibernation is to use swsusp which is built into the kernel. Gnome and pm-utils will use this method unless configured otherwise. 

The way you manually trigger hibernation using this 'kernel' method is to write 'disk' to <code>/sys/power/state</code>. There are two modes of 'kernel' hibernation: platform and shutdown. If one does not work, you can try the other:

<pre>
sudo -s
echo platform > /sys/power/disk
echo disk > /sys/power/state
</pre>

Or:

<pre>
sudo -s
echo shutdown > /sys/power/disk
echo disk > /sys/power/state
</pre>

Platform is the default and recommended mode of hibernation. Unfortunately, the "platform" mode of hibernation does not work on some systems with a broken BIOS. In such cases the "shutdown" mode of hibernation might work.

=== swsusp Troubleshooting ===

'''Problem''': ''The computer goes to hibernate ok. But after power-on it is loading as if no hibernate state was saved.''

'''Solution''' based on <nowiki>[[https://answers.launchpad.net/ubuntu/+question/111511|launchpad answer]]</nowiki> - add resume parameter to kernel boot options.

In the case of grub2:
* open <code>/etc/default/grub</code>
* find <code>GRUB_CMDLINE_LINUX_DEFAULT=</code> line - these are the option added to the regular boot menu choices
* add the <code>resume=/dev/sda6</code> option to the list (with correct swap partition path) like this:

Before:
<pre>
GRUB_CMDLINE_LINUX_DEFAULT="nosplash enable_mtrr_cleanup=1"
</pre>

After:
<pre>
GRUB_CMDLINE_LINUX_DEFAULT="nosplash enable_mtrr_cleanup=1 resume=/dev/sda6"
</pre>
* save file
* in the terminal execute command (to actually enable the new configuration settings)
<pre>
sudo update-grub2
</pre>

== uswsusp ==

The package <code>uswsusp</code> (for Userspace Software Suspend) includes an executable called <code>s2disk</code>. This program is an alternate method of hibernation. In general, <code>s2disk</code> should not be called directly, but it can useful to do so for testing. Typically, the program <code>pm-hibernate</code> is responsible for calling <code>s2disk</code>.

The <code>s2disk</code> program does the following in order to hibernate the machine:

1. Tell the kernel to create a snapshot of the current system state.
2. Read the snapshot data from the kernel and write it to the swap partition, possibly encrypting and compressing the data.
3. Power off the machine.

When next you power up, the reverse happens: 

1. After a basic system boot, but before mounting any partitions, <code>resume</code> runs from the initrd.
2. The snapshot data from the swap partition is read (and possibly decrypted and decompressed).
3. <code>resume</code> tells the kernel to restore the snapshot.
4. the kernel returns at the place it was before the hibernation.

To install <code>s2disk</code>:

<pre>
sudo apt-get install uswsusp
</pre>

It is not generally useful to trigger <code>s2disk</code> manually, unless you are debugging. For example:

<pre>
sudo tail -f /var/log/pm-suspend.log &
sudo s2disk
</pre>

When you run <code>s2disk</code> manually like this, it is likely that when you restore a lot of your devices will not be working. 

To change your uswsusp settings:

<pre>
sudo dpkg-reconfigure uswsusp
</pre>

Alternately, you can edit <code>/etc/uswsusp.conf</code> manually.

=== Integrating uswsusp with pm-utils ===

Currently, installing s2disk does not actually make it so that it is used by gnome or pm-utils. To do so, edit ''/etc/pm/config.d/00sleep_module'' and change the value of SLEEP_MODULE:

<pre>
SLEEP_MODULE="uswsusp"
</pre>

Then, to test, you can run this:

<pre>
sudo tail -f /var/log/pm-suspend.log &
sudo pm-hibernate
</pre>

<code>pm-hibernate</code> (part of pm-utils) is the preferred way to run <code>s2disk</code>. By default, when you choose hibernate from within gnome, the command <code>pm-hibernate</code> will get called.

=== uswsusp Troubleshooting ===

* I have encryption configured and when I resume the wrong term is open. To get to the password prompt, I have to hit Alt-1.

=== See Also ===

* <nowiki>[[http://en.opensuse.org/S2disk|OpenSUSE s2disk page]]</nowiki>

== TuxOnIce ==

1. <nowiki>[[https://launchpad.net/ubuntu/+source/tuxonice-userui|tuxonice-userui]]</nowiki>
2. <nowiki>[[https://launchpad.net/~tuxonice/+archive/ppa|PPA Available]]</nowiki>
3. Enable TuxOnIce kernel image in GRUB2 menu and select it when booting (grub-customizer is a good tool).

== Troubleshooting ==

For swsusp please see this part of this page
* https://help.ubuntu.com/community/PowerManagement/Hiberate#swsusp%20Troubleshooting
For uswsusp please see this part
* https://help.ubuntu.com/community/PowerManagement/Hiberate#uswsusp%20Troubleshooting

=== Hibernate Disabled by Default ===

Certain laptops have hibernate greyed out in the menu by default. For more on this please see
<nowiki>[[https://bugs.launchpad.net/ubuntu/+source/policykit-desktop-privileges/+bug/812394|bug 812394|target="https://bugs.launchpad.net/ubuntu/+source/policykit-desktop-privileges/+bug/812394"]]</nowiki>.

* 13.04 and below: To activate hibernate in Ubuntu or Xubuntu due to this, please see <nowiki>[[https://help.ubuntu.com/12.04/ubuntu-help/power-hibernate.html|the official documentation|target="https://help.ubuntu.com/12.04/ubuntu-help/power-hibernate.html"]]</nowiki>.
* 13.10: In Xubuntu, one will want to install pm-utils, and hibernate via a terminal (as the above doesn't enable the GUI option):<<BR>>sudo pm-hibernate<<BR>>
* 14.04: To activate hibernate in Ubuntu 14.04 read on <nowiki>[[https://help.ubuntu.com/14.04/ubuntu-help/power-hibernate.html|the official documentation|target="https://help.ubuntu.com/14.04/ubuntu-help/power-hibernate.html"]]</nowiki>

== Links ==

* <nowiki>[[https://www.kernel.org/doc/Documentation/power/basic-pm-debugging.txt|Kernel notes on debugging hibernation]]</nowiki>
* <nowiki>[[https://wiki.debian.org/Hibernation|Debian Hibernation Wiki Page]]</nowiki>
* Suspend2Kernel - building a kernel in ubuntu that supported !TuxOnIce
* <nowiki>[[http://www.ubuntugeek.com/how-to-install-tuxonice-in-ubuntu.html|How to install TuxOnIce for Ubuntu]]</nowiki>
