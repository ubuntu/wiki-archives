{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


A ''chroot'' is a way of isolating applications from the rest of your computer, by putting them in a ''jail''. This is particularly useful if you are testing an application which could potentially alter important system files, or which may be insecure.

This document explains the basic concepts surrounding the use of a ''chroot'' and provides instructions for getting a basic chroot up and running.

=== Basic Concepts ===

A chroot is basically a special directory on your computer which prevents applications, if run from inside that directory, from accessing files outside the directory. In many ways, a chroot is like installing another operating system inside your existing operating system.

Technically-speaking, chroot temporarily changes the root directory (which is normally ''/'') to the chroot directory (for example, ''/var/chroot''). As the root directory is the top of the filesystem hierarchy, applications are unable to access directories ''higher up'' than the root directory, and so are isolated from the rest of the system. This prevents applications inside the chroot from interfering with files elsewhere on your computer.

Note that it is possible for software from outside the chroot to access files inside the chroot.

See <nowiki>[[http://en.wikipedia.org/wiki/Chroot|Wikipedia - chroot]]</nowiki> for more information.

=== Uses of chroots ===

The following are some possible uses of chroots:

* Isolating insecure and unstable applications
* Running 32-bit applications on 64-bit systems
* Testing new packages before installing them on the production system
* Running older versions of applications on more modern versions of Ubuntu
* Building new packages, allowing careful control over the dependency packages which are installed

=== Creating a chroot ===

This section provides instructions on creating a basic chroot. For more advanced chroots, see <nowiki>[[DebootstrapChroot|Debootstrap Chroot]]</nowiki>.

# Install the <code>schroot</code> and <code>debootstrap</code> packages.
# As an administrator (i.e. using <code>sudo</code>), create a new directory for the chroot. In this procedure, the directory <code>/var/chroot</code> will be used.  To do this, type <code>sudo mkdir /var/chroot</code> into a command line.
# As an administrator, open <code>/etc/schroot/schroot.conf</code> in a text editor.  Type <code>cd /etc/schroot</code>, followed by <code>gksu gedit schroot.conf</code>.  This will allow you to edit the file.
# Add the following lines into <code>schroot.conf</code> and then save and close the file. Replace ''your_username'' with your username.
<pre>
[lucid]
description=Ubuntu Lucid
location=/var/chroot
priority=3
users=your_username
groups=sbuild
root-groups=root
</pre>
1. Open a terminal and type:
<pre>
sudo debootstrap --variant=buildd --arch i386 lucid /var/chroot/ http://mirror.url.com/ubuntu/
</pre>
 This will create a basic 'installation' of Ubuntu 10.04 (Lucid Lynx) in the chroot. It may take a while for the packages to be downloaded.

 '''Note:''' You can replace <code>lucid</code> with the Ubuntu version of your choice.

 '''Note:''' You ''must'' change the above '''mirror.url.com''' with the URL of a valid <nowiki>[[https://launchpad.net/ubuntu/+archivemirrors|archive mirror]]</nowiki> local to you.

1.#6 A basic chroot should now have been created. Type <code>sudo chroot /var/chroot</code> to change to a root shell inside the chroot.

=== Setting-up the chroot ===

There are some basic steps you can take to set-up the chroot, providing facilities such as DNS resolution and access to ''/proc''.

'''Note:''' Type these commands in a shell which is ''outside'' the chroot.

1. Type the following to mount the ''/proc'' filesystem in the chroot (required for managing processes):
<pre>
sudo mount -o bind /proc /var/chroot/proc
</pre>
1. Type the following to allow DNS resolution from within the chroot (required for Internet access):
<pre>
sudo cp /etc/resolv.conf /var/chroot/etc/resolv.conf
</pre>

Very few packages are installed by default in a chroot (even <code>sudo</code> isn't installed). Use <code>apt-get install package_name</code> to install packages.

See <nowiki>[[DebootstrapChroot|Debootstrap Chroot]]</nowiki> and <nowiki>[[http://wiki.mandriva.com/en/Development/Howto/Chroot|Installing Mandriva Linux in a Chroot]]</nowiki> for more advanced set-up instructions.

=== Accessing graphical applications inside the chroot ===

You can run graphical applications within a chroot, but you need to provide an X server for them to run in first. The easiest way to do this is to set the display of the chroot system to be identical to the root display of your system's main X server and provide access to it.

In other words, in the chroot shell type 
<pre>
export DISPLAY=:0.0
</pre>

And in the system shell type

<pre>
xhost +
</pre>

Any X command you type will now get its own window as you're used to, but as it is running inside the chroot jail it will not be able to see your normal file system.

You don't have to enter the chroot shell to access its commands. Suppose you want to run Firefox in a chroot jail in order to avoid security problems with signed Java applets and other components which otherwise would have access to your personal files. You can do this by running the command

<pre>
gksudo chroot /var/chroot firefox -DISPLAY=:0.0
</pre>

This command can also be invoked from the menu, or a panel applet or desktop shortcut.

If you want the chroot to have its own display, you need to create this display with the Xnest command. Perform the following instructions ''outside'' the chroot:

# Install the <code>xhost</code> and <code>xnest</code> packages.
# Ensure that ''/proc'' is mounted and DNS resolution is set-up within the chroot (see above).
# Type the following into a Terminal:
<pre>
Xnest -ac :1
</pre>
 A blank Xnest window should appear.
1.#4 Open another Terminal and type the following to enter the chroot:
<pre>
sudo chroot /var/chroot
</pre>
1. While in the chroot shell, type the following:
<pre>
export DISPLAY=localhost:1
</pre>
  If you have problems starting graphical applications, type the above command again, but replace <code>localhost</code> with <code>127.0.0.1</code>
1. Start a window manager inside the chroot. For example, install the <code>metacity</code> package and type:
<pre>
metacity &
</pre>
1. Start a graphical application inside the chroot (making sure that you installed it in the chroot first). It should appear in the Xnest window.

You can install a complete Ubuntu desktop in the chroot by installing the <code>ubuntu-desktop</code> package. GNOME can be started from the command line by running the <code>gnome-session</code> command.

''This section uses parts of the article <nowiki>[[http://wiki.mandriva.com/en/Development/Howto/Chroot|Installing Mandriva Linux in a Chroot]]</nowiki>, which is distributed under the <nowiki>[[http://creativecommons.org/licenses/by-sa/2.5/|CC-BY-SA 2.5]]</nowiki> license.''

=== References and further information ===

# <nowiki>[[http://en.wikipedia.org/wiki/Chroot|Wikipedia - chroot]]</nowiki>
# <nowiki>[[http://wiki.mandriva.com/en/Development/Howto/Chroot|Installing Mandriva Linux in a Chroot]]</nowiki>
# <nowiki>[[DebootstrapChroot|Debootstrap Chroot]]</nowiki>

=== Notes ===

It seems to advise installing and using <code>schroot</code> in lieu of <code>dchroot</code> would be more consistent. Additionally, (I don't have a reference at my fingertips) my memory is <code>dchroot</code> is being deprecated with <code>schroot</code> taking its place?

If there is agreement on using <code>schroot</code>, then in  lieu of <code>sudo chroot /var/chroot</code>, use <code>sudo schroot -c gutsy -d</code> and this will still keep things basic by using schroot defaults.

In addition, by using <code>schroot</code> then all binds are engaged and removed automatically at chroot enter and exit. This is important to minimize accidental erasures of data. Thus, I think in a basic help page like this to warn users not to erase/delete/trash_can an entire chroot or entire chroot directories until chroot is exited (and all binds removed). For schroot, all automatically created binds will be removed on exit and accidental erasure of entire /home (often heard about) can be minimized. (It seems either people forget or don't comprehend bi-directional nature of mount --bind.)

reedmb 20081224

----
CategorySecurity
