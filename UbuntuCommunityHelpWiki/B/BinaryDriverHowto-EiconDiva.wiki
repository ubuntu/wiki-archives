{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==

Eicon build and sell some nice BRI card for voice or data exchanges. It can be nicely integrated with Asterisk. You can find a presentation of the cards <nowiki>[[http://www.eicon.com/worldwide/products/MediaGateways/default.htm|here]]</nowiki>.

Why choose binary drivers whereas some drivers included in Ubuntu kernel exists ? Because Eicon only supports its own binary drivers and the drivers are coming with a nice tools set for configuring and managing your card.

== Installation ==

=== Download driver on Eicon website ===

The list of the drivers can be found on <nowiki>[[http://www.eicon.com/support/downind.asp|this webpage]]</nowiki>. Download the corresponding version for your card. You would have to choose the source Debian package. For exemple, for our Diva Card 4BRI, we choose the 8.2beta1 (which is much better than 7.7) linux driver. You have to fill the form for downloading...

=== Install the package ===

Install the package you have downloaded on Eicon website. It will install:
** kernel module source (that will be compiled in next section)
** binary firmwire
** utilities

Just proceed to installation:
<pre>
sudo dpkg -i divas4linux_EICON-106.57-1.deb
</pre>

=== Building kernel modules ===

First, install the necessary packages for building modules: <code>linux-source, build-essentials, libncurses-dev</code> (see InstallingSoftware).

You have to manually unpack kernel sources and create the symlink in order that your kernel sources can be found under <code>/usr/src/linux</code>:
<pre>
cd /usr/src
tar xvjf linux-source-2.6.15.tar.bz2
ln -s linux-source-2.6.15 linux
</pre>

You are ready to launche the build:
<pre>
cd /usr/lib/eicon/divas/src
./Build -mrproper -nowait
</pre>

<code>-mrproper</code> is the same as usual (clean everything before starting) and <code>-nowait</code> is for not waiting 15 seconds !

The license informations should be displayed and you have to accept it. The you should have the following messages:

<pre>
OK
PROCESSING: Call 'make dep', please be patient ... update 'version.h' ... OK
PROCESSING: Call 'make modules', please be patient ... OK
PROCESSING: Build MTPX adapter driver ... OK
PROCESSING: Install Diva modules ... divadidd.ko, divas.ko, diva_mnt.ko, diva_idi.ko, divacapi.ko, kernelcapi.ko, capi.ko diva_mtpx.ko OK
PROCESSING: Cleanup ... OK
PROCESSING: Build Divatty ...  OK
PROCESSING: Cleanup ... OK

SUCCESS. You can configure and start your Diva adapter now.
</pre>

Launch the configuration utility.

<pre>
cd ..
./Config
</pre>

=== Tuning your installation ===

Those modifications are not mandatory. Your software may work, as it may not work. Those modifications are made for making the drivers Debian compliant.

==== udev ====

All the stuff is installed, it has to be a little tuned to work properly. First, disabled melware (opensource) kernel module to load during boot phase by adding them to the blacklist udev section. For this edit <code>/etc/modprobe.d/blacklist-eicon</code> with your favorite editor and enters the following lines:
<pre>
blacklist       divacapi
blacklist       divadidd
blacklist       diva_idi
blacklist       diva_mnt
blacklist       divas
</pre>

==== Init script ====

The installation process add a script in <code>/etc/rc2.d</code>. This script call at startup <code>/usr/lib/eicon/divas/divas_cfg.rc</code> script. Now, we are going to add some minor changes to this script to correctly position rights on the device (the device should belong to the <code>dialout</code> group and be group writable). 

===== Patching the Divas Init Script =====
* A patch for version 8.2 can be found <nowiki>[[http://www.porcheron.info/patch-divas_cfg.rc.diff|here]]</nowiki>.
* A patch for version 9.0 can be found <nowiki>[[http://files.boerngen-schmidt.de/patch-divas_cfg.rc.diff|here]]</nowiki>.

Apply it:

<pre>
cd /usr/lib/eicon/divas
patch -p0 patch-divas_cfg.rc.diff
</pre>

Reboot the machine. Your <code>/dev/capi20</code> should have the following rights:

<pre>
ls -l /dev/capi20
crw-rw-r-- 1 root dialout 68, 0 2006-05-11 17:25 /dev/capi20
</pre>

== Administration / Maintenance ==

Eicon drivers come with a light http server for managing the card. Installation process add the following line to the <code>/etc/inetd.conf</code>:
<pre>
diva-cfg        stream  tcp     nowait  root.daemon     /usr/lib/eicon/divas/diva_httpd diva_httpd /usr/lib/eicon/divas/httpd
</pre>

By default, there is no <code>inetd</code> on Ubuntu. In order to get access to this server inetd is necessary, you have to install the following packages <code>netkit-inetd</code> (see InstallingSoftware).

Add a password to access the interface by editing the following file <code>/usr/lib/eicon/divas/httpd/login/login</code> and replacing (as it is explained) the <code>XX</code>.

You have access to the card manager interface by accessing in your favourite browser <nowiki>[[http://server:10005]]</nowiki>

== Conclusion ==

Then, you should be able to use your card. You just have to setup your application. Enjoy !
----
