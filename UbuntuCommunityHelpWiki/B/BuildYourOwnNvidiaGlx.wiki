{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

'''These instructions are outdated - the nvidia-glx package hasn't existed for a long time.'''

== Introduction ==
''Note:'' The 9755 driver was included with Ubuntu 7.04 and is called nvidia-glx-new. Later versions of Ubuntu may come with more recent drivers. Please see <nowiki>[[BinaryDriverHowto-Nvidia]]</nowiki> for further details.

This page details how to make your own '''nvidia-glx''' with the latest NVIDIA drivers integrated to the linux-restricted-modules package. Why do you want this you could ask? Well, people who have an NVIDIA 8800-series card need the latest driver (97.42) to get working 3D-acceleration. The card is not supported by the driver included in linux-restricted-modules ''(l-r-m)'' at the moment. The more popular reason would be that the 9x.xx drivers support the TFP (texture from pixmap) extension, which '''allows you to run Compiz/Beryl without XGL.'''

== Setting up repositories ==
Add this source entry into your '''/etc/apt/sources.list''':
<pre>
deb-src http://archive.ubuntu.com/ubuntu edgy-security main restricted universe multiverse
</pre>
The l-r-m was updated because of a security vulnerability found in the NVIDIA 8774 driver, this is why the source is located on the edgy-security repository.
== Getting the source ==

Then change to a directory where you want do to the compiling and get the source by issuing this command:
<pre>
apt-get source nvidia-glx
</pre>

Now let's satisfy the build dependencies (If you're building with pbuilder you can skip this step):
<pre>
sudo apt-get build-dep nvidia-glx
</pre>

== Download the driver packages ==
You need both of these packages for the linux-restricted-modules:

<nowiki>[[http://us.download.nvidia.com/XFree86/Linux-x86/1.0-9742/NVIDIA-Linux-x86-1.0-9742-pkg1.run|NVIDIA-Linux-x86-1.0-9742-pkg1.run]]</nowiki>
<nowiki>[[http://us.download.nvidia.com/XFree86/Linux-x86_64/1.0-9742/NVIDIA-Linux-x86_64-1.0-9742-pkg2.run|NVIDIA-Linux-x86_64-1.0-9742-pkg2.run]]</nowiki>

== Replacing files in the archive ==
Open ''linux-restricted-modules-2.6.17_2.6.17.6.orig.tar.gz'' in e.g. file-roller.
Go to /linux-restricted-modules-2.6.17-2.6.17.6.orig/nvidia/ (in fileroller) and delete the old (8776) driver, which you want to replace, still leaving the nvidia legacy drivers intact. After this, add the files you downloaded [ ''NVIDIA-Linux-x86-1.0-9742-pkg1.run NVIDIA-Linux-x86_64-1.0-9742-pkg2.run'' ] to the archive.

== Editing the .diff file ==
Extract ''linux-restricted-modules-2.6.17_2.6.17.6-1.diff.gz'' and open the .diff file in your favorite text editor.

1. Find and replace all instances of '''8776''' with '''9742''' (The 8776 in the changelog section you can leave unchanged.)

2. Find and replace:
<pre>
$(nv_dirname)/usr/X11R6/lib/modules/drivers/nvidia_drv.o
</pre>
''with''
<pre>
$(nv_dirname)/usr/X11R6/lib/modules/drivers/nvidia_drv.so
</pre>
3. Find:
<pre>
+linux-restricted-modules-2.6.17 (2.6.17.6-1) edgy-security; urgency=low
</pre>
Add this section '''above''' that line (to bump the version number and update the changelog):
<pre>
+linux-restricted-modules-2.6.17 (2.6.17.6-2) edgy-security; urgency=low
+
+  * Updated the NVIDIA driver to version 9742.
+
+ -- Christoffer Karvonen <mail@yourhost.com>  Mon, 20 Nov 2006 02:46:43 +0200
+
</pre>
4. As we have added six (6) lines to the file, the above line must be altered from:
<pre>
@@ -0,0 +1,1319 @@
</pre>
''to''
<pre>
@@ -0,0 +1,1325 @@
</pre>
You can of course replace my name and email with your own.

'''Save''' the file. Then rename the file to ''linux-restricted-modules-2.6.17_2.6.17.6-2.diff'' and '''gzip''' it.

== Making some final changes (the .dsc file) ==

Edit ''linux-restricted-modules-2.6.17_2.6.17.6-1.dsc'', again, open it with your favorite text editor.

1. Find and replace:
<pre>
Version: 2.6.17.6-1.1
</pre>
''with''
<pre>
Version: 2.6.17.6-1.2
</pre>
2. Replace:
<pre>
linux-restricted-modules-2.6.17_2.6.17.6-1.1.diff.gz
</pre>
''with''
<pre>
linux-restricted-modules-2.6.17_2.6.17.6-1.2.diff.gz
</pre>

Remove the old GnuPG signature header:
<pre>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
</pre>

and footer:
<pre>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (GNU/Linux)

iD8DBQFFP6N5H/9LqRcGPm0RAh+nAJ0Qb7TzsP0s2REbLfFE7E5kA72cSACgmJas
tU/3xuWQZKqSaPzNYhNeccU=
=JWsr
-----END PGP SIGNATURE-----
</pre>

Now we need to replace the MD5SUM's and sizes in the .dsc with new one's. Commands to do this are:
<pre>
 md5sum <filename>
ls -l <filename> </pre>

Be sure you get the MD5SUM's (and sizes) of the correct files; ''linux-restricted-modules-2.6.17_2.6.17.6.orig.tar.gz'' and ''linux-restricted-modules-2.6.17_2.6.17.6-2.diff.gz''

Rename the .dsc file
<pre>
mv linux-restricted-modules-2.6.17_2.6.17.6-1.dsc linux-restricted-modules-2.6.17_2.6.17.6-2.dsc
</pre>

Sign it the package with '''debsign''':
<pre>
debsign -kYOURKEY linux-restricted-modules-2.6.17_2.6.17.6-1.dsc
</pre>

If you don't have a GnuPG key, you can generate one with:
<pre>
gpg --gen-key
</pre>

== Building it ==
==== To build with pbuilder: ====
<pre>
sudo pbuilder build linux-restricted-modules-2.6.17_2.6.17.6-2.dsc
</pre>

==== To build without it: ====
Extract the source with
<pre>
dpkg-source -x <filename>.dsc
</pre>
Change to the directory it was extracted to and run
<pre>
dpkg-buildpackage -rfakeroot
</pre>

It takes a while to compile, but hopefully finishes. You can install the packages with '''dpkg''' as usual.

=== Related pages ===
<nowiki>[[BinaryDriverHowto-Nvidia]]</nowiki> NvidiaTroubleshooting <nowiki>[[https://wiki.ubuntu.com/PbuilderHowto|PbuilderHowto]]</nowiki>

== Discussions ==
Personally, I find this method is very hacky. Wouldn't be simpler to extract the package and do the changes directly inside its directory, instead of modifying a diff file? What happens if a new version of linux-restricted-modules is released? - AlexandreVassalotti
  
----
CategoryVideo CategoryGraphics
