{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==
Bacula is a backup program enabling you to backup, restore, and verify data across your network.  There are Bacula clients for Linux, Windows, and Mac OSX.  Making it a cross platform network wide solution.

There is an official documentation about Bacula here : https://help.ubuntu.com/lts/serverguide/bacula.html

== Overview ==
Bacula is made up of several components and services used to manage what to backup and where to back it up to:
* '''Bacula Director''' -- service that controls all backup, restore, verify, and archive operations.
* '''Bacula Console''' -- application allowing communication with the Director.  There are three versions of the Console: 
** Text based command line version.
** Gnome based gtk+ GUI interface.
** wxWidgets interface GUI interface.
** KDE based Qt GUI interface.
* '''Bacula File''' -- also known as the Bacula Client program.  Installed on machines to be backed up, and is responsible for the data requested by the Director.
* '''Bacula Storage''' -- the programs that perform the storage and recovery of data to the physical media. 
* '''Bacula Catalog''' -- responsible for maintaining the file indexes and volume databases for all files backed up.  The catalog enables quick location and restoration of archived files.  The Catalog supports three different databases MySQL, PostgreSQL, and SQLite.
* '''Bacula Monitor''' -- allows the monitoring of the Director, File daemons, and Storage daemons.  Currently the Monitor is only available as a GTK+ GUI application.

These services and applications can be run on multiple servers and clients, or they can be installed on one machine if backing up a single disk or volume.

== Installation ==
There are multiple packages containing the different '''Bacula''' components. Currently the Bacula packages are in the Universe repository, but work is being done to get the core packages into the Main repository.  

By default installing the '''bacula''' package will install the '''bacula-director-sqlite3''' package which will use '''SQLite''' for the Catalog.  If you want to use '''MySQL''' or '''PostgreSQL''' for the catalog install '''bacula-director-mysql''' or '''bacula-director-pgsql''' respectively. '''NOTE:''' as of Karmic (Ubuntu 9.10) the default database backend is mysql. 

See InstallingSoftware for information on repositories and using package managers.

After installing Bacula the <code>bacula-sd</code> daemon may have an issue starting because there is no storage device configured.  A work around for this error is to configure an '''Archive Device''' in the <code>/etc/bacula/bacula-sd.conf</code> file, and enter the following '''apt''' command to complete the package install:
<pre>
sudo apt-get install -f
</pre>

Bacula also requires a Mail Transfer Agent (MTA).  The default Ubuntu MTA is '''Postfix''', but it is possible to use another MTA such as Exim4.  For details on setting up Postfix see <nowiki>[[Postfix]]</nowiki>

== Configuration ==
Bacula configuration files are formatted based on '''resources''' comprising of '''directives''' surrounded by "{}" braces.  The files are located in the 
<code>/etc/bacula</code> directory, and there is a file for each component.

The various Bacula components must authorize themselves to each other.  This is accomplished using the '''password''' directive.  For example the '''Storage''' resource password in the <code>/etc/bacula/bacula-dir.conf</code> file must match the '''Director''' resource password in <code>/etc/bacula/bacula-sd.conf</code>.

By default '''Bacula''' configures a FileSet and job to backup itself.  The job name is '''Client1''' by default.  If you plan on using the server to backup more than one client you should change the name of this job to something more descriptive.  To change the name edit <code>/etc/bacula/bacula-dir.conf</code>:

<pre>
Job {
  Name = "BackupServer"
  JobDefs = "DefaultJob"
  Write Bootstrap = "/var/lib/bacula/Client1.bsr"
}
</pre>

* The example above changes the job name to ''!BackupServer'' matching the machine's host name.

The '''Console''' can be used to query the '''Director''' about jobs, but to use the Console with a non-root user the user needs to be in the '''bacula''' group.  To add a user to the bacula group enter the following from a terminal prompt:
<pre>
sudo adduser $username bacula
</pre>

* Replacing ''$username'' with an actual username.  Also, if you are adding the current user to the group you will need to log out and back in for the new permissions to take effect.

=== Localhost Backup ===
This section describes how to backup specified directories on a single host to a local tape drive.  

* First, the '''Storage''' device needs to be configured.  Edit <code>/etc/bacula/bacula-sd.conf</code> add:

<pre>
Device {
  Name = "Tape Drive"
  Device Type = tape
  Media Type = DDS-4
  Archive Device = /dev/st0
  Hardware end of medium = No;
  AutomaticMount = yes;               # when device opened, read it
  AlwaysOpen = Yes;
  RemovableMedia = yes;
  RandomAccess = no;
  Alert Command = "sh -c 'tapeinfo -f %c | grep TapeAlert'"
}
</pre>

** The example is for a '''DDS-4''' tape drive adjust the '''Media Type''' and '''Archive Device''' to match your hardware.  
** You could also uncomment one of the other examples in the file.

* After editing <code>/etc/bacula/bacula-sd.conf</code> the '''Bacula Storage''' deamon will need to be restarted:

<pre>
sudo /etc/init.d/bacula-sd restart
</pre>

* Now add a '''Storage''' resource in <code>/etc/bacula/bacula-dir.conf</code> to use the new '''Device''':

<pre>
Storage {
  Name = TapeDrive
## Do not use "localhost" here    
  Address = backupserver               # N.B. Use a fully qualified name here
  SDPort = 9103
  Password = "Cv70F6pf1t6pBopT4vQOnigDrR0v3LT3Cgkiyj"
  Device = "Tape Drive"
  Media Type = tape
}
</pre>

** The '''Address''' directive needs to be the Fully Qualified Domain Name (FQDN) of the server.  Change ''backupserver'' to the actual host name.
** Make sure the '''Password''' directive matches the password string in <code>/etc/bacula/bacula-sd.conf</code>.

* Create a new '''FileSet''' which will determines what directories to backup, add:

<pre>
FileSet {
  Name = "LocalhostFiles"
  Include {
    Options {
      signature = MD5
      compression=GZIP
    }
    File = /etc
    File = /home
  }
}
</pre>

** This '''FileSet''' will backup the <code>/etc</code> and <code>/home</code> directories.  The '''Options''' resource directives configure the FileSet to create a MD5 signature for each file backed up, and to compress the files using GZIP.  

* Next, create a new '''Schedule''' for the backup job:

<pre>
Schedule {
  Name = "LocalhostDaily"
  Run = Full daily at 00:01
}
</pre>

** The job will run every day at 00:01 or 12:01 am.  There are many other scheduling options available.
 
* Finally create the '''Job''':

<pre>
Job {
  Name = "LocalhostBackup"
  JobDefs = "DefaultJob"
  Enabled = yes
  Level = Full
  FileSet = "LocalhostFiles"
  Schedule = "LocalhostDaily"
  Storage = TapeDrive
  Write Bootstrap = "/var/lib/bacula/LocalhostBackup.bsr"
}  
</pre>

* The job will do a '''Full''' backup every day to the tape drive.

* Each tape used will need to have a '''Label'''.  If the current tape does not have a label Bacula will send an email letting you know.  To label a tape using the '''Console''' enter the following from a terminal:

<pre>
bconsole
</pre>

* At the '''Bacula Console''' prompt enter:

<pre>
label
</pre>

* You will then be prompted for the '''Storage''' resource:

<pre>
Automatically selected Catalog: MyCatalog
Using Catalog "MyCatalog"
The defined Storage resources are:
     1: File
     2: TapeDrive
Select Storage resource (1-2): 2
</pre>

* Enter the new '''Volume''' name:

<pre>
Enter new Volume name: Sunday
Defined Pools:
     1: Default
     2: Scratch
</pre>

* Select the '''Pool''':

<pre>
Select the Pool (1-2): 1
Connecting to Storage daemon TapeDrive at backupserver:9103 ...
Sending label command for Volume "Sunday" Slot 0 ...
</pre>

== Notes ==
By using the apt-get command we are downloading the available build from Ubuntu universe.
For karmic you can check the version available at http://packages.ubuntu.com/karmic/admin/ (at time of writting it was version 2.4.4-1ubuntu9 and in source there is up to verison 5)

In Natty Narwhal the initial configuration file /etc/bacula/bacula-dir.conf contains a small bug which will prevent the configuration from working and the director will quit when bconsole attempts to connect. The definition of the catalog Mycatalog contains a line starting with '  dbname = "bacula;"'. The semicolon inside the quotes should follow the quotes, so should start with '  dbname = "bacula" ;'

== Finding Autochanger and Tape Device ==

Ubuntu automatically puts symlinks to autochanger devices and tape drive devices under <code>/dev/tape/by-id/</code>.  List that directory and view where the symlinks point to: <code>ls -l /dev/tape/by-id/</code>.  A symlinke to an <code>sg#</code> device is your autochanger, and the pairs of symlinks to an <code>st#</code> and <code>nst#</code> device are tape drives.

== Resources ==
* <nowiki>[[http://www.bacula.org/en/rel-manual/index.html|Bacula Manual]]</nowiki>
* <nowiki>[[http://www.bacula.org/en/|Bacula Home Page]]</nowiki>
  
----
CategoryBackupRecovery
