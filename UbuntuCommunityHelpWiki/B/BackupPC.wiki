{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==
BackupPC is a free backup software suite with a web-based frontend. The cross-platform server will run on any Linux, Solaris, or UNIX based server. No client is necessary, as the server is itself a client for several protocols that are handled by other services native to the client OS.
=== Backup Methods ===
Three methods for getting backup data from a client are:
* smb (Server Message Block)
* tar (tape archiver)
* rsync (file transfer program for Unix systems)

{| class="wikitable"
|-
| <33%>
| <33%>WinXX
| <33%>Linux/Unix/MacOSX
|-
| smb
| <:>*
|-
| rsync
| <:>* 1.
| <:>*
|-
| tar
| 
| <:>*
|}

1. rsync/cygwin software needs to be installed on client machine

The easiest method for backing up windows machines is the "smb" protocol. See the BackupPC manual for the full pro's and con's

=== Configuration ===
To configure ''BackupPC'' there are 3 options:
* Web browser (Easier)
* Text editor (Power user)
* Combination of both (Balanced)

Note: The BackupPC user manual is heavily "Text" based.

=== The BackupPC Configuration Files ===
BackupPC's configuration files are in the `/etc/backuppc directory`. The most important ones are `/etc/backuppc/config.pl` and `/etc/backuppc/hosts`. You should open them now to become familiar with all configuration options. Both files are heavily commented, so by reading them you should understand what they do. For example, in `/etc/backuppc/config.pl` you can define how often and when BackupPC wakes up to back up the clients, when/how often it does full or incremental backups, how many log files it should keep, etc.
<pre>
nano -w /etc/backuppc/config.pl
</pre>
<pre>
nano -w  /etc/backuppc/hosts
</pre>
== Installation ==

<pre>
sudo apt-get install backuppc
</pre>

== Add Hosts ==
To add a client (Host) to BackupPC, we must add it to `/etc/backuppc/hosts`. That file has the following format:
<pre>
host        dhcp    user      moreUsers
hostname1     0     user1     anotheruser,athirduser
hostname2     1     user2     stillanotheruser
</pre>
The first column contains the hostname/NetBIOS name of the client (e.g. `hostname1`), the second column whether the client is configured through DHCP, the third column contains a user that is allowed to log into the BackupPC web interface to manage that backup client, and the fourth (optional) column contains additional users that can do the same.

=== Browse Network ===
'''smbtree''' is a smb browser program in text mode. It is similar to the "Network Neighborhood" found on Windows computers. It prints a tree with all the known domains, the servers in those domains and the shares on the servers.
<pre>
smbtree -b
Password:
</pre>
Don't enter a password, hit enter
<pre>
WORKGROUP
        \\BACKUP                        backup server (Samba, Ubuntu)
                \\BACKUP\IPC$                   IPC Service (backup server (Samba, Ubuntu))
                \\BACKUP\print$                 Printer Drivers
        \\AMD6000
cli_rpc_pipe_open: cli_nt_create failed on pipe \srvsvc to machine AMD6000.  Error was NT_STATUS_ACCESS_DENIED
</pre>
Your network will differ, '''BACKUP''' is the name of our '''BackupPC server''', '''AMD6000''' is the name of our Windows Vista PC we want to back up.

Although `AMD6000` is configured through DHCP, dhcp should only be set to 1 if the following tests fail:
<pre>
nmblookup AMD6000
</pre>
If the test is successful, it should display `AMD6000` current IP address:
<pre>
querying amd6000 on 192.168.0.255
192.168.0.50 amd6000<00>
</pre>
Now that you know `AMD6000` current IP address, run the same test in the other direction:
<pre>
nmblookup -A 192.168.0.50
</pre>
If successful, the output should look like this:
<pre>
Looking up status of 192.168.0.50
        AMD6000         <00> -         B <ACTIVE>
        WORKGROUP       <00> - <GROUP> B <ACTIVE>
        AMD6000         <20> -         B <ACTIVE>
        WORKGROUP       <1e> - <GROUP> B <ACTIVE>

        MAC Address = 00-1A-92-B0-4C-63
</pre>
Both tests were successful, so we can set `dhcp` to 0, and we put `AMD6000   0       user` into `/etc/backuppc/hosts` and comment out the `localhost` line:
<pre>
nano -w /etc/backuppc/hosts
</pre>
<pre>
[...]
AMD6000      0       user
</pre>
If the tests had not been successful, we would have put `AMD6000   1       user` into `/etc/backuppc/hosts` instead, and in addition to that we would have had to change the variable `$Conf{DHCPAddressRanges}` in `/etc/backuppc/config.pl`.

We have added the user user to the hosts file. That's the system user whom BackupPC will send email reports regarding `AMD6000`, so we should create that user on the BackupPC server now:
<pre>
useradd -m user
passwd user
</pre>
In addition to that we must create a password for ''user'' for the BackupPC web interface:
<pre>
htpasswd /etc/backuppc/htpasswd user
</pre>
(If you like you can now open a second browser and log in as `user` on `http://192.168.0.51/backuppc/`.)
== Backup Linux Client (rsync) ==
Now we must edit /etc/backuppc/config.pl. The backup method for AMD6000 will be '''rsync''', so we set $Conf{XferMethod} = 'rsync';.
AMD6000 has just one (big) partition (/), so we set $Conf{RsyncShareName} = '/';. If you have multiple partitions to backup, you'd specify something like $Conf{RsyncShareName} = ['/', '/var', '/data', '/boot']; instead.

rsync will be tunneled through SSH (port 22). SSH needs to know the hostname or IP address of the client. Unless you have a DNS server that resolves AMD6000 to its IP address, SSH will not be able to resolve the name AMD6000. Therefore we replace $host with $hostIP in $Conf{RsyncClientCmd} and $Conf{RsyncClientRestoreCmd}.
<pre>
nano -w /etc/backuppc/config.pl
</pre>
<pre>
[...]
$Conf{XferMethod} = 'rsync';

$Conf{RsyncClientPath} = '/usr/bin/rsync';
$Conf{RsyncClientCmd} = '$sshPath -q -x -l root $hostIP $rsyncPath $argList+';
$Conf{RsyncClientRestoreCmd} = '$sshPath -q -x -l root $hostIP $rsyncPath $argList+';
$Conf{RsyncShareName} = '/';
[...]
</pre>
(You might wonder now how we can specify options for multiple clients because the options for notebook will be different from those for AMD6000. It works like this: the options in /etc/backuppc/config.pl are global values that are valid for all clients unless they have their onw configuration file in /etc/backuppc, named after their hostname. So for notebook we will create /etc/backuppc/notebook.pl, and it will contain only the values that are different from the ones in /etc/backuppc/config.pl. In fact, we could have created /etc/backuppc/falko-desktop.pl for falko-desktop instead of modifying /etc/backuppc/config.pl.)

=== Enable settings ===
Next restart BackupPC:
<pre>
/etc/init.d/backuppc restart
</pre>

== Backup Windows Client (smb) ==
To make backups of Windows systems using smb, we must share the folder that we want to back up. In this case I want to backup the whole C: drive, so I right-click on it in the Windows Explorer and go to Sharing. As share name I specify C.

Next, on server1.example.com, I add a line for notebook to /etc/backuppc/hosts (I do this as root). In this case I use ''user'' again as the user. If you use a different username than before, make sure you create it on the system and for the BackupPC web interface, as shown in chapter 5.
<pre>
vi /etc/backuppc/hosts
</pre>
<pre>
[...]
AMD6000      0       user
notebook     0       user
</pre>

Then create the file /etc/backuppc/notebook.pl and add all options that are different from the ones in /etc/backuppc/config.pl. In this case we add $Conf{XferMethod} = 'smb';. Our share name is C, so we put $Conf{SmbShareName} = 'C'; into it as well as the username and password for the Windows share:
<pre>
nano -w /etc/backuppc/notebook.pl
</pre>
<pre>
$Conf{SmbShareName} = 'C';
$Conf{SmbShareUserName} = 'username';
$Conf{SmbSharePasswd} = 'password';
$Conf{XferMethod} = 'smb';
</pre>

=== Enable Settings ===
Then restart BackupPC:
<pre>
/etc/init.d/backuppc restart
</pre>
Then reload the BackupPC web interface again. You should now find notebook in the list of clients:

You can start the first backup of notebook manually or wait until BackupPC starts it:

== Backup Linux Clients (tar) ==
'''For some reason this does not work under Intreped/9.04, however the method described on http://www.howtoforge.com/linux_backuppc_p4 works fine! The page is complex and confusing, so you must be careful work out just which is your "client" and which is your "server"!'''

BackupPC is a great backup program for an Ubuntu server. However, backing up Ubuntu client machines doesn’t work “out of the box” due to Ubuntu’s lack of a root account. The following describes how to make BackupPC work with Ubuntu's sudo implementation. By adding sudo to the TAR commands in /etc/backuppc/config.pl and adding backuppc to the sudoers list, you’re able to perform both backups and restores directly from the web-based interface.

=== Modify /etc/backuppc/config.pl ===
** Run “sudo gedit /etc/backuppc/config.pl”
** Add sudo to the TAR <code>Client</code> and <code>ClientRestore</code> commands
*** Change <code>$Conf{TarClientCmd} </code>and <code>$Conf{TarClientRestoreCmd} </code>to read
<pre>
$Conf{TarClientCmd} = ‘sudo $tarPath -c -v -f - -C $shareName’
. ‘ –totals’;
</pre>
<pre>
$Conf{TarClientRestoreCmd} = ‘sudo $tarPath -x -p –numeric-owner –same-owner’
. ‘ -v -f - -C $shareName’;
</pre>
*** Also remove plus (+) from $incrDate in <code>$Conf{TarIncrArgs} </code> so it won't be double escaped (need to escape only once when running sudo): 
<pre>
$Conf{TarIncrArgs} = '--newer=$incrDate $fileList+';
</pre>
** Change <code>$Conf{BackupFilesExclude} </code>(these seem to all be temp files that you don’t really need to backup) to read
<pre>
$Conf{BackupFilesExclude} = ['/proc', '/dev', '/tmp', '/mnt', '/media', '/sys', '/lost+found', '/usr/src', '/var/lib', '/var/tmp', '/var/cache', '/var/spool', '/var/run', '/var/lock', '/var/games', '/home/*/.Trash', '/home/*/.mozilla/*/*/Cache', '/home/*/.mozilla/*/*/Cache.Trash'];
</pre>

=== Add backuppc to the sudoers list ===
** Run “sudo visudo”
** At the bottom of the file add
<pre>
backuppc ALL=NOPASSWD: /bin/tar
</pre>
** If you are unfamiliar with vi editor: Scroll to the end of last line of the file, press a to start adding text, write magic lines mentioned above, hit esc, type ":w"+enter to save file, ":q" to quit (":q!" to quit without saving changes).

== alternatives ==
For other ways of backing up some or all of your system, see
BackupYourSystem
.
== References ==
* http://www.howtoforge.com/linux_backuppc
* BackupPC: http://backuppc.sourceforge.net
* BackupPC Documentation: http://backuppc.sourceforge.net/faq/BackupPC.html

== Authors ==
* falko

----
CategoryBackupRecovery
