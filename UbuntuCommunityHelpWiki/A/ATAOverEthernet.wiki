{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Language ==

{| class="wikitable"
|-
| '''<nowiki>[[ATAOverEthernet|En]]</nowiki>'''
| 
| '''<nowiki>[[ATAOverEthernet_RU|Ru]]</nowiki>'''
|}

== Introduction ==

There is now a kernel module (aoe), tools (aoetools) and server
software (vblade) which allows anyone to set up an ATA over Ethernet
storage network... it is very easy to do in Ubuntu.

This software is available in Dapper 6.06 LTS and later.. 

WARNING: These commands need to be run with root privileges (sudo -i). 
Do this at your own risk.

WARNING: Don't mount the target from more than one client or filesystem corruption will occur.
To do this something like <nowiki>[[http://en.wikipedia.org/wiki/Global_File_System|GFS]]</nowiki> is needed.

== Required Packages ==

With the Universe repository enabled..

On the Ubuntu host that you wish to be the disk server (due to a bug in Ubuntu 8.04 LTS, you will need vblade 14-1ubuntu1.1 for this to work. See <nowiki>[[https://launchpad.net/bugs/223440|bug #223440]]</nowiki> for details):
<pre>
  (server)# apt-get install vblade
</pre>
On the Ubuntu host that you wish to mount the disk on:
<pre>
  (client)# apt-get install aoetools
</pre>

== To set the interface up ==
It's important to note that no IP address is needed to get this working.

<pre>
# ip link set eth0 up
</pre>

== To create an AoE device ==
To test that everything is working correctly, we created and used a
1 Mbyte file (vblade0). Any other block device or file could be used.

On the server:
<pre>
  (server)# dd if=/dev/zero of=vblade0 count=1 bs=1M
  (server)# vblade 1 1 eth0 vblade0
  ioctl returned 0
  1048576 bytes
  pid 25000: e1.1, 2048 sectors
</pre>
The daemon ('vbladed') could be used instead of 'vblade', which detaches the process from the console and send log messages to the system logs.

== Using AoE ==

The 'aoe' module should already be automatically loaded when the 'aoetools' package is installed. Please note that you will not be able to discover AoE devices on the localhost unless you specify ```lo``` to vblade.
 
If this hasn't occured, insert the module into the linux kernel.
<pre>
  (client)# modprobe aoe
</pre>

optionally the list of interfaces can be specified while loading the module
<pre>
   (client)# modprobe aoe aoe_iflist="eth0 eth1"
</pre>

This can automatically be performed at startup, by entering a line into the
/etc/modules file.

In Ubuntu 6.06 (or any systems without udev), create the 'etherd' directory:
<pre>
  (client)# mkdir /dev/etherd
</pre>

In Ubuntu 8.04, add the necessary rules to udev (this is not needed in 9.04 and later, see <nowiki>[[https://launchpad.net/bugs/234033|bug #234033]]</nowiki>):
<pre>
   (client)# cat > /etc/udev/rules.d/60-aoe.rules << EOM
SUBSYSTEM=="aoe", NAME="etherd/%k", GROUP="disk", MODE="0220"
SUBSYSTEM=="aoe", KERNEL=="err", MODE="0440"
EOM
   (client)# /etc/init.d/udev restart
</pre>

Next, access the devices:
<pre>
  (client)# aoe-interfaces eth0
  (client)# aoe-discover
  (client)# aoe-stat
      e1.1         0.001GB   eth0 up 
</pre>
The block device is then located in /dev/etherd/e1.1 and can be 
treated like any other block device.

Create a filesystem:
<pre>
  (client)# mke2fs /dev/etherd/e1.1
</pre>
Create a mount point and mount the file system:
<pre>
  (client)# mkdir /mnt/e1.1
  (client)# mount /dev/etherd/e1.1 /mnt/e1.1
</pre>
This can be made to automatically mount on reboot, by entering a configuration
line in /etc/fstab (untested).

If the AoE device disappears or changes size use the ```aoe-revalidate``` command:
<pre>
   (client)# aoe-revalidate e1.1
</pre>

Alternatively, you can re-load the aoe module completely.
<pre>
   (client)# rmmod aoe
   (client)# modprobe aoe
</pre>

== References ==

* http://support.coraid.com/support/linux/EtherDrive-2.6-HOWTO.html
* http://en.wikipedia.org/wiki/ATA_over_Ethernet
* http://en.wikipedia.org/wiki/Global_File_System

----
CategoryHardware CategoryNetworking
