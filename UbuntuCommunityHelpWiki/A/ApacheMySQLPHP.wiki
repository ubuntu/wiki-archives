{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

==== Hint: Server Guide ====
To find the Ubuntu Server Guide related to your specific version, please go to: https://help.ubuntu.com/, select your Ubuntu version and then click on '''Ubuntu Server Guide'''. For the latest LTS version (14.04.1 LTS) of Ubuntu Server, please go to https://help.ubuntu.com/14.04/serverguide/index.html

Parent page: <nowiki>[[Programming| Programming Applications]]</nowiki>

This is to help people set up and install a <nowiki>[[http://en.wikipedia.org/wiki/LAMP_%28software_bundle%29|LAMP]]</nowiki> ('''L'''inux-'''A'''pache-'''M'''ySQL-'''P'''HP) server in Ubuntu, including Apache 2, PHP 5 and MySQL 4.1 or 5.0.

=== To install the default LAMP stack in Ubuntu 10.04 and above ===

First refresh your package index...

<pre>
$ sudo apt-get update
</pre>

... and then install the LAMP stack:

<pre>
$ sudo apt-get install lamp-server^
</pre>

Mind the caret (^) at the end.  

=== Starting over: How to remove the LAMP stack ===

To remove the LAMP stack remove the following packages:
* Note: This assumes you have no other programs that require any of these packages.  You might wish to simulate this removal first, and only remove the packages that don't cause removal of something desired.
<pre>
apache2 apache2-mpm-prefork apache2-utils apache2.2-common libapache2-mod-php5 libapr1 libaprutil1 libdbd-mysql-perl libdbi-perl libnet-daemon-perl libplrpc-perl libpq5 mysql-client-5.5 mysql-common mysql-server mysql-server-5.5 php5-common php5-mysql
</pre>

To also remove the debconf data, use the purge option when removing.  To get rid of any configurations you may have made to apache, manually remove the /etc/apache2 directory once the packages have been removed.

You may also want to purge these packages:
<pre>
mysql-client-core-5.5 mysql-server-core-5.5
</pre>

=== Installing Apache 2 ===
To only install the apache2 webserver, use <nowiki>[[InstallingSoftware| any method]]</nowiki> to install:

<pre>
apache2
</pre>

It requires a restart for it to work:

<pre>
$ sudo /etc/init.d/apache2 restart
</pre>

or

<pre>
$ sudo service apache2 restart
</pre>
==== Checking Apache 2 installation ====

With your web browser, go to the URI '''http'''://localhost : if you read "It works!", which is the content of the file /var/www/index.html , this proves Apache works.

==== Troubleshooting Apache ====
If you get this error:

''apache2: Could not determine the server's fully qualified domain name, using 127.0.0.1 for ServerName''

'''Ubuntu 13.10+'''

Use a text editor such as "sudo nano" at the command line or "gksudo gedit" on the desktop to create a new file,
<pre>
$ sudo nano /etc/apache2/conf-available/fqdn.conf
</pre>
or
<pre>
$ gksu "gedit /etc/apache2/conf-available/fqdn.conf"
</pre>
then add
<pre>
ServerName localhost
</pre>
to the file, save it, and enable your new configuration file by running the command below.
<pre>
sudo a2enconf fqdn
</pre>

This can all be done in a single command with the following:
<pre>
$ echo "ServerName localhost" | sudo tee /etc/apache2/conf-available/fqdn.conf && sudo a2enconf fqdn
</pre>

'''Ubuntu 13.04 and below'''

In older versions of Apache, the configuration files were located in a different directory. Use a text editor such as "sudo nano" at the command line or "gksudo gedit" on the desktop to create a new file,
<pre>
$ sudo nano /etc/apache2/conf.d/fqdn
</pre>
or
<pre>
$ gksu "gedit /etc/apache2/conf.d/fqdn"
</pre>
then add
<pre>
ServerName localhost
</pre>
to the file and save.  This can all be done in a single command with the following:
<pre>
$ echo "ServerName localhost" | sudo tee /etc/apache2/conf.d/fqdn
</pre>

==== Virtual Hosts ====
Apache2 has the concept of sites, which are separate configuration files that Apache2 will read. These are available in <code>/etc/apache2/sites-available</code>. By default, there is one site available called ''000-default''. This is what you will see when you browse to http://localhost or http://127.0.0.1. You can have many different site configurations available, and activate only those that you need.

As an example, we want the default site to be <code>/home/user/public_html/</code>. To do this, we must create a new site and then enable it in Apache2.

To create a new site:

* Copy the default website as a starting point. <code>sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/mysite.conf </code>
* Edit the new configuration file in a text editor "sudo nano" on the command line or "gksudo gedit", for example: <code>gksudo gedit /etc/apache2/sites-available/mysite.conf</code>
* Change the <code>DocumentRoot</code> to point to the new location. For example, <code>/home/user/public_html/</code>
* In the file: /etc/apache2/apache2.conf, change the <code>Directory</code> directive, replace <code><Directory /var/www/></code> to <code><Directory /home/user/public_html/></code>
* ''You can also set separate logs for each site. To do this, change the <code>ErrorLog</code> and <code>CustomLog</code> directives. This is optional, but handy if you have many sites''
* Save the file

Now, we must deactivate the old site, and activate our new one. Ubuntu provides two small utilities that take care of this: a2ensite ('''a'''pache'''2en'''able '''site''') and a2dissite ('''a'''pache'''2dis'''able '''site''').

<pre>
$ sudo a2dissite 000-default && sudo a2ensite mysite
</pre>

Finally, we restart Apache2:

<pre>
$ sudo /etc/init.d/apache2 restart
</pre>

''If you have not created <code>/home/user/public_html/</code>, you will receive an warning message''

To test the new site, create a file in <code>/home/user/public_html/</code>:

<pre>
$ echo '<b>Hello! It is working!</b>' > /home/user/public_html/index.html
</pre>

Finally, browse to http://localhost/

=== Installing PHP 5 ===
To only install PHP5. use <nowiki>[[InstallingSoftware| any method]]</nowiki> to install the package

<pre>
libapache2-mod-php5
</pre>

Enable this module by doing
<pre>
$ sudo a2enmod php5
</pre>
which creates a symbolic link  /etc/apache2/mods-enabled/php5 pointing to  /etc/apache2/mods-availble/php5 .

Except if you use deprecated PHP code beginning only by "<?" instead of "<?php" (which is highly inadvisable), open, as root, the file /etc/php5/apache2/php.ini , look for the line "'''short_open_tag''' = On", change it to "short_open_tag = Off" (not including the quotation marks) and add a line of comment (beginning by a semi-colon) giving the reason, the author and the date of this change. This way, if you later want some XML or XHTML file to be served as PHP, the "<?xml" tag will be ignored by PHP instead of being seen as a PHP code mistake.

Relaunch Apache 2 again:

<pre>
$ sudo service apache2 restart
</pre>

==== Checking PHP 5 installation ====

In /var/www , create a text file called "test.php", grant the world (or, at least, Ubuntu user "apache") permission to read it, write in it the only line: "<?php phpinfo(); ?>" (without the quotation marks) then, with your web browser, go to the URI "http://localhost/test.php": if you can see a description of PHP5 configuration, it proves PHP 5 works with Apache.

==== Troubleshooting PHP 5 ====

Does your browser ask if you want to '''download the php''' file instead of displaying it?  If Apache is not actually parsing the php after you restarted it, install <code>libapache2-mod-php5</code>.  It is installed when you install the <code>php5</code> package, but may have been removed inadvertently by packages which need to run a different version of php.

If <code>sudo a2enmod php5</code> returns "$ This module does not exist!", you should purge (not just remove) the <code>libapache2-mod-php5</code> package and reinstall it.

Be sure to clear your browser's cache before testing your site again. To do this in Firefox 4: Edit → Preferences … Privacy → History: clear your recent history → Details : choose "Everything" in "Time range to clean" and check only "cache", then click on "Clear now".

Remember that, for Apache to be called, the URI in your web browser must begin with "http://". If it begins with "file://", then the file is read directly by the browser, without Apache, so you get (X)HTML and CSS, but no PHP. If you didn't configure any host alias or virtual host, then a local URI begins with "http://localhost", "http://127.0.0.1" or http://" followed by your IP number.

If the problem persists, check your PHP file authorisations (it should be readable at least by Ubuntu user "apache"), and check if the PHP code is correct. For instance, copy your PHP file, replace your whole PHP file content by "<?php phpinfo(); ?>" (without the quotation marks): if you get the PHP test page in your web browser, then the problem is in your PHP code, not in Apache or PHP configuration nor in file permissions. If this doesn't work, then it is a problem of file authorisation, Apache or PHP configuration, cache not emptied, or Apache not running or not restarted. Use the display of that test file in your web browser to see the list of files influencing PHP behaviour.

==== php.ini development vs. production ====

After standard installation, php configuration file ''/etc/php5/apache2/php.ini'' is set so as "production settings" which means, among others, that no error messages are displayed. So if you e.g. make a syntax error in your php source file, apache server would return HTTP 500 error instead of displaying the php syntax error debug message.

If you want to debug your scripts, it might be better to use the "development" settings. Both development and production settings ini's are located in /usr/share/php5/

<pre>
/usr/share/php5/php.ini-development
/usr/share/php5/php.ini-production
</pre>
so you can compare them and see the exact differences.

To make the "development" settings active, just backup your original php.ini
<pre>
sudo mv /etc/php5/apache2/php.ini /etc/php5/apache2/php.ini.bak
</pre>

and create a symlink to your desired settings:
<pre>
sudo cp -s /usr/share/php5/php.ini-development /etc/php5/apache2/php.ini
</pre>

or you may of course also edit the ''/etc/php5/apache2/php.ini'' directly on your own, if you wish.

==== PHP in user directories ====

According to <nowiki>[[http://blag.borap.net/2010/05/04/re-enabling-php-in-user-directories-in-ubuntu-10-04/|this blog]]</nowiki>, newer versions of Ubuntu do '''not''' have PHP enabled by default for user directories (your `public_html` folder).  See the blog for instructions on how to change this back.

=== Installing MYSQL with PHP 5 ===

Use <nowiki>[[InstallingSoftware| any method]]</nowiki> to install

<pre>
mysql-server libapache2-mod-auth-mysql php5-mysql
</pre>

=== After installing PHP ===

You may need to increase the memory limit that PHP imposes on a script.  Edit the /etc/php5/apache2/php.ini file and increase the ''memory_limit'' value.

=== After installing MySQL ===

==== Set mysql bind address ====

Before you can access the database '''from other''' computers in your network, you have to change its bind address.
'''Note that this can be a security problem, because your database can be accessed by other computers than your own.
Skip this step if the applications which require mysql are running on the same machine.'''

type:
<pre>
$ sudo nano /etc/mysql/my.cnf
</pre>

and change the line:
<pre>
bind-address           = localhost
</pre>
to your own internal ip address e.g. 192.168.1.20
<pre>
bind-address           = 192.168.1.20
</pre>

If your ip address is dynamic you can also comment out the bind-address line and it will default to your current ip.

If you try to connect without changing the bind-address you will recieve a "Can not connect to mysql error 10061".

==== Set mysql root password ====

Before accessing the database by console you need to type:
<pre>
$ mysql -u root
</pre>

At the mysql console type:
<pre>
$ mysql> SET PASSWORD FOR 'root'@'localhost' = PASSWORD('yourpassword');
</pre>

A successful mysql command will show:

''Query OK, 0 rows affected (0.00 sec) ''

Mysql commands can span several lines.  Do not forget to end your mysql command with a semicolon.

'''Note:'''  If you have already set a password for the mysql root, you will need to use:
<pre>
$ mysql -u root -p
</pre>
(Did you forget the mysql-root password?  See MysqlPasswordReset.)

==== Create a mysql database ====

<pre>
$ mysql> CREATE DATABASE database1;
</pre>

==== Create a mysql user ====

For creating a new user with all privileges (use only for troubleshooting), at mysql prompt type:
<pre>
$ mysql> GRANT ALL PRIVILEGES ON *.* TO 'yourusername'@'localhost' IDENTIFIED BY 'yourpassword' WITH GRANT OPTION;
</pre>

For creating a new user with fewer privileges (should work for most web applications) which can only use the database named "database1", at mysql prompt type:
<pre>
$ mysql> GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES ON database1.* TO 'yourusername'@'localhost' IDENTIFIED BY 'yourpassword';
</pre>

''yourusername'' and ''yourpassword'' can be anything you like. ''database1'' is the name of the database the user gets access to. ''localhost'' is the location which gets access to your database. You can change it to '%' (or to hostnames or ip addresses) to allow connections from every location (or only from specific locations) to the database. '''Note, that this can be a security problem and should only be used for testing purposes!'''

To exit the mysql prompt type:
<pre>
$ mysql> \q
</pre>

Since the mysql root password is now set, if you need to use mysql again (as the mysql root), you will need to use:
<pre>
$ mysql -u root -p
</pre>

and then enter the password at the prompt.

==== Backup-Settings ====

Please, let's say something in which directories mysql stores the database information and how to configure a backup

==== Alternatively ====
There is more than just one way to set the mysql root password and create a database.  For example '''mysqladmin''' can be used:

<pre>
$ mysqladmin -u root -p password yourpassword
</pre>

and

<pre>
$ mysqladmin -u root -p create database1
</pre>

''mysqladmin'' is a command-line tool provided by the default LAMP install.

=== Phpmyadmin and mysql-workbench ===

All mysql tasks including setting the root password and creating databases can be done via a graphical interface using '''phpmyadmin''' or '''mysql-workbench'''.

To install one or both of them, first enable the universe repository

* <nowiki>[[Repositories-CommandLine| I am using Ubuntu server (command line)]]</nowiki>
* <nowiki>[[AddingRepositoriesHowto| I am using a desktop]]</nowiki>

Use <nowiki>[[InstallingSoftware| any method]]</nowiki> to install

<pre>
phpmyadmin
</pre>

==== Troubleshooting Phpmyadmin & mysql-workbench ====
'''If you get blowfish_secret error:'''
Choose and set a phrase for cryptography in the file /etc/phpmyadmin/blowfish_secret.inc.php  and copy the line (not the php tags) into the file /etc/phpmyadmin/config.inc.php or you will receive an error.

'''If you get a 404 error upon visiting http://localhost/phpmyadmin:'''
You will need to configure apache2.conf to work with Phpmyadmin.

<pre>
$ gksudo gedit /etc/apache2/apache2.conf
</pre>

Include the following line at the bottom of the file, save and quit.

<pre>
$ Include /etc/phpmyadmin/apache.conf
</pre>

==== Alternative: install phpMyAdmin from source ====
See the <nowiki>[[https://help.ubuntu.com/community/phpMyAdmin|phpMyAdmin]]</nowiki> page for instructions on how to install phpmyadmin from source:

==== Mysql-workbench ====
Mysql-workbench runs locally, on the desktop.  Use <nowiki>[[InstallingSoftware| any method]]</nowiki> to install

<pre>
mysql-workbench
</pre>

==== For more information ====
<nowiki>[[http://dev.mysql.com/doc/mysql/en/default-privileges.html|2.9.3. Securing the Initial MySQL Accounts]]</nowiki> from the <nowiki>[[http://dev.mysql.com/doc/mysql/en/index.html|MySQL Reference Manual]]</nowiki> is worth reading.

=== Edit Apache Configuration ===
You may want your current user to be the PHP pages administrator. To do so, edit the Apache configuration file :
<pre>
$ gksudo "gedit /etc/apache2/envvars"
</pre>
Search both the strings starting by "APACHE_RUN_USER" and "APACHE_RUN_GROUP", and change the names to the current username and groupname you are using.
Then you'll need to restart Apache. (look at the next chapter concerning apache commands)

Configuration options relating specifically to user websites (accessed through localhost/~username) are in /etc/apache2/mods-available/userdir.conf and managed with the a2enmod and a2dismod commands.

=== Installing suPHP ===

suPHP is a tool for executing PHP scripts with the permissions of their owners. It consists of an Apache module (mod_suphp) and a setuid root binary (suphp) that is called by the Apache module to change the uid of the process executing the PHP interpreter.

Note: suPHP enforces, security and helps avoid file permission problems under development environments with several users editing the site files, but it also demands more memory and CPU usage, which can degrade your server performance under certain circumstances.

To only install suPHP. use <nowiki>[[InstallingSoftware| any method]]</nowiki> to install the package

<pre>
libapache2-mod-suphp
</pre>

Enable this module by doing

<pre>
sudo a2enmod suphp
</pre>

then use a text editor such as "sudo nano" at the command line or "gksudo gedit" on the desktop to edit this file

<pre>
sudo nano /etc/apache2/mods-available/php5.conf
</pre>

or

<pre>
gksu "gedit /etc/apache2/mods-available/php5.conf"
</pre>

make a new empty line at the top of the content, then add

<pre>
<Directory /usr/share>
</pre>

make a new empty line at the bottom of the content, then add

<pre>
</Directory>
</pre>

save changes

For security reasons we need to specify to suPHP what are the document paths allowed to execute scripts, use a text editor such as "sudo nano" at the command line or "gksudo gedit" on the desktop to edit this file

<pre>
sudo nano /etc/suphp/suphp.conf
</pre>

or

<pre>

gksu "gedit /etc/suphp/suphp.conf

</pre>

find the value "docroot" and specify the document path of your site files, for example:

<pre>
docroot=/var/www/
</pre>

that value restrict script execution only to files inside "/var/www/"

<pre>
docroot=/var/www/:${HOME}/public_html
</pre>

that value restrict script execution only to files inside a custom home folder for each configured user inside "/var/www/:${HOME}/public_html"

for this tutorial we are going to use this value

<pre>
docroot=/home/user/public_html/
</pre>

which is the same Apache directory directive set before in this document

save changes

to restart Apache, type in your terminal

<pre>
sudo /etc/init.d/apache2 restart
</pre>

Now lets create a test script to see if suPHP is working correctly, in your terminal type

<pre>
echo "<?php echo 'whoim = '.exec('/usr/bin/whoami');?>" | tee /home/user/public_html/whomi.php
</pre>

that command creates a quick php test file to display the current user executing the script

open your browser and navigate to "localhost/whomi.php", most likely the browser will show you a "500" server error, this is because suPHP does not allow too permissive file and folder permissions and also does not allow mixed file and folder ownership, to correct this type in your terminal

<pre>
sudo find /home/user/public_html/ -type f -exec chmod 644 {} \;
sudo find /home/user/public_html/ -type d -exec chmod 755 {} \;
sudo chown user:group -R /home/user/public_html/
</pre>

those commands enforce a secure and correct file and folder permission and also set a correct user and group ownership for all of them

Now open your browser and navigate to "localhost/whomi.php", if everything went fine you should see the name of the file owner executing the script and not "www-data" unless you specified so

=== Run, Stop, Test, And Restart Apache ===
Use the following command to run Apache :
<pre>
$ sudo /usr/sbin/apache2ctl start
</pre>
To stop it, use :
<pre>
$ sudo /usr/sbin/apache2ctl stop
</pre>
To test configuration changes, use :
<pre>
$ sudo /usr/sbin/apache2ctl configtest
</pre>
Finally, to restart it, run :
<pre>
$ sudo /usr/sbin/apache2ctl restart
</pre>

Alternatively, you can use a graphical interface by installing <nowiki>[[https://launchpad.net/rapache|Rapache]]</nowiki> or the simpler <nowiki>[[https://launchpad.net/localhost-indicator|localhost-indicator]]</nowiki>.
=== Using Apache ===
You can access apache by typing 127.0.0.1 or http://localhost (by default it will be listening on port 80) in your browser address bar.
By default the directory for apache server pages is /var/www .
It needs root access in order to put files in. A way to do it is just starting the file browser as root in a terminal:
<pre>
$ gksudo nautilus
</pre>

or

if you want to make /var/www your own. (Use only for non-production web servers - this is not the most secure way to do things.)
<pre>
$ sudo chown -R $USER:$USER /var/www
</pre>

=== Status ===
To check the status of your PHP installation:
<pre>
 $ gksudo "gedit /var/www/testphp.php"
</pre>
and insert the following line
<pre>
 <?php phpinfo(); ?>
</pre>

View this page on a web browser at http://yourserveripaddress/testphp.php or http://localhost/testphp.php

=== Securing Apache ===
If you just want to run your Apache install as a development server and want to prevent it from listening for incoming connection attempts, this is easy to do.
<pre>
$ gksudo "gedit /etc/apache2/ports.conf"
$ password:
</pre>

Change ports.conf so that it contains:
<pre>
Listen 127.0.0.1:80
</pre>

Save this file, and restart Apache (see above). Now Apache will serve only to your home domain, http://127.0.0.1 or http://localhost.

=== Password-Protect a Directory ===

There are 2 ways to password-protect a specific directory.
The recommended way involves editing
<code> /etc/apache2/apache2.conf </code>.
(To do this, you need root access).
The other way involves editing a <code>.htaccess</code> file in the directory to be protected.
(To do this, you need access to that directory).

==== Password-Protect a Directory With .htaccess ====

See EnablingUseOfApacheHtaccessFiles

'''Warning: On at least some versions of Ubuntu, <code>.htaccess</code> files will not work by default. See EnablingUseOfApacheHtaccessFiles for help on enabling them.'''

=== thumbnails ===

If you direct your web browser to a directory (rather than a specific file),
and there is no "index.html" file in that directory,
Apache will generate an index file on-the-fly listing all the files and folders in that directory.
Each folder has a little icon of a folder next to it.

To put a thumbnail of that specific image (rather than the generic "image icon")
next to each image file (.jpg, .png, etc.):

''... todo: add instructions on how to do thumbnails here, perhaps using <nowiki>[[http://aspn.activestate.com/ASPN/CodeDoc/Apache-AutoIndex/AutoIndex.html|Apache::AutoIndex 0.08]]</nowiki> or <nowiki>[[http://aspn.activestate.com/ASPN/CodeDoc/Apache-Album/Album.html|Apache::Album 0.95]]</nowiki> ... ''

=== Known problems ===

==== Skype incompatibility ====
<nowiki>[[Skype]]</nowiki> uses port 80 for incoming calls, and thus, may block Apache. The solution is to change the port in one of the applications. Usually, port 81 is free and works fine. To change the port number in <nowiki>[[Skype]]</nowiki> go to menu Tools > Options, then click on the Advanced tab, then in the box of the port for incoming calls write your preference.

=== Other Apache Options ===
* ServerSideIncludes - enable SSI in Apache2
* LocalhostSubdomain - access your local files as if you had different subdomains

=== Further Information ===
* StrongPasswords is recommended reading!
* BastilleLinux is also recommended if you're going to be running a live webserver.
* You can compile <nowiki>[[PHP5FromSource]]</nowiki>, as well as <nowiki>[[MYSQL5FromSource]]</nowiki>.
* <nowiki>[[PHPOracle]]</nowiki> will enable you to connect to Oracle databases.
* PhpPear : PHP Extension and Application Repository
