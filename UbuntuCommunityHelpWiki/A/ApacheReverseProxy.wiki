{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==
This solution solves the problem of having multiple servers on a LAN which has a single router connected to the Internet. The router forwards all port 80 traffic to a single primary server. That server will then be required to act as a proxy for the other servers on the LAN, redirecting incoming traffic addressed to the URLs of those other servers to their respective LAN IP addresses.

This increases the amount of traffic passing through the primary server, so is not a recommended solution for high volume situations (unless the primary server is a dedicated gateway/proxy server). An alternative to this method is to use the <nowiki>[[https://help.ubuntu.com/community/Pound|Pound Reverse Proxy]]</nowiki> server.

This method uses Apache2 virtual host configuration files on the primary server (to which the router sends port 80 traffic).

* On the primary server (which will act as the proxy), create a symbolic link to enable the proxy modules in Apache2, then restart Apache2:
<pre>
 sudo ln -s /etc/apache2/mods-available/proxy.load /etc/apache2/mods-enabled
 sudo ln -s /etc/apache2/mods-available/proxy_http.load /etc/apache2/mods-enabled
 sudo /etc/init.d/apache2 restart
</pre>

* Edit a virtual host file for all secondary servers:
<pre>
 sudo gedit /etc/apache2/sites-enabled/proxiedhosts
</pre>

and edit the file so that it resembles:

<pre>
 <VirtualHost *:80>
# 
 ServerName ''internalserver2.mydomain.org''
# 
     ProxyPreserveHost On
     ProxyRequests off
     ProxyPass / http://''192.168.1.192''/
     ProxyPassReverse / http://''192.168.1.192''/
# 
 </VirtualHost>
# 
# <VirtualHost *:80>
# 
# ServerName ''internalserver3.mydomain.org'
# 
# ProxyPreserveHost On
# ProxyRequests off
# ProxyPass / http://''192.168.1.193''/
# ProxyPassReverse / http://''192.168.1.193''/
# 
# </VirtualHost>
# 
# <VirtualHost *:80>
# 
# ServerName ''internalserver4.mydomain.org'
# 
# ProxyPreserveHost On
# ProxyRequests off
# ProxyPass / http://''192.168.1.194''/
# ProxyPassReverse / http://''192.168.1.194''/
# 
# </VirtualHost>
</pre>
Make sure each URL for each server has an entry (and obviously remove the hashmarks for each one that is active).

* Activate the virtual host file by making a symbolic link to the Apache2 sites-enabled folder then restarting Apache2:
<pre>
 sudo ln -s /etc/apache2/sites-enabled/proxiedhosts /etc/apache2/sites-enabled
 sudo /etc/init.d/apache2 restart
</pre>

=== Other resources ===
Much of this page was adapted from the originals at:
* <nowiki>[[http://ubuntuguide.org/wiki/Apache2_reverse_proxies|Ubuntuguide.org -- Apache2 Reverse Proxies]]</nowiki>
* <nowiki>[[http://www.kubuntuguide.info/index.php/Apache2_reverse_proxies|Kubuntuguide -- Apache2 Reverse Proxies]]</nowiki>

The information for this page was synthesized from these sources:
* <nowiki>[[http://jeffbaier.com/articles/configuring-apache-virtual-hosts-for-nat/| Configuring Apache virtual hosts for NAT]]</nowiki> -- blog tutorial for Apache ProxyPass
* <nowiki>[[http://www.raskas.be/blog/2006/04/21/reverse-proxy-of-virtual-hosts-with-apache-2/|Reverse proxy of virtual hosts with apache 2]]</nowiki>
* <nowiki>[[http://httpd.apache.org/docs/2.2/mod/mod_proxy.html#proxypass|Apache2 mod_proxy instructions]]</nowiki>

----
CategoryInternet
