{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__



== Язык статьи ==

{| class="wikitable"
|-
| '''<nowiki>[[ATAOverEthernet|En]]</nowiki>'''
| 
| '''<nowiki>[[ATAOverEthernet_RU|Ru]]</nowiki>'''
|}
== Введение ==

На сегодняшний день существует программное обеспечение: модуль ядра (aoe), инструменты (aoetools) и серверное ПО (vblade), которое позволяет любому человеку построить сеть хранения данных ATA over Ethernet… и это очень легко сделать в Ubuntu.

Это программное обеспечение доступно в версии Dapper 6.06 LTS и более поздних...

ПРЕДОСТЕРЕЖЕНИЕ: Эти команды необходимо запускать с правами root (sudo -i). Занимайтесь этим на свой страх и риск.

ПРЕДОСТЕРЕЖЕНИЕ:
Не монтируйте целевое устройство от более чем одного клиента, иначе произойдет сбой в файловой системе. Чтобы сделать это, используйте что-нибудь вроде <nowiki>[[http://en.wikipedia.org/wiki/Global_File_System|GFS]]</nowiki>.

== Необходимые пакеты ==

При включенном репозитории Universe..

На хосте Ubuntu, который вы планируете использовать как дисковый сервер (в следствие ошибки в Ubuntu 8.04 LTS для работы вам необходим vblade версии 14-1ubuntu1.1. Смотрите <nowiki>[[https://launchpad.net/bugs/223440|bug #223440]]</nowiki> для более детализированной информации):
<pre>
  (server)# apt-get install vblade
</pre>
На хосте Ubuntu, на который вы хотели бы монтировать диск:
<pre>
  (client)# apt-get install aoetools
</pre>

== Чтобы установить интерфейс ==
Важно заметить, что для его работы IP-адрес не требуется.

<pre>
# ip link set eth0 up
</pre>

== Чтобы создать устройство AoE ==
Чтобы проверить, что все работает, мы  создали и использовали файл размером 1 Мбайт (vblade0). Вместо него можно было использовать любое другое блочное устройство или файл.

На сервере:
<pre>
  (server)# dd if=/dev/zero of=vblade0 count=1 bs=1M
  (server)# vblade 1 1 eth0 vblade0
  ioctl returned 0
  1048576 bytes
  pid 25000: e1.1, 2048 sectors
</pre>
Демон ('vbladed') может быть использован вместо 'vblade', он отвязывает процесс от консоли и посылает сообщения в системные логи.

== Использование AoE ==

Модуль 'aoe' должен быть автоматически загружен, когда установлен пакет 'aoetools'. Имейте в виду, что у вас не будет возможности обнаружить устройства AoE до тех пор, пока вы не укажите для vblade интерфейс lo
 
Если этого не произошло, поместите модуль в ядро линукса.
<pre>
  (client)# modprobe aoe
</pre>

опционально при загрузке модуля может быть указан список интерфейсов
<pre>
   (client)# modprobe aoe aoe_iflist="eth0 eth1"
</pre>

Это может быть выполнено автоматически при старте добавлением строки в файл /etc/modules.

В Ubuntu 6.06 (или любых других системах без udev), создайте папку 'etherd': 

<pre>
  (client)# mkdir /dev/etherd
</pre>

В Ubuntu  8.04 добавьте необходимые правила к udev (для этого нет необходимости в версиях 9.04 или позже, см. <nowiki>[[https://launchpad.net/bugs/234033|bug #234033]]</nowiki>):

<pre>
   (client)# cat > /etc/udev/rules.d/60-aoe.rules << EOM
SUBSYSTEM=="aoe", NAME="etherd/%k", GROUP="disk", MODE="0220"
SUBSYSTEM=="aoe", KERNEL=="err", MODE="0440"
EOM
   (client)# /etc/init.d/udev restart
</pre>

Далее, получить доступ к устройствам:

<pre>
  (client)# aoe-interfaces eth0
  (client)# aoe-discover
  (client)# aoe-stat
      e1.1         0.001GB   eth0 up 
</pre>
Блочное устройство, таким образом, располагается в /dev/etherd/e1.1 и может быть обработано как любое другое блочное устройство.

Создать файловую систему:
<pre>
  (client)# mke2fs /dev/etherd/e1.1
</pre>
Создать точку монтирования и монтировать файловую систему:
<pre>
  (client)# mkdir /mnt/e1.1
  (client)# mount /dev/etherd/e1.1 /mnt/e1.1
</pre>
Можно сделать автоматическое монтирование при перезагрузке, внесением конфигурационной строки в /etc/fstab (не тестировалось)

== Примечание ==

Этот документ является переводом оригинальной статьи
* https://help.ubuntu.com/community/ATAOverEthernet

== Ссылки ==

* http://www.coraid.com/support/linux/EtherDrive-2.6-HOWTO.html (уже не рабочая)
* http://en.wikipedia.org/wiki/ATA_over_Ethernet
* http://en.wikipedia.org/wiki/Global_File_System

----
CategoryHardware CategoryNetworking
