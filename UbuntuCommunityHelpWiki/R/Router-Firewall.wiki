{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

See: <nowiki>[[UFW]]</nowiki>

== Basic ==
Install the Uncomplicated Firewall, package name is '''ufw'''. Uncomplicated firewall just sets up
iptables using a simple syntax, or an extended syntax based on OpenBSD's PF. To use ```ufw``` for
routing, you must know iptables and should edit the files in /etc/ufw/*.rules.

== Advanced ==

The following is a specific example of a firewall script using only iptables.

<pre>

EXTIF="eth0"

EXTIP=$(/sbin/ip addr show dev "$EXTIF" | perl -lne 'if(/inet (\S+)/){print$1;last}');
 
INTIF="br0"

INTIP="192.168.0.1/32"

INTNET="192.168.0.0/24"

UNIVERSE="0.0.0.0/0"

echo "External: [Interface=$EXTIF] [IP=$EXTIP]"
echo "Internal: [Interface=$INTIF] [IP=$INTIP] [Network:$INTNET]"

echo
echo -n "Loading rules..."

echo 1 > /proc/sys/net/ipv4/ip_forward

/sbin/iptables-restore <<-EOF;

* filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]

-A INPUT -i lo -s $UNIVERSE -d $UNIVERSE -j ACCEPT

-A INPUT -i $INTIF -s $INTNET -d $UNIVERSE -j ACCEPT

-A INPUT -i $EXTIF -s $INTNET -d $UNIVERSE -j REJECT

-A INPUT -i $EXTIF -p ICMP -s $UNIVERSE -d $EXTIP -j ACCEPT

-A INPUT -i $EXTIF -s $UNIVERSE -d $EXTIP -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

-A INPUT -i $INTIF -p tcp --sport 68 --dport 67 -j ACCEPT
-A INPUT -i $INTIF -p udp --sport 68 --dport 67 -j ACCEPT

-A INPUT -i $EXTIF -m conntrack --ctstate NEW,ESTABLISHED,RELATED -p tcp -s $UNIVERSE -d $EXTIP --dport 80 -j ACCEPT
-A INPUT -i $EXTIF -m conntrack --ctstate NEW,ESTABLISHED,RELATED -p tcp -s $UNIVERSE -d $EXTIP --dport 443 -j ACCEPT

-A INPUT -i $EXTIF -m conntrack --ctstate NEW,ESTABLISHED,RELATED -p tcp -s $UNIVERSE -d $EXTIP --dport 22 -j ACCEPT

-A INPUT -s $UNIVERSE -d $UNIVERSE -j REJECT

-A OUTPUT -m conntrack -p icmp --ctstate INVALID -j DROP

-A OUTPUT -o lo -s $UNIVERSE -d $UNIVERSE -j ACCEPT

-A OUTPUT -o $INTIF -s $EXTIP -d $INTNET -j ACCEPT

-A OUTPUT -o $INTIF -s $INTIP -d $INTNET -j ACCEPT

-A OUTPUT -o $EXTIF -s $UNIVERSE -d $INTNET -j REJECT

-A OUTPUT -o $EXTIF -s $EXTIP -d $UNIVERSE -j ACCEPT

-A OUTPUT -o $INTIF -p tcp -s $INTIP --sport 67 -d 255.255.255.255 --dport 68 -j ACCEPT
-A OUTPUT -o $INTIF -p udp -s $INTIP --sport 67 -d 255.255.255.255 --dport 68 -j ACCEPT

-A OUTPUT -s $UNIVERSE -d $UNIVERSE -j REJECT

-A FORWARD -i $EXTIF -o $INTIF -m conntrack --ctstate ESTABLISHED,RELATED  -j ACCEPT

-A FORWARD -i $INTIF -o $INTIF -j ACCEPT

-A FORWARD -i $INTIF -o $EXTIF -j ACCEPT

-A FORWARD -j REJECT

COMMIT

* nat
:PREROUTING ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

-A POSTROUTING -o $EXTIF -j MASQUERADE

COMMIT
EOF

echo " done."
</pre>
Or use '''<nowiki>[[http://firehol.sourceforge.net/|fireHOL]]</nowiki>'''
