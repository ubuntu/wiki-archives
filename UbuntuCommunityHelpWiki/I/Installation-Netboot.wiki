{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__



== Netboot Install ==

This HOWTO describes the steps required to start an installation of Ubuntu over the network. This is useful, for example, if you have an old machine with a non-bootable CD-ROM.

'''NOTE: Both netboot and installation from CD, of any release greater than 6.06, will fail on many SPARC machines with the message "Fast Data Access MMU miss". The netboot fails after A00000 bytes have been downloaded. The reason is, that SPARC only allocates around 4 MB for the kernel at boot time, and initrd exceeds this size.'''

=== Alternatives ===

If you have a bootable optical drive and you are looking for a minimal CD image to download packages at install time, look at the <nowiki>[[Installation-MinimalCD]]</nowiki>.

See <nowiki>[[Installation-QuickNetboot]]</nowiki> for alternative netboot instructions.

See <nowiki>[[Installation-NetbootInstallFromInternet]]</nowiki> for another (simpler) method which requires you to already have Grub installed, but does not require you to configure a DHCP or TFTP server.

See <nowiki>[[http://maas.ubuntu.com/docs/install.html|MAAS instructions]]</nowiki> to see how to set up a MAAS server which will deploy Ubuntu system through netboot.

=== Introduction ===

You must modify the host names and IP addresses in this HOWTO for your own setup. The principles described here are applicable to other DHCP and TFTP servers than those described below; using alternate server software is left as an exercise for the reader.

For instructions on how to use a windows computer as the TFTP and DHCP server, head to <nowiki>[[Installation-WindowsServerNetboot]]</nowiki>.

This HOWTO will get you as far as running the installer; if you want to perform automated or unattended installs of Ubuntu, see <nowiki>[[Installation-LocalNet]]</nowiki>.

=== The scenario ===

One old Celeron 420Mhz with non-bootable CD-ROM, (kanga, 172.31.0.242). This is the target for installation. It has a bootable floppy disk.

A DHCP server (roo, 172.31.0.252), using dnsmasq as the DHCP server. roo has a pretty much home made Linux on it. I added tftp-hpa to it (installation of tftp on Ubuntu or Debian is explained in further detail below).  dnsmasq's tftp support is enough to netboot, but this example uses a separate tftp daemon.

Assumption: You are behind a firewall and will not expose services used for this exercise to the world. You have a reasonably fast network connection, not 56k dial-up.

=== Set Up DHCP-BOOT ===

==== On roo (the DHCP server): ====

* In /etc/dnsmasq.conf, add the line:
<pre>
  dhcp-boot=pxelinux.0,roo,172.31.0.252
</pre>

This machine already serves an IP address to kanga via DHCP. (See "DHCP Note" below for help setting up this sort of arrangement.)

* Restart dnsmasq.
<pre>
  /etc/init.d/dnsmasq restart
</pre>

==== Install the tftp-server ====

There are two different versions for the Trivial File Transfer Protocol server, the original tftpd and tftpd-hpa. For Etherboot installation (see below) tftpd will suffice, but it cannot do PXE installs due to the lack of the tsize option. Use tftpd-hpa instead. On Ubuntu or Debian (adapt for other distros or install from source):

<pre>
  apt-get install tftpd-hpa tftp-hpa xinetd
</pre>

(Note: xinetd is not part of the default install)

===== If you have an installation CD =====

* Insert the installation CD in the drive

* Copy the netboot files into a suitable directory, e.g. /var/lib/tftpboot

===== If you do not have an installation CD =====

* Download the appropriate netboot.tar.gz file from http://cdimage.ubuntu.com/netboot/

* Unpack into a suitable directory, e.g. /var/lib/tftpboot

<pre>
  tar -xvzf netboot.tar.gz -C /var/lib/tftpboot/
  chown -R nobody:nogroup /var/lib/tftpboot
</pre>

* Enable the tftpd server. Add the following as /etc/xinetd.d/tftp.
<pre>
  service tftp
  {
        disable                 = no
        socket_type             = dgram
        wait                    = yes
        user                    = root
        server                  = /usr/sbin/in.tftpd
        server_args             = -v -s /var/lib/tftpboot
        only_from   = 172.31.0.240/28
        interface   = 172.31.0.252
  }
</pre>

* Restart xinetd
<pre>
 killall -HUP xinetd
</pre>

==== If your target PC for installation can network boot ====

* Reboot the target PC

* Interrupt the boot and enter the Bios settings screen

* Choose the 'Network Boot' option

* Resume booting

* Marvel as the Ubuntu installer starts over the net

 ''Warning - don't forget to reset the BIOS to 'Boot from the hard disk' next time you reboot the PC ;-)''

==== If your target PC for installation cannot network boot ====

===== On any machine: =====

* Build a gPXE boot floppy, CD, or USB key.  Complete instructions are <nowiki>[[http://etherboot.org/wiki/howtos|here]]</nowiki>.  gPXE evolved from Etherboot, and is maintained by the Etherboot project. 

===== Start the install =====

* Boot the install target (kanga) from the gPXE boot media.

* Marvel as the Ubuntu installer starts over the net.

== Q&A ==
** '''Q:''' I've noticed you didn't add the interface MAC address. Each and every tutorial I've see stressed the importance of the MAC address to allow the net booting machine authorized on the boot server, is this redundant and can be ignored altogether? --SivanGreen

** '''A:''' "It Depends"(tm)  Either way will work - each has pros and cons.  You don't need it, but that increases the risk of some other machine's system getting installed over.

** '''Q:''' Hmm, has someone gotten this to work? Using etherboot-5.3.12 with defaults (cd src ; make bin/via-rhine.zfd0 - the defaults include -DPXE_IMAGE and -DPXE_EXPORT ), the boot process seems to stop after loading the file from TFTP:
  <code>Loading 192.168.0.2:pxelinux.0 ..(PXE)done</code>
  Also, it may be worth mentioning that the images from http://rom-o-matic.net/ (the referred-to Etherboot manual has a link to this site) don't support PXE images at all. --PeterParkkali

** '''A:''' I have had good luck with both.  I have used rom-o-matic.net for 4 or 5 nics, they do support pxe.

** '''Q:''' The kernel in the Breezy netboot images doesn't contain driver XXXX which I need to install with.  How can I rebuild the netboot kernel image & initrd.gz to include XXXX? --KeithHopkins

** '''Q:''' If you installed netboot for a beta release, such as Feisty, do you need to update netboot again to install the official Feisty release later on?  Would the differences be limited to the operation of the netboot installation script, or would you potentially end up with a hybrid target system, such as a mixture of the beta kernel with the release userland?  --Allan

** '''A:''' The hybrid target system is unlikely unless the netboot image can find its matching kernel online.  If the netboot installer seeks an old kernel version which is no longer available in the repository, it will fail.  --<nowiki>[[https://wiki.ubuntu.com/RyanStonecipherFisher|Ryan Stonecipher-Fisher]]</nowiki>

== Note ==
For machines behind DHCP-enabled routers using the etherboot floppy method, the automatic detection of DHCP and TFTP servers may default to the router's address.  In the following workaround, the target and server computers use the IP addresses for "kanga" and "roo" from the above example, respectively.  After extracting the tarball for Etherboot, one can add the following lines to the file "Config" in the extracted "src/" directory:
<pre>
CFLAGS+=    -DUSE_STATIC_BOOT_INFO
CFLAGS+=    -DSTATIC_CLIENT_IP=\"172.31.0.242\"
CFLAGS+=    -DSTATIC_SUBNET_MASK=\"255.255.255.0\"
CFLAGS+=    -DSTATIC_SERVER_IP=\"172.31.0.252\"
CFLAGS+=    -DSTATIC_GATEWAY_IP=\"172.31.0.252\"
CFLAGS+=    -DSTATIC_BOOTFILE=\"tftp://172.31.0.252/pxelinux.0\"
</pre>
Running the appropriate make command for the target machine's interface will then create a bootable floppy which only connects to the chosen server.  The DHCP server and dnsmasq are not necessary to use static IP addresses.
2006-08-08 RSF

----
I needed to disable the J-Micron SATA controller on Asus N4L-VM motherboard to make the network boot ROM run.
----
See also: <nowiki>[[Installation-LocalNet]]</nowiki> and http://wiki.heinous.org/index.php/Ubuntu_Notes

== Note ==
As of 12/9/2006, the heinous.org link is dead.
Also, etherboot does not support PCMCIA/PCcard.  AFAIK, laptops with only PCMCIA NICs (wired or wireless) can not be ether booted.

== Note ==
Following these instructions 11/11/07 with DHCP and TFTP from a SUSE 10 server / DELL C400 client, I needed to set filename "pxelinux.0" in the dhcpd.conf. I'm sure that for apt to work later it needs the "option domain-name-servers X.X.X.X; as well (i.e. the IP address of your DNS server / ADSL router). Don't forget <nowiki>[[Installation-LocalNet]]</nowiki>. That's the best page for this.

== DHCP Note ==
I had a d-link router as my DHCP server, and had to do the following to get my linux box to be the DHCP server: 1) switched my workstation to have a static IP address (from "networking" under gnome-control-center). 2) turned off the DHCP server in my router (I assume this helps). 3) used these config lines in my /etc/dnsmasq.conf:
<pre>
  dhcp-boot=pxelinux.0,jhome,192.168.0.103
  dhcp-range=192.168.0.5,192.168.0.99,12h
  dhcp-option=3,192.168.0.1
</pre>
The IP address on the last line is that of the router (gateway).  Hope that helps. -- Jason

== Etherboot note ==
It is now possible to just to create and download an etherboot floppy image from http://www.rom-o-matic.net/ customized for your card.

== Multiple Network Interface Note ==
If the system has multiple network interfaces (like a laptop with both wired and wireless Ethernet) the installer may select the wrong interface for downloading installer components.  You can control it by specifying the boot parameter "netcfg/choose_interface".  For example, using the default install option and specifying eth1 would be: install netcfg/choose_interface=eth1

----
CategoryInstallation
