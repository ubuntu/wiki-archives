{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


 

QEMU creates a virtual machine, similar to VMWare, Virtualbox, KVM, and Xen. It allows you to run one operating system from within another operating system. The operating systems can be the same ones, or different. Your memory resources will be divided between your native (host) OS and your virtual machine (guest) OS. You will therefore notice a decrease in performance of activities in both the host OS and the guest OS.

Therefore, if you plan to use QEMU only to create a Windows virtual environment in order to run Windows programs, consider using one of several free Linux SoftwareEquivalents instead. If you need to run only a single Windows program, also consider using <nowiki>[[Wine]]</nowiki> instead of QEMU. Running a virtual machine environment such as QEMU will slow down your computer noticeably.

Also see <nowiki>[[WindowsXPUnderQemuHowTo]]</nowiki>, https://wiki.ubuntu.com/ScreencastTeam/HowToSetupQEMU .

Also consider trying a QEMU interface, such as <nowiki>[[http://qemulator.createweb.de/|Qemulator]]</nowiki>, or the package <code>qemu-launcher</code>.

Another QEMU GUI is <code>virt-manager</code>. It manages virtual machines not only for QEMU, but also for kvm and xen, in a consistent fashion (through <code>libvirt</code>).

=== What is QEMU ? ===
<nowiki>[[http://bellard.org/qemu/|QEMU]]</nowiki> is a fast processor emulator. The package currently supports arm, powerpc, sparc and x86 emulation. By using dynamic translation it achieves reasonable speed, while being easy to port to new host CPUs. QEMU has two operating modes:
* User mode emulation: QEMU can launch individual Linux processes compiled for one CPU on another CPU.
* Full system emulation: QEMU can emulate a full system, including the processor and peripherals. This enables testing and debugging of system code in a contained (and quarantined) virtual system. It can even be used to host several virtual machines simultaneously on a single server (given enough host processor power and RAM).

As QEMU requires no host kernel patches to run, it is safe and easy to use.

=== Why use an emulator? ===

QEMU emulates everything, including the CPU, so it is slower than the host system. Hardware acceleration will not be as effective for a software OS emulator. Nevertheless, it is a pretty good way of testing a distribution, without having to repartition your drive or set up new hardware.

=== Preparation of the QEMU virtual environment ===

* QEMU is available as a standard package in the <nowiki>[[https://help.ubuntu.com/community/Repositories/Ubuntu#head-5bbef89639d9a7d93fe38f6356dc17847d373096|Universe]]</nowiki> repository. (There are <nowiki>[[https://help.ubuntu.com/community/InstallingSoftware#head-82ee502162e81ddca57bfba9281ad97c39fd7fbeinstructions|on how to install packages elsewhere in this guide]]</nowiki>. Unlike some other virtualization systems (like VMWare), separate kernel modules are not needed.
* Download the Ubuntu ISO file you wish to install into a virtual QEMU environment.
* Recent QEMU versions support networking out of the box. There is a "linux-test" add-on at <nowiki>[[http://www.nongnu.org/qemu/|QEMU's site]]</nowiki>, a one-line script. Alternatively, run this command before starting the emulator:

 sudo /sbin/ip addr add 172.20.0.1/12 dev eth0

* A virtual disk is needed for the virtual machine. A virtual disk is made by creating a file of a size appropriately large to contain the full guest OS:

<code>qemu-img create ubuntu-test 3G</code>

The 'qemu-img'' command (included in the QEMU package) creates a 3Gb image named 'ubuntu-test'. (''qemu-img'' also supports other compressed and VMWare compatible disk-image formats.)

Another way of creating such images is using the standard ''dd'' utility:

<code>dd of=ubuntu-test bs=1024 seek=4194304 count=0</code>

This will create a 4GB file named ''ubuntu-test'' to use as a disk. ''bs'' is the blocksize, ''seek'' is the number of bytes to skip from start of the file being created (a multiple of 1048576 (or 1024K) ). In this case the image would be 4GB. If you wish to get a number to create another size, multiply the number of GB desired by 1024^2 or 1048576. So , 10GB would be 10x1048576 = 10485760.

=== Installation of an operating system from ISO to the QEMU environment ===

We are ready to install the guest OS. Download, for example, <nowiki>[[http://www.ubuntu.com/testing/|the latest development version of Ubuntu]]</nowiki>. Assuming your ISO image is named ''ubuntu-6.10-desktop-i386.iso'' for example:

<code>qemu -hda ubuntu-test -cdrom ubuntu-6.10-desktop-i386.iso -m 192 -boot d</code>

* This command instructs QEMU to use hda as the empty disk file. It uses Ubuntu ISO file as if installing from the CDROM, and sets the amount of memory to use in the virtual machine to be 192Mb. It then instructs to boot from the CDROM.

A word of caution: giving too much memory to the virtual system will make your native host machine start swapping to disk, which will slow things down a lot. On the other hand, giving it too little memory will make the virtual machine start swapping, which will slow things down as well. Clearly, the more RAM you have, the better.

As the installer boots and goes through options, choose the defaults at each step. The installer should detect the virtual network properly and install without diificulties.

* At the end, it will try to reboot the machine, but this will fail.
* Exit the emulator (type "quit" in the emulator console), then rerun:

<code>qemu -hda ubuntu-test -cdrom ubuntu-6.10-desktop-i386.iso -m 192</code>

Note that the boot parameter is removed this time, so that it will boot ubuntu from the new virtual hard drive, not from the "cd". 

* Follow the directions from the installer and create a user. The installer will then fetch updates and add additional packages. This may take between one and two hours, depending on your system configuration and options chosen.
* At one point, it will register all documentation for the help system.
* Graphics display and adapter setup is very easy; the only question is what video modes to support. Leave this at the defaults; the virtual video hardware may not support higher resolutions than those already set.

=== Installing QEMU in Windows ===
The reason to install QEMU in Windows is so that you can run an Ubuntu Server in a virtual machine. Such a virtual machine can be copied and moved.

At this time, it is best to <nowiki>[[http://www.qemu.org/download.html|download the source]]</nowiki> and then compile QEMU in Windows using <nowiki>[[http://www.qemu.org/qemu-doc.html#SEC86|these instructions]]</nowiki>. Once QEMU is running in Windows, usage is the same as in Linux. 

=== Usage ===

First of all, running an OS on emulated hardware is not screamingly, insanely fast. Don't expect to run anything demanding on this system, other than for testing purposes. That said, even on fairly underpowered hardware, it is certainly fast enough to test a distribution, perhaps install some packages, see how it all fits together.

This is also a good tool for increased security system management. QEMU can have a read-only disk image with a separate write-back file, so one use would be to test the installation of an intrusive packages (or test your own packages to make sure they don't break the system) without actually touching your real system. If it turns out it breaks the system, just remove the write-back file and it never happened.

If you have a very fast network connection, you may want to remove the -cdrom parameter for future invocations of QEMU and comment out the line starting with ''deb cdrom:'' (insert a # sign at the beginning) from the command line:

`sudo nano /etc/apt/sources.list`
