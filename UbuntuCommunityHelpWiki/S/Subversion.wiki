{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


'''This wiki document explains how to setup Subversion alias
SVN on Ubuntu. The intended audience is experienced Linux users and system administrators.'''

== Introduction ==

If you are new to Subversion, this section provides a quick introduction.

Subversion is an open source version control system. Using
Subversion, you can record the history of source files and
documents. It manages files and directories over time. A tree
of files is placed into a central repository. The repository
is much like an ordinary file server, except that it remembers
every change ever made to files and directories.

== Assumptions ==

It is assumed that you are aware of how to run Linux commands,
edit files, start/stop services in an Ubuntu
system. It is also assumed that Ubuntu is running, you
have <nowiki>[[RootSudo|sudo access]]</nowiki> and you
want to use Subversion software.

It is also assumed you have an internet connection.

== Scope of this document ==

To make an SVN repository available to access using the HTTP protocol, you
must install & configure web server. Apache 2 is proven to work
with SVN. The installation of Apache 2 Webserver is beyond the
scope of this document. (See <nowiki>[[ApacheHTTPserver]]</nowiki>.) However, the configuration of Apache 2 Webserver
for SVN is covered in this document.

To access an SVN repository using HTTPS protocol, you
must install & configure digital certificate in your Apache 2 web server.
The installation and configuration of digital certificate is beyond the
scope of this document. (See <nowiki>[[OpenSSL]]</nowiki>.)

== Installation ==

Subversion is already in the main repository, so to install Subversion you can simply install the <code>subversion</code> package (see InstallingSoftware).

If it fails reporting dependencies, please locate the
packages and install them. If it reports any other issues,
please resolve them. If you cannot resolve the issue,
please refer the mailing list archive of those packages.

== Server Configuration ==

This step assumes you have installed above mentioned packages
on your system. This section explains how to create SVN repository and
access the project.

=== Create SVN Repository ===

There are several typical places to put a Subversion repository;
most common places are: /srv/svn, /usr/local/svn and /home/svn. For clarity's sake, we'll
assume we are putting the Subversion repository in /home/svn, and your
project's name is simply 'myproject'

There are also several common ways to set permissions on your repository. However,
this area is the most common source of errors in installation, so we will cover it
thoroughly. Typically, you should choose to create a new group called 'subversion' that
will own the repository directory. To do this (see <nowiki>[[AddUsersHowto]]</nowiki> for details):

 1. Choose System >  Administration > Users and Groups from your Ubuntu menu.

 1. Click the 'Manage Groups' button.

 1. Click the 'Add' button.

 1. Name the group 'subversion'

 1. Add yourself and www-data (the Apache user) as users to this group
  (Note: in order to see www-data you may need to see <nowiki>[[FixShowAllUsers]]</nowiki>)

 1. Click 'OK', then click 'Close' twice to commit your changes and exit the app.

You have to logout and login again before you are a member of the subversion group, and can do check ins.

Now issue the following commands:
<pre>
   $ sudo mkdir /home/svn
   $ cd /home/svn
   $ sudo mkdir myproject
</pre>

The SVN repository can be created using the following command:
<pre>
  $ sudo svnadmin create /home/svn/myproject
</pre>

And use the following commands to correct file permissions:
<pre>
   $ cd /home/svn
   $ sudo chown -R www-data:subversion myproject
   $ sudo chmod -R g+rws myproject
</pre>

The last command sets gid for proper permissions on all new files added to your
Subversion repository.

If you want to use WebDAV as an access method described below, repeat the chmod -R g+rws myproject command again. This is because svnadmin will create directories and files without group write access. This is no problem for read only access or using the custom svn protocol but when Apache tries to commit changes to the repository linux will deny it access.
Also the owner and group are set as root. This can be changed by repeating the chown and chgrp commands listed above.

== Access Methods ==

Subversion repositories can be accessed (checkout) through many different
methods-on local disk, or through various network protocols. A
repository location, however, is always a URL. The table describes how
different URL schemas map to the available access methods.

{| class="wikitable"
|-
| <rowbgcolor="#d9bb7a">'''Schema'''
| '''Access Method'''
|-
| `file:///`
| direct repository access (on local disk)
|-
| `http://`
| Access via WebDAV protocol to Subversion-aware Apache 2 web server
|-
| `https://`
| Same as http://, but with SSL encryption
|-
| `svn://`
| Access via custom protocol to an svnserve server
|-
| `svn+ssh://`
| Same as svn://, but through an SSH tunnel
|}

In this section, we will see how to configure SVN for all these access
methods.  Here, we cover the basics. For more advanced usage details,
you are always recommended to refer the <nowiki>[[http://svnbook.red-bean.com/|svn book]]</nowiki>.

=== Direct repository access (file://) ===

This is the simplest of all access methods. It does not require any
SVN server process to be running. This access method is used to access
SVN from the same machine. The syntax is as follows:

<pre>
  $ svn co file:///home/svn/myproject
            or
  $ svn co file://localhost/home/svn/myproject
</pre>

''NOTE: Please note, if you do not specify the hostname, you must use
three forward slashes (///). If you specify the hostname, you must use
two forward slashes (//).''

The repository permission is dependant on filesystem permission. If the
user has read/write permission, he can checkout/commit the changes to the
repository. If you set permissions as above, you can give new users the ability
to checkout/commit by simply adding them to the Subversion group you added above.

=== Access via WebDAV protocol (http://) ===

To access the SVN repository via WebDAV protocol, you must configure
your Apache 2 web server. 

First install the following package <code>libapache2-svn</code> (see InstallingSoftware).

''NOTE: If you have already tried to install the "dav" modules manually, package installation may fail. Simply remove all files beginning with "dav" from the <code>mods-enabled</code> directory, then remove and install the package again. Let the package put files in the correct place, then edit your configuration.''

You must add the following snippet in your
<code>/etc/apache2/mods-available/dav_svn.conf</code> file:

<pre>
  <Location /svn/myproject>
     DAV svn
     SVNPath /home/svn/myproject
     AuthType Basic
     AuthName "myproject subversion repository"
     AuthUserFile /etc/subversion/passwd
     Require valid-user
  </Location>
</pre>

'''NOTE:''' The above configuration assumes that all Subversion repositories are available under <code>/home/svn</code> directory.

'''TIP:''' If you want the ability to browse all projects on this repository by going to the root url (http://www.serveraddress.com/svn) use the following in dav_svn.conf '''instead''' of the previous listing:

<pre>
  <Location /svn>
     DAV svn
     SVNParentPath /home/svn
     SVNListParentPath On
     AuthType Basic
     AuthName "Subversion Repository"
     AuthUserFile /etc/subversion/passwd
     Require valid-user
  </Location>
</pre>

'''NOTE:''' The above configuration requires authentication with any of the users specified within the file to access the repository. If you want to allow anonymous read access to the repositories add the following <LimitExcept ...> and </LimitExcept> lines around the "Require valid-user" line. The previous listing would become:

<pre>
  <Location /svn>
     DAV svn
     SVNParentPath /home/svn
     SVNListParentPath On
     AuthType Basic
     AuthName "Subversion Repository"
     AuthUserFile /etc/subversion/passwd
     <LimitExcept GET PROPFIND OPTIONS REPORT>
        Require valid-user
     </LimitExcept>
  </Location>
</pre>

'''NOTE:''' If a client tries to <code>svn update</code> which involves updating many files, the update request might result in an error <code>Server sent unexpected return value (413 Request Entity Too Large) in response to REPORT request</code>, because the size of the update request exceeds the limit allowed by the server. You can avoid this error by disabling the request size limit by adding the line <code>LimitXMLRequestBody 0</code> between the <Location...> and </Location> lines.

Alternatively, you can allow svn access on a per-site basis. This is done by adding the previous snippet into the desired site configuration file located in
<code>/etc/apache2/sites-available/</code> directory.

Once you add the above lines, you must restart apache2 web server. To restart apache2
web server, you can run the following command:

<pre>
  sudo /etc/init.d/apache2 restart
</pre>

Next, you must create /etc/subversion/passwd file. This file contains
user authentication details. 

If you have just installed SVN, the passwd file will not yet exist and needs to be created using the "-c" switch. Adding any users after that should be done without the "-c" switch to avoid overwriting the passwd file.

To add the first entry, ie.. to add the first user, you can run the following command:

<pre>
  sudo htpasswd -c /etc/subversion/passwd user_name
</pre>

It prompts you to enter the password. Once you enter the password, the user is added.

To add more users after that, you can run the following command:

<pre>
  sudo htpasswd /etc/subversion/passwd second_user_name
</pre>

If you are uncertain whether the passwd file exists, running the command below will tell you whether the file already exists:

<pre>
  cat /etc/subversion/passwd
</pre>

Now, to access the repository you can run the
following command:

<pre>
  $ svn co http://hostname/svn/myproject myproject --username user_name
</pre>

It prompts you to enter the password. You must enter the password
configured using htpasswd command. Once it is authenticated the
project is checked out. 
If you encounter access denied, please remember to logout and login again for your memebership of the subversion user-group to take effect.

'''WARNING: The password is transmitted as plain text. If you are worried
about password snooping, you are advised to use SSL encryption. For
details, please refer next section.'''

=== Access via WebDAV protocol with SSL encryption (https://) ===

Accessing SVN repository via WebDAV protocol with SSL encryption
(https://) is similar to http:// except you must install and configure
the digital certificate in your Apache 2 web server.

You can install a digital certificate issued by Signing
authority like Verisign. Alternatively, you can install your own self
signed certificate.

This step assumes you have installed and configured digital certificate
in your Apache 2 web server. Now to access SVN repository please refer
the above section. You must use ''https://'' to access the SVN repository.

=== Access via custom protocol (svn://) ===

Once the SVN repository is created, you can configure the access
control. You can edit /home/svn/myproject/conf/svnserve.conf file to
configure the access control.

'''NOTE: svnserve.conf is sensitive to whitespace, be sure not to leave any whitespace at the start of a line or it will not be able to read the file.'''

For example, to setup authentication you can uncomment the following
lines in the configuration file:

<pre>
## [general]
## password-db = passwd
</pre>

After uncommenting the above lines, you can maintain the user list in
''passwd'' file. So, edit the file ''passwd'' in the same directory and
add new user. The syntax is as follows:

<pre>
  username = password
</pre>

For more details, please refer the file.

Now, to access SVN via svn:// custom protocol either from the same
machine or different machine, you can run svnserver using
''svnserve'' command. The syntax is as follows:

<pre>
  $ svnserve -d --foreground -r /home/svn
### -d -- daemon mode
### --foreground -- run in foreground (useful for debugging)
### -r -- root of directory to serve

  For more usage details, please refer,
  $ svnserve --help
</pre>

Once you run this command, SVN starts listening on default port
(3690). To access the project repository, you must run the following command:

<pre>
  $ svn co svn://hostname/myproject myproject --username user_name
</pre>

Based on server configuration, it prompts for password. Once it is
authenticated, it checks out the code from SVN repository.

To synchronize the project repository with the local copy, you can run
update sub-command. The syntax is as follows:

<pre>
  $ cd project_dir
  $ svn update
</pre>

For more details about using each SVN sub-command, you can refer the
manual. For example, to learn more about co (checkout) command, please
run:

<pre>
  $ svn help co
</pre>

==== Start svnserve at bootup ====

One can start the svnserve daemon at bootup using an initd script.
Look at <nowiki>[[http://odyniec.net/articles/ubuntu-subversion-server/|Micha≈Ç Wojciechowski Blog post]]</nowiki> for instructions and a good <nowiki>[[http://odyniec.net/articles/ubuntu-subversion-server/svnserve|initd script for svnserve]]</nowiki>.

==== Start svnserve at bootup using upstart ====

On recent <nowiki>[[http://upstart.ubuntu.com/|upstart]]</nowiki> based Ubuntu versions you can place an upstart config file in /etc/init/svnserve.conf. See the example <nowiki>[[http://pelam.fi/published_sources/svnserve.conf|svnserve.conf]]</nowiki>; however, you will most likely need to edit it after reading the <nowiki>[[http://upstart.ubuntu.com/|upstart]]</nowiki> documentation and the svnserve man page.

After placing the config file you can start svnserve with:
<pre>
  $ sudo initctl start svnserve
</pre>

==== Start svnserve at bootup using xinetd ====

An alternative method to run svnserve at startup is to install xinetd, and then add the following line to /etc/xinetd.conf  (replacing 'svnowner' and '/home/svn' with appropriate values)

<pre>
svn stream tcp nowait svnowner /usr/bin/svnserve svnserve -i -r /home/svn
</pre>

=== Access via custom protocol with SSH encryption (svn+ssh://) ===

It is not necessary to run the SVN server (svnserve) in order to access SVN repositories on a remote machine using this method.  However, it is assumed that the <nowiki>[[SSH]]</nowiki> server is running in the remote machine with the repository and
it is allowing incoming connections. To confirm, please try to login to
that machine using ''ssh''. If you can login, then everything is
perfect. If you cannot login, please <nowiki>[[SSH|address it]]</nowiki> before continuing
further.

The svn+ssh:// protocol is used for accessing SVN repositories with SSH based encryption for secure data transfer.  To access a repository using this method, run the following command:

<pre>
  $ svn co svn+ssh://hostname/home/svn/myproject myproject --username user_name
</pre>

'''NOTE: You must use full path (/home/svn/myproject) to access an SVN
repository using this method.'''

Based on the <nowiki>[[SSH]]</nowiki> server configuration, it prompts for password. You must
enter the password you use to login via ''ssh''. Once it is
authenticated, it checks out the code from SVN repository.

You can also refer the SVN book for details about the svn+ssh:// protocol.

== References ==
** <nowiki>[[ApacheMySQLPHP|Setting up Apache on Ubuntu]]</nowiki>
** <nowiki>[[http://subversion.apache.org/|SVN Home page]]</nowiki>
** <nowiki>[[http://svnbook.red-bean.com/|SVN Manual]]</nowiki>
** <nowiki>[[http://httpd.apache.org/docs/2.2/|Apache 2 Documentation]]</nowiki>
** <nowiki>[[http://www.modssl.org/|Mod-SSL]]</nowiki>
** <nowiki>[[http://www.apache-ssl.org/|Apache-SSL]]</nowiki>

----
----
CategoryDocumentation CategoryDocumentation
