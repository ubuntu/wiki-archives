{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__



== Client Access - Browsing SMB shares ==
The <code>samba</code> package is a meta-package intended to be installed on file and printer sharing servers. Clients do not need this meta-package (you are acting as a client if you need to access files on another computer).  For example, installing samba is not necessary if you only need your Ubuntu system to do any of the following:
* Access shared folders, drives and printers on a Windows computer (that is, act as a client with Windows servers). To do this, you only need the '''smbfs''' plugin. See MountWindowsSharesPermanently for more information.
* Have your Windows computer use (via a network) a printer that is attached to a Linux computer.  CUPS can be configured to make the printer accessible to the network.
* Share directories between two Linux computers. You can use NFS or setup an <nowiki>[[SSH]]</nowiki> server on one computer and access it from other computers using an scp or sftp client, or Places -> Connect to Server... and choose "SSH" as the service type.

=== Ubuntu Clients ===
Ubuntu and Gnome make it easy to access files on a Windows network share.
Open the '''Places''' Menu, then click on '''Network'''. You will see a '''Windows network''' icon. Double-click to open it. The next window shows all the domains/workgroups found on your network. Inside each domain/workgroup you will see all the computers on the domain/workgroup with sharing enabled. Double-click on a computer icon to access its shares and files.
* If you want to be able to share folders with nautilus (the file browser), install the <code>nautilus-share</code> package (installed by default in Ubuntu 9.10 Desktop edition):
<pre>
sudo apt-get install nautilus-share
</pre>

'''Alternate:''' From the menu at the top select "Location" -> "Connect to a server". In the "Service type" pull down select "Windows share". Enter the server ip address in the "Server:" box and the share name in the "Share:" box. Click "Connect" and then "Connect" again on the second dialog box

'''Alternate 12.04:''' Double clicking on 'Windows network' did not work for me. So I went to 'Go' menu in the nautilus file browser and clicked 'Location'. I got an address bar at the top of the window. I entered "smb://192.168.2.148" (substitute the IP address of your Samba server) - I was presented with user/password window - After typing in user/passwd I was able to see the samba shares on the server and browse the files/folders.

'''Note:''' The default installation of Samba does not synchronize passwords.  You may have to run "smbpasswd" for each user that needs to have access to his Ubuntu home directory from Microsoft Windows.

=== Windows Clients (XP,Server,Vista, Win7) ===
Microsoft Windows clients connect and browse through their corresponding network interface.

'''Example:''' XP clients can open '''Windows Network Neighborhood''' or '''My Network Places''' to browse available SMB shares.

== Samba Client - Manual Configuration ==

This section covers how to manually configure and connect to a SMB file server from an Ubuntu client. <code>smbclient</code> is a command line tool similar to a ftp connection while <code>smbfs</code> allows you to mount a SMB file share. Once a SMB share is mounted it acts similar to a local hard drive (you can access the SMB share with your file browser (nautilus, konqueror, thunar, other).

==== Connecting to a Samba File Server from the command line ====

Connecting from the command line is similar to a ftp connection.

List public SMB shares with

<pre>
smbclient -L //server -U user
</pre>

Connect to a SMB share with

<pre>
smbclient //server/share -U user
</pre>

Enter you user password.

You can connect directly with

<pre>
smbclient //server/share -U user%password
</pre>

but your password will show on the screen (less secure).

Once connected you will get a prompt that looks like this :

<pre>
smb: \>
</pre>

Type "help" , without quotes, at the prompt for a list of available commands.

=== Connecting using CIFS ===

CIFS is included in the smbfs package and is a replacement for smbfs (I know, the terminology here is a little confusing).

Reference : http://linux-cifs.samba.org/

As above, install by any method, <code>smbfs</code>, on Ubuntu 12.10, <code>smbfs</code> has been replaced by <code>cifs-utils</code>.

==== Allow non-root users to mount SMB shares ====

By default only root may mount SMB shares on the command line. To allow non-root users to mount SMB shares you could set the SUID, but I advise you configure sudo. You should configure sudo with '''visudo'''

You may either allow the group "users" to mount SMB shares, or add a group, samba, and add users you wish to allow to mount SMB shares to the samba group.

<pre>
sudo groupadd samba
sudo adduser user samba
</pre>

Change "user" to the username you wish to add to the samba group.

<pre>
sudo visudo
</pre>

In the "group" section add your group you wish to allow to mount SMB shares

<pre>
Add a line  in the "group" section :
%admin ALL=(ALL) ALL
%samba   ALL=(ALL) /bin/mount,/bin/umount,/sbin/mount.cifs,/sbin/umount.cifs
</pre>

Change "%samba" to "%users" if you wish to allow members of the users group to mount SMB shares.

The following will mount the myshare folder on myserver to <code>~/mnt</code> (it will be in your home directory):

<pre>
mkdir ~/mnt
sudo mount -t cifs //myserver_ip_address/myshare ~/mnt -o username=samb_user,noexec
</pre>

__Note__: "samba_user" = the user name on the samba server (may be different from your log-in name on the client).

The "noexec" option prevents executable scripts running from the SMB share.

You will be asked for BOTH your sudo and then your samba_user password.

To umount,
<pre>
sudo umount ~/mnt
</pre>

==== Automagically mount SMB shares ====

In order to have a share mounted automatically every time you reboot, you need to do the following:

With any editor, create a file containing your Windows/Samba user account details:

<pre>
gksu gedit /etc/samba/user
</pre>

KDE users must use kdesu rather than gksu and instead of Gedit they can use Kwrite as editor.

... it should contain two lines as follows:

<pre>
username=samba_user
password=samba_user_password
</pre>

__Note__: "samba_user" = the user name on the samba server (may be different from your log-in name on the client). "samba_user_password" is the password you assigned to the samba_user on the samba server.

Save the file and exit gedit.

Change the permissions on the file for security:

<pre>
sudo chmod 0400 /etc/samba/user # permissions of 0400 = read only
</pre>

Now create a directory where you want to mount your share (e.g. /media/samba_share):

<pre>
sudo mkdir /media/samba_share
</pre>

Now, using any editor, and add a line to /etc/fstab for your SMB share as follows:

<pre>
sudo cp /etc/fstab /etc/fstab.bak
gksu gedit /etc/fstab
</pre>

Add a line for your SMB share:

<pre>
//myserver_ip_address/myshare  /media/samba_share  cifs  credentials=/etc/samba/user,noexec  0 0
</pre>

The share will mount automatically when you boot. The "noexec" option prevents executable scripts running from the SMB share.

To mount the share now, without rebooting,

<pre>
sudo mount /media/samba_share
</pre>

You can unmount the share with :

<pre>
sudo umount /media/samba_share
</pre>

If you wish to increase security at the expense of convenience, use this line in /etc/fstab

<pre>
//myserver_ip_address/myshare  /media/samba_share  cifs  noauto,credentials=/etc/samba/user,noexec  0 0
</pre>

The noexec" option prevents executable scripts running from the SMB share.

Edit <code>/etc/samba/user</code>, remove the password (leave just the samba user).

Now the share will NOT automatically mount when you boot and you will be asked for your samba password.

Mount the share with :

<pre>
sudo mount /media/samba_share
</pre>

CIFS may cause a shutdown error.
<pre>
CIFS VFS: Server not responding.
</pre>
There is a <nowiki>[[http://ubuntuforums.org/showthread.php?t=288534|fix in the troubleshooting section of this forum post.]]</nowiki>

<nowiki>[[#Top|Back to top]]</nowiki>

=== Connecting using SMBFS (deprecated) ===

__Note__: This method still works, but as outlined under the "CIFS" section above is "deprecated" (no longer maintained and pending removal from the kernel).

Mounting a share on the local filesystem allows you to work around programs that do not yet use GnomeVFS to browse remote shares transparently.  To mount a SMB share, first install smbfs:

<pre>
sudo apt-get update
sudo apt-get install smbfs
</pre>
To allow non root accounts to mount shares, change the permissions on the smbmnt program thus:

<pre>
sudo chmod u+s /usr/bin/smbmnt /usr/bin/smbumount
</pre>

-----

__Note__: This may be a security risk as after setting the SUID bit anyone can mount a SMB share. I advise you configure sudo, as above.

The working line in /etc/sudoers is as follows (see CIFS section above):

<pre>
%samba   ALL=(ALL) /bin/mount,/bin/umount,/sbin/mount.cifs,/sbin/umount.cifs,/usr/bin/smbmount,/usr/bin/smbumount
</pre>

This allows any user in the samba group to mount SMB shares (you will need to create a samba group and add users).

The following will mount the myshare folder on myserver to <code>~/mnt</code> (it will be in your home directory):

-----

<pre>
mkdir ~/mnt
smbmount //myserver/myshare ~/mnt
</pre>
To umount,
<pre>
smbumount ~/mnt
</pre>

In order to have a share mounted automatically every time you reboot, you need to do the following:

Open a shell as root

<pre>
sudo -s
</pre>
Create a file containing your Windows/Samba user account details:

<pre>
vi /etc/samba/user
</pre>
...it should contain two lines as follows:
<pre>
username=george
password=secret
</pre>
Change the permissions on the file for security:

<pre>
chmod 0600 /etc/samba/user
</pre>
Now create a directory where you want to mount your share (e.g. /mnt/data):

<pre>
mkdir /mnt/data
</pre>
Now edit the file system table (/etc/fstab) and add a line as follows:

<pre>
//server/share   /mnt/data   smbfs   credentials=/etc/samba/user,rw,uid=bob   0   0
</pre>
...where 'bob' is the non-root user you log into ubuntu with, 'server' is the name or address of the Windows machine and 'share' is the name of the share.

To mount the share now, just use the following command as root. It will mount automatically on subsequent reboots.

<pre>
mount /mnt/data
</pre>
to be continued...

==== Ubuntu Client ====

On the Ubuntu client using the menu at the top, go to "Places" -> "Network". You will see an icon "Windows network" and should be able to browse to your shared folder. You will be asked for a password, leave it blank. Click the "Connect button.

(no need for a password).

If you would like to mount your SMB share using your (server) hostname rather than the IP Address, edit /etc/hosts and add your samba server (syntax IP Address hostname).

<pre>
192.168.1.100    hostname
</pre>

Where "hostname" = the name of your samba server.

==== Windows Client ====

On Windows open "My Computer" and navigate to "My Network Places". Navigate to your Ubuntu server and your share will be available without a password.

Alternate : From the menu at the top select "Tools" -> "Map Network Drive". Select an available letter for your SMB share (Default is z: ). In the "Folder:" box enter \\samba_server_ipaddress\share. Tic (Select with the mouse) the option "Reconnect at login" if you want the share to be automatically mounted when you boot Windows. Click the "Finish" box. A dialog box will appear, enter your samba user name and password. Click "OK".

If you would like to mount your SMB share using your (server) hostname rather than the IP Address, edit C:\WINDOWS\system32\drivers\etc\hosts and add your samba server (syntax IP Address hostname).

<pre>
192.168.1.100    hostname
</pre>

Where "hostname" = the name of your samba server.
