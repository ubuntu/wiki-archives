{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__



'''This guide explains how to setup <nowiki>[[http://www.list.org/|Mailman]]</nowiki> mailing list software with the Apache web server and either the Exim4 or Postfix mail servers on Ubuntu. The intended audience is experienced linux users and system administrators.'''

== Introduction ==

If you are new to Mailman, this section provides a quick introduction to Mailman.

Mailman is an open source program for managing electronic mail discussions and e-newsletter lists. Many open source mailing lists (including all the <nowiki>[[http://lists.ubuntu.com|Ubuntu mailing lists]]</nowiki>) use Mailman as their mailing list software. It is powerful, easy to install and easy to maintain.

== Assumptions ==

It is assumed that you know how to run linux commands, edit files, and start and stop services in the linux system. It is also assumed that you have administrative access to an Ubuntu system, that you have internet connection and that you have configured <code>/etc/apt/sources.list</code>.

== Installation ==

Mailman provides the web interface for the administrators and users. Mailman uses an external mailserver to send/receive emails. It works perfectly with the following mailservers:
* <nowiki>[[http://www.postfix.org|Postfix]]</nowiki>
* <nowiki>[[http://www.exim.org|Exim]]</nowiki>
* <nowiki>[[http://www.sendmail.org|Sendmail]]</nowiki>
* <nowiki>[[http://qmail.org/top.html|Qmail]]</nowiki>

In this section, we will see howto install Mailman, Apache web server and Exim or Postfix mail server. If you wish to install Mailman with another mail server, please refer the reference pages given at the end of the guide.

=== Apache2 ===

Apache2 is already in the repository. Install the following packages: <code>apache2</code> (see InstallingSoftware).

=== Mailman ===

Mailman is Main in the repository. Install the following packages: <code>mailman</code> (see InstallingSoftware).

It copies the installation files in <code>/var/lib/mailman</code>. It installs the cgi scripts in <code>/usr/lib/cgi-bin/mailman</code> directory.

The package creates a 'list' user and a 'list' group. The mailman process is be owned by this user.

=== Mail server installation ===

You only need one Mail Transport Agent (MTA) installed and configured in order to use Mailman.  Here are instructions and for installing Exim4 and Postfix.

==== Exim4 ====

Exim4 is already in the repository. Install the following packages: <code>exim4</code> (see InstallingSoftware).

See the <nowiki>[[Exim4]]</nowiki> page for more details on installing and configuring Exim4. This example uses split configuration (Exim4 default, multiple configuration files), not monolithic/unsplit configuration (a single file).

==== Postfix ====

Install the following packages: <code>postfix</code> (see InstallingSoftware).

Just choose ''Internet Site'' and default options. For further details on Postfix installation, visit the <nowiki>[[Postfix]]</nowiki> page.

== Configuration ==

This section assumes you have successfully completed the installation of Mailman, Apache and a Mail server. Now you just need to configure them. At the end of this section, your Mailman will be ready to rock!

=== Apache Configuration ===

An example Apache configuration file comes with Mailman and is placed in <code>/etc/mailman/apache.conf</code>. In order for Apache to use the config file it needs to be symlinked over to <code>/etc/apache2/sites-available</code>:

<pre>
sudo ln -s /etc/mailman/apache.conf /etc/apache2/sites-available/mailman.conf
</pre>

This will setup a new Apache '''VirtualHost''' for the Mailman administration site.
Once you have copied the virtual host file, you'll need to enable it along with the cgid module:
<pre>
sudo a2ensite mailman.conf
sudo a2enmod cgid
</pre>

and reload Apache: 

<pre>
sudo /etc/init.d/apache2 reload
</pre>

=== Postfix Configuration ===

For this integration, we will associates the domain <code>lists.example.com</code> with the mailing lists. As a consequence, the domain will be reserved for the mailing-list traffic. You can nevertheless have a website to this domain (usually, the domain <code>lists.example.com</code> is used by the mailing list system and for the mailman web interface).

Step 1 is activate the MTA option on the mailman config file (<code>/etc/mailman/mm_cfg.py</code>). Write or uncomment this line:
<pre>
MTA = 'Postfix'
</pre>
Save and close the file.

Run the script to generate aliases. This depends on the MTA being set correctly in mm_cfg.py:
<pre>
sudo /usr/lib/mailman/bin/genaliases
</pre>

You can use the '''postconf''' command to add the necessary configuration to <code>/etc/postfix/main.cf</code>:
<pre>
sudo postconf -e 'relay_domains = lists.example.com'
sudo postconf -e 'transport_maps = hash:/etc/postfix/transport'
sudo postconf -e 'mailman_destination_recipient_limit = 1'
sudo postconf -e 'alias_maps = hash:/etc/aliases, hash:/var/lib/mailman/data/aliases'
</pre>

In <code>/etc/postfix/master.cf</code> double check that you have the following transport:
<pre>
mailman   unix  -       n       n       -       -       pipe
  flags=FR user=list argv=/usr/lib/mailman/bin/postfix-to-mailman.py
  ${nexthop} ${user}
</pre>

It calls the <code>postfix-to-mailman.py</code> script when a mail is delivered to a list.

Associate the domain <code>lists.example.com</code> to the <code>mailman</code> transport with the transport map. Edit the file <code>/etc/postfix/transport</code>:
<pre>
lists.example.com      mailman:
</pre>

Now have Postfix build the '''transport''' map by entering the following from a terminal prompt:
<pre>
sudo postmap -v /etc/postfix/transport
</pre>

Then add mailman aliases in /etc/aliases
<pre>
mailman:              "|/var/lib/mailman/mail/mailman post mailman"
mailman-admin:        "|/var/lib/mailman/mail/mailman admin mailman"
mailman-bounces:      "|/var/lib/mailman/mail/mailman bounces mailman"
mailman-confirm:      "|/var/lib/mailman/mail/mailman confirm mailman"
mailman-join:         "|/var/lib/mailman/mail/mailman join mailman"
mailman-leave:        "|/var/lib/mailman/mail/mailman leave mailman"
mailman-owner:        "|/var/lib/mailman/mail/mailman owner mailman"
mailman-request:      "|/var/lib/mailman/mail/mailman request mailman"
mailman-subscribe:    "|/var/lib/mailman/mail/mailman subscribe mailman"
mailman-unsubscribe:  "|/var/lib/mailman/mail/mailman unsubscribe mailman"
</pre>

This build of mailman runs as list. It must have permission to read /etc/aliases and read and write /var/lib/mailman/data/aliases. Do this with these commands:
<pre>
sudo chown root:list /var/lib/mailman/data/aliases
sudo chown root:list /etc/aliases
</pre> 

Save and run:
<pre>
sudo newaliases
</pre>

Then restart Postfix to enable the new configurations:
<pre>
sudo /etc/init.d/postfix restart
</pre>

That's all ! It is very easy and very efficient.

=== Exim4 Configuration ===

Once exim4 is installed, you can run it using the following command:
  
<pre>
}}}

In order to make mailman work with exim4, you need to configure exim4. As mentioned earlier, by default, exim4 uses multiple configuration files of different types. For details, please refer <nowiki>[[http://www.exim.org|Exim]]</nowiki> website.

To run mailman, we should make add new configuration file to each of the following configuration types:
* Main
* Transport
* Router

Exim creates a master configuration file, by sorting all these mini configuration files. So, the order of these configuration files is important.
This is accomplished using certain file names prefixed by a number.  See below.

==== Main ====

All the configuration files belonging to main type are stored in
<code>/etc/exim4/conf.d/main/</code> directory. You can add the following content
in a new file. You may name it as <code>04_exim4-config_mailman</code>::

{{{
MM_HOME=/var/lib/mailman
MM_UID=list
MM_GID=list
domainlist mm_domains=lists.example.com
MM_WRAP=MM_HOME/mail/mailman
MM_LISTCHK=MM_HOME/lists/${lc::$local_part}/config.pck
</pre>

'''IMPORTANT: Please replace lists.example.com with your own domain'''

==== Transport ====

All the configuration files belonging to transport type are stored in
<code>/etc/exim4/conf.d/transport/</code> directory. You can add the following content
in a new file. You may name it as <code>40_exim4-config_mailman</code>::

{<pre>
mailman_transport:
   driver = pipe
   command = MM_WRAP \
          '${if def:local_part_suffix \
                {${sg{$local_part_suffix}{-(\\w+)(\\+.*)?}{\$1}}} \
                {post}}' \
          $local_part
   current_directory = MM_HOME
   home_directory = MM_HOME
   user = MM_UID
   group = MM_GID
</pre>}

==== Router ====

All the configuration files belonging to router type are stored in
<code>/etc/exim4/conf.d/router/</code> directory. You can add the following content
in a new file. You may name it as <code>101_exim4-config_mailman</code>::

<pre>
mailman_router:
   driver = accept
   require_files = MM_HOME/lists/$local_part/config.pck
   local_part_suffix_optional
   local_part_suffix = -bounces : -bounces+* : \
                       -confirm+* : -join : -leave : \
                       -owner : -request : -admin
   domains = +mm_domains
   transport = mailman_transport
</pre>

'''IMPORTANT:''' The order of main and transport configuration files can be in any order. But, the order of router configuration files must be in the same order. This particular file, must appear before
<code>200_exim4-config_primary</code> file. These two configuration files contain same type of information. The first file takes the precedence. For more details, please refer to the <nowiki>[[http://www.exim.org|exim]]</nowiki> website or the references section in this page.

=== Mailman Configuration ===

Once mailman is installed, you should create the default mailing list. Run the following command:

<pre>
## sudo newlist mailman
  Enter the email of the person running the list: bhuvaneswaran at NOSPAM gmail.com
  Initial mailman password:
  To finish creating your mailing list, you must edit your /etc/aliases (or
  equivalent) file by adding the following lines, and possibly running the
  `newaliases' program:

## # mailman mailing list
  mailman:              "|/var/lib/mailman/mail/mailman post mailman"
  mailman-admin:        "|/var/lib/mailman/mail/mailman admin mailman"
  mailman-bounces:      "|/var/lib/mailman/mail/mailman bounces mailman"
  mailman-confirm:      "|/var/lib/mailman/mail/mailman confirm mailman"
  mailman-join:         "|/var/lib/mailman/mail/mailman join mailman"
  mailman-leave:        "|/var/lib/mailman/mail/mailman leave mailman"
  mailman-owner:        "|/var/lib/mailman/mail/mailman owner mailman"
  mailman-request:      "|/var/lib/mailman/mail/mailman request mailman"
  mailman-subscribe:    "|/var/lib/mailman/mail/mailman subscribe mailman"
  mailman-unsubscribe:  "|/var/lib/mailman/mail/mailman unsubscribe mailman"

  Hit enter to notify mailman owner...

## 
</pre>

Once mailman is installed and the default mailing list created, you can run it using the following command:
<pre>
sudo /etc/init.d/mailman start
</pre>

We have configured Exim4 or Postfix to recognize all emails from Mailman. So, it's not mandatory to make any new entries in /etc/aliases.

If you have made any changes to the configuration files, please ensure that you restart those services, before continuing to next section.

== Administration ==

=== Web administration ===

In this section, we assume you have done the default installation. The Mailman CGI scripts are still in <code>/usr/lib/cgi-bin/mailman</code> directory.

Mailman provides web based administration facility. To access this page, point your browser to the following url: <code>http://hostname/cgi-bin/mailman/admin</code>

The default mailing list, 'mailman' would appear in this screen. If you click the mailing list name, it would ask for authentication password. If you enter the correct password, you would be able to change administrative settings of this mailing list.

You can create new mailing list using command line utilility (newlist). Alternatively, you can create new mailing list using web interface.

For each list, you have three web sections:
* <code>http://hostname/cgi-bin/mailman/admin/list</code>: admin interface for the list ''list''.
* <code>http://hostname/cgi-bin/mailman/listinfo/list</code>: user interface for the list ''list''.
* <code>http://hostname/cgi-bin/mailman/admindb/list</code>: pending messages waiting for approval.

=== Command line interface ===

Mailman also have a set of command line tools. Here are the most important:

* <code>newlist</code>: add a new list
* <code>rmlist ''list''</code>: delete a list
* <code>list_lists</code>: list all the lists
* <code>list_members ''list''</code>: list all the members of the list
* <code>add_members ''user@example.com'' ''list''</code>: add e-mail ''user@example.com'' to the list ''list''.
* <code>remove_members ''user@example.com'' ''list''</code>: remove e-mail ''user@example.com'' to the list ''list''
* <code>mmsitepass</code>: define a site password to access administration web interfaces

== Users ==

Mailman provides web based interfaces for users. To access this page, point your browser to the following url:
 <code> http://hostname/cgi-bin/mailman/listinfo </code>

The default mailing list, 'mailman' would appear in this screen. If
you click the mailing list name, it would display the subscription
form. You can enter your email address, name (optional) and password
to subscribe. An email intimation would be sent to you. You can follow
the instructions in the email to subscribe.

== References ==

* <nowiki>[[http://www.list.org/mailman-install/index.html|GNU Mailman - Installation Manual]]</nowiki>
* <nowiki>[[http://www.exim.org/howto/mailman21.html|HOWTO - Using Exim 4 and Mailman 2.1 together]]</nowiki>

Hope this document is useful. Feedbacks are welcome to bhuvaneswaran at NOSPAM gmail.com.
----
CategoryEmail
