{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

== Goal ==

To run moodle (http://moodle.org/) and zope2.7 (http://www.zope.org/) on port 80 of our school computer science
web server (http://linus.yhspatriot.net).  We are behind a firewall with only port 80 open, so I needed to setup virtual hosting with apache2 to make this work.  I wanted linus.yhspatriot.net to point to a zope2.7 instance, and
moodle.yhspatriot.net to point to a moodle instance.  I found it convenient to have mysql.yhspatriot.net point to
mysql-admin as well.

== Setting up the server ==

## install ubuntu 5.04 server
## edit <code>/etc/network/interfaces</code> for static ip address by changing the primary interface to:
    <pre>
### The primary network interface
    iface eth0 inet static
        address 158.59.195.113
        netmask 255.255.252.0
        gateway 158.59.192.1
    </pre>

## edit <code>/etc/apt/sources.list</code> removing cdrom source at top and uncommenting universe sources
## do the apt-get dance (<code>apt-get update</code> and <code>apt-get upgrade</code>)
## install the following using apt-get:
*** ssh
*** zip and unzip
*** apache2
*** mysql-server
*** phpmyadmin

== Configuring mysql ==

## Point a web brower at <code>http://158.59.195.113/phpmyadmin/</code>
## By default, username <code>root</code> with no password is enabled
## Login, click on "Change password", and change the password
## Click "Databases", fill-in "Create new database" with <code>moodle</code> and click "Create"
## Click "Privileges" then "Add a new User"
## Add user <code>moodle</code> with all "Data" and "Structure" privileges checked

== Configuring Apache Modules ==

* As root, run the following:
   <code>ln -s /etc/apache2/mods-available/proxy.conf /etc/apache2/mods-enabled/proxy.conf</code>
* Repeat with <code>proxy_connect.load</code> and <code>proxy.load</code>

== Configuring virtual hosts ==

0. Edit <code>/etc/apache2/apache2.conf</code>, adding a <code>NameVirtualHost</code> line, so that the last three lines of the file look like this: <pre>
### Include the virtual host configurations
    NameVirtualHost 158.59.195.113:80
    Include /etc/apache2/sites-enabled/[^.#]* </pre>
0. Create a file named azi.conf in /etc/apache2/sites-available with the following: <pre>
    <VirtualHost 158.59.195.113:80>
    ServerName linus.yhspatriot.net
    ServerAdmin jeff@elkner.net
    ProxyRequests off
    <Proxy *>
    Order deny,allow
    Allow from all
    </Proxy>
    ProxyPass / http://158.59.195.113:8080/
    ProxyPassReverse / http://158.59.195.113:8080/
    ProxyPass /misc_ http://158.59.195.113:8080/misc_
    ProxyPassReverse /misc_ http://158.59.195.113:8080/misc_
    ProxyPass /p_ http://158.59.195.113:8080/p_
    ProxyPassReverse /p_ http://158.59.195.113:8080/p_
    </VirtualHost>

    <VirtualHost 158.59.195.113:80>
    ServerName mysql.yhspatriot.net
    ServerAdmin jeff@elkner.net
    ProxyRequests off
    <Proxy *>
    Order deny,allow
    Allow from all
    </Proxy>

    DocumentRoot /var/www/phpmyadmin/

    Options +FollowSymLinks

    <IfModule mod_php4.c>
            php_flag magic_quotes_gpc On
            php_flag magic_quotes_runtime Off
            php_flag file_uploads On
            php_flag short_open_tag On
            php_flag session.auto_start Off
            php_flag session.bug_compat_warn Off

            php_value upload_max_filesize 2M
            php_value post_max_size 2M
    </IfModule>

    <IfModule mod_dir.c>
            DirectoryIndex index.php
    </IfModule>
    </VirtualHost>

    <VirtualHost 158.59.195.113:80>
    ServerName moodle.yhspatriot.net
    ServerAdmin jeff@elkner.net
    ProxyRequests off
    <Proxy *>
    Order deny,allow
    Allow from all
    </Proxy>

    DocumentRoot /var/www/moodle/

    Options +FollowSymLinks

    <IfModule mod_php4.c>
            php_flag magic_quotes_gpc On
            php_flag magic_quotes_runtime Off
            php_flag file_uploads On
            php_flag short_open_tag On
            php_flag session.auto_start Off
            php_flag session.bug_compat_warn Off

            php_value upload_max_filesize 2M
            php_value post_max_size 2M
    </IfModule>

    <IfModule mod_dir.c>
            DirectoryIndex index.php
    </IfModule>
    </VirtualHost></pre>
0. create a sym-link in sites-enabled:
  <code>ln -s /etc/apache2/sites-available/azi.conf /etc/apache2/sites-enabled/azi.conf</code>

== Installing moodle ==

  My goal was to use packages from the ubuntu and universe repositories whenever possible, but the after
  several unsuccessful attempts to use the moodle package I found it much easier to install moodle from source,
  using the following proceedure:

0. Download the latest moodle source
       (<code>wget http://download.moodle.org/stable15/moodle-1.5.2.tgz</code> worked at the time this
       was written
### Untar it in <code>/var/www</code>
### Point a web browser at <code>http://158.59.195.113/moodle</code>
### Run through all the setup pages:
**** use <code>/var/moodledata</code> for data directory (as root):
##### <code>mkdir /var/moodledata</code>
##### <code>chown www-data.www-data /var/moodledata</code> 

== Installing zope2.7 ==

  As root:
### <code>apt-get install zope2.7</code>
### <code>apt-get install zope-zwiki</code>
### <code>mkzope2.7instance</code>
### edit <code>/var/lib/zope2.7/instance/linus/etc/zope.conf</code> changing <code>http-server</code> port to 8080

  Now log into your zope instance and create a <code>SiteRoot</code>, setting the <code>Base</code> to <code>http://linus.yhspatriot.net</code> and the <code>Path</code> to <code>/</code>.

----
