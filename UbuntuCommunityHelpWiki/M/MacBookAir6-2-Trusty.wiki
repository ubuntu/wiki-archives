{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__



== MacBookAir (6,2) on Ubuntu 14.04 (Trusty Tahr) ==
<nowiki>[[File:MacBooksmall.png]]</nowiki><<BR>><<BR>>

This page aims to describe the steps needed, to fully enable all features of the '''6-th Generation MacBookAir''' (release date: mid 2013) when using '''Ubuntu 14.04, Trusty Tahr'''.<<BR>>
<<BR>>
<nowiki>[[File:IconsPage/terminal.png]]</nowiki> You can find out, what model you have by typing at the terminal:<<BR>>
<pre>
sudo dmidecode -s system-product-name
</pre>
<<BR>>
If you have a different model, please go <nowiki>[[https://wiki.ubuntu.com/MactelSupportTeam/CommunityHelpPages|here]]</nowiki> and find the right wiki.

=== Overview ===

Anything not mentioned here probably already works out of the box. If not, please refer to the <nowiki>[[http://ubuntuforums.org/forumdisplay.php?f=328|Ubuntu Apple Users forum]]</nowiki>. 

{| class="wikitable"
|-
| <style="background-color: #f9eaaf;">Feature
| <style="background-color: #f9eaaf;"> Support status
|-
| LCD Panel
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|-
| Suspend & Hibernate
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>[[#Backlight|<nowiki>[[File:IconsPage-warning.png]]</nowiki>]] Suspend ok, but LCD brightness can't be adjusted after resume. Fix is available. <<BR>><nowiki>[[File:IconsPage/question.png]]</nowiki> Hibernate not tried yet
|-
| Shut-down and Reboot
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|-
| Keyboard functions (Brightness,volume,...)
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|-
| Touchpad (appletouch)
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|-
| Wireless (Air``Port)
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>[[#Wireless (AirPort)|<nowiki>[[File:IconsPage-info.png]]</nowiki>]]
|-
| Bluetooth
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>[[#Bluetooth|<nowiki>[[File:IconsPage-info.png]]</nowiki>]]
|-
| iSight
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>[[#iSight|<nowiki>[[File:IconsPage-info.png]]</nowiki>]]
|-
| Sound
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|-
| Microphone
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|-
| External Monitor
| <nowiki>[[File:IconsPage/ok.png]]</nowiki> <nowiki>[[File:IconsPage/info.png]]</nowiki>
|-
| Thunderbolt
| <nowiki>[[File:IconsPage/question.png]]</nowiki> To be verified
|-
| SD card slot
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|-
| HFS+ (OS X disc partition)
| <nowiki>[[File:IconsPage/ok.png]]</nowiki> mount read-only
|-
| Fan Control
| <nowiki>[[File:IconsPage/ok.png]]</nowiki> according to <code>tlp stat</code>
|-
| Sensors (temps & fans)
| <nowiki>[[File:IconsPage/ok.png]]</nowiki> according to <code>tlp stat</code>
|-
| GPU Power Save
| <nowiki>[[File:IconsPage/ok.png]]</nowiki>
|}

<nowiki>[[File:IconsPage/ok.png]]</nowiki> (works out-of-the-box) <<BR>>
<nowiki>[[File:IconsPage/ok.png]]</nowiki> <nowiki>[[File:IconsPage/info.png]]</nowiki> (works, with remarks) <<BR>>
<nowiki>[[File:IconsPage/warning.png]]</nowiki> (needs manual install) <<BR>>
<nowiki>[[File:IconsPage/dont.png]]</nowiki> (won't work)<<BR>>
<nowiki>[[File:IconsPage/question.png]]</nowiki> (not yet documented)<<BR>>

=== Basic Installation Instructions ===

Common things about installing and maintaining Ubuntu on Intel-based Macs:
<nowiki>[[https://help.ubuntu.com/community/MactelSupportTeam/AppleIntelInstallation|Intel CPU-based Macintosh Generic Installation Instructions]]</nowiki>

==== Prerequisites ====

1. MacBookAir6,2 
  Check on OSX with 
<pre>
sysctl hw.model
  </pre>
  Check on linux with 
  <pre> 
sudo dmidecode -s system-product-name
  </pre>

2. Apple USB-Ethernet Adapter

3. USB-Stick (1GB at least)

4. <nowiki>[[http://releases.ubuntu.com/14.04/ubuntu-14.04-desktop-amd64.iso|ubuntu-14.04-desktop-amd64.iso]]</nowiki>.

==== Partition Harddisk ====

1. Boot Macbook Air into OSX

2. Open Disk Utility 
  <pre> 
open /Applications/Utility/Disk\ Utility.app 
  </pre>

3. Select "Macintosh HD" > (Tab)Partition
  Add (+) 3 more partitions
  2nd Partition: Set 30-40GB for Ubuntu "/" <<BR>>
  4th Partition: Set 4GB for Linux Swap partition <<BR>>
  3rd Partition: Use as much space as left for "/home" <<BR>>

==== Prepare USB-Stick ====

1. In OSX

2. Download iso image to ~/Downloads

3. Open Terminal (a detailed description can be found  <nowiki>[[http://www.ubuntu.com/download/desktop/create-a-usb-stick-on-mac-osx|here]]</nowiki>.
   <pre>
cd ~/Downloads
hdiutil convert -format UDRW -o ubuntu-14.04-desktop-amd64.img ubuntu-14.04-desktop-amd64.iso
open /Applications/Utilities/Disk\ Utility.app
diskutil list
diskutil unmountDisk /dev/disk1
sudo dd if=ubuntu-14.04-desktop-amd64.img.dmg of=/dev/rdisk1 bs=1m
   </pre>

==== Install Ubuntu ====

1. Restart and press "Alt"-Key on startup.

2. Make sure that the USB-Ethernet Adapter is inserted. (With a network connection the bcmwl-kernel-source module gets downloaded during the installation process.<<BR>>
   Select first USB-device labled "EFI-Boot" and press "Enter".<<BR>>
   '''No splash screen''' shall be displayed but the Ubuntu installation menu. See <nowiki>[[https://help.ubuntu.com/community/UEFI|Identifying if the computer boots the Ubuntu DVD in EFI mode]]</nowiki>.<<BR>>
   Select "Install Ubuntu"<<BR>>
   Note: If booting into BIOS-Mode is a bad choice as you can currently only run on one core. <nowiki>[[https://bugzilla.kernel.org/show_bug.cgi?id=60635|Bug]]</nowiki><<BR>>

3. Choose "Something else" for partitioning.<<BR>>
   Please check the sizes in the list according to the partitioning for the step above. <<BR>>
   OSX Disk Utility leaves unallocated partitions inbetween which usually are arround 128MB in size.<<BR>>
   Do not try to delete these "blank" partitions.<<BR>>
   2nd partition should be ext4 formatted and mounted "/".<<BR>>
   3rd partition should be ext3 formatted and mounted "/home". (I use ext3 in order to use fuse-ext2 from OSX; ext4 is yet not supported) <<BR>>
   4th partition should be swap (no format and mountpoint required)<<BR>>
   Proceed...

4. The installation process should run through smoothly. 

5. Restart with pressed "Alt"-Key.<<BR>>
   Unfortunately selecting the "Windows" labled Partition (HD-icon) only displayed a black screen with a blinking cursor.<<BR>>
   Reboot into OSX again and install "refind".<<BR>>
   Download (<nowiki>[[http://www.rodsbooks.com/refind/getting.html|Binary Zip-File]]</nowiki>) (<nowiki>[[http://sourceforge.net/projects/refind/files/0.8.2/refind-bin-0.8.2.zip/download|Direct Download refind-bin-0.8.2.zip]]</nowiki>)<<BR>>
   Open a Terminal
   <pre>
cd Downloads
unzip  refind-bin-0.8.2.zip 
cd refind-bin-0.8.2
sudo ./install.sh 
   </pre>

6. Restart again. Now a Ubuntu labled "/efi/ubuntu/grubx64.efi" should be shown.<<BR>>
   Select this an start it, now the grub-menu should be displayed.<<BR>>
   Select "Ubuntu".<<BR>>
   Now Ubuntu should boot.

=== Wireless (AirPort) ===

<nowiki>[[File:IconsPage/restricted.png]]</nowiki>

Requires an Apple USB-Ethernet Adapter or an Apple Thunderbolt-Ethernet Adapter.

1. Log into ubuntu 14.04 and open a terminal (Ctrl+Alt+t).
   Attach Apple X-Ethernet Adapter.
   Enter the following commands:
   <pre>
sudo apt-get update
sudo apt-get upgrade
   </pre>
   This updates all packages

2. Start (Panel) > (Menu)System Settings > (Icon)Software & Updates or from terminal `/usr/bin/python3 /usr/bin/software-properties-gtk`
   Select (Tab)Additional Drivers and install Broadcom 802.11 Linux STA wireless driver from bcmwl-kernel-source

3. Now reboot again
   Select "Ubuntu"

=== Sound ===

Works. You may want to change default ALSA sound card (needed for Lubuntu) - put this in
<code>/etc/asound.conf</code> :
   <pre>
defaults.ctl.card 1
defaults.pcm.card 1
defaults.timer.card 1
   </pre>
=== iSight ===

<nowiki>[[File:IconsPage/webcam.png]]</nowiki>

Patrik Jakobsson wrote a driver for the camera which appears to work, though is still listed as experimental. It depends on kernel 3.19 minimum and you should run 
<pre>
sudo modprobe -r bdc_pci
</pre>
prior to following the <nowiki>[[https://github.com/patjak/bcwc_pcie/wiki/Get-Started#get-started-on-debian|Get started on Debian]]</nowiki> instructions for Trusty.

=== Touchpad (appletouch) ===

Works.

=== External Monitor ===

Works via thunderbolt --> DVI out of the box. 

Although Apple Displays won't hotplug. Probably will need features coming in kernel 3.15 (or backported)  

Note there is a regression in supported resolutions in the kernel that ships with 14.04. 
On at least some displays, the maximum resolution available is lower on 14.04 than it was on 13.04.
(For example, tested on a Samsung display with 2560x1440 resolution on 13.04, but only 1920x1200 on 14.04.)

The regression appears to have been introduced with 13.10 and still exists in 14.10.

One suggested workaround is to load a kernel that came with 13.04 (which exactly?).
More information here: http://ubuntuforums.org/showthread.php?t=2218618
and here: https://bugs.launchpad.net/ubuntu/+source/xorg/+bug/1391984

=== Bluetooth ===

Works.

I encountered some initial problems with searching for devices. Simply no devices could be found with using "Set up new device". 
After some reboots and a kernel update to "3.13.0-30-generic" adding and accessing bluetooth devices is not an issue any longer.

=== Function Keys ===

Works. See also <nowiki>[[AppleKeyboard#Corrections]]</nowiki> page for fine tuning.

=== Finetuning Powersave functions ===

With the procedures enabled below ~10h on battery can be achieved.

1. Install powertop
<pre>
sudo apt-get install powertop
sudo powertop
   </pre>
   Toggle through with "TAB" to Tunables
   Lots of "Bad" values should be displayed.
   
2. Install TLP
   For detailed Instructions refer to <nowiki>[[http://thinkwiki.de/TLP_-_Linux_Stromsparen|TLP wiki]]</nowiki>.
   <pre>
sudo add-apt-repository ppa:linrunner/tlp
sudo apt-get update
sudo apt-get install tlp tlp-rdw
   </pre>
   
3. Copy tlp config <nowiki>[[attachment:tlp]]</nowiki> to <code>/etc/default/tlp</code> or adjust (only changes are shown)
   <pre>
DISK_IDLE_SECS_ON_AC=0
DISK_IDLE_SECS_ON_BAT=1
MAX_LOST_WORK_SECS_ON_BAT=15
DISK_APM_LEVEL_ON_BAT="1 1"
RUNTIME_PM_ALL=1
RESTORE_DEVICE_STATE_ON_STARTUP=1
   </pre>
   Restart tpl with <code>sudo /etc/init.d/tlp restart</code>
!!!
Two problems with this part of solution:
1. the tlp file contains 
<pre>
RESTORE_DEVICE_STATE_ON_STARTUP=0
</pre>
which can be edited in txt. BUT
2. permission is denied when 
<pre>
cp attachment .tlp
</pre>
and i cannot chmod the tlp file because of permissions even with superuser privilege
Please advise, because i think this is the main cause of black screen after suspend/lid close e.g. http://m.helpsforcoder.com/ubuntu/499293-macbook-air-2013-wont-wake-after-opening-lid-14-04.html
!!!

   Check if settings took effect with powertop.

4. Enable more powersaving options
   Put this script <nowiki>[[attachment:99macbookair6]]</nowiki> under <code>/etc/pm/power.d/99macbookair6</code>
    
   In <code>/etc/rc.local</code> add the following line:
<pre>
/etc/pm/power.d/99macbookair6 true
   </pre>

5. Run <code>sudo tlp stat</code>
   Still
   <pre>
/sys/module/i915/parameters/i915_enable_rc6  = -1 (use per-chip default)
/sys/module/i915/parameters/i915_enable_fbc  = -1 (use per-chip default)
/sys/module/i915/parameters/lvds_downclock   =  0 (disabled)
/sys/module/i915/parameters/semaphores       = -1 (use per-chip default)
   </pre>
   Add the following line in <code>/etc/default/grub</code>
   <pre>
GRUB_CMDLINE_LINUX_DEFAULT="pcie_aspm=force i915.i915_enable_rc6=1 i915.i915_enable_fbc=1 i915.lvds_downclock=1 acpi_backlight=vendor"
   </pre>
   Then run <code>sudo update-grub</code> and reboot.
   After that:
   <pre>
/sys/module/i915/parameters/i915_enable_rc6  =  1 (enabled)
/sys/module/i915/parameters/i915_enable_fbc  =  1 (enabled)
/sys/module/i915/parameters/lvds_downclock   =  1 (enabled)
/sys/module/i915/parameters/semaphores       = -1 (use per-chip default)
   </pre>

=== Backlight ===

There is a strange bug with backlight. All settings (using F1, F2 keys) work great but after suspend your can only get 0% or 100% backlight.

There is no real solution for the moment, but there is now a workaround.

Look at comment 78 in https://bugs.freedesktop.org/show_bug.cgi?id=67454#c78

Patrik Jakobsson wrote a <nowiki>[[https://github.com/patjak/mba6x_bl|kernel module]]</nowiki> that directly programs the backlight driver and it works!

If you don't want to compile by yourself, follow these steps.

1. Install Build-Essentials and headers
<pre>
sudo apt-get install build-essential linux-headers-generic
</pre>

2. Download <nowiki>[[attachment:mba6xbl-dkms_0.0.3_all.deb]]</nowiki> and install it with
<pre>
sudo dpkg -i mba6xbl-dkms_0.0.3_all.deb
</pre>

'''Note:''' Repeat this installation step each time you kernel gets updated.

3. Load the module:

<pre>
sudo modprobe mba6x_bl
</pre>

4. Log out and log back in. It should load automatically on next boot.

Earlier versions of these instructions suggested editing /etc/X11/xorg.conf as well as adding the module to /etc/modules, but these steps are not necessary as of version 0.0.3 of the driver.

=== Display ===

Display colors are not true by default. To have right color profile, you should consider import ICC color profile from your OSX installation, located on your OSX partition at /Library/ColorSync/Profiles/Displays.

You can import this profile from Gnome settings into the Color settings pannel.

----
<nowiki>[[https://help.ubuntu.com/community/CategoryMac|CategoryMac]]</nowiki> 
----
<<BR>><<BR>>
{| class="wikitable"
|-
| <style="background-color: #f9eaaf;" tablewidth="100%"><nowiki>[[File:IconsPage/users.png]]</nowiki><<BR>> Please update this page, if you have figured out anything, that is not mentioned here!
|}
<<BR>><<BR>>
{| class="wikitable"
|-
| <style="background-color: #f9eaaf;" tablewidth="100%"><nowiki>[[File:IconsPage/users.png]]</nowiki><<BR>> The <nowiki>[[http://ubuntuforums.org/group.php?groupid=352|MactelSupportTeam]]</nowiki> is about to restructure and reorganize the documentation for Intel-based Macs. If you are interested in helping, please visit our <nowiki>[[https://wiki.ubuntu.com/MactelSupportTeam|team page]]</nowiki> for information. For all Mactel wikis, there is a starting place <nowiki>[[https://wiki.ubuntu.com/MactelSupportTeam/CommunityHelpPages|here]]</nowiki>. There is also a <nowiki>[[http://ubuntuforums.org/showthread.php?t=969360|thread]]</nowiki> about planning the Mactel docummentation going on.
|}
<<BR>><<BR>>
----
CategoryHardware
