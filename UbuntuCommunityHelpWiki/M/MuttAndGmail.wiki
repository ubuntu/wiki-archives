{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

{| class="wikitable"
|-
| <tablestyle="float:right; font-size: 0.9em; width:40%; background:#F1F1ED; margin: 0 0 1em 1em;" style="padding:0.5em;"><<BR>>
|}

''This page was created from the Ubuntu Forums guide: [[http://ubuntuforums.org/showthread.php?t=1021746|[Howto] Use Mutt with Gmail]], where support is still available for this wiki page. Thanks to the author of this guide for his kind permission to use the material on this page!''

== Introduction ==

This page is a guide to using the email client Mutt to send, receive and read email under Ubuntu using a Gmail account as a relay. It describes POP2 over SSL rather than the increasingly popular IMAP. It has been tested and extensively used under Ubuntu Oneiric Ocelot. There are a few steps involved but if followed carefully and in sequence you will soon be using Mutt successfully with your Gmail account. If this is your first attempt at this guide I would recommend following the sequence of the page, otherwise feel free to navigate as you please!

=== Introducing John ===

To avoid confusion in editing the many configuration files involved in this setup I will describe the setup of mutt and gmail for my new friend John, who has been borrowed from this guide's <nowiki>[[http://www.andrews-corner.org/mutt.html|big brother]]</nowiki>. John's details are as follows:

<pre>
Gmail Address:        john.example@gmail.com
Gmail Password:       rover
Computer Username:    john
</pre> 

Please remember, Gentle Reader, to substitute your own details for John's. Hopefully this will lessen the confusion that I have unintentionally created with older versions of this page!

=== Introducing vim ===

I have been somewhat taken to task for throwing vim into this guide without too much warning, for which my apologies to all. vim is the text editor that I feel suits mutt the best but a little preparation is a good idea before launching straight into it. Download vim from the repository as follows:

<pre>
sudo apt-get install vim
</pre>

and once vim is installed run through the builtin tutorial by simply running:

<pre>
vimtutor
</pre>

It may take a little time to come to grips with this great editor but trust me it is time well spent. For those who find it all a little hard there is always nano or pico!

== Further setup ==

Mutt does not work on its own so before getting to grips with mutt itself w will need to install and configure a few other applications:

=== SSL Tools ===

Gmail uses the POP3-over-SSL protocol to protect the transmission of username and password over the Internet. You will need to install both open SSL and a certificate pack from the repository as follows:

<pre>
sudo apt-get install openssl ca-certificates
</pre>

Later you will need to add the necessary SSL instructions to Fetchmail, but the next step is to install the software to send mail from your computer to the server: msmtp.

=== msmtp ===

msmtp is a great and wonderfully reliable way to move mail from your computer. Download it from the repository as follows:

<pre>
sudo apt-get install msmtp
</pre>

There is a single configuration file to be altered: $HOME/.msmtprc. It can be created and permissions set as follows:

<pre>
touch $HOME/.msmtprc && \
touch $HOME/.msmtp.log && \
chmod 0600 $HOME/.msmtprc
</pre>

Below is the required configuration for a Gmail server:

<pre>
account default              
host smtp.gmail.com          
port 587                     
from "john.example@gmail.com"   
tls on                       
tls_starttls on              
tls_trust_file /etc/ssl/certs/ca-certificates.crt
auth on                     
user "john.example"       
password "rover"       
logfile ~/.msmtp.log
</pre>

Now to setup Fetchmail:

=== Fetchmail ===

Fetchmail is great tool to download mail from Gmail. Download it from the repository as follows:

<pre>
sudo apt-get install fetchmail
</pre>

Once again a single configuration file is required and so you will need to create ~/.fetchmailrc as follows:

<pre>
vim ~/.fetchmailrc
</pre>

The following configuration allow Fetchmail to access and fetch email from Gmail, leave a copy of the mail on the Gmail server and pass the mail to Procmail on your local machine. The SSL configuration is included here as well:

<pre>
poll pop.gmail.com                   
with proto POP3                      
user "john.example@gmail.com"        
there with password "rover"        
is "john" here                              
mda "/usr/bin/procmail -d %T"        
options                                                             
no keep                                 
ssl                                  
sslcertck                            
sslcertpath /etc/ssl/certs
</pre>

All done except as a final touch, since the username and password are openly in this file,you will need to make the file readable only by the file owner. If this is not done Fetchmail will not even run:

<pre>
chmod 600 ~/.fetchmailrc
</pre>

Now would be a good to time to make sure you have <nowiki>[[http://gmail.google.com/support/bin/answer.py?answer=13273|POP forwarding enabled]]</nowiki> in your Gmail account. You will find this in: Settings - Forwarding and POP. Note also that Gmail has a little oddity in regard to the "keep" and "nokeep" command of Fetchmail. You cannot remove mail from Gmail servers via POP3 but you can choose to have your messages archived, kept or deleted once they have been downloaded via POP3. This is a Gmail setting hidden in Settings - Forwarding and POP: "When messages are accessed with POP...".

Now for the mail delivery program Procmail:

=== Procmail ===

Procmail is great sorting tool for use with any mail setup. It can be easily downloaded from the repository:

<pre>
sudo apt-get install procmail
</pre>

So where will Procmail deliver to? Traditionally all mail goes to the location specified in the $MAIL environment variable, but in a default Ubuntu system this is often not set. Set the MAIL variable by opening ~/.bashrc as follows:

<pre>
vim ~/.bashrc
</pre>

and adding the following, using your own username:

<pre>
MAIL=/var/spool/mail/john && export MAIL
</pre>

A very simple configuration file must be created for procmail as follows:

<pre>
vim ~/.procmailrc
</pre>

and below is a very simple start to what can be quite a complex file:

<pre>
PATH=/bin:/usr/bin:/usr/local/bin 
VERBOSE=off                   # Turn on for verbose log
MAILDIR=$HOME/Mail            # Where Procmail recipes deliver
LOGFILE=$HOME/.procmaillog    # Keep a log for troubleshooting.
:0:
* ^TOmutt-user
mutt
</pre>

I include a very simple sorting recipe with the file: this one intercepts everything addressed to "mutt-user" and directs it to $HOME/Mail/mutt. This is the mutt-user mailing list which I would advise all new mutt users to join. And lets not forget to create the Mail folder:

<pre>
mkdir $HOME/Mail
</pre>

Now finally to Mutt.

== Install & Configure Mutt ==

Mutt is one of the truly great pieces of software under Linux. The following command downloads Mutt from the Ubuntu repository:

<pre>
sudo apt-get install mutt
</pre>

Mutt is driven by a configuration file that can be created as follows:

<pre>
vim ~/.muttrc
</pre>

I have spent some time building this file from scratch but for you, Gentle Reader, I include here a more basic version, similar to the one I started from:

<pre>
set realname =john
set from = john.example@gmail.com
set use_from = yes
set envelope_from ="yes"
set sendmail="/usr/bin/msmtp"

set spoolfile = /var/spool/mail/john

set folder="~/Mail"                # Mailboxes in here
set record="+sent"                 # where to store sent messages
set postponed="+postponed"         # where to store draft messages
set move=no                        # Don't move mail from the spool.

mailboxes ! +Fetchmail +slrn +mutt
set sort_browser=alpha    # Sort mailboxes by alpha(bet)

hdr_order Date: From: User-Agent: X-Mailer \
          To: Cc: Reply-To: Subject:
ignore *
unignore Date: From: User-Agent: X-Mailer  \
         To: Cc: Reply-To: Subject:
               
set editor="vim -c 'set tw=70 et' '+/^$' " 
set edit_headers          # See the headers when editing

set sort_alias=alias     # sort aliases in alpha order by alias name

set markers          # mark wrapped lines of text in the pager with a +
set smart_wrap       # Don't wrap mid-word
set pager_context=5  # Retain 5 lines of previous page when scrolling.
set status_on_top    # Status bar on top.
push <show-version>  # Shows mutt version at startup
</pre>

Note: Procmail will create your mailbox in the spool, and set the appropriate permissions, when it first receives mail from fetchmail so don't worry that mutt cannot initially find this mailbox. If you wish to create the mailbox yourself the following permissions and ownership are required (taken from my own system):

<pre>
-rw-rw---- 1 andrew mail 0 2008-10-23 10:12 /var/spool/mail/andrew
</pre>

And finally it is reward time as you open Mutt, type ! to open a shell prompt, type fetchmail -v and start reading your mail! My parting gift is a little macro that was written for me by a generous person on the mutt-user mailing list that will actually do this for you when you simply press the key "I". Place the following in your ~/.muttrc file:

<pre>
macro index,pager I '<shell-escape> fetchmail -v<enter>'
</pre>

And welcome to the world of mutt!

----
CategorySoftware
