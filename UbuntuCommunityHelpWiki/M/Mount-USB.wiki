{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


== Introduction ==

This page explains how to use USB drives, like external hard disks and USB flash drives (aka USB sticks, thumb drives, pen drives, etc).  The material here also applies to flash cards (like in your digital camera).

USB storage devices have the enormous advantage that for the most part they use a standard set of protocols. Thus, instead of needing individual drivers, as does much computer hardware, a standard driver permits access to the devices, making them very portable and able to easily work on many platforms.

{| class="wikitable"
|-
| <tablestyle="float:left; margin: 0em 1em 0em 0em;" border="0" style="padding:0.5em; border-left: 0px; border-right: 0px; border-top: 0px; border-bottom: 0px"><nowiki>[[File:IconsPage/stop.png]]</nowiki>
|}
For help with internal hard drives, see <nowiki>[[Fstab]]</nowiki> and <nowiki>[[MountingWindowsPartitions]]</nowiki>.

<<BR>>

== Automounting ==
=== Mounting ===
By default, storage devices that are plugged into the system mount automatically in the '''/media/<username>''' directory, open a file browser window for each volume and place an icon on your desktop. The rationale for this slight change of behavior can be found <nowiki>[[http://ubuntuforums.org/showthread.php?t=2152773&p=12683721#post12683721| here]]</nowiki>. If you plug in a usb hard disk with many partitions, all of the partitions will automatically mount. This behaviour may not be what you want; you can configure it as shown below.

If the volumes have labels the icons will be named accordingly. Otherwise, they will be named ''' "disk"''', '''"disk-1"''' and so on.

To change the volume label see <nowiki>[[RenameUSBDrive]]</nowiki>.

=== Configuring Automounting ===

To enable or disable automount open a terminal and type:

<pre>
dconf-editor
</pre>
Browse to '''org.gnome.desktop.media-handling'''.

The '''automount''' key controls whether to automatically mount media. If set to true, Nautilus will automatically mount media such as user-visible hard disks and removable media on start-up and media insertion.

Another key, '''org.gnome.desktop.media-handling.automount-open''', controls whether to automatically open a folder for automounted media.

If set to true, Nautilus will automatically open a folder when media is automounted. This only applies to media where no known x-content type was detected; for media where a known x-content type is detected, the user configurable action will be taken instead. This can be configured as shown below.

=== Configuring Program Autostart ===

To control which programs automatically start when you plug in a device, go to '''System-Settings - Details - Removable Media'''. 

For more complex scenarios, see <nowiki>[[UsbDriveDoSomethingHowto]]</nowiki>.

==== Unmounting/Ejecting ====

Before you disconnect the device, don't forget to unmount it.  
This can be done in one of the following ways:
* Right-click the desktop icon and select "Unmount" (or in some cases, "Eject"). 
* In the file manager window, click on the "eject" button next to the name of the mounted volume.
* Right-click the icon in the launcher and select "Unmount".

=== Auto-mounting (Ubuntu Server) ===

By default, disk drives do not auto-mount in Ubuntu Server Edition. If you are looking for a lightweight solution that does not depend on HAL/DBUS, you can install "usbmount". 

== Manually Mounting ==
=== Using Disks ===
'''Disks''' (the GNOME disk utility) is an application for visually managing disk drives and media. When you run it, you will see a list of your drives, including USB drives. If you click a drive on the list, you can view its details, and you can click the triangle-shaped button (Play button) to mount the drive. (This method works even when the drive does not auto-mount.)

=== Using mount ===
==== Get the Information ====
Sometimes, devices don't automount, in which case you should try to manually mount them.  First, you must know what device you are dealing with and what filesystem it is formatted with.  Most flash drives are FAT16 or FAT32 and most external hard disks are NTFS. Type the following:
<pre>
sudo fdisk -l
</pre>
Find your device in the list. It is probably something like /dev/sdb1.  For more information about filesystems, see <nowiki>[[LinuxFilesystemsExplained]]</nowiki>.

==== Create the Mount Point ====
Now we need to create a mount point for the device. Let's say we want to call it "external".  You can call it whatever you want, but if you use spaces in the name it gets a little more complicated. Instead, use an underscore to separate words (like "my_external").  Create the mount point:
<pre>
sudo mkdir /media/external
</pre>

==== Mount the Drive ====
We can now mount the drive.  Let's say the device is /dev/sdb1, the filesystem is FAT16 or FAT32 (like it is for most USB flash drives), and we want to mount it at /media/external (having already created the mount point):
<pre>
sudo mount -t vfat /dev/sdb1 /media/external -o uid=1000,gid=1000,utf8,dmask=027,fmask=137
</pre>
The options following the "-o" give you ownership of the drive, and the masks allow for extra security for file system permissions.  If you don't use those extra options you ''may'' not be able to read and write the drive with your regular username.

Otherwise, if the device is formatted with NTFS, run:
<pre>
sudo mount -t ntfs-3g /dev/sdb1 /media/external
</pre>
<<BR>>
Note: You must have the ntfs-3g driver installed.  See <nowiki>[[MountingWindowsPartitions]]</nowiki> for more information.
<<BR>>
<<BR>>

==== Unmounting the Drive ====
When you are finished with the device, don't forget to unmount the drive before disconnecting it.  Assuming /dev/sdb1 is mounted at /media/external, you can either unmount using the device or the mount point:
<pre>
sudo umount /dev/sdb1
</pre>
or:
<pre>
sudo umount /media/external
</pre>
You cannot unmount from the desktop by right-clicking the icon if the drive was manually mounted.

=== Using pmount ===
There is a program called <code>pmount</code> available in the <nowiki>[[Repositories-Ubuntu| repositories]]</nowiki> which allows unprivileged users to mount drives as if they were using sudo, even without an entry in <nowiki>[[Fstab| -etc-fstab]]</nowiki>. This is perfect for computers that have users without <nowiki>[[RootSudo]]</nowiki> access, like public terminals or thin clients.

pmount can be used with the same syntax as mount (but without sudo), or quite simply as follows:
<pre>
pmount <device> [ label ] 
</pre>
Example:
 <pre>
 pmount /dev/sdb1 flash_drive}}}
 This will mount the device /dev/sdb1 at /media/flash_drive.

If you leave off the ''label'' option, it will mount by default at /media/device.

To unmount the device, use <code>pumount</code>, like so:
{{{
pumount <device>
</pre>
Example:
 <pre>
 pumount /dev/sdb1}}}

For more help, see the man pages for <nowiki>[[http://linux.die.net/man/1/pmount| pmount]]</nowiki> and <nowiki>[[http://linux.die.net/man/1/pumount| pumount]]</nowiki>.

== The Importance of Unmounting ==
{| class="wikitable"
|-
| <tablestyle="float:left; margin: 0em 1em 0em 0em;" border="0" style="padding:0.5em; border-left: 0px; border-right: 0px; border-top: 0px; border-bottom: 0px"><nowiki>[[File:IconsPage/tip.png]]</nowiki>
|}
Before disconnecting devices, you must unmount them first.  This is similar to "Safely Remove" in Windows in that the device won't unmount until data is finished being written to the device, or until other programs are finished using it.  This applies to all types of storage devices, including flash drives, flash cards, external hard drives, ipods and other media players, and even remote storage like Samba or NFS shares.

'''Failure to unmount before disconnecting the device can result in loss of data and/or a corrupted file system.'''  There are no exceptions to this rule.  Be safe - unmount your drives before disconnecting them!

== Other Useful Commands ==
To see a list of your USB devices (the vendor and device ID's), run:
{{{
lsusb
</pre>

To see all attached storage devices and their partitions, run:
<pre>
sudo fdisk -l
</pre>

To see information about currently mounted systems, simply run:
<pre>
mount
</pre>

== Troubleshooting ==
Presented here are some common problems users encounter.

=== Interfering services ===
Two services/programs responsible for automounting might interfere and thereby prevent a successful automount and permission setting.

Example:
Activating the Automount function of Nautilus while using pmount will result in read-only permissions for normal users. Either disable Nautilus' Automount function or deinstall pmount. 

=== Unclean LogFile ===
If you are mounting drives formatted with NTFS (like most external USB hard disks are), you must first have the ntfs-3g driver installed.  This is done automatically in newer versions of Ubuntu.  You should also install ntfs-config and enable mounting, which is not done automatically.  For ntfs-3g and ntfs-config, see <nowiki>[[MountingWindowsPartitions]]</nowiki>.

When a drive is not Safely Removed from a Windows machine (or a forced shutdown occurs from Windows), you may get an error like this when you plug in your drive:
<pre>
$LogFile indicates unclean shutdown (0, 0)
Failed to mount '/dev/sda1': Operation not supported
Mount is denied because NTFS is marked to be in use. Choose one action:

Choice 1: If you have Windows then disconnect the external devices by
clicking on the 'Safely Remove Hardware' icon in the Windows
taskbar then shutdown Windows cleanly.

Choice 2: If you don't have Windows then you can use the 'force' option for
your own responsibility. For example type on the command line:

mount -t ntfs-3g /dev/sda1 /media/sda1/ -o force
</pre>

The best option is Choice 1, but you can force the mount by running Choice 2 with sudo. You must then manually unmount it from the terminal (you can't right click the desktop icon):
<pre>
sudo umount <mount_point>
</pre>
After that the drive should automount normally again.

=== User Privileges ===
If your usb device doesn't appear on your desktop, you should check that your user has the correct privileges.  Go to '''System->Administration->User and Groups''', choose the user, click on "Properties", then go to the "User Privileges" tab.  You should have the "Access external storage devices automatically" option checked.

=== Preferences ===
If your usb device doesn't appear on your desktop, you should check that the automount action is enabled in the preferences:
* Navigate to '''System->Preferences->Removable Drives and Media'''
* Verify that all "Mount removable drives when..." are checked.
NOTE: This does not seem to apply to Hardy Heron.

=== USB 2 Issues ===
==== old kernels workaround ====
If you encounter problems using your USB device with USB 2 (i.e. 'high speed' mode), you can revert to  the 'full speed' mode (slower) by unloading ehci_hcd. To do that, type in a terminal:
<pre>
sudo rmmod ehci_hcd
</pre>
before plugging in your device.

==== recent kernels workaround, from Karmic ====
see also <nowiki>[[http://www.absolutelytech.com/2010/04/18/solved-unable-to-enumerate-usb-device-disabling-ehci_hcd| AbsolutelyTech]]</nowiki>

ehci_hcd is now built into the kernel and cannot be load/unloaded using modprobe.
To revert a connected device from (failing) high-speed to full-speed:

* Determine your device id using 
 <pre>
 lsusb
 }}}
* Find which bus it is connected to.
 The bus id can be found as a folder in /sys/bus/pci/drivers/ehci_hcd.
 The following script explores buses and connected devices:
 {{{
pushd /sys/bus/pci/drivers/ehci_hcd > /dev/null
for bus in 0000:??:??.? ; do
	echo "ehci_hcd bus $bus"
	pushd $bus/usb1 > /dev/null
	for dev in ?-?; do
		idVendor=`cat $dev/idVendor`
		idProduct=`cat $dev/idProduct`
		echo "ehci_hcd bus $bus: device $dev = $idVendor:$idProduct"
	done
	popd > /dev/null
done
popd > /dev/null
</pre>
 The information is also usually available in /var/log/kern.log

* Unbind the bus (and all devices) from the ehci_hcd driver.
 Insert the bus id in the following command, using the format 0000:00:xx.x
 <pre>
 sudo sh -c 'echo -n "0000:00:xx.x" > unbind'
 }}}

=== Buffer I/O Errors ===
If you see errors related to Buffer I/O when attaching a USB storage device, there are two ways to work around it. First, try using varying max_sectors settings, as such:
{{{
sudo sh -c "echo 120 > /sys/block/sda/queue/max_sectors_kb"
</pre>

Try values of 120, 64 and 32.

If this does not resolve the issue, then you may need an unusual_dev entry for your device. It would look something like this:
<pre>
UNUSUAL_DEV(0x03eb , 0x2002, 0x0100, 0x9999,
            "Generic",
            "MusicDrive",
            US_SC_DEVICE, US_PR_DEVICE, NULL,
            US_FL_IGNORE_RESIDUE),
</pre>

The vendor and device IDs can be obtained from the output of "lsusb". The entry would be placed in drivers/usb/storage/unusual_devs.h. If you cannot compile your own kernel, please file a bug report, and we'll attempt to compile a test module for you.

=== Device suddenly becomes read-only ===
If your device changes suddenly to read-only mode, and you see this kind of error:
<pre>
[17183798.908000] FAT: Filesystem panic (dev sda1)
[17183798.908000]     fat_get_cluster: invalid cluster chain (i_pos 0)
[17183798.908000]     File system has been set read-only
</pre>

This might be the sign of an unclean device.
You should check your device. Try <nowiki>[[TestingStorageMedia]]</nowiki> to do so. Or use "Disk Utility" (under System, Administration), find your device, unmount it, check the file system, then mount it again.

=== USB-Device is or becomes read-only without errors ===
If you see "Write Protect is off" and no errors in your logfiles, than you should set filesystem type specific mount options (FS_MOUNTOPTIONS) in /etc/usbmount/usbmount.conf. Wrong gid causes mounting read only.  

=== General tip ===
When you encounter problems with USB devices, the first thing to do is to check the latest debug information generated from the kernel just after you plug in your device and/or just after you encounter the problem.<<BR>>
To do that, open a terminal and type :
<pre>
dmesg
</pre>
Check the latest messages; they should be related to your problem.

=== Seeking Further Help ===
The best place to get help with almost any Ubuntu problem is on the <nowiki>[[http://ubuntuforums.org/| Ubuntu Forums]]</nowiki>.  The ''Absolute Beginner Talk'' section is best for beginners.

== Other Resources ==
{| class="wikitable"
|-
| <tablestyle="float:left; margin: 0em 1em 0em 0em;" border="0" style="padding:0.5em; border-left: 0px; border-right: 0px; border-top: 0px; border-bottom: 0px"><nowiki>[[File:IconsPage/resources.png]]</nowiki>
|}
<<BR>>
Some other related material:
<<BR>>
<<BR>>

* <nowiki>[[RenameUSBDrive]]</nowiki>
* <nowiki>[[BootFromUSB]]</nowiki>
* <nowiki>[[UsbDriveDoSomethingHowto]]</nowiki>
* <nowiki>[[http://en.wikipedia.org/wiki/USB_flash_drive]]</nowiki>
* <nowiki>[[DebuggingUSBStorage]]</nowiki>
----
CategoryHardware CategoryUsb
