{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__



== Introduction ==

Long''''''Run is a feature introduced by <nowiki>[[http://www.transmeta.com/|Transmeta (tm)]]</nowiki> and used in the <nowiki>[[http://www.transmeta.com/crusoe/index.html|Crusoe (tm)]]</nowiki> and <nowiki>[[http://www.transmeta.com/efficeon/index.html|Efficeon (tm)]]</nowiki> processors. It allows processors to use power on demand to increase performance.

This page shows how Ubuntu 5.04 (Hoary Hedgehog) can be configured to control and take advantage of Long''''''Run-enabled processors. Instructions for running the <code>longrun</code> utility are also included.

'''Note:''' Tips may work on previous versions of Ubuntu, but testing would be necessary to confirm their effectiveness.

== Definition ==
The official definition from http://www.transmeta.com/efficeon/faq.html#12:

 Long''''''Run is Transmeta's original proprietary power management technology that enables processors to change voltage and frequency dynamically -- hundreds of times per second -- to provide the performance needed by the application at any moment. Transmeta introduced Long''''''Run power management in the Crusoe processor, and the new Efficeon processor now also incorporates Enhanced Long''''''Run technology.

== Requirements ==
To be able to make use of the Long''''''Run functionality of the Transmeta Crusoe family of processors on Ubuntu, there are certain requirements, especially in the kernel drivers. These are the following:
* CPUID device driver
* MSR device driver
* longrun package (available from the universe repository)

The first two device drivers may be loaded from the default Ubuntu packaged Linux kernel by issuing the following commands from the terminal (or the shell):

<pre>
sudo modprobe cpuid
sudo modprobe msr
</pre>

The two modules may be loaded during boot time by adding their names to /etc/modules -- part of which is shown below:

<pre>

...

cpuid
msr

...
</pre>

The Long''''''Run utility is provided by the <code>longrun</code> package from the Universe repository:

<pre>
sudo apt-get install longrun
</pre>

== Command Index ==
There are five operations which can be done using the <code>longrun</code> utility to enable, configure, disable, and query the Long''''''Run settings for the processor. These are:

* Listing Long''''''Run information about available performance levels for the processor.
* Printing the current Long''''''Run settings and status.
* Setting the Long''''''Run mode flag.
* Configuring the current Long''''''Run performance window.
* Setting the current Long''''''Run Thermal Extensions setting.

These operations are enumerated in depth in the following sections.

The basic format for the <code>longrun</code> command is as follows:

<pre>
longrun -c (cpuid device) -m (msr device) (command flag) [command options]
</pre>

CPUID device pertains to the device created and associated with the CPUID device driver -- which works the same for the MSR device, created and associated with the MSR device driver. Usually, on uniprocessor systems, CPUID and MSR devices for the one and only processor are the following files respectively:

<pre>
/dev/cpu/0/cpuid
/dev/cpu/0/msr
</pre>

When used in the <code>longrun function</code>, it usually looks like the following:

<pre>
sudo longrun -c /dev/cpu/0/cpuid -m /dev/cpu/0/msr ...
</pre>

The '0' (zero) pertains to the cpu id which you want to be able to control with the utility. In cases where there are more than one Long''''''Run-capable processor in the system, each one gets a cpu id. For example, in a dual-Crusoe(TM) system, the second processor is accessed using the following device(s):

<pre>
/dev/cpu/1/cpuid
/dev/cpu/1/msr
</pre>

'''NOTE:''' To be able to perform these operations, make sure that the appropriate drivers have been loaded and that the <code>longrun</code> utility is installed in the system. See above for information about installing required packages and loaded device drivers.

=== Displaying current settings and status. ===
The following command can be used to display the current settings and status:

<pre>
sudo longrun -c /dev/0/cpuid -m /dev/0/msr -p
</pre>

Which would yield something similar to this:

<pre>
LongRun: enabled
LongRun Thermal Extensions (LTX): inactive
Current performance window: 0 to 100
Current performance level: 66
LongRun flags: economy
</pre>

=== Listing available LongRun performance levels ===
To see the available performance levels for the processor, the following command should show that information on the terminal/command line:

<pre>
sudo longrun -c /dev/cpu/0/cpuid -m /dev/cpu/0/msr -l
</pre>

Typical outputs look like the following:

<pre>
  0   300  1.200  0.281  100   75   33
 33   400  1.250  0.407  100   80   33
 66   500  1.400  0.638  125  100   33
100   600  1.600  1.000  120  100   33
</pre>

The above values are obtained from a Transmeta(TM) Crusoe(TM) Processor TM5600, installed on an ECS Desknote A530 (See <nowiki>[[Ubuntu:HardwareSupportMachinesECS|ECS Hardware Support]]</nowiki> for more information).

The significant values of note are the values on the first column, which defines the possible values for the performance window.

=== Configuring the Current Performance Window ===
Given the values from the available performance levels, setting the current performance window (minimum and maximum levels) may be done using the following command:

<pre>
sudo longrun -c /dev/cpu/0/cpuid -m /dev/cpu/0/msr -s 0 100
</pre>

When the current settings and status are displayed, the output should be similar to the following:

<pre>
sudo longrun -c /dev/cpu/0/cpuid -m /dev/cpu/0/msr -p
</pre>

Ouput:

<pre>
LongRun: enabled
LongRun Thermal Extensions (LTX): inactive
Current performance window: 0 to 100
Current performance level: 100
LongRun flags: economy
</pre>

'''TODO:''' Explain performance window and its effect on the performance of the processor.

=== Setting the performance mode flag ===
Long''''''Run CPU's have different performance mode flags, which can be set using the '''-f''' option of the longrun utility. In the case of the Transmeta Crusoe TM5600, the two flags ''performance'' and ''economy'' are available.

To set the performance flag using the <code>longrun</code> utility, the following command can be used:

<pre>
sudo longrun -c /dev/0/cpuid -m /dev/0/msr -f performance
</pre>

This sets the ''performance'' flag for the processor. To verify the results, the settings are printed:

<pre>
sudo longrun -c /dev/0/cpuid -m /dev/0/msr -p
</pre>

<pre>
LongRun: enabled
LongRun Thermal Extensions (LTX): inactive
Current performance window: 0 to 100
Current performance level: 100
LongRun flags: performance
</pre>

'''TODO:''' Explain what the ''performance'' and ''economy'' flags do for the processor. Consult technical docs for more info.

=== Setting thermal extension settings. ===
Long''''''Run Thermal Extensions (LTX) can be enabled, disabled, and configured using the '''-t''' option. Valid values range from 0 to 8 where a setting of 8 turns off the extensions.

To set the LTX to the highest sensitivity (?) setting of 0, the following command can be used:

<pre>
sudo longrun -c /dev/cpu/0/cpuid -m /dev/cpu/0/msr -t 0
</pre>

To verify:

<pre>
sudo longrun -c /dev/cpu/0/cpuid -m /dev/cpu/0/msr -p
</pre>

<pre>
LongRun: enabled
LongRun Thermal Extensions (LTX): active
LTX setting: reserved
Current performance window: 0 to 100
Current performance level: 0
LongRun flags: performance
</pre>

Notice that the LTX setting is set to '''reserved''' while the Long''''''Run Thermal Extensions (LTX) indicates that it's "active".

From '''man longrun''':
<pre>
Longrun Thermal  Extensions  (LTX)  is  an  alternative  way  to
manipulate  the  power saving functionality of the processor, by
controlling heat dissipation directly.   Settings  2  through  8
represent   power   utilization   levels   from   25%  to  100%,
respectively, in 12.5% increments.  NOTE: Settings 0 and  1  are
listed  as  ’reserved’  in  the  TM5600 literature.  Though they
appear to represent 0% and  12.5%  respectively  on  the  TM5800
chip, use these settings at your own risk.

...

Notes:  This  functionality  may  or  may  not  provide you with
different performance per  watt  characteristings  than  the  -s
flag.   It is provided for completeness, and left as an exercise
to the reader to decide if it is appropriate  on  their  system.
As mentioned above, use the -t 0 and -t 1 settings with caution.
</pre>

== External Links ==
* <nowiki>[[http://www.transmeta.com/efficeon/faq.html|Transmeta FAQ]]</nowiki>
* <nowiki>[[Ubuntu:HardwareSupportMachinesECS|ECS Hardware Support]]</nowiki>
* http://research.indocisc.com/~andika/ecs/

''This HOWTO is a work in progress. Please feel free to comment on the Wiki, or contact <nowiki>[[Ubuntu:DeanMichaelBerris|Dean Michael Berris]]</nowiki> for questions and clarifications.''

----
CategoryHardware
