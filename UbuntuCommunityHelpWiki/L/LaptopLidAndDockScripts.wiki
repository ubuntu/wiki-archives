{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

== Laptop Lid and Dock Scripts ==

The purpose of this tutorial is to show:
 1. How to catch the lid open and close events.
 2. How to catch the laptop dock and undock events.
 3. How to run a script for each of those events.

Specific examples are portrayed here: 
 - When the lid closes play a "closing" sound and set Pidgin status to away with a message saying "My laptop lid is closed..." <<BR>>
 - When the lid is opened play an "opening" sound and set Pidgin status to available with a message saying "I am here..." <<BR>>
 - When the laptop is undocked from the docking station play a "undock" sound <<BR>>
 - When the laptop is docked in the docking station play a "docked" sound <<BR>>

'''NOTES:'''
- The material here was tested in Ubuntu 10.04. The computers used were a Lenovo Thinkpad T61 and a T61p. Things might slightly change depending on the laptop or Linux distribution. But the main idea will be the same. This tutorial is just to point people towards the right solution.

=== Laptop Lid Open/Close Scripts ===

It is important to understand that these events will be caught by processes owned by root. A fix is needed to allow root to run processes in the normal user's X environment.
In order to make the environment variables available for root:

<pre>
gedit ~/export_x_info
</pre>

and paste the following in:

<pre>
sleep 5
touch $HOME/.Xdbus
chmod 600 $HOME/.Xdbus
env | grep DBUS_SESSION_BUS_ADDRESS > $HOME/.Xdbus
echo 'export DBUS_SESSION_BUS_ADDRESS' >> $HOME/.Xdbus
env | grep XAUTHORITY >> $HOME/.Xdbus
echo 'export XAUTHORITY' >> $HOME/.Xdbus
</pre>

Save and close. Then make it executable:

<pre>
chmod 700 ~/export_x_info
</pre>

Now set it to run at startup. In Gnome 2, System> Preferences> Sessions and click Add. In Ubuntu Unity, click the gear icon in the upper right, select Startup Programs, and click Add.

<pre>
Name: X Environment Variables
Command: /home/your_user/export_x_info
</pre>

Click Add and close.

This will execute every time you start your computer and the call to source ~/.Xdbus loads the DBUS_SESSION_BUS_ADDRESS and XAUTHORITY environment variables before executing the purple-remote command for Pidgin.

Ubuntu makes it easy to catch the laptop lid open and close events.

Firstly, you need to create (if it's not there, that's the case on Ubuntu 14.04) the /etc/acpi/events/lm_lid file and put:

<pre>
event=button/lid.*
action=/etc/acpi/lid.sh
</pre>

After that, there is a file /etc/acpi/lid.sh which runs every time your lid open or closes. So run:

<pre>
gksudo gedit /etc/acpi/lid.sh
</pre>

and right after line '''#!/bin/bash''' paste '''/home/your_user/lid_event'''. Save and close.

Now create the file that will call different scripts according to open or close events.

<pre>
gedit ~/lid_event
</pre>

and paste the following into the file:

<pre>
grep -q closed /proc/acpi/button/lid/LID/state
if [ $? = 0 ]
then
        /home/your_user/close;
else
        /home/your_user/open;
fi
</pre>

Save and close and make it executable.

<pre>
chmod +x ~/lid_event
</pre>

And finally, create the files '''open''' and '''close'''.

<pre>
gedit ~/open
</pre>

Paste the following into the file:

<pre>
source /home/your_user/.Xdbus
DISPLAY=:0.0 su your_user -c "aplay /usr/lib/openoffice/basis3.0/share/gallery/sounds/sparcle.wav"
DISPLAY=:0.0 su your_user -c "purple-remote 'setstatus?status=available&message=I am here...'"
</pre>

Save and close. Make it executable:

<pre>
chmod +x ~/open
</pre>

Now create the '''close''' file:

<pre>
gedit ~/close
</pre>

and paste the following into the file:

<pre>
source /home/your_user/.Xdbus
DISPLAY=:0.0 su your_user -c "aplay /usr/lib/openoffice/basis3.0/share/gallery/sounds/falling.wav"
DISPLAY=:0.0 su your_user -c "purple-remote 'setstatus?status=away&message=My laptop lid is closed...'"
</pre>

Save and close. Make it executable:

<pre>
chmod +x ~/close
</pre>

Next, restart ACPI. Run:

<pre>
sudo /etc/init.d/acpid restart
</pre>

Now you can test that it works by opening and closing your laptop lid.
<<BR>>

 '''Notes:'''
 - Make sure that the Power Management option for laptop lid closed is set to do nothing. <<BR>>
 - The sounds used are from OpenOffice 3.0, the path changes for other versions. <<BR>>
 - Make sure you have libpurple-bin installed -- '''sudo apt-get install libpurple-bin'''. <<BR>>

=== Dock and Undock Scripts ===

 
Many laptops can be docked into a powered, cooled docking station. These scripts are meant to capture the dock/undock event and, in this case, play a sound.

This is done by creating and using a udev event.

<pre>
gksudo gedit /lib/udev/rules.d/85-thinkpad-T61.rules
</pre>

And paste the following:

<pre>
KERNEL=="dock.0", ACTION=="change", RUN+="/etc/thinkpad/dock.sh"
</pre>

Create the '''docked''' script:

<pre>
sudo mkdir /etc/thinkpad
gksudo gedit /etc/thinkpad/dock.sh
</pre>

and paste the following:

<pre>
sleep 1
DOCKED=$(cat /sys/devices/platform/dock.0/docked)
case "$DOCKED" in
	"0")
# undocked event
	/home/your_user/undocked
	;;
	"1")
# docked event
	/home/your_user/docked
	;;
esac
exit 0
</pre>

Save and close. Make it executable:

<pre>
sudo chmod +x /etc/thinkpad/dock.sh
</pre>

Next, create the '''undocked''' file:

<pre>
gedit ~/undocked
</pre>

and paste the following:

<pre>
source /home/your_user/.Xdbus
DISPLAY=:0.0 su your_user -c "aplay /usr/lib/openoffice/basis3.0/share/gallery/sounds/falling.wav"
</pre>

Save and close. Make it executable:

<pre>
chmod +x ~/undocked
</pre>

Next, the docked file:

<pre>
gedit ~/docked
</pre>

Paste the following:

<pre>
source /home/your_user/.Xdbus
DISPLAY=:0.0 su your_user -c "aplay /usr/lib/openoffice/basis3.0/share/gallery/sounds/sparcle.wav"
</pre>

Save and close. Make it executable:

<pre>
chmod +x ~/docked
</pre>

Now finally we need to restart hal:

<pre>
sudo /etc/init.d/hal restart
</pre>

You now should be able to dock and undock and hear a sound each time you do. From here the options for you are endless.
--------------------------
Originally posted <nowiki>[[http://ubuntuforums.org/showthread.php?t=1076486|The Ubuntu Forums (ubuntuforums.org)]]</nowiki>
