{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


== Introduction ==
For an introduction to firewalls, please see <nowiki>[[Firewall]]</nowiki>.

=== UFW - Uncomplicated Firewall ===
The default firewall configuration tool for Ubuntu is <code>ufw</code>. Developed to ease <code>iptables</code> firewall configuration, <code>ufw</code> provides a user friendly way to create an IPv4 or IPv6 host-based firewall. By default UFW is disabled.

<nowiki>[[Gufw]]</nowiki> is a GUI that is available as a frontend.

== Basic Syntax and Examples ==
=== Default rules are fine for the average home user ===

When you turn UFW on, it uses a default set of rules (profile) that should be fine for the average home user. That's at least the goal of the Ubuntu developers. In short, all 'incoming' is being denied, with some exceptions to make things easier for home users.

=== Enable and Disable ===
==== Enable UFW ====
To turn UFW on with the default set of rules:
<pre>
sudo ufw enable
</pre>

To check the status of UFW:
<pre>
sudo ufw status verbose
</pre>

The output should be like this:
<pre>
youruser@yourcomputer:~$ sudo ufw status verbose
[sudo] password for youruser:
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing)
New profiles: skip
youruser@yourcomputer:~$
</pre>

Note that by default, deny is being applied to incoming. There are exceptions, which can be found in the output of this command:
<pre>
sudo ufw show raw
</pre>

You can also read the rules files in /etc/ufw (the files whose names end with .rules).

==== Disable UFW ====
To disable ufw use:
<pre>
sudo ufw disable
</pre>

=== Allow and Deny (specific rules) ===
==== Allow ====
<pre>
sudo ufw allow <port>/<optional: protocol>
</pre>

'''example:''' To allow incoming tcp and udp packet on port 53
 <pre>
sudo ufw allow 53
</pre>
'''example:''' To allow incoming tcp packets on port 53
 <pre>
sudo ufw allow 53/tcp
</pre>
'''example:''' To allow incoming udp packets on port 53
 <pre>
sudo ufw allow 53/udp
</pre>

==== Deny ====
<pre>
sudo ufw deny <port>/<optional: protocol>
</pre>

'''example:''' To deny tcp and udp packets on port 53
 <pre>
sudo ufw deny 53
</pre>
'''example:''' To deny incoming tcp packets on port 53
 <pre>
sudo ufw deny 53/tcp
</pre>
'''example:''' To deny incoming udp packets on port 53
 <pre>
sudo ufw deny 53/udp
</pre>

=== Delete Existing Rule ===
To delete a rule, simply prefix the original rule with delete. For example, if the original rule was:
<pre>
ufw deny 80/tcp
</pre>
Use this to delete it:
<pre>
sudo ufw delete deny 80/tcp
</pre>

=== Services ===
You can also allow or deny by service name since ufw reads from /etc/services
To see get a list of services:
<pre>
less /etc/services
</pre>

==== Allow by Service Name ====
<pre>
sudo ufw allow <service name>
</pre>

'''example:''' to allow ssh by name
 <pre>
sudo ufw allow ssh
</pre>

==== Deny by Service Name ====
<pre>
sudo ufw deny <service name>
</pre>

'''example:''' to deny ssh by name
 <pre>
sudo ufw deny ssh
</pre>

=== Status ===
<nowiki>[[File:IconsPage/important.png]]</nowiki> Checking the status of ufw will tell you if ufw is enabled or disabled and also list the current ufw rules that are applied to your iptables.

To check the status of ufw:
<pre>
sudo ufw status

Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7
22:tcp                     ALLOW   192.168.0.0/24
22:udp                     ALLOW   192.168.0.0/24
</pre>

if ufw was not enabled the output would be:

<pre>
sudo ufw status
Status: inactive
</pre>

=== Logging ===
To enable logging use: <pre>
sudo ufw logging on
</pre>
To disable logging use: <pre>
sudo ufw logging off
</pre>

== Advanced Syntax ==
You can also use a fuller syntax, specifying the source and destination addresses, ports and protocols.

=== Allow Access ===
This section shows how to allow specific access.

==== Allow by Specific IP ====
<pre>
sudo ufw allow from <ip address>
</pre>

'''example:'''To allow packets from 207.46.232.182:
 <pre>
sudo ufw allow from 207.46.232.182
</pre>

==== Allow by Subnet ====

You may use a net mask :

<pre>
sudo ufw allow from 192.168.1.0/24
</pre>

==== Allow by specific port and IP address ====
<pre>
sudo ufw allow from <target> to <destination> port <port number>
</pre>

'''example:''' allow IP address 192.168.0.4 access to port 22 for all protocols
 <pre>
sudo ufw allow from 192.168.0.4 to any port 22
</pre>

==== Allow by specific port, IP address and protocol ====
<pre>
sudo ufw allow from <target> to <destination> port <port number> proto <protocol name>
</pre>

'''example:''' allow IP address 192.168.0.4 access to port 22 using TCP
 <pre>
sudo ufw allow from 192.168.0.4 to any port 22 proto tcp
</pre>

==== Enable PING ====

__Note__: Security by obscurity may be of very little actual benefit with modern cracker scripts. '''By default, UFW allows ping requests'''. You may find you wish to leave (icmp) ping requests enabled to diagnose networking problems.

In order to disable ping (icmp) requests, you need to edit '''/etc/ufw/before.rules''' and remove the following lines:

<pre>
-A ufw-before-input -p icmp --icmp-type destination-unreachable -j ACCEPT
-A ufw-before-input -p icmp --icmp-type source-quench -j ACCEPT
-A ufw-before-input -p icmp --icmp-type time-exceeded -j ACCEPT
-A ufw-before-input -p icmp --icmp-type parameter-problem -j ACCEPT
-A ufw-before-input -p icmp --icmp-type echo-request -j ACCEPT
</pre>

or change the "ACCEPT" to "DROP" 

<pre>
-A ufw-before-input -p icmp --icmp-type destination-unreachable -j DROP
-A ufw-before-input -p icmp --icmp-type source-quench -j DROP
-A ufw-before-input -p icmp --icmp-type time-exceeded -j DROP
-A ufw-before-input -p icmp --icmp-type parameter-problem -j DROP
-A ufw-before-input -p icmp --icmp-type echo-request -j DROP
</pre>

=== Deny Access ===
==== Deny by specific IP ====
<pre>
sudo ufw deny from <ip address>
</pre>

'''example:'''To block packets from 207.46.232.182:
 <pre>
sudo ufw deny from 207.46.232.182
</pre>

==== Deny by specific port and IP address ====
<pre>
sudo ufw deny from <ip address> to <protocol> port <port number>
</pre>

'''example:''' deny ip address 192.168.0.1 access to port 22 for all protocols
 <pre>
sudo ufw deny from 192.168.0.1 to any port 22
</pre>

=== Working with numbered rules ===
==== Listing rules with a reference number ====

You may use status numbered to show the order and id number of rules:

<pre>
sudo ufw status numbered
</pre>

=== Editing numbered rules ===
==== Delete numbered rule ====
You may then delete rules using the number. This will delete the first rule and rules will shift up to fill in the list.

<pre>
sudo ufw delete 1
</pre>

==== Insert numbered rule ====
<pre>
sudo ufw insert 1 allow from <ip address>
</pre>

=== Advanced Example ===
'''Scenario:''' You want to block access to port 22 from 192.168.0.1 and 192.168.0.7 but allow all other 192.168.0.x IPs to have access to port 22 using tcp

<pre>
sudo ufw deny from 192.168.0.1 to any port 22
sudo ufw deny from 192.168.0.7 to any port 22
sudo ufw allow from 192.168.0.0/24 to any port 22 proto tcp
</pre>

<nowiki>[[File:IconsPage/important.png]]</nowiki> This puts the specific rules first and the generic second. Once a rule is matched the others will not be evaluated (see manual below) so you must put the specific rules first. '''As rules change you may need to delete old rules to ensure that new rules are put in the proper order.'''

To check your rules orders you can check the status; for the scenario the output below is the desired output for the rules to work properly

<pre>
sudo ufw status
Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7
22:tcp                     ALLOW   192.168.0.0/24
</pre>

'''Scenario change:''' You want to block access to port 22 to 192.168.0.3 as well as 192.168.0.1 and 192.168.0.7.

<pre>
sudo ufw delete allow from 192.168.0.0/24 to any port 22
sudo ufw status
Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7

sudo ufw deny 192.168.0.3 to any port 22
sudo ufw allow 192.168.0.0/24 to any port 22 proto tcp
sudo ufw status

Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7
22:tcp                     DENY    192.168.0.3
22:udp                     DENY    192.168.0.3
22:tcp                     ALLOW   192.168.0.0/24
</pre>

<nowiki>[[File:IconsPage/important.png]]</nowiki> If you simply add the deny rule the allow would have been above it and been applied instead of the deny

== Interpreting Log Entries ==
Based on the response to the post <nowiki>[[ http:--ubuntuforums.org-showthread.php?t=2085110&p=12361050#post12361050  | UFW log guide-tutorial ? ]]</nowiki>.

The SPT and DPT values, along with SRC and DST values, will typically be the values you’ll focus on when analysing the firewall logs.

==== Pseudo Log Entry ====
<pre>
Feb  4 23:33:37 hostname kernel: [ 3529.289825] [UFW BLOCK] IN=eth0 OUT= MAC=00:11:22:33:44:55:66:77:88:99:aa:bb:cc:dd SRC=444.333.222.111 DST=111.222.333.444 LEN=103 TOS=0x00 PREC=0x00 TTL=52 ID=0 DF PROTO=UDP SPT=53 DPT=36427 LEN=83
</pre>

==== Date ====
It's good practice to watch the dates and times. If things are out of order or blocks of time are missing then an attacker probably messed with your logs.

==== Hostname ====
The server’s hostname

==== Uptime ====
The time in seconds since boot.

==== Logged Event ====
Short description of the logged event; e.g. [UFW BLOCK]

==== IN ====
If set, then the event was an incoming event.

==== OUT ====
If set, then the event was an outgoing event.

==== MAC ====
This provides a 14-byte combination of the Destination MAC, Source MAC, and EtherType fields, following the order found in the Ethernet II header. See <nowiki>[[http://en.wikipedia.org/wiki/Ethernet_frame | Ethernet frame ]]</nowiki> and <nowiki>[[http://en.wikipedia.org/wiki/EtherType | EtherType ]]</nowiki> for more information.

==== SRC ====
This indicates the source IP, who sent the packet initially. Some IPs are routable over the internet, some will only communicate over a LAN, and some will only route back to the source computer. See <nowiki>[[ http:--en.wikipedia.org-wiki-IP_address#Private_addresses | IP address ]]</nowiki> for more information.

==== DST ====
This indicates the destination IP, who is meant to receive the packet. You can use <nowiki>[[ https:--whois.net- | whois.net ]]</nowiki> or the cli `whois` to determine the owner of the IP address.

==== LEN ====
This indicates the length of the packet.

==== TOS ====
I believe this refers to the TOS field of the IPv4 header. See <nowiki>[[ http:--tools.ietf.org-html-draft-xiao-tcp-prec-02 | TCP Processing of the IPv4 Precedence Field ]]</nowiki> for more information.

==== PREC ====
I believe this refers to the Precedence field of the IPv4 header.

==== TTL ====
This indicates the “Time to live” for the packet. Basically each packet will only bounce through the given number of routers before it dies and disappears. If it hasn’t found its destination before the TTL expires, then the packet will evaporate. This field keeps lost packets from clogging the internet forever. See <nowiki>[[ http:--en.wikipedia.org-wiki-Time_to_live | Time to live ]]</nowiki> for more information.

==== ID ====
Not sure what this one is, but it's not really important for reading logs. It might be ufw’s internal ID system, it might be the operating system’s ID.

==== PROTO ====
This indicates the protocol of the packet - TCP or UDP. See <nowiki>[[ http:--www.bleepingcomputer.com-tutorials-tcp-and-udp-ports-explained- | TCP and UDP Ports Explained ]]</nowiki> for more information.

==== SPT ====
This indicates the source. I believe this is the port, which the SRC IP sent the IP packet over. See <nowiki>[[ http:--en.wikipedia.org-wiki-List_of_TCP_and_UDP_port_numbers | List of TCP and UDP port numbers ]]</nowiki> for more information.

==== DPT ====
This indicates the destination port. I believe this is the port, which the SRC IP sent its IP packet to, expecting a service to be running on this port.

==== WINDOW ====
This indicates the size of packet the sender is willing to receive.

==== RES ====
This bit is reserved for future use & is always set to 0. Basically it’s irrelevant for log reading purposes.

==== SYN URGP ====
SYN indicates that this connection requires a three-way handshake, which is typical of TCP connections. URGP indicates whether the urgent pointer field is relevant. 0 means it's not. Doesn’t really matter for firewall log reading.

== IP Blocklist for UFW ==
If your Ubuntu system is directly exposed to the internet, either via a public IP address or port forwarding, an IP blocklist will add another layer of protection. I created a couple of scripts that integrate with ufw and update the list daily. Full details are available on the GitHub project: <nowiki>[[https://github.com/poddmo/ufw-blocklist]]</nowiki>.

== Other Resources ==
* For instructions on using ufw first see the <nowiki>[[https://help.ubuntu.com/lts/serverguide/firewall.html| official server guide]]</nowiki>.
* The most recent syntax and manual can be retrieved by getting the <nowiki>[[http://manpages.ubuntu.com/manpages/man8/ufw.8.html|man page]]</nowiki>. Otherwise open a terminal window and type:
 <pre>
man ufw
</pre>
* <nowiki>[[Firewall]]</nowiki> - wiki homepage for firewall related documentation.
* <nowiki>[[Iptables]]</nowiki> - interface to the netfilter subsystem in the Linux kernel.
* <nowiki>[[Ubuntu:UncomplicatedFirewall]]</nowiki> - UFW Project wiki page.
* <nowiki>[[Gufw]]</nowiki> - Graphic User Interface for UFW.
----
CategoryNetworking CategorySecurity
