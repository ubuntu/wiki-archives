{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


== Introduction ==
For an introduction to firewalls, please see <nowiki>[[Firewall]]</nowiki>.

=== UFW - Uncomplicated Firewall ===
The default firewall configuration tool for Ubuntu is <code>ufw</code>. Developed to ease <code>iptables</code> firewall configuration, <code>ufw</code> provides a user friendly way to create an IPv4 or IPv6 host-based firewall.

By default UFW is enabled but all ports are left open (otherwise there would be no Internet access following installation).

<nowiki>[[Gufw]]</nowiki> is a GUI that is available as a frontend.

== Basic Syntax and Examples ==
=== Set Default Rule ===

Setting the default mode of ufw is recommended before turning it on
Set Default Deny:
<pre>
sudo ufw default deny
</pre>
Set Default Allow:
<pre>
sudo ufw default allow
</pre>

=== Enable and Disable ===
==== Enable ufw ====
To turn UFW on:
<pre>
sudo ufw enable
</pre>

<nowiki>[[File:IconsPage/note.png]]</nowiki> Unless you have used set the default to deny when you initially enable ufw it is in ALLOW mode, and will allow everything incoming and outgoing until you make rulesets.

==== Disable ufw ====
To disable ufw use:
<pre>
sudo ufw disable
</pre>

=== Allow and Deny ===
==== Allow ====
<pre>
sudo ufw allow <port>/<optional: protocol>
</pre>

'''example:''' To allow incoming tcp and udp packet on port 53
<pre>
sudo ufw allow 53
</pre>
'''example:''' To allow incoming tcp packets on port 53
<pre>
sudo ufw allow 53/tcp
</pre>
'''example:''' To allow incoming udp packets on port 53
<pre>
sudo ufw allow 53/udp
</pre>

==== Deny ====
<pre>
sudo ufw deny <port>/<optional: protocol>
</pre>

'''example:''' To deny tcp and udp packets on port 53
<pre>
sudo ufw deny 53
</pre>
'''example:''' To deny incoming tcp packets on port 53
<pre>
sudo ufw deny 53/tcp
</pre>
'''example:''' To deny incoming udp packets on port 53
<pre>
sudo ufw deny 53/udp
</pre>

=== Delete Existing Rule ===
To delete a rule, simply prefix the original rule with delete. For example, if the original rule was:
<pre>
ufw deny 80/tcp
</pre>
Use this to delete it:
<pre>
sudo ufw delete deny 80/tcp
</pre>

=== Services ===
You can also allow or deny by service name since ufw reads from /etc/services
To see get a list of services:
<pre>
less /etc/services
</pre>

==== Allow by Service Name ====
<pre>
sudo ufw allow <service name>
</pre>

'''example:''' to allow ssh by name
<pre>
sudo ufw allow ssh
</pre>

==== Deny by Service Name ====
<pre>
sudo ufw deny <service name>
</pre>

'''example:''' to deny ssh by name
<pre>
sudo ufw deny ssh
</pre>

=== Status ===
<nowiki>[[File:IconsPage/important.png]]</nowiki> Checking the status of ufw will tell you if ufw is enabled or disabled and also list the current ufw rules that are applied to your iptables.

To check the status of ufw:
<pre>
sudo ufw status

Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7
22:tcp                     ALLOW   192.168.0.0/24
22:udp                     ALLOW   192.168.0.0/24
</pre>

if ufw was not enabled the output would be:

<pre>
sudo ufw status
Status: inactive
</pre>

=== Logging ===
To enable logging use: <pre>
sudo ufw logging on
</pre>
To disable logging use: <pre>
sudo ufw logging off
</pre>

== Advanced Syntax ==
You can also use a fuller syntax, specifying the source and destination addresses and ports.
=== Allow Access ===
This section shows how to allow specific access.

==== Allow by Specific IP ====
<pre>
sudo ufw allow <ip address>
</pre>

'''example:'''To allow packets from 207.46.232.182:
<pre>
sudo ufw allow from 207.46.232.182
</pre>

==== Allow by Subnet ====

You may use a net mask :

<pre>
sudo ufw allow from 192.168.1.0/24
</pre>

==== Allow by specific port and IP address ====
<pre>
sudo ufw allow from <ip address> to <protocol> port <port number>
</pre>

'''example:''' allow ip address 192.168.0.4 access to port 22 for all protocols
<pre>
sudo ufw allow from 192.168.0.4 to any port 22
</pre>

==== Enable PING ====

__Note__: Security by obscurity may be of very little actual benefit with modern cracker scripts. '''By default, UFW allows ping requests'''. You may find you wish to leave (icmp) ping requests enabled to diagnose networking problems.

You need to edit '''/etc/ufw/before.rules''' and remove edit the following lines:

<pre>
-A ufw-before-input -p icmp --icmp-type destination-unreachable -j ACCEPT
-A ufw-before-input -p icmp --icmp-type source-quench -j ACCEPT
-A ufw-before-input -p icmp --icmp-type time-exceeded -j ACCEPT
-A ufw-before-input -p icmp --icmp-type parameter-problem -j ACCEPT
-A ufw-before-input -p icmp --icmp-type echo-request -j ACCEPT
</pre>

Change the "ACCEPT" to "DROP" or

<pre>
-A ufw-before-input -p icmp --icmp-type destination-unreachable -j DROP
-A ufw-before-input -p icmp --icmp-type source-quench -j DROP
-A ufw-before-input -p icmp --icmp-type time-exceeded -j DROP
-A ufw-before-input -p icmp --icmp-type parameter-problem -j DROP
-A ufw-before-input -p icmp --icmp-type echo-request -j DROP
</pre>

=== Deny Access ===
==== Deny by specific IP ====
<pre>
sudo ufw deny from <ip address>
</pre>

'''example:'''To block packets from 207.46.232.182:
<pre>
sudo ufw deny from 207.46.232.182
</pre>

==== Deny by specific port and IP address ====
<pre>
sudo ufw deny from <ip address> to <protocol> port <port number>
</pre>

'''example:''' deny ip address 192.168.0.1 access to port 22 for all protocols
<pre>
sudo ufw deny from 192.168.0.1 to any port 22
</pre>

==== Advanced Blocking Rules ====

Blocking IP addresses is not so straight forward if you have an existing set of rules as IPTABLES matches in order.

So if you started with default deny and added in port 80 for a public server :

<pre>
sudo ufw allow 80
</pre>

But then find IP address 111.222.3.44 is hacking your server :

<pre>
sudo ufw deny 111.222.3.44
</pre>

'''will do nothing (you allowed access with your first rule).'''

You need to edit '''/etc/ufw/before.rules''' and add a section "Block IP" after "Drop INVALID packets" : 

<pre>
-A ufw-before-input -s 111.222.3.44 -j DROP #Assuming no loging is desired of course)
-A ufw-before-input -m conntrack --ctstate INVALID -j DROP

-A ufw-before-input -s 111.222.3.44 -j DROP
</pre>

=== Advanced Example ===
'''Scenario:''' You want to block access to port 22 from 192.168.0.1 and 192.168.0.7 but allow all other 192.168.0.x IPs to have access to port 22

<pre>
sudo ufw deny from 192.168.0.1 to any port 22
sudo ufw deny from 192.168.0.7 to any port 22
sudo ufw allow from 192.168.0.0/24 to any port 22
</pre>

<nowiki>[[File:IconsPage/important.png]]</nowiki> This puts the specific rules first and the generic second. Once a rule is matched the others will not be evaluated (see manual below) so you must put the specific rules first. '''As rules change you may need to delete old rules to ensure that new rules are put in the proper order.'''

To check your rules orders you can check the status; for the scenario the output below is the desired output for the rules to work properly

<pre>
sudo ufw status
Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7
22:tcp                     ALLOW   192.168.0.0/24
22:udp                     ALLOW   192.168.0.0/24
</pre>

'''Scenario change:''' You want to block access to port 22 to 192.168.0.3 as well as 192.168.0.1 and 192.168.0.7.

<pre>
sudo ufw delete allow from 192.168.0.0/24 to any port 22
sudo ufw status
Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7

sudo ufw deny 192.168.0.3 to any port 22
sudo ufw allow 192.168.0.0/24 to any port 22
sudo ufw status

Firewall loaded

To                         Action  From
--                         ------  ----
22:tcp                     DENY    192.168.0.1
22:udp                     DENY    192.168.0.1
22:tcp                     DENY    192.168.0.7
22:udp                     DENY    192.168.0.7
22:tcp                     DENY    192.168.0.3
22:udp                     DENY    192.168.0.3
22:tcp                     ALLOW   192.168.0.0/24
22:udp                     ALLOW   192.168.0.0/24
</pre>

<nowiki>[[File:IconsPage/important.png]]</nowiki> If you simply add the deny rule the allow would have been above it and been applied instead of the deny

== Other Resources ==
* For instructions on using ufw first see the <nowiki>[[https://help.ubuntu.com/8.04/serverguide/C/firewall.html| official server guide]]</nowiki>.
* The most recent syntax and manual can be retrieved by getting the <nowiki>[[http://manpages.ubuntu.com/manpages/man8/ufw.8.html|man page]]</nowiki>. Otherwise open a terminal window and type:
<pre>
man ufw
</pre>
* <nowiki>[[Firewall]]</nowiki> - wiki homepage for firewall related documentation.
* <nowiki>[[Iptables]]</nowiki> - interface to the netfilter subsystem in the Linux kernel.
* <nowiki>[[Ubuntu:UbuntuFirewall]]</nowiki> - UFW Project wiki page.
* <nowiki>[[Gufw]]</nowiki> - Graphic User Interface for UFW.
----
CategoryNetworking CategorySecurity
