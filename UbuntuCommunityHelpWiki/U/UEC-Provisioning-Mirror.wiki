{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

UEC Provisioning greatly benefits from a local Ubuntu Mirror, as installations are performed over the network.  Over a gigabit local connection, this can take as little as 5 minutes per machine installation.

A full Ubuntu mirror of all supported packages and all supported architectures requires ~350GB.

Please see the <nowiki>[[https://wiki.ubuntu.com/Mirrors|Ubuntu Wiki]]</nowiki> for information about mirroring Ubuntu. For unofficial mirrors; '''please use a local mirror instead of the primary ones''' for the '''UBUARC_MIRROR''' and '''UBUREL_MIRROR''' variables.

=== Install Ubumirror ===

<pre>
sudo apt-get install ubumirror
</pre>

=== Configure Ubumirror ===

<pre>
sudo vi /etc/ubumirror.conf
</pre>

<pre>

EMAIL=root@localhost

HOSTNAME=$(hostname -f)

SPEED=0

UBUARC_DIR="/srv/mirror/ubuntu"

UBUCDI_DIR="/srv/mirror/ubuntu-cdimage"

UBUREL_DIR="/srv/mirror/ubuntu-releases"

UBUPOR_DIR="/srv/mirror/ubuntu-ports"

LOGDIR="/var/log/ubumirror/"

UBUARC_MIRROR=archive.ubuntu.com::ubuntu/
UBUCDI_MIRROR=cdimage.ubuntu.com::cdimage/
UBUREL_MIRROR=rsync.releases.ubuntu.com::releases/
UBUPOR_MIRROR=ports.ubuntu.com::ubuntu-ports/

UBUCDI_FLAVOURS="\
  daily daily-live \
  ubuntu-netbook/daily-live ubuntu-server/daily \
"

UBUARC_EXCLUDE="\
  --exclude binary-powerpc/ --exclude binary-sparc/ \
  --exclude daily-installer-powerpc/ --exclude daily-installer-sparc/ \
  --exclude installer-powerpc/ --exclude installer-sparc/ \
  --exclude *_powerpc.deb --exclude *_powerpc.udeb \
  --exclude *_sparc.deb --exclude *_sparc.udeb \
  --exclude Contents-powerpc.gz --exclude Contents-sparc.gz \
"
UBUCDI_EXCLUDE="\
  --exclude *-powerpc.* --exclude *-sparc.* \
  --exclude source/ \
"
UBUREL_EXCLUDE="\
  --exclude *-powerpc.* --exclude *-sparc.* \
"
UBUPOR_EXCLUDE="\
  --exclude binary-powerpc/ --exclude binary-sparc/ \
  --exclude daily-installer-powerpc/ --exclude daily-installer-sparc/ \
  --exclude installer-powerpc/ --exclude installer-sparc/ \
  --exclude *_powerpc.deb --exclude *_powerpc.udeb \
  --exclude *_sparc.deb --exclude *_sparc.udeb \
  --exclude Contents-powerpc.gz --exclude Contents-sparc.gz \
"
</pre>

=== Run Ubumirror ===

Check available space in /srv, ensure that you have ~350GB free.

<pre>
df -h /srv
</pre>

Then run the mirror commands.  On the first run, this may take many hours or several days (depending on your network connectivity).  Ideally, you would seed this mirror from someone nearby you who has an up-to-date mirror.

<pre>
sudo ubuarchive
sudo uburelease
</pre>

=== Configure to Run in Crontab ===

This will update your archive every 6 hours.  Configure according to your needs.

<pre>
echo "21 */6 * * * root ubumirror /usr/bin/ubuarchive >/dev/null" | sudo tee -a /etc/crontab
</pre>

=== Serve Your Mirror over HTTP ===

<pre>
sudo apt-get install apache2
sudo ln -s /srv/mirror/ubuntu /var/www
</pre>
