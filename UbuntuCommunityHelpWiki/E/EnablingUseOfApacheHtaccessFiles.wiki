{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

'''WARNING''': This page was written based on Ubuntu 10.04 (Lucid), although the same may apply to other releases. You are encouraged to also read:

1. The related <nowiki>[[https://help.ubuntu.com/|ubuntu server guide]]</nowiki> (Choose your distribution version > "Ubuntu Server Guide" > "Web servers").
2. The apache htaccess tutorial: http://httpd.apache.org/docs/2.0/howto/htaccess.html

By '''default''', Ubuntu's Apache will '''ignore''' the directives in your <code>.htaccess</code> files.

=== When (not) to use .htaccess files ===

According to <nowiki>[[http://httpd.apache.org/docs/2.0/howto/htaccess.html#when|Apache.org's Apache Tutorial]]</nowiki>,

''"In general, you should never use .htaccess files unless you don't have access to the main server configuration file. There is, for example, a prevailing misconception that user authentication should always be done in .htaccess files. This is simply not the case. You can put user authentication configurations in the main server configuration, and this is, in fact, the preferred way to do things."''

''".htaccess files should be used in a case where the content providers need to make configuration changes to the server on a per-directory basis, but do not have root access on the server system. In the event that the server administrator is not willing to make frequent configuration changes, it might be desirable to permit individual users to make these changes in .htaccess files for themselves."''

On Ed/X/Ubuntu 6.06 and Ubuntu Edgy Eft, the ''"main server configuration file"'' is <code> /etc/apache2/apache2.conf </code>.

=== OK, I know it is not recommended -- how do I do it anyway? ===

To make <code>.htaccess</code> files work as expected, you need to edit this file:
<pre>
/etc/apache2/sites-available/default
</pre>

Look for a section that looks like this:
<pre>
        <Directory /var/www/>
                Options Indexes FollowSymLinks MultiViews
                AllowOverride None
                Order allow,deny
                allow from all
######### Uncomment this directive is you want to see apache2's
######### default start page (in /apache2-default) when you go to /
######### RedirectMatch ^/$ /apache2-default/
        </Directory>
</pre>
You need to modify the line containing <code>AllowOverride None</code> to read <code>AllowOverride All</code>.  This tells Apache that it's okay to allow <code>.htaccess</code> files to over-ride previous directives.  You must ''reload'' Apache before this change will have an effect:
<pre>
sudo /etc/init.d/apache2 reload
</pre>

2009.12.08 note: in the LAMP download about a week ago with Ubuntu 9.10 (Karmic) the default configuration file was <code>/etc/apache2/sites-available/000-default</code> and it included AllowOverride None under <code><Directory /></code> in addition to <code><Directory /var/www/></code>. Also, directories in <code>/www/var/</code> containing <code>.htaccess</code> files defaulted to not giving the Apache server read access, resulting in the Apache error
    ''(13)Permission denied: /var/www/webapp/.htaccess pcfg_openfile: unable to check htaccess file, ensure it is readable''.
To fix, <code>$ sudo nautilus</code> then right click on the directory with the .htaccess file, select Properties, then select Permissions, and give the user group you log in as at least read permission.

See http://httpd.apache.org/docs/2.0/mod/core.html#allowoverride for more info on <code>AllowOverride</code>.

=== Password-Protect a Directory With .htaccess ===

'''Warning: On at least some versions of Ubuntu, <code>.htaccess</code> files will not work by default.  See EnablingUseOfApacheHtaccessFiles for help on enabling them.'''

Create a file called <code>.htaccess</code> in the directory you want to password-protect with the follwing content:
<pre>
AuthUserFile /your/path/.htpasswd
AuthName "Authorization Required"
AuthType Basic
require valid-user
</pre>
instead of <code>valid-user</code>, you can also add the users you want directly

If you want to password protect just a single file in a folder add the following lines to the <code>.htaccess</code> file:
<pre>
<Files "mypage.html">
  Require valid-user
</Files>
</pre>

Then create the file <code>/your/path/.htpasswd</code> which contains the users that are allowed to login and their passwords. We do that with the <code>htpasswd</code> command:
<pre>
htpasswd -c /path/to/your/.htpasswd user1
</pre>
The <code>-c</code> flag is used only when you are creating a new file. After the first time, you will omit the <code>-c</code>  flag, when you are adding new users to an already-existing password file. Otherwise you will overwrite the file!!

Nevertheless, you should store the file in as secure a location as possible, with whatever minimum permissions on the file so that the web server itself can read the file.

Finally we need to add the following lines to <code>/etc/apache2/apache2.conf</code>:
<pre>
<Directory /your/path>
AllowOverride All
</Directory>
</pre>

You have to adjust <code>/your/path/.htpasswd</code>

Restart your webserver:
<pre>
sudo /etc/init.d/apache2 restart
</pre>

==== Troubleshooting ====
If you can't access your stuff and the dialog keeps popping up, check that you entered the username and password correctly. If it still doesn't work, check the path to your <code>.htpasswd</code> and make sure the path specified in the <code>AuthUserFile directive</code> is correct. Also make sure that both the <code>.htpasswd</code> and <code>.htaccess</code> files are readable by the web server user
<code>chmod 644</code> should do the trick!

==== Example ====
Here is an example on how to prevent users from access the directory, password-protect a specific file and allow userse to view a specific file:
<pre>
AuthUserFile /your/path/.htpasswd
AuthName "Authorization Required"
AuthType Basic
Order Allow,Deny
<Files myfile1.html>
 Order Allow,Deny
 require valid-user
</Files>

<Files myfile2.html>
 Order Deny,Allow
</Files>
</pre>

=== Redirect requests using .htaccess and mod_rewrite ===

1. Make sure Apache .htaccess is enabled (by default it is enabled in Ubuntu)
2. Make sure the Apache module <code>mod_rewrite</code> is enabled. Execute:
<pre>
sudo a2enmod rewrite
</pre>
..and see if rewrite is listed here:
<pre>
sudo apache2ctl -M
</pre>

and then you can redirect requests using RewriteRules. Example:
<pre>
RewriteEngine On

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?_REQUEST=$1 [L]
</pre>
