{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==
This page describes how to integrate <nowiki>[[ClamAV]]</nowiki> (virus scanner) and <nowiki>[[Exim4]]</nowiki> (mail server).

== Required packages ==
You must have the following packages installed
** exim4-daemon-heavy
** clamav-daemon

== Configuring Exim to use ClamAV ==
If you are using a split configuration file, create the file <code>/etc/exim4/conf.d/main/50_local_clamav</code> with the following content:
<pre>
CHECK_DATA_LOCAL_ACL_FILE = /etc/exim4/conf.d/local-acl
av_scanner = clamd:/var/run/clamav/clamd.ctl
</pre>
Otherwise, insert those two lines into your exim4.conf.

  /!\ Note that the sample exim4.conf specifies an incorrect <code>av_scanner</code> path of <code>clamd:/tmp/clamd</code>

Next, create the file <code>/etc/exim4/conf.d/local-acl</code> with the following content:
<pre>
  deny
   malware = *
   message = This message was detected as possible malware ($malware_name).
</pre>

=== Restart exim4 ===
Reconfigure exim4 so that it picks up your changes. Normally, this is with the command 
<pre>
</pre>

Accepting all the defaults should be OK.

== Allow ClamAV to access the Exim mail spool ==
Add the <code>clamav</code> daemon user to the <code>Debian-exim</code> group, so that it can access the spool files.
<pre>
</pre>

=== Restart clamav-daemon ===
After changing the daemon's groups, you must restart the daemon so that it acquires the new groups
<pre>
</pre>

== Testing ==
Test your email server by mailing it a copy of <nowiki>[[http://www.eicar.org/anti_virus_test_file.htm|EICAR test virus (eicar.com)]]</nowiki>

The mail server should reject the message immediately.

== See Also ==
* <nowiki>[[ClamAV]]</nowiki> - The ClamAV anti-virus
* <nowiki>[[Exim4]]</nowiki> - The Exim mail server

----
categoryInternet
