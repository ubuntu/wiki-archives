{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

=== Introduction ===
Sane is the software that controls scanners under Linux. There are times that you need to build sane from source, such as when bugs are fixed or a new scanner support is added. This is a relatively advanced process for a new Linux user. Hopefully, this will be helpful.

=== The Procedure ===
Open a Terminal. You need some usb libraries, and compile and build software.
Some backends use avahi to discover network scanners so type:
<pre>
sudo apt-get install libusb-dev build-essential libsane-dev
sudo apt-get install libavahi-client-dev libavahi-glib-dev
</pre>
Install git-core
<pre>
sudo apt-get install git-core
</pre> 
Download the source code
<pre>
git clone git://git.debian.org/sane/sane-backends.git
</pre>
 
<pre>
cd sane-backends
</pre>
Discover where your existing sane is installed
<pre>
sudo find /usr/lib -name 'libsane-dll.so'
</pre>
The full path of libsane-dll.so is returned. For example "/usr/lib/i386-linux-gnu/sane/libsane-dll.so"
Remove "/sane/libsane-dll.so" from the end and,when configuring, set libdir to the remainder of the path
<pre>
./configure --prefix=/usr --libdir=/usr/lib/i386-linux-gnu --sysconfdir=/etc --localstatedir=/var  --enable-avahi
make
sudo make install
</pre>
make takes a long time to compile all backends. If you only need a small number of backends you can speed up compilation by specifying those backends.
<pre>
./configure --prefix=/usr --libdir=/usr/lib/i386-linux-gnu --sysconfdir=/etc --localstatedir=/var  --enable-avahi BACKENDS="kodakaio test"
make
sudo make install
</pre>
will compile only the kodakaio and test backends.

Plug in your scanner and type
<pre>
sane-find-scanner
</pre>
and your scanner should be listed. Now try
<pre>
scanimage -L
sudo scanimage -L
</pre> 
If your scanner is detected with both of these commands, you have a successful install. If it is detected with sudo but not as user, then you have a permissions problem. If it is not detected with either, see Troubleshooting below

=== Permissions ===
If you can scan as root, but not as user, you have a permissions issue. Current Ubuntu releases use udev to set permisions. Some previous releases used HAL. To edit udev:
<pre>
sudo gedit /lib/udev/rules.d/40-libsane.rules
</pre>
and add the following two lines(change the scanner name and usb product id and vendor id to match your scanner):
<pre>
ATTRS{idVendor}=="04a9", ATTRS{idProduct}=="1904", ENV{libsane_matched}="yes"
</pre>
Save the file, exit gedit and Scan Away.

=== Troubleshooting ===
If you follow the above instructions and cannot scan, there are several useful things you try.

First, check the file /etc/sane.d/<backend.conf>, where backend is the name of the backend that your scanner uses. Your scanner should be listed in this file, along with its usb id. If it is not listed, then add it, following the format that the other scanners use. In this example we are checking a scanner that uses the genesys backend.
<pre>
cat /etc/sane.d/genesys.conf
</pre>
A few of the older backends are deactivated by default. You can check for this by:
<pre>
cat /etc/sane.d/dll.conf
</pre>
and make sure that your backend is not commented with a '#'. If your backend is commented out, then delete the # with your favorite text editor.

Some additional commands that can be helpful are:
<pre>
lsusb
</pre>
Returns all usb devices
<pre>
sane-find-scanner
</pre>
Returns all attached scanners, supported or not
<pre>
scanimage -L
</pre>
Returns attached supported scanners
<pre>
sudo scanimage -L
</pre>
same as above, with root privileges. 
<pre>
scanimage -T
</pre>
Runs a test of the scanner
<pre>
scanimage -V
</pre>
returns version of sane-backends

=== Updating sane-backends After Initial "git clone" ===
If you have previously cloned the source code and want to download the latest code, use the following:
<pre>
cd ~/sane-backends
git pull
</pre>
Then proceed with compiling sane as described above.

=== Compiled Sane without Configure Flags ===
Another problem that occasionally comes up is that someone tries to build the latest version of sane as described above, but they forget to add the recommended flags after the ./configure command.
<pre>
--prefix=/usr --sysconfdir=/etc --localstatedir=/var
</pre> 

What happens is that Ubuntu ships with the sane libraries in /usr/lib/sane. 

If you build sane from source with  
<pre>
./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var
</pre>
the new sane libraries will be installed over the previous ones in /usr/lib/sane.

But if you build sane with just
<pre>
./configure
</pre>
the new sane libraries will be installed in /usr/local/lib/sane.

To make sure that the newest version of sane (in /usr/local/lib/sane) is used
<pre>
gksu gedit /etc/ld.so.conf
</pre>
To use the old version it should read
<pre>
include /etc/ld.so.conf.d/*.conf
include /usr/lib
</pre>

To use the new version, change it to 
<pre>
include /etc/ld.so.conf.d/*.conf
include /usr/local/lib
</pre>

Then run
<pre>
sudo ldconfig
</pre>
and you should be running the latest sane.
=== Additional References ===
* <nowiki>[[http://mp610.blogspot.com/2008_04_01_archive.html | Fresh Sane Install Blog]]</nowiki> - Excellent article describing how to update to the latest sane.
