{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


'''IMPORTANT NOTE

The guest session feature is available in Ubuntu 14.04 and 16.04, including those flavors which use the LightDM display manager.

In later versions of standard Ubuntu, the feature is not available, since LightDM has been replaced with GDM. As regards later versions of flavors which use LightDM, the guest session feature is available but disabled by default. As explained at <nowiki>[[https://askubuntu.com/questions/915415/guest-session-stopped-working-on-ubuntu-16-10-and-17-04|this Ask Ubuntu page]]</nowiki>, guest session can be enabled, but there is currently a security issue which you must consider before enabling it. <nowiki>[[https://launchpad.net/bugs/1742912|This bug report]]</nowiki> tracks possible progress for that issue.'''

----------

== Introduction ==
{| class="wikitable"
|-
| <tablestyle="float:right; font-size: 0.9em; width:40%; background:#F1F1ED; margin: 0 0 1em 1em;" style="padding:0.5em;"><<BR>>
|}

By default, when you enter a <nowiki>[[https://help.ubuntu.com/16.04/ubuntu-help/shell-guest-session.html|guest session]]</nowiki>, the desktop looks like it does when a regular user logs in for the first time. This tutorial shows how a system owner can customize the guest session feature to change the appearance and behavior.

== Hooks facilitate customization ==
This section is intended for advanced users. If you find it somewhat esoteric, just skip it and continue to the <nowiki>[[#Special_purpose_user|next section]]</nowiki>. ;-)

When you launch a guest session, a temporary user account, whose home directory is located in <code>/tmp</code>, is created behind the scenes. To customize the feature, we need to control the contents of that home directory, and the source code includes a couple of 'hooks' for the purpose:

* If the directory <code>/etc/guest-session/skel</code> exists and is not empty, its contents is copied to the home directory of the temporary user account. Otherwise the files in <code>/etc/skel</code> are copied.

* If the file <code>/etc/guest-session/prefs.sh</code> exists, it's sourced by <code>/usr/sbin/guest-account</code>. <code>/etc/guest-session/prefs.sh</code> is intended for commands that modify the contents of the home directory. In that file, <code>$USER</code> refers to "guest-XXXXXX" and <code>$HOME</code> to the home directory of the temporary account.

* If the file <code>/etc/guest-session/auto.sh</code> exists, it's sourced by the autostarted <code>/usr/lib/lightdm/guest-session-auto.sh</code> script. <code>/etc/guest-session/auto.sh</code> can be used to e.g. launch programs automatically at startup.

== Special purpose user ==
Using a special user account for setting the guest preferences is the most convenient way to customize the guest session feature. Please follow these steps:

1. <nowiki>[[https://help.ubuntu.com/stable/ubuntu-help/user-add.html|Add a new user account]]</nowiki> with the username '''guest-prefs'''.

1. Log in to '''guest-prefs''' and change things to what you want your guests encounter at startup.

1. <nowiki>[[UsingTheTerminal#Starting_a_terminal|Open a terminal window]]</nowiki> and create a symbolic link to the home directory of '''guest-prefs''':<pre>
sudo mkdir /etc/guest-session
sudo ln -s /home/guest-prefs /etc/guest-session/skel
</pre>

Now, when you launch a guest session, it will have the same preferences as you set for '''guest-prefs'''.

'''Notes:'''
* In this tutorial we use the name '''guest-prefs''', but you can give the special purpose user some other username.

* You may prefer to hide '''guest-prefs''' from the login screen and the system menu. Hopefully that will be easy to accomplish when https://launchpad.net/bugs/857651 has been fixed.

== Startup dialog ==
When you launch a guest session, a dialog window shows up that alerts you about the temporary nature of the session.

<nowiki>[[File:guest-session-startup-dialog.png]]</nowiki>

It's considered desirable that the window gets focused, so it's started with a 4 seconds delay. Whether those 4 seconds are sufficient is affected by for instance how powerful the computer is and which programs are automatically launched at startup.

=== Modify dialog delay time ===
To set 8 seconds delay time, create or open the file <code>/etc/guest-session/prefs.sh</code> and insert this line:

<pre>
echo "export DIALOG_SLEEP=8" >> $HOME/.profile
</pre>

=== Disable startup dialog ===
If you prefer that the dialog does not show up at all, create or open the file <code>/etc/guest-session/prefs.sh</code> and insert this line:

<pre>
touch $HOME/.skip-guest-warning-dialog
</pre>

== Save files on disk ==
For the case you want to offer your guests the possibility to store files persistently on disk (not permitted by default), you can create the folder <code>/var/guest-data</code>:

<pre>
sudo mkdir -m 0777 /var/guest-data
</pre>

That folder is mentioned in the startup dialog if it exists and is world writable.

== Add guest to additional user group ==
By default the guest user only belongs to a temporary user group with the same name as the user. To add the guest to the group <code>mygroup</code> (must be an existing group), create or open the file <code>/etc/guest-session/prefs.sh</code> and insert this line:

<pre>
adduser $USER mygroup
</pre>

== Language selection dialog ==
Normally the display language is fixated to either the default system language (as specified in the <code>/etc/default/locale</code> file) or the language the system owner specified using the customization methods described above. However, it's possible on a multilingual system to let the guest select the language when launching a guest session.

You can use a wrapper script to let the user choose display language via a Zenity dialog. Hence <nowiki>[[apt:zenity|zenity]]</nowiki> needs to be installed, and also the languages you include in the script, of course. The example script below includes English and Swedish.

1. Create <code>/etc/guest-session/choose-language-wrapper.sh</code>, give it this contents:<pre>

ONLYGUEST=true
for U in $(users); do
    if [ "${U%%-*}" != 'guest' ]; then
        ONLYGUEST=false
        break
    fi
done

if $ONLYGUEST && [ -x /usr/bin/zenity ]; then
    guestlang=$( zenity --list --title 'Select language' \
      --text 'Select language for the guest session' --radiolist \
      --column 'Pick' --column '' TRUE 'English' FALSE 'Swedish' )
    if [ "$guestlang" = 'English' ]; then
        echo 'export LANGUAGE=en_US' >> "$HOME/.profile"
        echo 'export LANG=en_US.UTF-8' >> "$HOME/.profile"
    elif [ "$guestlang" = 'Swedish' ]; then
        echo 'export LANGUAGE=sv' >> "$HOME/.profile"
        echo 'export LANG=sv_SE.UTF-8' >> "$HOME/.profile"
    fi
fi

exec /usr/lib/lightdm/lightdm-guest-session "$@"
</pre>and make it executable:<pre>
sudo chmod +x /etc/guest-session/choose-language-wrapper.sh
</pre>

1. Enable the wrapper script by creating the file <code>/etc/lightdm/lightdm.conf.d/50-choose-guest-language.conf</code> and give it this contents:<pre>
[Seat:*]
guest-wrapper=/etc/guest-session/choose-language-wrapper.sh
</pre>

After next reboot the zenity dialog should show up when launching a guest session from the greeter.

== See also ==
1. <nowiki>[[https://help.ubuntu.com/16.04/ubuntu-help/shell-guest-session.html|Launch a restricted guest session]]</nowiki> - Official guest session documentation.

1. <nowiki>[[CustomizeGuestSession-old]]</nowiki> - Deprecated predecessor of this tutorial.<<BR>>Even if the old tutorial is deprecated, the page and the tarballs contain code snippets that might serve as examples for the case you choose to set the guest preferences via <code>/etc/guest-session/prefs.sh</code> and/or <code>/etc/guest-session/auto.sh</code> instead of <nowiki>[[#Special_purpose_user|creating a special user account]]</nowiki> for the purpose.

----
CategorySystem
