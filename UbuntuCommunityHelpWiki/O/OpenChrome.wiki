{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


''Revised: 7 May 2010''

== Description ==
'''openChrome''' is a free and Open Source video driver for the VIA/S3G UniChrome, UniChrome Pro and Chrome9 graphics chipsets: CLE266, KM400/KN400/KM400A/P4M800, CN400/PM800/PN800/PM880, <code>K8M800</code>, CN700/VM800/P4M800Pro, CX700, <code>K8M890</code>, <code>P4M890</code>, P4M900/VN896/CN896, VX800, VX855, VX900.

For more information, please visit <nowiki>[[http://www.freedesktop.org/wiki/Openchrome/]]</nowiki>

=== Ubuntu 8.04 , Debian 5.0 and newer releases ===

Since Ubuntu 8.04 (Hardy Heron) and Debian 5.0 the <code>openchrome</code> driver is installed by default, provided by the <code>xserver-xorg-video-openchrome</code> package. If this driver works correctly for your needs, '''there is no need to compile the driver yourself'''.

The <code>openchrome</code> manual page indicates which options can be used to configure the driver by editing <code>/etc/X11/xorg.conf</code>.
The <code>xorg.conf</code> manual page explains the structure of this file.

<pre>
man xorg.conf
man openchrome
</pre>

== Manual Installation ==

These instructions will help you compile and install the openChrome driver in Ubuntu 6.06 (Dapper) and up. It should also work on Debian and other Debian-based distributions.

=== Before you start ===
* Compiling drivers is for experienced users. If you feel unsure, best is to stick to the drivers in the repositories.
* Make sure you have enabled the <nowiki>[[Repositories-Ubuntu#what|Universe and Multiverse repositories]]</nowiki>. See <nowiki>[[Repositories-Ubuntu|Managing Repositories in Ubuntu]]</nowiki> or <nowiki>[[Repositories-Kubuntu|Kubuntu]]</nowiki> for help with this.
* Use <code>sudo</code> to obtain <nowiki>[[RootSudo|administrative privileges]]</nowiki>, in order to edit, move or install system files.
* Commands for checking out source code, patching files, or compiling don't need <code>sudo</code>.
 

=== openChrome 2D driver compilation ===
1. '''Install needed dependencies'''

** Get necessary tools to compile source code:
<pre>
sudo apt-get install build-essential
sudo apt-get install autoconf automake1.9 libtool git xutils xutils-dev
  </pre>

** Get all the dependency packages needed to build the driver.

  Run:
  <pre>
sudo apt-get build-dep xserver-xorg-video-openchrome
  </pre>
  Recent openChrome versions may require additional packages:
  <pre>
sudo apt-get install pkg-config xserver-xorg-dev libxext-dev libxv-dev libxvmc-dev
  </pre>

1. '''Compile and install the 2D driver'''
** Get the openChrome source code from the subversion repository:
  <pre>
git clone git://anongit.freedesktop.org/openchrome/xf86-video-openchrome
  </pre>
  
** Change into the newly created directory:
  <pre>
cd xf86-video-openchrome
  </pre>

** Run <code>autogen.sh</code> with the prefix option so that the driver is installed to the correct directory. You may enable debug options to troubleshoot the driver in case it doesn't work:
  <pre>
./autogen.sh --prefix=/usr --enable-debug --enable-xv-debug
  </pre>

** Compile openChrome:
  <pre>
make
  </pre>

** Install openChrome:
  <pre>
sudo make install
  </pre>

1. '''Test the driver'''

 Restart your desktop manager by logging out and back in, or restarting your computer.

1. '''If it doesn't work'''

 If the X Server does not start any more, that is, you have a black screen. Login into safe mode by choosing option during boot. After run and login create/edit <code>xorg.conf</code> file located at <code>/etc/X11/xorg.conf</code>. Then you could use generic <code>vesa</code> driver in order to boot and find another solution for your problem.

 Log into textual console (Ctrl+Alt+F1), open <code>xorg.conf</code>
 <pre>
sudoedit /etc/X11/xorg.conf
 </pre>
 and set <code>Driver</code> to <code>"vesa"</code>:
 <pre>
Section "Device"
        Identifier      "Configured Video Device"
        Driver          "vesa"
EndSection
 </pre>

=== 3D doesn't always work ===

The <code>openchrome</code> driver (and previously the <code>via</code> driver) only supports 2D acceleration, and most of the time it will work.

3D acceleration (Direct Rendering Infrastructure or DRI) is provided by a companion driver by the Mesa project and it is normally already installed on your system.

To avoid immediate crash of the X Server, from openChrome revision 749, DRI was disabled by default for Chrome9, thus making 3D applications run in Software Rasterizer mode. This solution helps to prevent system freezing, specially with OpenGL applications, games, screensavers, and <nowiki>[[Wine]]</nowiki> (see Launchpad bug <nowiki>[[https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-openchrome/+bug/274340|#274340]]</nowiki>). With this solution you won't have 3D acceleration (3D applications will be slow), but your system won't freeze.

Keep in mind that:
* There is no good 3D driver because VIA has not released enough chipset specifications to free software developers.
* For desktop PC users a definitive solution to the lack of 3D features is to use another graphics card, either PCI, AGP, PCI-Express, etc. Laptop users may have to avoid 3D applications altogether.

== VIA proprietary graphics driver for Chrome9 ==

''Note from the editor:'' Help clean up this section. It is not evident what exactly is being installed, or why the instructions ask to use some files for Ubuntu 8.10, and other files for Ubuntu 9.04.

There is a VIA proprietary driver for Chrome9 chipsets that should support most of the features missing with the openChrome driver, like video decoding acceleration and 3D hardware acceleration.

These installing instructions are for Ubuntu 9.04 and Chrome9 graphic series chipsets: CX700M/VX700/CN700/CN896/VN896/VX800/VX855.

1. Install some packages in order to be able to compile a kernel module
<pre>
sudo apt-get install build-essential autoconf automake1.9 libtool linux-headers-generic xorg-dev
</pre>

The driver can be found at the following website:

http://linux.via.com.tw/support/downloadFiles.action

Choose "OS: Ubuntu 8.10" and "Platform: VX800" and download the "Unified GFX driver Ver 85a-44597 for Ubuntu 8.10".

Install the <code>libGL.so.1.2.via_chrome9</code> library:
<pre>
tar -xzvf 5.74.33.85a-44597.tar.gz
cd 5.74.33.85a-44597
sudo ./vinstall
</pre>

The previous step installs the libGL library for Ubuntu 8.10, and not Ubuntu 9.04; this seems to work to some extent. The other option would be to not install it, but then GL would not be available.

Choose "OS: Ubuntu 9.04" and "Platform: VX800" and download the "Unified 2D/DRM driver source version 86a-50283".

Install the <code>via_chrome9</code> kernel module and the <code>via</code> xorg driver:
<pre>
tar -xjvf /root/via-xserver-86a-50283_src.tgz
cd via-xserver-86a-50283_src/DRM/H5DRM_Independent_2.6.27_28
make
sudo make install
sudo depmod -a
cd ../../XServer
chmod a+x autogen.sh
./autogen.sh
make
sudo make install
cd Misc
chmod a+x vinstall_ubuntu
sudo ./vinstall_ubuntu
</pre>

At this point, edit <code>/etc/X11/xorg.conf</code> to include the <code>"via"</code> driver in the <code>"Device"</code> section:
<pre>
Section "ServerLayout"
        Identifier     "X.org Configured"
        Option         "RandR"  "false"
EndSection

Section "Device"
        Identifier      "Configured Video Device"
        Driver          "via"
EndSection
</pre>

Mixing the latest 2D VIA open source driver (v86a) with the previous GFX driver (v85a) will crash your system when starting an OpenGL program that uses textures. So refrain from doing so until VIA comes with an updated version of the GFX driver.

=== Beta Drivers for Ubuntu 10.04 ===
'''Supported Chipsets'''

* Target system must contain one of the following VIA Chipsets:

   VIA VX800/VX855/VX900 Chipset

   '''Warning: This is a BETA driver!'''

 <nowiki>[[http://www.viaarena.com/Driver/5.75.32.87a-u1004-55689.tar.gz|Beta Unified GFX driver Ver 87a-55689 for Ubuntu 10.04(04Aug10) (2.1M)]]</nowiki>

'''Installation instructions'''

Since i had no 3D support with the current kernel, following instructions will install a newer kernel as the source directory in the driver package suggests ("VIA_Chrome9_2.6.33"). 

You may try installing the driver with the current kernel first.

* New kernel 2.6.33
** Download and install
   <nowiki>[[http://kernel.ubuntu.com/~kernel-ppa/mainline/v2.6.33.5-lucid/linux-headers-2.6.33-02063305_2.6.33-02063305_all.deb|linux-headers-2.6.33-02063305_2.6.33-02063305_all.deb]]</nowiki>
** Download and install the appropriate kernel headers for your architecture
   '''i386''' <nowiki>[[http://kernel.ubuntu.com/~kernel-ppa/mainline/v2.6.33.5-lucid/linux-headers-2.6.33-02063305-generic_2.6.33-02063305_i386.deb|linux-headers-2.6.33-02063305-generic_2.6.33-02063305_i386.deb]]</nowiki>

   '''amd64''' <nowiki>[[http://kernel.ubuntu.com/~kernel-ppa/mainline/v2.6.33.5-lucid/linux-headers-2.6.33-02063305-generic_2.6.33-02063305_amd64.deb|linux-headers-2.6.33-02063305-generic_2.6.33-02063305_amd64.deb]]</nowiki>
** Download and install the appropriate kernel image for your architecture
   '''i386''' <nowiki>[[http://kernel.ubuntu.com/~kernel-ppa/mainline/v2.6.33.5-lucid/linux-image-2.6.33-02063305-generic_2.6.33-02063305_i386.deb|linux-image-2.6.33-02063305-generic_2.6.33-02063305_i386.deb]]</nowiki>

   '''amd64''' <nowiki>[[http://kernel.ubuntu.com/~kernel-ppa/mainline/v2.6.33.5-lucid/linux-image-2.6.33-02063305-generic_2.6.33-02063305_amd64.deb|linux-image-2.6.33-02063305-generic_2.6.33-02063305_amd64.deb]]</nowiki>

** Update grub: sudo update-grub
** Reboot and select the new kernel
 
* Install Via Chrome Driver
** We need a few more packages since we are going to compile the driver from source:

  <pre>
  sudo apt-get install build-essential autoconf automake1.9 libtool xorg-dev
  </pre>
  '''only with current kernel 2.6.32''' :
  sudo apt-get install linux-headers-generic
    
** Download driver package
  <nowiki>[[http://www.viaarena.com/Driver/5.75.32.87a-u1004-55689.tar.gz|Beta Unified GFX driver Ver 87a-55689 for Ubuntu 10.04(04Aug10) (2.1M)]]</nowiki>
** Unpack and install the driver package
  <pre>
  tar -xzvf 5.75.32.87a-u1004-55689.tar.gz
  cd 5.75.32.87a-u1004-55689
  sudo ./vinstall
  </pre>
** Compile and install DRM driver
  <pre>
## we are still in the directory "5.75.32.87a-u1004-55689"
  cd VIA_Chrome9_2.6.33
  make
  sudo make install
  sudo depmod -a
  sudo modprobe via_chrome9
  lsmod | grep via # now there should be a driver via_chrome9
  </pre>
** edit the device section in /etc/X11/xorg.conf
  <pre>
  Section "Device"
        Identifier      "Configured Video Device"
        Driver          "via"
  EndSection
  </pre>
** restart your display manager
  
== Problems and solutions ==

=== General ===

* '''After compiling and upgrading to the latest openChrome revision, a bug appeared. What should I do?'''
 
 First find in which revision the bug was introduced. You should get intermediate revisions of the openChrome driver between the last working revision, and the current one. Then, you should compile and install some revisions to determine in which revision the bug appeared.

 For example, to get revision 713, check out from the subversion tree:
 <pre>
svn checkout http://svn.openchrome.org/svn/trunk openchrome
 </pre>
 Then, enter the created directory and type:
 <pre>
svn update -r713
 </pre>

 Then, compile, install, and test this revision as described above. If you can confirm that a bug was introduced in this revision, submit a bug report at:
  http://www.openchrome.org/trac/newticket

 For the developers' convenience, attach the X Server log <code>/var/log/Xorg.0.log</code>, and the X Server configuration file <code>/etc/X11/xorg.conf</code>.

* '''I found a bug in openChrome. How do I enable debug mode?'''

 After obtaining the source code, run <code>autogen.sh</code> with debug options:
 <pre>
./autogen.sh --prefix=/usr  --enable-debug --enable-xv-debug
 </pre>
 Then you may compile, install, and test the driver as was described above.

* '''When running <code>autogen.sh</code> for the openchrome 2D driver, I get errors like:'''
 <pre>
configure.ac: 30: required file `./[config.h].in' not found
unichrome/Makefile.am:33: via_drv_la_SOURCES defined both conditionally and unconditionally
 </pre>

 This is due to having multiple versions of the <code>automake</code> tool installed, with the wrong version as the default. Make sure you use <code>automake-1.9</code>:
 <pre>
sudo apt-get install automake1.9
 </pre>

 If you have different versions installed, you can choose the default one with:
 <pre>
sudo update-alternatives --config automake
 </pre>

* '''How do I apply a patch to the openChrome driver'''

 Go into openChrome source code directory and type:
 <pre>
patch -p0 < patch-file-name-here
 </pre>

* '''I installed a kernel update, now 3D does not work any more.'''

 If you manually compiled and installed the VIA kernel module, you will have to recompile it with the new kernel headers, as described above.

=== Disabling 3D ===

* '''My system sometimes freezes with OpenGL applications, games, screensavers, or <nowiki>[[Wine]]</nowiki>. How do I disable DRI?'''

 Edit <code>/etc/X11/xorg.conf</code> and disable DRI in the <code>"Module"</code> section.

 In Ubuntu 8.04 (Hardy) and newer, the X Server configures itself and the <code>xorg.conf</code> file no longer lists all the sections described in the manual page. In this case you can add the <code>"Module"</code> section to the beginning of the file, and your options will override the X Server's defaults.
 
 Add:
 <pre>
Section "Module"
        Disable    "dri"
EndSection
 </pre>

 Without DRI, 3D effects will be software-rendered, which will be slow. This is a sensible solution for those that don't care about desktop effects or games.

=== Ubuntu 8.10 ===

* '''My system sometimes freezes after loading the Gnome Desktop Manager.'''

 Try adding the <code>"XaaNoImageWriteRect"</code> option to the <code>"Device"</code> section of <code>/etc/X11/xorg.conf</code>:
 <pre>
Section "Device"
        Driver    "openchrome"
        Option    "XaaNoImageWriteRect"
EndSection
 </pre>

* '''My login prompt is not centered on the screen.'''

 In the <code>"Screen"</code> section of <code>/etc/X11/xorg.conf</code>, try adding a <code>"Display"</code> subsection to include the <code>Virtual</code> resolution matching your screen size:
 <pre>
Section "Screen"
        Identifier      "Default Screen"
        Monitor         "Configured Monitor"
        Device          "Configured Video Device"
        SubSection "Display"
                Virtual    1280    1024
        EndSubSection
EndSection
 </pre>
 

* '''My mouse cursor sometimes disappears or is invisible.'''

 This is known to happen on VIA's K8M800, VN800 and VM800 chipsets, e.g. Axioo Neon TVR 856C / TVR 016C laptops. As a solution, try using a software-rendered cursor. For this, add the <code>"SWCursor"</code> option to the <code>"Device"</code> section of <code>/etc/X11/xorg.conf</code>:
 <pre>
Section "Device"
        Driver    "openchrome"
        Option    "SWCursor"    "true"
EndSection
 </pre>

* '''I have redrawing errors on the desktop and in various applications. Lines, icons, and sliders disappear.'''

 The redrawing issues can be worked around by trying <code>"True"</code> or <code>"False"</code> as values for the <code>"EnableAGPDMA"</code> option of the <code>"Device"</code> section of <code>/etc/X11/xorg.conf</code>:
 <pre>
Section "Device"
        Driver    "openchrome"
        Option    "EnableAGPDMA"    "True"
EndSection
 </pre>

=== Ubuntu 10.04 LTS ===

* '''My Monitor does not display anything with the PM800 chip'''

 Revision 818 of openChrome introduced new mode switching code for the PM800 chip, which may cause problems on some setups. You can try to use the <code>"legacy"</code> mode-switching method in the <code>"Device"</code> section of <code>/etc/xorg.conf</code>:
 <pre>
Section "Device"
        Driver    "openchrome"
        Option    "ModeSwitchMethod" "legacy"
EndSection
 </pre>

* '''VIA 2D/DRM driver does not compile'''

 Currently ''(2010-09-21)'' there are only beta drivers for Ubuntu 10.04 at VIA
 site. The most recent stable integrated graphics drivers correspond to
 Ubuntu 9.04:

** <nowiki>[[http://www.viaarena.com/Driver/via-xserver-86a-50283_src.tgz|unified 2D/DRM driver source]]</nowiki> (dated 2009-08-27)
** <nowiki>[[http://www.viaarena.com/Driver/5.74.33.86a-u904-50937.tgz|unified GFX Driver]]</nowiki> (dated 2009-10-26)

 Use <nowiki>[[attachment:DRM-H5DRM_Independent_2.6.27_28.patch|this patch]]</nowiki>
 to make `H5DRM_Independent_2.6.27_28' directory (2D/DRM driver source
 archive) buildable against vanilla 2.6.32-23 kernel.

* '''New VIA DRM Beta driver for Ubuntu 10.04: 3D does not work'''
** <nowiki>[[http://www.viaarena.com/Driver/5.75.32.87a-u1004-55689.tar.gz|unified GFX Driver]]</nowiki> (dated 2010-08-04)
 Try compiling the DRM Driver with the new Ubuntu kernel 2.6.33 (as the source directory suggests "VIA_Chrome9_2.6.33"), its kernel headers  and the following build packages installed: "sudo apt-get install build-essential autoconf automake1.9 libtool xorg-dev".
 
