{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


* '''Launchpad Entry''': https://launchpad.net/distros/ubuntu/+spec/ubuntu-express-base-system
* '''Created''':  by Fabianx
* '''Contributors''': Fabianx, ColinWatson, LaMontJones, StephanHermann, AndrewMitchell
* '''Packages affected''': ubuntu-express, apt-setup, keymapper, cdebconf, kbd-chooser

=== Summary ===

The UbuntuExpress installer needs to configure the base system, to create a user and set a password. The Ubuntu installer already contains code to configure the base system, which we can reuse under the <nowiki>[[OEMInstaller|oem-config]]</nowiki> framework.

=== Rationale ===

The base system configuration component(s) of UbuntuExpress needs to perform the following tasks (in cooperation with user interface code for each of GNOME and KDE):

* select language
* select country
* select timezone
* select keymap
* select username/password
* select hostname
* configure apt

There has been some debate about whether hostname selection ought to be present; we include it partly because of its impact on zeroconf.

APT configuration is an awkward case, because sources.list can be customised by somebody modifying the live CD as well as by the end user, and we want to preserve both customisations. Nevertheless, if neither customisation is present, or if requested by somebody customising the live CD, we should regenerate `sources.list` (replacing that in the live filesystem) to make sure that it is using `$CC.archive.ubuntu.com` mirrors. This must be done in UbuntuExpress rather than in casper, because casper does not know what country is going to be selected later.

=== Use cases ===

* A user wants to install the system in his own language.
* A user expects desktop functions (such as the clock and calendar) to be aware of her country and timezone, and wants to inform the system of these just once at installation time.
* A user wants to be able to type the characters engraved on his keyboard as expected when the system is installed.
* A user wants her own account created at installation time so that she can log in after installation. She may later create accounts for her husband and son.
* A user wants to be able to download updates from the local mirror of Ubuntu packages, rather than having to wait and/or pay for downloads from further away.

=== Scope ===

This specification considers the base system configuration components of UbuntuExpress (that is, everything after <nowiki>[[UbuntuExpress/CopyFileSystem|copying the live filesystem]]</nowiki> not covered by other specifications), and the associated user interface issues.

=== Design and Implementation ===

In the <nowiki>[[UbuntuExpress/GnomeUserInterface|GNOME user interface]]</nowiki>, we will borrow a city map widget from Evolution to choose a city for the timezone. This implies the country, and gives us a good guess for the language, in conjunction with the bootloader language. (KubuntuExpress will borrow from KWorldMap.)

For keymap configuration, we will factor out the "select keymap based on pressing keys" widget from our existing installer (it is already quite cleanly separated), build any necessary `.deb`s, and add appropriate user interface code to it. We will select the keymap default based on that configured in the live CD. Instead of selecting the console keymap and inferring an X keymap from it, since we're already in X we will modify `keymapper` to be able to select an X keymap (which the user will be able to test) and infer a console keymap from that, inverting the existing mapping.

The Guadalinex implementation of UbuntuExpress already has username, password, and hostname questions, which just need some polish (and replacement of the backend to remove duplicated and incorrect validation code, instead just using the validation in `passwd.config`).

Finally, `apt-setup.deb` will be created (in order that we can use existing code from the apt-setup udebs) and UbuntuExpress will run it under `debconffilter` to generate an appropriate `/etc/apt/sources.list` file, allocating some progress bar space for the mirror verification steps. `casper` will record the original `sources.list` file from when the live filesystem is started up, in order to allow UbuntuExpress to skip this step if the user had already modified `sources.list`. The implementor should provide a mechanism for customisers to indicate that they do not want this to happen, in case a fixed `sources.list` is desired.

=== Implementation status ===

* 2006-01-04 ColinWatson: TollefFogHeen has factored out the keymapper widget from cdebconf. I have username/password configuration working by calling code from user-setup.
* 2006-02-23 ColinWatson: Language and timezone configuration done.
* 2006-04-11 ColinWatson: apt-setup work done, completing this specification. Customisation support isn't really ideal yet, but it's at least possible to work around that; see https://launchpad.net/distros/ubuntu/+source/espresso/+bug/39156 for details.
