{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


~-<nowiki>[[UbuntuDevelopment|Ubuntu Development]]</nowiki> > <nowiki>[[UbuntuDevelopment-Internationalisation|Internationalization Guide]]</nowiki> > Packaging -~

==== Language Packs ====

===== General =====
Packages in `main` and `restricted` don't contain <nowiki>[[..-Glossary#MessageCatalog|translations (*.mo) files]]</nowiki> themselves, they are stripped during the build on the Launchpad buildds and put into `language-pack-*` packages instead. This is done in an attempt to bundle the translations you're interested in and cut down the occupied space.

{| class="wikitable"
|-
| <tablestyle="width:50%;" style="width: 40px; background-color: #565248;text-align: center;"><nowiki>[[File:Translations/info.png]]</nowiki>
| <style=" text-align: left;" >Once a package is promoted to `main`, it only needs to be rebuilt the first time after promotion so that <nowiki>[[https://launchpad.net/ubuntu/+source/pkgbinarymangler|pkgbinarymangler]]</nowiki> can strip the translations. After this, import to Launchpad Translations and export in language packs "will just happen"
|}

===== Translation templates =====
For `pkgstriptranslations` (in the `pkgbinarymangler` package) to do the job right and translations to be imported into Launchpad, please make sure that your package in `main` or `restricted` generates a <nowiki>[[..-Glossary#TranslationTemplate|POT translation template]]</nowiki> during the build. It does not necessarily need to be shipped in the source or in the binary package. Generating it during the build is good enough.

{| class="wikitable"
|-
| <tablestyle="width:100%;" style="width: 40px; background-color: #565248;text-align: center;"><nowiki>[[File:Translations/warning.png]]</nowiki>
| <style=" text-align: left;" >If your package does not generate a POT template on build, its translations will remain as ''Blocked'' in the <nowiki>[[https://translations.launchpad.net/+imports|Launchpad Translations import queue]]</nowiki> and will not be imported
|}

The most common approaches are running either of the following in `debian/rules`:

* For packages using CDBS and automake:
** You just need to include `/usr/share/cdbs/1/rules/langpack.mk` in `debian/rules`
** If the package is a GNOME one, and you are using the `gnome.mk` CDBS class already, you should be good to go, since it already includes `langpack.mk`
** KDE packages: TODO
** If for some reason the POT template cannot be generated during the build, see the sections below.

* Other packages, using `intltool` usually require:
** A call to `intltool-update -p` in `debian/rules`, or 
** a call to an already existing Makefile target to build the POT (this does exist quite often in fact).

* Packages which don't use `intltool`: 
** Need to get fixed individually
** Usually by adding a call to `xgettext` and `po/POTFILES.in`, or 
** Finding an already existing Makefile target. e.g. Use `$(MAKE) -C po update-po` instead of `(cd po; make update-po; cd ..)`. Example in the <code>debian/rules</code> file from <code>upower</code>:
<pre>
common-post-build-arch::
	make -C po upower.pot
</pre>

* Packages which use `python-distutils-extra`:
** Template creation should happen automagically :)
** TODO: explanation of the command and auto modules

==== Other translation files ====
===== Desktop Entries =====

Translations of <nowiki>[[http://www.freedesktop.org/wiki/Specifications/desktop-entry-spec|desktop entries]]</nowiki> (.desktop files) are also stripped out and included in language packs.

Contrary to what other distros do (except currently OpenSUSE), the translations are not expected to be in the .desktop files themselves (static translations), but rather in the same .mo file of the application, from which they are then loaded at runtime. We do this in order to be able to translate them in Launchpad and to ship them in language packs, so that they can be edited and updated by Ubuntu translators.

The runtime loading is done by patches to <nowiki>[[https://launchpad.net/glib/+bug/3935|patch glib]]</nowiki> and <nowiki>[[http://patches.ubuntu.com/k/kde4libs/extracted/kubuntu_56_langpacks_desktop_files.diff|kdelibs]]</nowiki>, which recognises the the '''X-Ubuntu-Gettext-Domain''' <nowiki>[[http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s08.html|additional key]]</nowiki> we add to all Ubuntu .desktop files and adds gettext support when loading them. Note that if the .desktop file already contains translations, these static translations will be preferred.

Adding the X-Ubuntu-Gettext-Domain= key is done during build time in the packaging either automatically with the package build system or (increasingly rarely) with patches.

{| class="wikitable"
|-
| '''Packaging Method'''
| '''Method for adding key'''
|-
| KDE CDBS
| kde.mk includes /usr/lib/kubuntu-desktop-i18n/kubuntu.mk which adds the key using the package name (or an environment variable specified in debian/rule)
|-
| KDE old CDBS
| Older packages may will use /usr/share/cdbs/1/class/kde4.mk, which add the key, this is deprecated in favour of /usr/share/pkg-kde-tools/makefiles/1/cdbs/kde.mk
|-
| KDE Debhelper 7
| /usr/share/pkg-kde-tools/makefiles/1/debhelper/kde.mk includes /usr/lib/kubuntu-desktop-i18n/debhelper/kubuntu.mk which adds the key based on the package name (or an environment variable)
|-
| GNOME CDBS
| <nowiki>[[http://packages.ubuntu.com/search?searchon=contents&keywords=gnome.mk&mode=exactfilename&suite=karmic&arch=any|gnome.mk]]</nowiki> includes <nowiki>[[http://packages.ubuntu.com/search?searchon=contents&keywords=langpack.mk&mode=exactfilename&suite=karmic&arch=any|langpack.mk]]</nowiki>, the catalogue name comes from po/Makefile
|-
| GNOME Debhelper 7
| TODO
|-
| GNOME Old
| The .desktop files are patched directly <nowiki>[[http://patches.ubuntu.com/t/transmission/extracted/20_add_X-Ubuntu-Gettext-Domain.diff|e.g. transmission]]</nowiki>
|}

For KDE the translations themselves are downloaded as part of the packaging process of the upstream kde-l10n-xx language packs.

The patch to glib is being <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=569829|submitted upstream]]</nowiki> (using the key X-GNOME-Gettext-Domain) but has not yet been accepted. The Ubuntu glib version supports both keys, it first checks for `X-GNOME-` and then `X-Ubuntu-`.

In summary, for packages in `main` we strip the translations out of the .desktop files, and glib/kdelibs carry a distro patch to load translations from the .mo file. They use the `X-Ubuntu-Gettext-Domain` key to figure out where to get the translation from.

Additional information:

* <nowiki>[[LangpacksDesktopfiles|Original specification]]</nowiki>
* <nowiki>[[LangpacksDesktopfilesKDE|Original specification for KDE]]</nowiki>
* <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=568845|Upstream glib bug]]</nowiki>

===== Schema files =====

TODO

Additional information:

* <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=569829|Upstream gconf bug]]</nowiki>

===== Policy files =====

<pre>
$ for i in `ls /usr/share/polkit-1/actions/`; do dpkg -S $i; done
</pre>

===== Interactive upgrade hooks =====

After certain upgrades (most notably upgrades between Ubuntu releases), there are follow-up actions which should be taken by the user. These are not logically part of the upgrade, but should be dealt with at some point after the upgrade is complete. 

They take the form of helper scripts that can be called by the package's `postinst` script, and can be internationalized through language packs.

Here's an example showing how these can be internationalized:

==== Verifying translation uploads ====

This information is intended to help package maintainers to optimize their packages, so that translation related files get automatically imported into Launchpad.

===== Testing the package locally =====

To test if your package conforms to the requirements of the import script in Launchpad, please do the following:
# <nowiki>[[apt:--pkgbinarymangler|Install the pkgbinarymangler package]]</nowiki>
# In `/etc/pkgbinarymangler/striptranslations.conf` set `enable:` to `true`
# Optionally, install any build dependencies: `sudo apt-get build-dep $PKGNAME`
# Build the package with `debuild -uc -us -b`
# You will find a `<pkgname>-translations.tar.gz` tarball along with the .deb package(s)
# Untar that tarball into a temporary directory
# Compare if the directory structure and the .pot and .po files conform to the requirements listed below

===== Guidelines =====

If the application uses gettext, like most GTK and GNU applications do:

** '''Template name and domain''': the filename of the <nowiki>[[..-Glossary#TranslationTemplate|template (.pot file)]]</nowiki> should be the same as what the expected <nowiki>[[UbuntuDevelopment-Internationalisation-Glossary#TranslationDomain|translation domain]]</nowiki> is.
** '''Translation filenames''': the actual <nowiki>[[UbuntuDevelopment-Internationalisation-Glossary#TranslationFile|translations (.po files)]]</nowiki> must have a filename of the format `$LANGUAGECODE.po` or `$LOCALECODE.po` (e.g. `de.po`, `pt_BR.po`, `zh_TW.po`)
** '''Template and translations location''': all translation-related files (the .pot template and its corresponding .po templates) must end up in the same (sub-)directory if possible.
** '''Multiple domains:''' if the application has multiple translation domains (i.e. multiple .pot files), each .pot file and their corresponding .po files should end up in a separate subdirectory (e.g. po/nautilus/nautilus.pot and po/libnautilus/libnautilus.pot)
** '''Recommended translations layout''': it is recommended that templates and translations for the main application or library are located in the `po/` directory.
** '''Recommended help layout''': it is recommended that templates and translations for help files are located in the `help/po/` directory. Note: they will be ignored by Launchpad, since we currently have no infrastructure to deal with them properly.
** '''Recommended documentation layout''': it is recommended that templates and translations for documentation files are located in the `doc/po/` directory. Note: they will also be ignored by Launchpad for the same reason as the help translations.
** '''Obsolete translations''': if there are .po files present in the package but no associated .pot template, please remove them, since they cannot be used without a .pot template. There might be a bug in the package or in the source code whereby the .pot file doesn't get generated, so make sure to double-check that as well.
** '''Valid POT template''': please check if the .pot file has any meaningful content. Empty .pot files should be removed and the package build rules be fixed.
** '''Templates generated by patches''': if your package contains patches and those patches result into extra templates, like `patches.pot`, please merge those changes into the main template, as we have no use for patch .pot files. Such .pot files should not exist in the final tarball.
** '''Multiple templates merged into one''': if the package generates multiple .pot files and later merges them into one, only the final .pot file should be present in the final tarball.
** '''Architecture-dependent templates''': if the package creates the same .pot file in architecture-dependent subdirectories, please consider to merge them, as we can only deal with one single .pot per translation domain.
** '''Test templates''': test routines and test files should not generate any .pot template or ship any .po file. If such files are present, please remove them.
** '''Use UTF-8 encoding''': if you have multiple .po files for a language, each in a different encoding, please consider '''renaming''' the ones encoded in UTF-8 to be the main .po file for that language and '''discard''' the other ones. They might be interesting for Windows users, but not for Linux ones, since translations get converted with `iconv` into the encoding the user is runnning anyway. And nowadays UTF-8 is the default encoding on Linux. E.g.: if you have `zh_TW.po` (Big5 encoding), `zh_TW.UTF-8.po` and `zh_TW.cp960.po`, please remove `zh_TW.po` and `zh_TW.cp960.po` and rename `zh_TW.UTF-8.po` to `zh_TW.po`.
** '''Obsolete `no` locale''': the `no` locale is obsolete. If you find no.po files, please look into it and find out if it's Norwegian Bokmål or Nynorsk. Usually it's Bokmål. Please rename the file to the proper language code: `nb.po` for Bokmål, `nn.po` for Nynorsk. If `nb.po` and `nn.po` are already present, remove `no.po`.
** '''English US translations''': If you have an `en_US.po` file, please investigate if it really contains translations (i.e. if the source code uses en_GB or another language) and if not, you can safely discard it.

==== Documentation ====

TODO:

* Converting xml to PO with `xml2po`
* Launchpad import

==== Packages not using the Gettext format ====

===== Mozilla =====

===== OpenOffice.org =====

----
CategoryUbuntuDevelopment
CategoryTranslations
