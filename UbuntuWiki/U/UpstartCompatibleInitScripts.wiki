{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

Beginning in saucy, the upstart job support in debhelper and sysvinit has been synchronized with current Debian policy.  This enables patches for upstart jobs to be safely forwarded to Debian for the first time, following a few simple steps.

These instructions all assume the package is using debhelper (and in particular, dh_installinit) for maintainer script handling of jobs/init scripts.  If a package is not using dh_installinit, or if it is calling dh_installinit with the --noscripts option, particular care must be taken to properly handle upgrades from packages using the older style of upstart job support in Ubuntu.  This page does not attempt to document the required steps if you are not using dh_installinit; if you have questions, consult the dh_installinit source, or just convert the package to use debhelper.

=== Step-by-step ===
* Make sure that the upstart jobs and init scripts in the package have matching names.  If the names do not match, either the init script should be split (cf. <code>/etc/init.d/samba</code>-><code>/etc/init.d{s,n}mbd</code> in the <code>samba</code> package), or dummy upstart jobs should be created (cf. <code>/etc/init/mountall.sh.conf</code> in the <code>mountall</code> package) so that the names line up.  Without this, insserv will not correctly detect that the upstart job has started and dependency-based booting will fail.
* Edit the init scripts to call <code>init_is_upstart</code> and exit without taking any action if running on an upstart system.  E.g.:
<pre>
. /lib/lsb/init-functions

case $1 in
    start)
        if init_is_upstart; then
            exit 1
        fi
        [...]
        ;;
    stop)
        if init_is_upstart; then
            exit 0
        fi
        [...]
        ;;
    restart|force-reload)
        if init_is_upstart; then
            exit 1
        fi
        [...]
        ;;
esac
</pre>
* Manually add a versioned dependency on lsb-base for the use of init_is_upstart:
<pre>
Depends: [...], lsb-base (>= 4.1+Debian3), [...]
</pre>

=== Results ===
For a source package <code>foo</code> with the following contents: <pre>
debian/foo.init
debian/foo.default
debian/foo.upstart
</pre>
... you should end up with a binary package with the following contents: <pre>
/etc/init.d/foo
/etc/default/foo
/etc/init/foo.conf
</pre>
... and with the following dependencies: <pre>
Depends: [...] lsb-base (>= 4.1+Debian3), sysv-rc (>= 2.88dsf-24)
</pre>

Upgrading the package should give you <code>/etc/init.d/foo</code> as a real file.  If, after upgrading, you still see a symlink to <code>/lib/init/upstart-job</code>, or if there is an <code>/etc/init.d/foo.dpkg-new</code> on the system, something is wrong!  Do not upload to Ubuntu until you have figured out why and fixed it.

And always, always do a boot test before you upload! :)

=== Other notes ===
* Since the new init script will be a no-op, packages which normally restart in the postinst (instead of stopping in the prerm and starting in the postinst) ''MUST'' handle stopping the service in their preinst when upgrading from a pre-upstart-capable version.  See the Debian udev package for an example of this.
