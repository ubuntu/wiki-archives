{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


{| class="wikitable"
|-
| <tablestyle="background-color:yellow">'''Under Construction'''
|}

== How to maintain the Ubuntu Studio Packages ==

This section is a step by step description on how to make changes to a Ubuntu Studio package and publish it.

=== Source Repositories ===

Ubuntu Studio package source can be found in one of two places:

* Launchpad (where our original sources are kept)
* Ubuntu archive (where the packages are built, and becomes installable)

==== Source at launchpad ====

Let's look at a typical Ubuntu Studio original package, using '''ubuntustudio-default-settings''' as an example.

Typically all Ubuntu Studio source packages belong to a launchpad project with the same name as the source package. In the case with the package ubuntustudio-default-settings, the project page is <nowiki>[[https://launchpad.net/ubuntustudio-default-settings|launchpad.net/ubuntustudio-default-settings]]</nowiki>, and the source can be found at <nowiki>[[https://code.launchpad.net/ubuntustudio-default-settings|code.launchpad.net/ubuntustudio-default-settings]]</nowiki>.

There may be more than one source repository for the package. The one under active development is the one with the shorthand ''lp:<projectname>''. The real name for the package with that shorhand is ''trunk'', which you can see from this full url to the trunk branch for ubuntustudio-default-settings: https://code.launchpad.net/~ubuntustudio-dev/ubuntustudio-default-settings/trunk.

===== Repository naming for bzr branches =====

====== The development branch: trunk ======

There's always at least one branch for each project/package called ''trunk''. This is the branch which is under active development, and will always stay that way.
So, if you ever create a new original Ubuntu Studio package, create a project for it with the same name as the package, and if you create a bzr repository you name it ''trunk''. If it's a git repository, you may use a different naming scheme.

====== Stable Release branches ======

There's no need to create branches other than ''trunk'' usually. The situation where this might be needed is when you need to fix a bug in a stable release package, but for some reason you are not able to just build and upload the current development branch. When that happens, you'll can create a new branch which is based on the stable release code - not the trunk branch.

Creating a branch for it under the project will allow other team members to further make changes to the same source, so doing this is only valuable when many people work on the same source. Else, you can just create a personal branch, do the bugfix, and then do a merge request (but this is under the topic bug fixing, so not further explained here).

If you need to create a new branch of the stable release of a package, this is how you do it (using ubuntustudio-default-settings as an example package):

<pre>
pull-lp-source ubuntustudio-default-settings trusty
</pre>

Create a new branch in launchpad for it. Name it using either the codename (i.e. ''trusty''), or the release number (14.04). For example:

<pre>
bzr push lp:~ubuntustudio-dev/ubuntustudio-default-settings/14.04
</pre>

=== Making Changes to a Package ===

Different packages need different kind of treatment. But, simply put, there are two kinds of packages:
* ''regular'' packages
* meta packages

=== Meta Package Maintenance ===

The ubuntustudio-meta package is special. The source is now kept in git which you can obtain with:
<pre>
git clone https://git.launchpad.net/~ubuntustudio-dev/ubuntustudio-meta
</pre>

Please note that sometimes people outside of the team will update the metapackage with the latest seeded packages (using the ./update script) without updating the git repository. Therefore we should start by comparing the state of the git repository with the latest version in the archive.
Assuming there have been no recent changes in the git repository, first build the current git version.
<pre>
debuild -S
</pre>

Then, pull the source for the development release with:
<pre>
pull-lp-source ubuntustudio-meta
</pre>

In the rare cases you need to make changes to a released version of Ubuntu Studio, you need to also specify the release:
<pre>
pull-lp-source ubuntustudio-meta xenial
</pre>

Create a debdiff file to get the "out of git repository" changes.
<pre>
debdiff ubuntustudio-meta-<git version>.dsc ubuntustudio-meta-<archive version>.dsc > ubuntustudio-meta-<archive version>.debdiff
</pre>

If the diff seems right, this should be committed to the git repository.
<pre>
patch -p1 < ../ubuntustudio-meta-<archive version>.debdiff
git commit -m "Merge latest changes from archive version"
</pre>

Now we have a solid base, we start a new version by incrementing the changelog.
<pre>
dch -i
</pre>

Then run the "update" script to update the seed files based on the latest seeds:
<pre>
./update
</pre>

To run the above command, you will need to have the ""germinate"" package installed. This script downloads the latest package files from the archive, checks out the git repository for the seeds, and downloads relevant packages from the archive in order to update the seed files for all architectures (e.g. i386). The script also updates the Debian changelog with a new entry to list the changes to seeded packages.

Next, finalise the changelog by editing the changelog with "dch -e". Remember to close any bugs against the metapackages with an (LP: #12345) entry against the relevant change entry. Then update the changelog entry with your name and the current date and time, and the correct distribution with: 
<pre>
dch -r -D yakkety
</pre>

Then build the package locally:
<pre>
debuild
</pre>
This will rebuild all of the debian/control files for each binary meta-package (e.g. ubuntustudio-audio), so that the binary meta-packages depend/recommend all of the right Ubuntu Studio packages.

At this point, it is a good idea to do a "difference" check with the last version to see that the changes look sensible:
<pre>
cd ..
debdiff ubuntustudio-meta_0.155.dsc ubuntustudio-meta_0.156.dsc | less
</pre>

If everything looks fine, it is time to build the final version, and upload it to a ppa ready for a test install:
<pre>
cd ubuntustudio-meta-0.156
debuild -S
cd ..
dput ppa:ubuntustudio-dev/dev-testing ubuntustudio-meta_0.156_source.changes
</pre>

This builds a source only version of the package, and the binaries will be built within the ppa. This may take some time if the build machines are busy. If you are not a member of the Ubuntu Studio Development Team, you can upload to your own ppa instead.

Once the ppa has successfully build the metapackage, fire up a machine (a virtual one will be fine) with the current Ubuntu Studio development version. Make sure the machine is up to date, and then add the testing ppa:
<pre>
sudo add-apt-repository ppa:ubuntustudio-dev/dev-testing
sudo apt-get update
</pre>

This should find the new version of the metapackages to be tested, so that they will be installed with a ""sudo apt-get upgrade"" command.

Assuming it installs fine, then if you have upload rights, the *.changes file can be uploaded as normal. If you need sponsorship, then you should attach a debdiff between the previous version and this one to a bug in Launchpad, and subscribe the sponsorship team to the bug.

The debdiff can be generated by:
<pre>
cd ..
debdiff ubuntustudio-meta_0.155.dsc ubuntustudio-meta_0.156.dsc > ubuntustudio-meta.debdiff
</pre>

Remember to push your changes:
<pre>
git push
</pre>
If you are not a member of ~ubuntustudio-dev, you will have to push to your own repository.

Once the Meta Package has been uploaded to the archive, tag the git repository and push the tag:
<pre>
git tag -a v167 -m "Update latest seeds for disco dingo"
git push --tags
</pre>

=== Other packages ===

git, debian build tools, uploading...

----
CategoryUbuntuStudio
CategoryUbuntuStudioDev
