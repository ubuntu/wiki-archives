{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

<pre>
[22:05] <Riddell> Friends, time for  our next talk
[22:05] <Riddell> which is from.. me
[22:05] <Riddell> Packaging and Merging with the Ninjas
[22:05] <Riddell> if you want to follow along you'll need some packages installed:  apt-get install devscripts kdelibs5-dev kdebase-workspace-dev
[22:06] <Riddell> KDE releases every six months
[22:06] <Riddell> Each release includes about three beta/RC releases plus the final thing
[22:06] <Riddell> The Kubuntu ninjas are the people who package all of these releases so they're available as soon as possible at release time for the development version and latest released version of Kubuntu
[22:06] <Riddell> any ninjas here today?
[22:07] <vorian> ~ninjas
[22:07] <kubotu> apachelogger, Arby, devfil, JontheEchidna, nhandler, Riddell, ScottK, stdin, nixternal, a|wen and vorian ... to the Batcave!
[22:08] <Riddell> On top of KDE there's also releases of major KDE apps such as Amarok, KDevelop, KOffice and everything in extragear which we try to treat similarly
[22:08] <Riddell> with packages available toot sweet after release and backports to the latest stable Kubuntu
[22:08] <Riddell> The ninjas work partly in secret because we get the source tars a few days early to get the packaged in time for release
[22:09] <Riddell> and to check for final problems in the code before release (which happens a lot)
[22:09] <Monika|K> so those who package Ubuntu (non-K) stuff are not ninjas?
[22:09] <Riddell> think of them as yellow belts :)
[22:09] <Riddell> but they're not a secrative lot, infact you can join them and get your own black belt and ninja mask by showing your packaging skills and saying that you wish to help
[22:10] <Riddell> This week we have been mostly packaging KDE 4.3 RC 1
[22:10] <Riddell> Let's take a look at updating one of the RC packages from the previous beta release
[22:10] <Riddell> first grab the current packaging
[22:10] <Riddell> if you're in karmic that's:  apt-get source kdetoys
[22:10] <Riddell> if you're not using karmic you can get it from launchpad
[22:10] <Riddell> go to https://edge.launchpad.net/ubuntu/karmic/+source/kdetoys/4:4.2.90-0ubuntu1
[22:10] <Riddell> and dget the .dsc file it points to
[22:11] <Riddell> (dget will download the three files)
[22:11] <shadeslayer> Riddell: all 3 right?
[22:11] <Riddell> shadeslayer: yes
[22:11] <Riddell> Deb source packages are not really source packages at all, they're the source tar with any changes made in a compressed .diff file, usually the changes are to add the debian/ packaging directory.  the .dsc has the checksums for the two files
[22:12] <Riddell> you can use   dpkg-source -x foo.dsc  to extract the files (apt-get source will run this for you)
[22:13] <Riddell> WielkieG: that's fine to ignore for now
[22:13] <Riddell> ok, Here's the source, you all have to obay the code of the ninjas and not let it get public before KDE does their release in a couple of days
[22:13] <Riddell> http://people.ubuntu.com/~jriddell/tmp/kdetoys-4.2.95.tar.bz2
[22:13] <Riddell> remember, top secret is that!
[22:13] <Riddell> download that in a separate directory
[22:14] <Riddell> it needs to be changed to the deb naming format for tars
[22:14] <Riddell> bunzip2 kdetoys-4.2.95.tar.bz2
[22:14] <Riddell> gzip -9 kdetoys-4.2.95.tar
[22:14] <Riddell> mv kdetoys-4.2.95.tar.gz kdetoys_4.2.95.orig.tar.gz
[22:14] <Riddell> to get it as gzip, and rename it to the correct naming format
[22:14] <Riddell> then extract it:
[22:14] <Riddell> tar xf kdetoys_4.2.95.orig.tar.gz
[22:14] <Riddell> cd kdetoys-4.2.95
[22:15] <Riddell> then copy over the debian/ directory from the old sources you just downloaded
[22:15] <Riddell> cp -r ../kdetoys-4.2.90/debian .
[22:15] <Riddell> (ajust your path to wherever you downloaded it to)
[22:19] <Riddell> if you've copied over the debian/ directory from the old version of the package the next step is to add a changelog entry
[22:19] <Riddell> dch -i   will do that and open an editor for you to add the changelog message
[22:19] <Riddell> which you can type in as "New upstream release" or something similar
[22:19] <Riddell> also set the version number to 4.2.95-0ubuntu1 in the editor at the top
[22:20] <Riddell> close the editor
[22:20] <Riddell> and that's the package all updated to the new version
[22:20] <Riddell> you need to test build it and make sure it actually works though
[22:20] <Riddell> get it compiling with:   debuild
[22:21] <Riddell> that'll probably ask for some extra packages to be installed first
[22:21] <Riddell> install those and run debuild again and it'll compile away
[22:22] <Riddell> watch the build output though to see if it complains about any missing libraries, new versions of KDE often pick up new dependencies
[22:27] <Quintasan> Riddell: don't we need to bump the build depends?
[22:27] <Riddell> Quintasan: yes should do, although you probably don't have the new versions of kde4libs and base so can't  in this case
[22:32] <jscurtu> i have an error in debsign...
[22:32] <Riddell> jscurtu: excellent!
[22:32] <Riddell> that means it all compiled
[22:33] <jscurtu> juhu
[22:33]  * Riddell hands jscurtu his orange ninja belt
[22:33] <Riddell> if you have it compiled you can check for new files
[22:33] <Riddell> dh_install --sourcedir=debian/tmp --list-missing
[22:33] <Riddell> that'll show if there's any new files that need to be installed
[22:33] <Riddell> in the directory above you'll find the .deb files ready to be installed and tested
[22:35] <Riddell> jscurtu: you asked about splitting the packages, you'll see in the debian/ directory a bunch of .install files, they list the files which have to go into each package

[22:36] <Riddell> I have another packaging mission if anyone is interested in patching
[22:37] <Riddell> this bug came though the radar this morning  https://bugs.edge.launchpad.net/hundredpapercuts/+bug/389747
[22:37] <ubottu> Ubuntu bug 389747 in hundredpapercuts "In default KDE panel use Show Desktop instead of Show Dashboard widget" [Undecided,Confirmed]
[22:37] <Riddell> "In default KDE panel use Show Desktop instead of Show Dashboard widget"
[22:37] <Riddell> it's a usability issue where the text used is considered confusing
[22:37] <Riddell> we need to change that text
[22:37] <Riddell> if you notice on your panel you probably have the Show Dashboard widget with that tooltip
[22:38] <Riddell> it comes from kdeplasma-addons package
[22:38] <Riddell> so that's what we need to patch
[22:38] <Riddell> apt-get source kdeplasma-addons
[22:38] <Riddell> run that to download the source ^^
[22:39] <Riddell> anyone got it downloaded?
[22:39] <Riddell> it should extract itself too
[22:39] <Riddell> cd kdeplasma-addons-4.2.90
[22:40] <Riddell> you can find the string in question with a grep
[22:40] <Riddell> grep "Show the Plasma Dashboard" * -r
[22:41] <Riddell> which shows us it's in applets/showdashboard/showdashboard.cpp
[22:41] <Riddell> we want to edit that file and take a diff
[22:41] <Riddell> first copy the file to make a backup of the un-edited version
[22:41] <Riddell> cp applets/showdashboard/showdashboard.cpp applets/showdashboard/showdashboard.cpp-orig
[22:41] <Riddell> and edit it in your favourite text editor
[22:41] <Riddell> emacs applets/showdashboard/showdashboard.cpp
[22:42] <Riddell> change "Show the Plasma Dashboard"  to  "Show the Desktop"
[22:42] <Riddell> then take a diff between the new and old versions
[22:42] <Riddell> diff -u applets/showdashboard/showdashboard.cpp-orig applets/showdashboard/showdashboard.cpp
[22:43] <Riddell> will show you what's changed
[22:43] <Riddell> we want to put the diff into the packaging in the debian/patches directory
[22:43] <Monika|K> what does the -u do?
[22:43] <Riddell> if you run `ls debian/patches/`  you'll see there's already a couple in there
[22:43] <Riddell> Monika|K: uses the Unified Diff format, which is much easier to read than the non -u format
[22:45] <Riddell> diff -u applets/showdashboard/showdashboard.cpp-orig applets/showdashboard/showdashboard.cpp > debian/patches/kubuntu_03_desktop_string.diff
[22:46] <Riddell> next we need to edit the diff to make it at the correct level
[22:46] <Riddell> emacs debian/patches/kubuntu_03_desktop_string.diff
[22:46] <Riddell> and change  applets/showdashboard/showdashboard.cpp  to  kdeplasma-addons/applets/showdashboard/showdashboard.cpp
[22:47] <Riddell> in the first lines
[22:47] <Riddell> then add the patch to the debian/patches/series file
[22:47] <Riddell> emacs debian/patches/series
[22:47] <Riddell> and add  kubuntu_03_desktop_string.diff in there
[22:48] <Riddell> we need to revert our change now else it'll try to apply it twice
[22:48] <Riddell> mv applets/showdashboard/showdashboard.cpp-orig applets/showdashboard/showdashboard.cpp
[22:48] <Riddell> and add a changelog with   dch -i
[22:48] <Riddell> set the changelog entry to "add patch kubuntu_03_desktop_string.diff, Closes LP: #389747"  or similar
[22:49] <Riddell> and that's us done
[22:49] <Riddell> we can build the package with    debuild
[22:49] <Riddell> and once it's build you can take the diff between the old and new versions of the package with debdiff
[22:49] <Riddell> debdiff <old.dsc> <new.dsc>
[22:50] <Riddell> if anyone follows that through and gets a debdiff, please attach it to that bug and we can use it
[22:49] <msdlk45> what about the often used quilt?
[22:50] <Riddell> msdlk45: quilt does let you do lots of clever things with patches, no time to cover them today
[22:50] <Riddell> and I mostly just do what I just showed you anyway
[22:51] <Riddell> quilt can be too clever for the simple cases I find
[22:51] <Riddell> khaije|amalt: you had a question?
[22:52] <Riddell> those are two packaging examples, updating to a new version and adding a patch
[22:52] <Riddell> there's a lot there and I suspect I lost many of you along the way
[22:53] <Riddell> but don't get disheartened, that covers the majority of what the ninjas do
[22:53] <Quintasan> khaije|amalt: that's the debian's way of packaging. It ensures the package build properly on all machines
[22:53] <khaije|amalt> so is the debian directory generated or is it already in the archives?
[22:53] <Riddell> lots of testing involved too of course
[22:53] <Riddell> khaije|amalt: you can get a template debian directory with  dh_make
[22:53] <Riddell> or just copy it from another package
[22:54] <khaije|amalt> and the debian/ dir is for package meta information?
[22:55] <Riddell> khaije|amalt: right, it has all the packaging information in it, what packages to build and how to compile and install the app
[22:55] <Riddell> debian/control  has the meta information
[22:55] <Riddell> debian/rules is a makefile to build it (which these days often just has an include for a generic makefile for all KDE apps)
[22:55] <khaije|amalt> WielkieG: ook, so it has, at a minimum the package metainfo, but potentially much more including diffs or (install/uninstall) scripts?
[22:56] <Riddell> debian/*install  splits out the files into  individual package
[22:56] <Riddell> and changes to upstream are put into  debian/patches/
[22:57] <khaije|amalt> mkay, so this method could produce potentially many packages from a single .dsc?
</pre>
