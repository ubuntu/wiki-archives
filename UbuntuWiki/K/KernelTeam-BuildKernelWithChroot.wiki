{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


=== Summary ===
This wiki page is the step-by-step document for build the environment of chroot for build kernel image

=== Install necessary package on host ===
host# '''sudo apt-get install schroot debootstrap dchroot'''

=== Where the root of chroot is ===
host# '''sudo mkdir /var/chroot'''

=== Before you start ===
There is an easy script that can do whole things that have to be done at host side that describe as below section. You can download this script and give it a try
<nowiki>[[http://people.ubuntu.com/~acelan/scripts/create_chroot.sh|create_chroot.sh]]</nowiki>
It should be run with root privilage.
<pre>
$ ./create_chroot.sh
Usage: ./create_chroot.sh name corename arch location
 ex. ./create_chroot.sh hardy-lpia hardy lpia /var/chroot/hardy-lpia
</pre>
<pre>
$ sudo ./create_chroot.sh jaunty-lpia jaunty lpia /var/chroot/jaunty-lpia
I: Retrieving Release
I: Retrieving Packages
I: Validating Packages
I: Resolving dependencies of required packages...
I: Resolving dependencies of base packages...
...
postfix:*:14424:0:99999:7:::
statd:*:14425:0:99999:7:::

NOTE. there are three local files will be modified, they are
        /etc/schroot/schroot.conf
        /etc/fstab
        /etc/dchroot.conf
please check the modification isn't mixed up the files and you can find the backup files in the /tmp.

Done.

You can try to use the new chroot by
        sudo chroot /var/chroot/jaunty-lpia
or
        dchroot -c jaunty-lpia -d
Enjoy.
</pre>

=== Modify the schroot config file ===
host# '''sudo vi /etc/schroot/schroot.conf'''<<BR>>
''Append the following context''
<pre>
[hardy-lpia]
description=Ubuntu hardy lpia 32 bit
location=/var/chroot/hardy-lpia
priority=3
users=<your_userid_on_your_host>
groups=sbuild
root-groups=root
personality=linux32
</pre>

=== Install basic package into chroot environment ===
host# '''sudo debootstrap --variant=buildd --arch lpia hardy /var/chroot/hardy-lpia `http://ports.ubuntu.com/`'''<<BR>>
host# '''sudo cp /etc/resolv.conf /var/chroot/hardy-lpia/etc/resolv.conf'''<<BR>>
host# '''sudo vi /var/chroot/hardy-lpia/etc/apt/sources.list'''<<BR>>
''Remove everything and add following line''
<pre>
deb http://ports.ubuntu.com hardy main restricted multiverse universe
deb-src http://ports.ubuntu.com hardy main restricted multiverse universe
</pre>

=== Now you can chroot in and install more package ===
host# '''sudo chroot /var/chroot/hardy-lpia'''<<BR>>
root@chroot# '''apt-get install gnupg; apt-get update'''<<BR>>
root@chroot# '''apt-get install wget debconf devscripts dialog nano vim debhelper locales sudo kernel-wedge fakeroot'''<<BR>>
root@chroot# '''locale-gen en_US.UTF-8'''<<BR>>
root@chroot# '''tzselect'''<<BR>>
root@chroot# '''exit'''<<BR>>

=== Bind several directory with chroot and host ===
host# '''sudo vi /etc/fstab'''<<BR>>
''Append the following lines''<<BR>>
''Take care it will bind /home between your host and chroot environment''<<BR>>
''If you want to remove chroot environment, '''*umount them first*'''''
<pre>
/home           /var/chroot/hardy-lpia/home        none    bind            0       0
/tmp            /var/chroot/hardy-lpia/tmp         none    bind            0       0
/dev            /var/chroot/hardy-lpia/dev         none    bind            0       0
proc-chroot     /var/chroot/hardy-lpia/proc        proc    defaults        0       0
devpts-chroot   /var/chroot/hardy-lpia/dev/pts     devpts  defaults        0       0
</pre>
host# '''sudo mount -a'''<<BR>>

=== Setup userid/password in chroot ===
host# '''sudo cp /etc/passwd /var/chroot/hardy-lpia/etc/'''<<BR>>
host# '''`sudo sed 's/\([^:]*\):[^:]*:/\1:*:/' /etc/shadow | sudo tee /var/chroot/hardy-lpia/etc/shadow`'''<<BR>>
host# '''sudo cp /etc/group /var/chroot/hardy-lpia/etc/'''<<BR>>
host# '''sudo cp /etc/hosts /var/chroot/hardy-lpia/etc/'''<<BR>>
host# '''sudo cp /etc/sudoers /var/chroot/hardy-lpia/etc/'''<<BR>>
host# '''sudo chroot /var/chroot/hardy-lpia/'''<<BR>>
chroot# '''dpkg-reconfigure passwd'''<<BR>>
chroot# '''passwd <your_userid_on_your_host>'''<<BR>>
chroot# '''echo hardy-lpia > /etc/debian_chroot'''<<BR>>
chroot# '''exit'''

=== Setup final information for dchroot.conf ===
host# '''sudo vi /etc/dchroot.conf'''<<BR>>
''Append with the following content''
<pre>
hardy-lpia /var/chroot/hardy-lpia/
</pre>

=== Congratulations, everything is done ===
host# '''dchroot -c hardy-lpia -d'''<<BR>>
''your shall prompt shall be something like this''
<pre>
(hardy-lpia)ikepanhc@laptop:~$ 
</pre>
