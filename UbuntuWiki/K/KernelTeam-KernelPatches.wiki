{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__



The Ubuntu kernel team's target scenario is to have little to no divergence from the upstream linux kernel.  As such, the Ubuntu kernel team's preferred policy is for all patches to be submitted and accepted into the upstream kernel before agreeing to pull them into the Ubuntu kernel.  The following will help describe the process of how to go about getting a patch included into the Ubuntu kernel.  Let us know if there are any questions or if we can <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelPatches#Getting Help|be of any assistance]]</nowiki>.

=== Typical Patch Life Cycle ===
This outlines the typical steps a patch should go through before it's included into the Ubuntu kernel.

# <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelBugFixing|Patch is created and thoroughly tested.]]</nowiki>
# <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelTeamBugPolicies#Filing Kernel Bug reports|File a bug in Launchpad]]</nowiki> documenting the issue and what the patch does to resolve that issue.
# Attach the patch to the Launchpad bug.  Be sure to tick the "This attachment is a patch" checkbox when attaching.
# Optional: if you want your patch reviewed before submitting upstream, please send it in an email to the .
** These types of patches can be submitted on the  in one of two forms:
## A pull request from a publicly available git repository, e.g., attach the output of 'git request-pull'. This is the preferred method for large or numerous patches.
## From your local git repository run the command 'git format-patch -1 <SHA1>' and email the resulting file. Beware of tab mangling and line wrapping.  A good rule of thumb is to email the patch to yourself first and verify it applies cleanly.
** Don't forget to add your "Signed-off-by:" line.
** The patch should be reviewed by the Ubuntu kernel team and feedback will likely be given.  Be sure to make any suggested improvements and resubmit for another review if necessary.
1. Once the patch is ready, submit it upstream.  See the <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelPatches#Submitting%20a%20Patch%20Upstream|the Submitting a Patch Upstream]]</nowiki> section below.
** The patch will typically undergo a review by the upstream kernel developers and may receive additional comments on how to improve the patch.  Be sure to make the suggested improvements and resubmit until it's finally accepted.
** At this point, it's also a good idea to add a reference in the Launchpad bug to the thread of the patch posted upstream.
# Patch accepted upstream.
# Once upstream, the patch will automatically land in the Ubuntu kernel.
** If this patch should be cherry-picked immediately into the Ubuntu kernel from upstream, please refer to the <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelPatches#Submitting%20a%20Patch%20to%20the%20Ubuntu%20Kernel|Submitting a Patch to the Ubuntu Kernel]]</nowiki>

If you need assistance with any of these steps, please refer to the <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelPatches#Getting Help|help section]]</nowiki> below.

=== Submitting a Patch Upstream ===

If a patch will benefit the entire kernel community as a whole it should go upstream first.  Once the patch is integrated upstream, the patch will automatically trickle down into the Ubuntu kernel.  If a patch has not been submitted upstream it's not likely to be applied to the Ubuntu kernel.  So how does one go about submitting a patch to the upstream kernel?

# First, read the <nowiki>[[http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/SubmittingPatches|upstream patch submission documentation]]</nowiki>.  Do not just skim or browse this.  It's rude to waste an upstream developers time by not knowing how to properly submit a patch, especially when the patch submission process has been fully documented.  The upstream developers take patches and contributions seriously, so please return the favor by submitting a patch properly.
# Look at the <nowiki>[[http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=MAINTAINERS|MAINTAINERS]]</nowiki> file to know where to send the patch.
# Be sure to create the patch against the upstream kernel source, not the Ubuntu kernel source.
** Some subsystems maintain their own git trees which are then merged with Linus'.  If this is the case, create the patch against the subsystem's tree.  Otherwise use http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git.
<pre>
git clone http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git
</pre>
1. Make sure to maintain full provenance of the patch by signing off on it (ie add your Signed-off-by:)

==== Example of Submitting a Patch Upstream ====
<nowiki>[[https://bugs.launchpad.net/ubuntu/+source/linux/+bug/323592|Bug 323592]]</nowiki> - reboot freeze of Dell XPS 710

This particular bug was fixed by creating a patch to add a reboot quirk for this particular system.  This patch would be beneficial not only for Ubuntu users but all users who had this hardware.  As such, this patch was submitted upstream as follows:
# The patch was first thoroughly tested and confirmed to fix the issue.
# The submitter carefully read the <nowiki>[[http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/SubmittingPatches|upstream patch submission documentation]]</nowiki> and noted some key elements to keep in mind:
** the patch needed to have a well written description
** the patch followed the upstream kernel coding style
** the patch would be submitted as inline text in an email (ie. no attachments, no links, etc.)
** patch was generated against the latest kernel available
** "[PATCH]" was included in the subject of the email
** patch was signed off
1. The submitter examined the <nowiki>[[http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=MAINTAINERS|MAINTAINERS]]</nowiki> file to see who and where to submit the patch to:
<pre>
X86 ARCHITECTURE (32-BIT AND 64-BIT)
P:      Thomas Gleixner
M:      tglx@linutronix.de
P:      Ingo Molnar
M:      mingo@redhat.com
P:      H. Peter Anvin
M:      hpa@zytor.com
M:      x86@kernel.org
T:      git git://git.kernel.org/pub/scm/linux/kernel/git/x86/linux-2.6-x86.git
S:      Maintained
F:      Documentation/x86/
F:      arch/x86/
</pre>
# After examining the <nowiki>[[http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=MAINTAINERS|MAINTAINERS]]</nowiki> file it was noted that this particular subsystem had it's own git tree.  The patch was quickly rebased against the linux-2.6-x86.git tree.
# The email was then crafted and was sent to the maintainers (Thomas Gleixner, Ingo Molnar, H. Peter Anvin), the x86 kernel mailing list, and LKML.
** http://lkml.org/lkml/2009/3/4/285
1. The patch was accepted and merged upstream
** http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=dd4124a8a06bca89c077a16437edac010f0bb993

'''Caveats'''
* When this patch was submitted it also had a "Cc: <stable@kernel.org>" line included in the email.  That was to make sure it was also submitted to the stable updates tree once it was accepted.  Most patches won't likely need this line in the email.
* If this patch would have been submitted more recently, it should have also contained a line "BugLink: https://bugs.launchpad.net/bugs/323592"

==== Additional Examples ====

https://bugs.edge.launchpad.net/ubuntu/+source/linux/+bug/371574

=== Submitting a Patch to the Ubuntu Kernel ===

The majority of patches should go upstream first before the Ubuntu kernel team will consider applying them to the Ubuntu kernel.  Refer to <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelPatches#Submitting%20a%20Patch%20Upstream|the Submitting a Patch Upstream section above]]</nowiki>.  Once a patch has been submitted and accepted upstream it will automatically find it's way into the Ubuntu kernel.  If the upstream patch is something that should be cherry-picked as soon as possible into the Ubuntu kernel tree, please do the following:

# <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelTeamBugPolicies#Filing Kernel Bug reports|File a bug in Launchpad]]</nowiki> and be sure to reference the upstream SHA1 git id that the Ubuntu kernel team should cherry-pick.
# Send an email to the  requesting the cherry-pick.  Also be sure to reference the Launchpad bug in your email.

There are exceptions that are sometimes made.  If a patch is for example a Critical bug fix, the Ubuntu kernel team may opt to temporarily carry the patch while it's going through the upstream submission process.  Patches must still adhere to the following:
# A bug should also be filed in Launchpad for tracking purposes.
# The patch should have full provenance (including your Signed-off-by:), i.e., who wrote the patch, where it came from, and a descriptive commit log message.
# These types of patches can be submitted on the  in one of two forms:
** A pull request from a publicly available git repository, e.g., attach the output of 'git request-pull'. This is the preferred method for large or numerous patches.
** From your local git repository run the command 'git format-patch -1 <SHA1>' and email the resulting file. Beware of tab mangling. Use an email attachment if necessary.
1. The email to the  should reference the upstream thread where discussion is taking place regarding the patch as well as the Launchpad bug #.  

Finally, there do exist scenarios where a patch is Ubuntu specific.  For example, <nowiki>[[https://bugs.launchpad.net/ubuntu/+source/linux/+bug/393517|Bug 393517]]</nowiki>.  If this is the case, <nowiki>[[https://wiki.ubuntu.com/KernelTeam/KernelTeamBugPolicies#Filing Kernel Bug reports|file a bug in Launchpad]]</nowiki>.  Then send an email to the .

=== Reasons Why the Ubuntu Kernel Team Won't Take a Patch ===
* "If it ain't good enough for Linus it ain't good enough for us." That's not 100% true, but the basic idea is that if the patch is not in upstream, that generally means they aren't stable. Ubuntu's kernel is not a testing ground for developing features.
* Maintaining a patch in our tree is not easy. Let's say we include v0.54 of some patch. Later, we want to sync up to the latest version of this patch. It's not easy to simply revert v0.54, because merges could have changed some of the code. Not to mention, there are very few patches like this that provide incremental changes between versions.
* Patching stock code means we can't get upstream kernel maintainers to help us much anymore. If our users experience bugs, we'll have to get them to try a stock kernel before being able to push the bug to upstream.
* Patching stock code means we have to worry about merges between the patch and code it touches. This can happen while we are following upstream development of the kernel, or when doing security patches for released kernels.
* Patching stock code opens up to unforeseen security issues. The patch you are asking to include could contain potential security problems, which we would likely never hear about, since the code isn't part of the stock kernel.
* Patching stock code could introduce bugs that even users who aren't getting the features of the patch would see (Xen is a good example of this). Adding bugs is bad.
* The patch is not against a new enough kernel. For example, at the time of writing this, Xen was still only stable against 2.6.16, but the kernel we are working on is 2.6.20-pre. The 2.6.20 kernel line broke even our third-party drivers.
* Confusion. This applies to patches that people want compiled as a separate kernel flavour. While we've done this for other features, it is not always good to have so many types of kernels available. Not to mention we'll also have people wanting flavour foo compiled with flavour bar, to provide a foo-bar kernel. We don't want to make a habit of this.
* A very uncommon reason, but just as important, is that the patch is just crap or serves no real purpose. Don't be offended.
* And the most important reason is, we just don't have time. Think if we included everyone's pet patch, and had to maintain them all. We'd be so swamped, we couldn't keep Ubuntu the great stable Linux OS it is now.

=== The Patch Wasn't Accepted, Now What? ===

There's usually a good reason why a patch wasn't accepted and it's usually explained in a reply.  If there are suggestions for improvements that need to be done to the patch before it'll be accepted, make those improvements and re-submit.  Most patches go through this type of review process and will need to be modified and re-submitted a few times before they are accepted.  Don't give up.

There are some patches that don't make it upstream or into the Ubuntu kernel.  Some people seem to be able, and God help them, willing to maintain a kernel package outside of Ubuntu's main repository.  This is great if someone is willing to do this but it's not recommended.  If someone opts for this route, things usually happen in stages. Most custom kernels never make it past the first stage.
# People create custom kernels built against the Ubuntu source and provide it publicly somewhere. They take on all the responsibility of keeping it current.
# If the package is used enough, sometimes it can make it into Universe, and made available to a wider audience. The patch would build depend on the Ubuntu kernel source, and easily stay in sync with updates to it. It would also be built on all available architectures. For this to happen, takes a greater degree of commitment from the person maintaining this package.
# Hopefully, some time after this stage the patch will be reconsidered for inclusion in upstream kernel. If not, then there's probably very little chance it would be included in the main Ubuntu kernel, but things can happen.

Colin:  1 & 2 would be much easier if building linux-restricted-modules against non-standard flavours were supported.  I submitted some changes in a <nowiki>[[https://bugs.launchpad.net/ubuntu/+source/linux-restricted-modules-2.6.20/+bug/77064|bug report]]</nowiki> but I don't think it has been looked at; wouldn't something similar go a long way towards facilitating kernel customization?  --MattPrice

=== Getting Help ===

If you need assistance or have any questions regarding a patch, need a patch to be reviewed, or need help getting the patch submitted upstream, the Ubuntu kernel team would be happy to help.  Please contact them either through the  or join the #ubuntu-kernel channel on the FreeNode IRC server.

----
CategoryKernel
