{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

After being seeking around for a user-based home folder encryption really flexible using Truecrypt, I've been surprised not finding anything. Therefore, I've considered experimenting it.
Encryption of home folder perfectly fits a laptop security requirement for example.

== Use cases ==
* Create a new user with an encrypted folder
* Convert an existing user home into an encrypted truecrypt container

=== Common setup (by root) ===
* Install truecrypt package (available <nowiki>[[http://www.truecrypt.org]]</nowiki>)
* Ensure user is in admin wheel to be able to mount the home encrypted fs: 
<code> addgroup <username> admin </code>
* Install Xsession.d script to mount your home on first login after boot (asking for passphrase interactively). This script executes after login before any script. The main problematic is to keep the X authentication token which is solved by copy (see comments in script)
'''/etc/X11/Xsession.d/10tc-home'''
<pre>
TC_HOME_FILE=${HOME}/.tc-home

if [ -e ${TC_HOME_FILE} ] 
then
##### use conf file variables
        . ${TC_HOME_FILE}
##### check home volume exists
        if [ -e ${TC_HOME_VOLUME} ]
        then
######### when remounting home, the Xserver cannot access to its authentication signature
######### need to copy it to the remounted home
                TEMP=`mktemp`
                XAUTH=${HOME}/.Xauthority
######### backup Xserver authority file in current home
                cp ${XAUTH} ${TEMP}
######### proceed to home mount
                truecrypt ${TC_HOME_VOLUME} ${HOME}
######### restore Xserver authority file to remounted home
                mv ${TEMP} ${XAUTH}
        fi
fi
</pre>

=== New user home folder encryption ===
* Add new user: 
<code> adduser <username> </code>
* Create truecrypt volume (use truecrypt GUI, use a linux aware FS (ext3/4)): /home/<username>/home.tc
* Create /home/<username>/.tc-home file with content:
<pre>
TC_HOME_VOLUME=${HOME}/home.tc
</pre>
* Login under <username> ;)

=== Convert user home into truecrypt volume ===
* Create truecrypt volume (use truecrypt GUI, use a linux aware FS (ext3/4)): /home/<username>/home.tc
* Mount truecrypt volume (hereafter assumed /media/truecrypt)
* Move old home to new one (do this as root !)
<pre> 
cd ~/..
mv $USERNAME /media/truecrypt<x>
cd /media/truecrypt<x>/$USERNAME
mv * .* ../
cd /media/truecrypt<x>/
rmdir $USERNAME
</pre>
* Create /home/<username>/.tc-home file with content:
<pre>
TC_HOME_VOLUME=${HOME}/home.tc
</pre>
* Login under <username> ;) (or reboot: <code> sudo reboot </code>)

== Shell login ==
You need to add aside your home.tc (i.e. outside the encrypted home) a .bash_profile that callback the encryption container mount
'''.bash_profile'''
<pre>
/etc/X11/Xsession.d/10tc-home
cd
source ~/.bashrc
</pre>

== Conclusion ==

Hope it helps, it's just a draft so feel free to update and/or correct mistakes

Pros:
* easy to backup (copy of the truecrypt file), 
* proven security (hidden volume (2 versions of your home folder is possible !),
* encrypt the whole home folder no user selection, all .* files also.

Cons:
* fixed size container (not extensible on the fly (unsensitive data not to be stored in your home  folder, use symlinks ...))
* need to modify the X11 boot process (as for ecryptfs based solutions)

----
-- <nowiki>[[LaunchpadHome:topaz]]</nowiki> CategoryLaptop
