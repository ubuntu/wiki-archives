{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


The desktoptesting library can also be used as a python library, without the need of using the framework.

=== Installation ===

==== Prerequisites ====

ldtp and python-ldtp packages are needed to run the tests based on the testing library. Both packages are available in universe. They are installed automatically when installing the desktop testing library through the packages.

==== Enabling Assistive Technologies ====

It is necessary to enable the GNOME Assistive Technologies. The process is described at https://wiki.ubuntu.com/Testing/Automation/LDTP#How%20to%20enable%20GNOME%20Assistive%20Technologies

==== Installation ====

* bzr branch lp:ubuntu-desktop-testing
* cd ubuntu-desktop-testing
* sudo python setup.py install

=== Hello World! ===

Once installed we are going to create our first script to test Ubuntu. Our script will open the Gedit and will write the string "Hello World!" in the main gedit window. We will comment below the meaning of each of the lines.

<pre>

from time import time()

from ubuntutesting.ubuntu import Gedit

try:

### Gedit is the main class for GEdit tests. [3]
    gedit = GEdit()
    
### Start performance test
    start_time = time()
    
### Open Gedit application and wait for existance [4]
    gedit.open()
    
### Write the selected text [5]
    gedit.write_text("Hello World!")
    stop_time = time()
    
    elapsed = stop_time - start_time
    
### Log time performance [6]
    log ('elapsed_time: ' + str(elapsed), 'comment')
    
except LdtpExecutionError, msg:
    raise

</pre>

* [0]: LDTP is written mainly in C, but it has two wrappers in python, ldtp (http://ldtp.freedesktop.org/user-doc/index.html) and ooldtp. ooldtp is not yet documented.
* [1]: Right now the performance is done through the time module. It will be changed, eventually, to the desktop-testing-library module.
* [2]: Import the desktop-testing-library. The latest documentation of the testing library API is available at http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/
* [3]: The applications are subclasses of Application ([../DesktopTestingLibrary/Application]). Check the available applications at the testing library API documentation.
* [4]: Open (http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/ubuntutesting.ubuntu.GEdit-class.html) is a method inherit from the Application class. It will try to open the application through its menu and will wait for the main window to appear.
* [5]: write_text is a method for the Gedit class, that writes the given text to the main buffer.
* [6]: log is a function of ldtp that writes to the log.
 
=== The Application Class ===

The Application class is one of the main classes of the Desktop Testing Library. Its aim is to include all the common behavior of the Ubuntu applications. If the application you want to test is not yet in the library, you can still use the Application class. 

To open any application you can use the open_and_check_menu_item module function (http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/ubuntutesting.ubuntu-module.html#open_and_check_menu_item). This function will be move to Application class in future releases of the desktop-testing-library. You need to give the name of the menu item and the name of the window. I.e. to open the Calculator application we would do:

<pre>
from ooldtp import *
from ldtp import *
from ldtputils import *

from ubuntutesting.ubuntu import *

try:

### Open the Calculator and wait for its main window
    open_and_check_menu_item('Calculator', 'Calculator')

except LdtpExecutionError, msg:
    raise

</pre>

If the application fails to open, an error will be logged in the test log.

The Application class at least can:

* exit: Given an application, it tries to quit it. It will work only if the application has a 'Quit' menu item.
* save: Given an application, it tries to save the current document. It will work only if the application has a 'Save' menu item.
* write_text: Given an application it tries to write text to its current buffer.
* remap: It reloads the application map for the given context.

Please, check the complete documentation of the class at <nowiki>[[http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/ubuntutesting.ubuntu.Application-class.html|the API documentation]]</nowiki>
 
=== Application Specific Classes ===

One of the objectives of the desktop-testing-library is to provide a simple way to create new test cases for the most common applications in Ubuntu. This is done by providing classes that inherit from Application and that provide common tasks for the given application.

Right now we have classes for Gedit, Update Manager and G''''''kSu. If you want to contribute extending these classes or adding new ones, please refer to the guide on how to extend the library ../HowToExtendTestingLibrary .

==== GEdit ====

The GEdit class (http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/ubuntutesting.ubuntu.GEdit-class.html) provide common functionality for the Text Editor application.

We will provide an example on how to use the GEdit class through an example annotated script:

<pre>
from ooldtp import *
from ldtp import *
from ldtputils import *

from ubuntutesting.ubuntu import *

try:

### Gedit is the main class for GEdit tests. 
    gedit = GEdit()
        
### Open Gedit application and wait for existance 
    gedit.open()
    
### Write text to the buffer. Right now the file does not have a name yet.
    gedit.write_text("This is a text")

### Exit the application without saving
    gedit.exit()

### Open again the application
    gedit.open()
    
### Write text to the buffer.
    gedit.write_text("This is a random text")
    
### Save the file
    gedit.save('tempfile.txt')

### Write more text to it
    gedit.write_text('new text')

### Exit the application, saving the changes
    gedit.exit(True)

### Open again the application
    gedit.open()
    
### Write text to the buffer.
    gedit.write_text("This is a random text")
    
### Exit the application saving with a new name
    gedit.exit(True, 'newfile.txt')
        
except LdtpExecutionError, msg:
    raise

</pre>

==== PolicyKit ====

P''''''olicyKit is the class that wraps the behavior of the G''''''kSu dialogs. This application is used by others when they need to gain sudo access.

The available methods for this class are:

* __init__(password)
   (Constructor)	 
   PolicyKit class main constructor. You need to pass the password for administrative activities as argument.
* wait()
   It waits for the pop up window asking for the password to appear. It returns 1, if the gksu window exists; or 0, otherwise.
* set_password()
   It enters the password in the text field and clicks enter. 	
* cancel()
   It exists the gksu window withouth entering the password.

For examples, check the U''''''pdateManager section.

==== UpdateManager ====

U''''''pdateManager (http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/ubuntutesting.ubuntu.UpdateManager-class.html) is the class that wraps the behavior of the Update Manager application (Ubuntu's application that manages packages and distribution updates).

We will provide an example on how to use the U''''''pdateManager class through an example annotated script:

<pre>
from ooldtp import *
from ldtp import *
from ldtputils import *

try:
### Start the update manager application
    updateManager = UpdateManager('adminpassword')
    updateManager.open()

### Check Updates and Install Updates use internally PolicyKit 
### to gain sudo access
    updateManager.check_updates()
    updateManager.install_updates()

### Close the application
    updateManger.close()

except LdtpExecutionError, msg:
    raise
</pre>

Refer to the class documentation for the rest to the available methods: http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/ubuntutesting.ubuntu.UpdateManager-class.html

=== check.py module ===

The Check module provides different ways to check if a test has passed or fail (http://people.ubuntu.com/~ara/ldtp/doc/testing_module_doc/toc-ubuntutesting.check-module.html).

All the subclasses of Check will have a method called perform_test that will return PASS, if the test passes; or FAIL, otherwise.

The available check classes right now are:

==== FileComparison ====

Test check for file comparison. If two files are equal, the test passes. Let's have a look through an example:

<pre>
from ooldtp import *
from ldtp import *
from ldtputils import *

from ubuntutesting.ubuntu import *
from ubuntutesting.check import *

try:

### Open the Gedit application
    test = GEdit()   
    test.open()

### Write the "Hello World!" string and 
### save the file as "test.txt"
    test.write_text("Hello World!")
    test.save("test.txt")
    test.exit()

    stop_time = time()
    
### Compare the new file against an existing one that
### already contains the same string
    testcheck = FileComparison("oracle.txt", "test.txt")
    check = testcheck.perform_test()
    
### If the test fails, log the error
    if check == FAIL:
        log ('Files differ.', 'CAUSE')
        log ('Files differ.', 'ERROR')

except LdtpExecutionError, msg:
    raise

</pre>
