{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

== Maintaining Code Phablet ==

Instructions on how we currently maintain https://code-review.phablet.ubuntu.com, and how to reflect merges that get pushed there into the Android source package we maintain on Ubuntu.

=== Pushing Changes / Code Review ===

This server contains a public gerrit instance that is used to host the repositories and provide code review for pull requests. You can read more about how to use gerrit at https://wiki.ubuntu.com/Touch/Gerrit

At the moment only developers that are part of the admin group can push/accept pull requests.

Current list of admin users:
* Alfonso Sanchez-Beato <alfonso.sanchez-beato@canonical.com>
* John McAleely <john.mcaleely@canonical.com>
* Ondrej Kubik <ondrej.kubik@canonical.com>
* Tony Espy <espy@canonical.com>
* Jim Hodapp <jim.hodapp@canonical.com>
* Simon Fels <simon.fels@canonical.com>

=== Producing the android tarballs ===

At https://code-review.phablet.ubuntu.com/export/ you can find the original tarball that gets used when updating the android source package (it's basically the orig tarball for the package).

The script that creates such tarball is part of a cronjob that runs at ''hesperidium.canonical.com'' (at the moment it runs once at every day). If you got access to such server, you can find the script at ''/home/rsalveti/bin/export_android_aosp.sh''.

The idea behind this script is to create a dump of the repo manifest used for phablet (https://code-review.phablet.ubuntu.com/p/aosp/platform/manifest.git -> branch phablet-4.4.2_r1), but without containing any git object, so we can produce a smaller source tree (repo clone has more than a few GBs, while the tarball is around 250MB).

=== Updating the Android source package ===

You can find the current Android source package at https://code.launchpad.net/~phablet-team/android/+git/android

The package is maintained using <nowiki>[[https://wiki.debian.org/PackagingWithGit git-buildpackage]]</nowiki>.

This package is currently used when producing images for the following devices:
<pre>
$ cat android/debian/android-targets 
x86		generic_x86	goldfish	i386		i386
arm		generic		goldfish	armhf		armel
mako		mako		mako		armhf		armel
flo		flo		flo		armhf		armel
deb		deb		flo		armhf		armel
</pre>

==== Setup the packaging tree ====

<pre>
$ git clone git clone git+ssh://git.launchpad.net/~phablet-team/android/+git/android
$ cd android
</pre>

==== Generate the latest phablet tarball ====

As the export job is quite heavy in terms of disk usage we don't run it currently in a regular manor on a server. It has to be executed manually for now.

The script is available as ''debian/scripts/export_phablet.sh''. It will fetch the full Phablet code tree which is about ~40GB. Its wise to keep a reference on your disk which the script then uses to fetch much faster. Have a look at the header of that script for things you can configure.

To simply generate a new tarball run

<pre>
$ debian/scripts/export_phablet.sh
</pre>

Execution will take quite some time and the result will be stored in ~/phablet-export.

==== Updating packaging ====

With the new tarball in hands we can now update the package itself. We're mostly automating this with the help of git-buildpacakge.

'''NOTE:''' When git-buildpackage asks you to enter the new upstream release version be careful and check if its the right one.

<pre>
$ cd android
$ gbp import-orig <path-to-tarball>
</pre>

git-buildpackage will import the tarball into the upstream branch of the git repo and merge it back into the master branch.

==== Uploading package to latest Ubuntu devel release ====

Build the source package, including the new orig tarball:
<pre>
$ gbp buildpacakge -S -sa
</pre>

And dput to your silo:
<pre>
$ dput ppa:ci-train-ppa-service/landing-040 android_20150519-2220-0ubuntu1_source.changes
</pre>

Once built and tested, usual landing rules apply.

=== Testing the Android build ===

Please check https://wiki.ubuntu.com/Process/Merges/TestPlans/Android for the test plan defined for Android.
