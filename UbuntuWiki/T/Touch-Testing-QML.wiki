{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__



== QML Testing ==
----
----
'''This page contains deprecated information. Instead, please check out the tutorials on <nowiki>[[https://developer.ubuntu.com/en/start/quality/|developer.ubuntu.com]]</nowiki>.'''
----
----
----
----

=== Unit tests ===

* Written in QML
* Frameworked used is <nowiki>[[http://doc.qt.io/qt-5/qtquick-qtquicktest.html]]</nowiki>
* Tests are written from the developer point of view
* Examples are found from <nowiki>[[http://bazaar.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/trunk/files/head:/tests/unit/tst_qmltemplate/|UI Toolkit project]]</nowiki> and template from Qt Creator application wizard.
* Running tests
** locally: execute qmltestrunner in the same directory where your tests lives
** CI: implement make check target, <nowiki>[[http://bazaar.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/trunk/view/head:/tests/unit/add_qmlmakecheck.pri|example]]</nowiki>.

==== What should be covered? ====
* Give priority to public APIs. Check all functions and if the function should change some internal state, check that state before and after.
* Initial values for properties

==== How to install ====
<pre>
sudo apt-get install qtdeclarative5-dev-tools qtdeclarative5-test-plugin
</pre>

=== Getting started with unit testing ===

==== A simple Ubuntu UI application ====

This is the component/application under test.

===== Directory structure =====

<pre> bash
$ find .
./myapp.qml
./MyComponent.qml
</pre>
===== The application source code (myapp.qml) =====
<pre> python
import QtQuick 2.0

Rectangle {
  width: 600
  height: 480
  MyComponent {
      anchors.centerIn: parent
  }
}
</pre>
===== The component source code (MyComponent.qml) =====
<pre> python
import QtQuick 2.0

Rectangle {
 width: 360
 height: 360
 property bool myFlag : false

 Text {
     id: myLabelId
     objectName: "myLabel"
     anchors.centerIn: parent
     text: "My Label"
 }

 onMyFlagChanged: myLabelId.text = myFlag ? "Hello" : "World"
}
</pre>

==== Writing a unit test for MyComponent.qml ====

In this we write a simple unit test and execute it.

===== Directory structure =====

We should place the unit tests under tests/unit.
<pre> bash
$ mkdir -p tests/unit
$ find .
./Makefile
./MyComponent.qml
./myapp.qml
./tests
./tests/unit
./tests/unit/tst_myapp.qml
</pre>

===== Creating the unit test (tst_myapp.qml) =====

Unit test name should begin with tst_ so that tests are identified properly by the QtQuick Test Framework.

<pre> python
import QtQuick 2.0
import QtTest 1.0
/******* NOTE: the Ubuntu.Test module is not yet available at the time of writing ******/
import Ubuntu.Test 0.1
import "../.." as App

Item {
  id: root
  width: 200
  height: 200

  App.MyComponent {
      id: objectUnderTest
      anchors.margins: 20
      anchors.fill: parent
  }

  TestCase {
      name: "MyAppUnitTest"
      when: windowShown

      property variant myCompLabel;

      function initTestCase() {
          myCompLabel = Tools.findChild(objectUnderTest,"myLabel");

          compare(myCompLabel!==undefined,true,"There should be myLabel");
          compare(objectUnderTest.myFlag,false,"Initial value for myFlag should be false.");
          compare(myCompLabel.text,"My Label","myLabel.text initial value is 'My Label'");
      }

      function test_toggleMyFlag_data() {
          return [
                      { myFlag: true, text: "Hello", tag: "When myFlag is true, then text is 'Hello'"},
                      { myFlag: false, text: "World", tag: "When myFlag is false, then text is 'World'"}

                  ];

      }

      function test_toggleMyFlag(data) {
          objectUnderTest.myFlag = data.myFlag;
          tryCompare(objectUnderTest.myFlag,data.myFlag);
          compare(myCompLabel.text,data.text);
      }
  }
}
</pre>
This test demonstrates the data driven testing, in which you define a table of values which you are going to use inside a test function.

===== Add ‘make check’ target (Makefile) =====
<pre> bash
$ cat Makefile
check:

 . cd tests/unit qmltestrunner
</pre>

===== Adding a bazaar hook for pre_commit =====

TBD
