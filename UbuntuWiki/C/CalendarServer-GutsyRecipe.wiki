{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

/!\ ''' THIS PAGE IS NOT FINISHED. CONSIDER THE INSTRUCTIONS OF ALPHA RELEASE QUALITY. '''
 ''If you have any problems with any of the instructions here, please provide comment and feedback.''
 ''This page is a candidate for deletion.''

This page explains how to install Apple's <nowiki>[[http://en.wikipedia.org/wiki/Darwin_Calendar_Server|Darwin Calendar Server]]</nowiki> (also called DCS, and the basis for their iCal Server) on Ubuntu Gutsy.

=== Install procedure for Ubuntu Server 7.10 ===
Installing Apple's iCal Server is fairly trivial once you know what to do. You do need to download some additional packages using apt-get, and you'll need to download some software using subversion. Most users will be familiar with apt-get, many with subversion. If you're not familiar with subversion, don't panic. This guide will be a detailed, step by step howto, showing exactly which commands to enter and when.

To make this work you will need to enable the Universe repositories (see <nowiki>[[AddingRepositoriesHowto]]</nowiki> and remember to do an <code> apt-get update </code> afterwards).

Ready?

* Log into the server console or via ssh, so you can enter commands, and run <code> sudo -s </code> to get a root shell.
* Install some software:
 <code> apt-get install subversion libkrb5-dev attr curl build-essential libssl-dev python-pysqlite2 bzip2 </code>
* Install some more software:
 <code> apt-get install curl zope3 python-xml python-pyopenssl python-dateutil python-xattr python-pysqlite2 python-twisted python-vobject python-kerberos python-dev </code>
* We now need to edit our /etc/fstab file and add <code> user_xattr </code> to the options for the partition containing the CalDAV server, / in this case: <code> vim /etc/fstab </code>

 This is what the /etc/fstab change looks like:
 <pre>
 Before: UUID=94a96528-c889-45a1-bc98-d9d02ecdd59c / ext3 defaults,errors=remount-ro 0 1
After : UUID=94a96528-c889-45a1-bc98-d9d02ecdd59c / ext3 defaults,errors=remount-ro,user_xattr 0 1 }}}

* Remount the file system (to activate user_xattr): <code> mount -o remount / </code>
* Create a directory for our server to live in; <code> mkdir /opt/caldavd </code>
* and change into it, <code> cd /opt/caldavd </code>
* Let's download the server software itself using subversion:
 <code> svn checkout http://svn.macosforge.org/repository/calendarserver/CalendarServer/trunk CalendarServer </code>
* Subversion has downloaded a lot of software, and created a directory for us, called CalendarServer. Let's change into it: <code> cd CalendarServer </code>
* And run a script to download some necessary packages, configure, etc: <code> ./run -s </code>
* Our CalDAV server is almost ready for action. Let's copy the test configuration so we can get it up as quickly as possible. Real configuration can wait: <code> cp conf/caldavd-test.plist conf/caldavd-dev.plist </code>
* We do need to do a little configuration though: <code> vi conf/caldavd-dev.plist </code>

* First change the hostname for the server. Locate the line <code> <!-- Network host name --> </code> and change  <code> <string>localhost</string> </code> to <code> <string>your-real-hostname</string> </code> (That is, put the actual name of your server inside the string, it's used within URLs within the software.)
* To make the server available to connections from other computers. Locate this line: <code> <!-- List of IP addresses to bind to [empty = all] --> </code> and replace <code> 127.0.0.1 </code> in <code> <string>127.0.0.1</string> </code> with either nothing or a specific, public ip address for your server.

* Create a user and group to give our server an identity of its own, but we don't need a home directory for it; <code> adduser --system --group caldavd --no-create-home </code>

* Set permissions; <code> chown -R caldavd:caldavd /opt/caldavd </code>

* Run the server: <code> sudo -u caldavd -b /opt/caldavd/CalendarServer/run </code>

That's it! The server is up and running, and you can connect to it with your CalDAV client using <code> caldav://ADDRESS:8008/calendars/users/admin/calendar </code> to test the server using username <code> admin </code> and password <code> admin </code>

To work with Apple iCal under Mac OS 10.5, the URI required was simply: <code> caldav://ADDRESS:8008 </code>

We want our CalendarServer to start up when our server starts up.
Thatfor we write a little startup script:

<code>/etc/init.d/caldavd</code>
{{{#! /bin/sh

. /lib/lsb/init-functions

CALDAVD="/opt/caldavd/CalendarServer/run"
CALDAVD_USER="caldavd"
CALDAVD_OPTS="-d"
PIDFILE="/opt/caldavd/CalendarServer/logs/caldavd.pid"
NAME=caldavd

test -x $CALDAVD || exit 0

case "$1" in
  start)
        log_daemon_msg "Starting Darwin Calendar Server" "$NAME"
        if start-stop-daemon --start --quiet --oknodo --pidfile $PIDFILE --chuid $CALDAVD_USER --exec $CALDAVD -- $CALDAVD_OPTS; then
            log_end_msg 0
        else
            log_end_msg 1
        fi
        ;;
  stop)
        log_daemon_msg "Stopping Darwin Calendar Server" "$NAME"
        if start-stop-daemon --stop --quiet --oknodo --pidfile $PIDFILE; then
            log_end_msg 0
        else
            log_end_msg 1
        fi
        ;;
  restart)
        log_daemon_msg "Restarting Darwin Calendar Server" "$NAME"
        start-stop-daemon --stop --quiet --oknodo --retry 30 --pidfile $PIDFILE
        if start-stop-daemon --start --quiet --oknodo --pidfile $PIDFILE --chuid $CALDAVD_USER --exec $CALDAVD -- $CALDAVD_OPTS; then
            log_end_msg 0
        else
            log_end_msg 1
        fi
        ;;
  status)
        status_of_proc -p "$CALDAVD" "$NAME" && exit 0 || exit $?
        ;;
** )
        log_action_msg "Usage: /etc/init.d/caldavd {start|stop|restart|status}"
        exit 1
esac

exit 0
</pre>

And to get it to load on boot and shutdown safely:
<pre>
update-rc.d caldavd defaults
</pre>

=== To Do: ===
We also need to set up users and permissions for the server itself, so people can connect to the server and share their calendars, which is what we've been aiming for.

We should also document where the server-data is stored, so the information that users have entrusted to the server can be backed up.

Ideally we should package this application so the installation is installable with a single command.
