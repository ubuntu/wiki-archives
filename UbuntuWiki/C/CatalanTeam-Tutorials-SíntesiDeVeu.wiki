{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__



{| class="wikitable"
|-
| <tablestyle="text-align:center; font-weight: bold; font-size: 0.85em; border: none; width: 100%; -moz-border-radius:15px; background-color:#d9bb7a;" style="border: none;">'''Síntesi de veu'''<<BR>>
|}

== Com instal·lar la veu catalana del Festival ==

'''Resum:''' Indiquem com instal·lar i com desinstal·lar les <nowiki>[[http://gps-tsc.upc.es/veu/festcat/|veus catalanes]]</nowiki>, i algunes millores possibles en les que podeu col·laborar. Podeu veure exemples de com fer-les servir a <nowiki>[[Exemples]]</nowiki>.

{| class="wikitable"
|-
| <tablestyle="float:center; font-size: 0.9em; width:95%; background:#F1F1ED; margin: 0 0 1em 1em;" style="padding:0.5em; ">'''Índex'''<<BR>>
|}

=== Instal·lació ===

Aquestes instruccions han estat provades amb <nowiki>[[https://wiki.ubuntu.com/CatalanTeam/Recursos/Instal%C2%B7laci%C3%B3_i_configuraci%C3%B3_d%27ubuntu|Ubuntu Hardy 8.04]]</nowiki> (<nowiki>[[https://wiki.ubuntu.com/CatalanTeam/Tutorials/S%C3%ADntesiDeVeu#Tinc%20Ubuntu%20Hardy%208.04%20i%20Festival%20no%20em%20funciona|1]]</nowiki>). Si us funcionen en altres versions, <nowiki>[[http://ubuntuforums.org/showthread.php?t=806060|us preguem que ho feu saber al fòrum]]</nowiki>

Si no volem llegir les explicacions, podem anar directament a l'apartat ''Codi per copiar al terminal''.

==== Instal·lem Festival ====

Si feu servir Ubuntu Hardy 8.04, o posterior, <nowiki>[[https://wiki.ubuntu.com/CatalanTeam/Tutorials/S%C3%ADntesiDeVeu#Tinc%20Ubuntu%20Hardy%208.04%20i%20Festival%20no%20em%20funciona|veieu això]]</nowiki>.

Obrim un terminal (o consola) amb el menú Aplicacions | Accessoris | Terminal i fem (demanarà la nostra contrasenya de la sessió):

<pre>
 $ sudo apt-get install festival festlex-cmu festlex-poslex festvox-kallpc16k libestools1.2
</pre>

Per comprovar que funciona copiem al terminal la línia següent:

<pre>
 $ echo 'hello world!' | festival --tts
</pre>
Si funciona correctament i tenim la tarja de so ben configurada, escoltarem el text pels altaveus.

==== Instal·lem les veus ====

===== Amb repositoris (Només Ubuntu Jaunty 9.04 i Karmic 9.10) =====

Nota: Aquest procediment ha estat provat per Ubuntu Jaunty 9.04. Si teniu cap problema, indiqueu els detalls al <nowiki>[[http://ubuntuforums.org/forumdisplay.php?f=206|fòrum]]</nowiki>, i feu servir el procediment manual, ja provat, indicat a la secció següent (De forma manual).

Si tenim les veus instal·lades de forma manual, primer les hem de retirar, veieu l'apartat ''Desinstal·lació (versió manual)''

1. Al terminal, afegim la clau amb què s'ha firmat el codi:
<pre>
sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com A3A48C4A
</pre>

2. Afegim la font al repositori: Al menú Sistema | Administració | Fonts de programari, pestanya ''Programari de tercers'', botó ''Afegeix'', afegim la línia:
<pre>
deb http://ppa.launchpad.net/zeehio/festcat/ubuntu jaunty main
</pre>
Per a Ubuntu Karmic 9.10, canviem la paraula jaunty per karmic a la linia anterior.

Fem ''Afegeix la font'' i ''Tanca''.

3. Instal·lem les veus: Al menú Sistema | Administració | Gestor de paquets Synaptic, triem el botó ''Refresca'' i cerquem: festvox-ca, marquem la veu festvox-ca-upc-hts-ona i triem ''Aplica''. Opcionalment podem marcar altres veus.

====== Desinstal·lació (versió repositoris) ======
Per desinstal·lar-ho, copiem al terminal (demanarà la nostra contrasenya de la sessió):

<pre>
$ sudo apt-get remove festival-ca
$ sudo apt-get autoremove
</pre>

===== De forma manual (alres versions) =====

Nota (Gener 2010): per les altres versions només les veus són al repositori anterior, que es poden fer servir, però cal instal·lar les veus manualment, però per fer servir els repositoris, cal vigilar la versió de Festival necessària (falta completar).

1. Baixem els arxius de llengua i alguna veu de  http://gps-tsc.upc.es/veu/festcat/download/

<pre>
$ wget http://www.talp.cat/festcat/download/upc_ca_base.tgz
$ wget http://www.talp.cat/festcat/download/upc_ca_ona_hts.tgz
$ wget http://www.talp.cat/festcat/download/upc_ca_pau_hts.tgz
</pre>
Opcionalment, <nowiki>[[http://www.talp.cat/festcat/download.php|podem baixar altres veus]]</nowiki>.

2. Desempaquetem els arxius a la carpeta /usr/share/festival, copiant al terminal:

<pre>
$ sudo tar -C /usr/share/festival -zxf upc_ca_base.tgz
$ sudo tar -C /usr/share/festival -zxf upc_ca_ona_hts.tgz
$ sudo tar -C /usr/share/festival -zxf upc_ca_pau_hts.tgz
</pre>
(Si hem baixat més veus, les desempaquetem de la mateixa forma.)

Per comprovar que funciona en català copiem al terminal la línia següent:

<pre>
 $ echo 'hola mon' | festival --language catalan --tts
</pre>
Si funciona correctament i tenim la tarja de so ben configurada, escoltarem el text en català pels altaveus.

4. Per triar una veu en català per omisió, cal crear un arxiu de text a la carpeta de  l'usuari, el nom de l'arxiu ha de ser .festivalrc 

Sortim del Festival amb (exit), i fem:

<pre>
 $ gedit .festivalrc
</pre>
Al seu interior copiarem la línia següent, a la que podem triar qualsevol de les veus instal·lades

<pre>
 (set! catalan-default-voices (list 'upc_ca_ona_hts))
</pre>

Nota: Per llegir en altres llegües ara caldrà indicar-ho. Veiem l'apartat 10.

====== Desinstal·lació (versió manual) ======
Per desinstal·lar les veus catalanes, copiem al terminal (demanarà la nostra contrasenya de la sessió):

<pre>
$ sudo rm -R /usr/share/festival/upc_catalan
$ sudo rm -R /usr/share/festival/dicts/upc
$ sudo rm -R /usr/share/festival/voices/catalan
</pre>
Per desintal·lar el festival fem al terminal:

<pre>
$ sudo apt-get remove festival
$ sudo apt-get autoremove
</pre>

==== Configuració del dispositiu de só ====
Es suposa que tenim so a l'escriptori. En cas contrari, veiem altres guies com ara <nowiki>[[https://help.ubuntu.com/community/SoundTroubleshootingProcedure|Sound Troubleshooting Procedure]]</nowiki>.

Si ets un usuari nou i fas servir PulseAudio, no cal fer res.

Si ets un usuari nou i no fas servir PulseAudio (o PulseAudio et falla o tens problemes d'àudio):

En un terminal escriu:
<pre>
sudo apt-get install alsa-utils
sudo printf ";use ALSA\n(Parameter.set 'Audio_Method 'Audio_Command)\n(Parameter.set 'Audio_Command \"aplay -q -c 1 -t raw -f s16 -r \$SR \$FILE\")\n" > /etc/festival.scm
</pre>
Si portes temps fent servir Festival, pots provar el nou mòdul posant un ";" davant les línies dels fitxers /etc/festival.scm i ~/.festivalrc semblants a:
<pre>
(Parameter.set 'Audio_Method alguna_cosa)
(Parameter.set 'Audio_Command alguna_cosa)
</pre>
de manera que quedin:
<pre>
;(Parameter.set 'Audio_Method alguna_cosa)
;(Parameter.set 'Audio_Command alguna_cosa)
</pre>
=== Exemples d'ús ===
'''<nowiki>[[https://wiki.ubuntu.com/CatalanTeam/Tutorials/S%c3%adntesiDeVeu#head-df775a3f69baaef7dfdcb19563ea170d56429dd1|Cal que els arxius de text a convertir tinguin codificació latin-1]]</nowiki>'''

Veieu altres exemples a: http://www.talp.cat/festcat/download/LLEGEIX-ME

Segons l'opció que hem triat al pas anterior, ara tenim dues opcions:

Per llegir en veu alta la frase ''hola mon'', copiem al terminal la línia següent:

<pre>
 $ echo 'hola mon' | festival --language catalan --tts
</pre>
Per llegir en veu alta un arxiu anomenat ''arxiu.txt'' hi copiem:

<pre>
 $ festival --language catalan --tts arxiu.txt
</pre>
o bé:

<pre>
 $ cat arxiu.txt | festival --language catalan --tts
</pre>
Les instruccions originals són aquí: http://www.talp.cat/festcat/download/LLEGEIX-ME

'''Nota:''' atenció amb les rutes al desempaquetar, un petit error em feia que no funcionés!

==== Llegir amb Pidgin ====
Veieu aquest article: <nowiki>[[http://gnulinux.cat/2010/05/21/lordinador-parla-en-catala-festival-3-pidgin/|L’ordinador parla en català: Festival 3- Pidgin]]</nowiki>

==== Llegir amb Firefox ====
Veieu aquest article: <nowiki>[[http://gnulinux.cat/2010/05/22/lordinador-parla-en-catala-festival-4-firefox/|L’ordinador parla en català: Festival 4- Firefox]]</nowiki>

==== Llegir amb OpenOffice ====
Veieu aquest article: <nowiki>[[http://gnulinux.cat/2010/05/23/lordinador-parla-en-catala-festival-5-openoffice-org/|L’ordinador parla en català: Festival 5- OpenOffice]]</nowiki>

==== Més exemples ====
Podem veure com llegir l'hora en veu alta, fer-la servir amb OpenOffice i amb Orca per llegir la pantalla, i com generar arxius de so a <nowiki>[[Exemples]]</nowiki>

=== Codi per copiar al terminal ===
No és necessari fer aquest pas si hem fet el pas ''1. Instal·lació''

Obrim un terminal fent Aplicacions | Accessoris | Terminal i copiem això (demanarà la nostra contrasenya de la sessió):

<pre>
sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com A3A48C4A
source /etc/lsb-release
sudo echo "deb http://ppa.launchpad.net/zeehio/festcat/ubuntu $DISTRIB_CODENAME main" >> /etc/apt/sources.list
sudo apt-get update
sudo apt-get install festival festival-ca festvox-ca-upc-hts-ona
printf ";Catala per defecte:\n(set! language_default 'catalan)\n" > ~/.festivalrc
</pre>

Llavors podem provar que funciona en anglés, copiant al terminal:

<pre>
 $ echo 'hello world!' | festival --language americanenglish --tts
</pre>
(Si funciona correctament i tenim la tarja de so ben configurada, escoltarem el text pels altaveus)

i en català, copiant al terminal:

<pre>
 $ echo 'hola mon' | festival --tts
</pre>
=== Com convertir un arxiu de text a latin-1 ===
La codificació per omissió dels arxius a Ubuntu és UTF-8. Podem fer servir les opcions de guardar del editor gedit, o fer servir programes conversors de format, com iconv copiant al terminal (<nowiki>[[http://www.talp.cat/festcat/download/LLEGEIX-ME|Més]]</nowiki>):

<pre>
 $ iconv -f utf8 -t latin1 arxiu_utf8.txt > arxiu_latin1.txt
</pre>

'''Truc útil''': Si tenim un arxiu de text llarg en UTF-8, pot ser molt laboriós trobar els caràcters que no es podem convertir a latin-1. Si fem la conversió anterior amb iconv en donarà error: però si observem l'arxiu generat, aquest és trucarà exactament al primer caràcter que no es pot convertir, que ja tenim localitzat al nostre arxiu. El canviem i tornem a fer la conversió. Així els podem localitzar de forma sistemàtica. '''Si ets un expert en scripts de sustitució''' potser podràs preparar un script que els sustitueixi tots de cop! Si ho fas, <nowiki>[[http://ubuntuforums.org/showthread.php?t=806060|posa'l al fòrum]]</nowiki>!
=== Documents pdf ===
Per convertir un document pdf, resulta útil el programa pdftotext, que amb la següent ordre el converteix directament a latin1:

<pre>
sudo apt-get install poppler-utils
pdftotext -enc Latin1 -nopgbrk $@ $@.txt
</pre>

=== Com fer que Festival llegeixi també en anglés i / o castellà ===
Si hem triat que es faci servir la veu catalana quan no indiquem res (Veu el punt 1.5 més a munt), quan volguem llegir en castellà o en anglés - o en qualsevol altre llengua - caldrà indicar-ho.

Primer comprovem que tenim les veus instalades fent (La veu castellana és ''festvox-ellpc11k'' i la americana: ''festvox-kdlpc16k''):

<pre>
 $ sudo apt-get install festvox-ellpc11k festvox-kdlpc16k
</pre>
Per provar aquestes veus podem fer, per la veu castellana:

<pre>
 $ echo hola | festival --language spanish --tts
</pre>
i per la americana:

<pre>
 $ echo hello | festival --language americanenglish --tts
</pre>
=== Problemes coneguts ===
Mireu també a l'apartat ''Instal·lació'' la nota el dispositiu de so.

Cal millorar el tractament de signes de puntuació:

Sintetitzar 2 admiracions seguides "!!" no funciona bé.

Problema si la frase comença amb I majúscula: SIOD ERROR: comma-not-inside-backquote 

Millorar la lectura de les lliste numerades

==== Amb algunes paraules, s'obté aquest error ====

<pre>
 SIOD ERROR: the currently assigned stack limit has been exceded
</pre>
Cal actualitzar la versió de Festival.

Aquest problema és dona quan es troba una paraula amb una majúscula repetida com ara ''TamTam'' , o amb el punt volat '·' i està sent corregit pels desenvolupadors. Mentrestant podem convertir una d'aquestes lletres a minúscula, i canviant els punt volats per punts corrents '.'.

Nota: El TALP està treballant en una millora que ho soluciona. Quan estigui llesta ho afegirem aquí. (Solucionat!)

===== Coses a fer =====
Falta suport a UTF8. (Hi estem treballant)

Cal poder pronunciar paraules amb caràcters estrangers.

Preparar un paquet Debian amb els scripts per posar-lo al repositori, de manera que es puguin actualitzar amb facilitat.

==== Textos en format UTF-8 ====

Festival espera arxius de text en codificació latin-1. Si el text conté caràcters que no són en aquesta codificació, també donarà error. Antonio Bonafonte ha fet un script en perl que substitueix els caràcters:

<pre>

chomp;

$debug=0;

if ($debug) {

    s{([^- \t\n\ra-z0-9áàéèíìóòúùüïçñA-ZÁÀÉÈÍÌÓÒÚÙÜÏÇÑ\[\]\{\}ºª\\!\|\"@·#\$~%&/()=?'¿¡*+_.:,;<>€])}{#$1#}g;

} else {

    s{([^- \t\n\ra-z0-9áàéèíìóòúùüïçñA-ZÁÀÉÈÍÌÓÒÚÙÜÏÇÑ\[\]\{\}ºª\\!\|\"@·#\$~%&/()=?'¿¡*+_.:,;<>€])}{ }g;

}

print "$_\n";
</pre>

Per fer-lo servir, li donem permisos d'execució i fem:
<pre>
perl festcat_neteja.pl arxiu.txt > arxiu.net
</pre>

=== Millores ===
Si trobeu alguna solució, podeu afegir-la a aquest wiki, editant-lo, o comentar-ho al fòrum: http://ubuntuforums.org/showthread.php?t=806060 Fora interessant per exemple:

1. (Fet) Simplificar les ordres per desempaquetar els arxius, que segurament es pot fer de forma més eficient.

2. (Fet - veieu més amunt, el punt 4. de 'De forma manual') Poder indicar la llengua o veu per omissió, per no haver de dir cada cop que volem la llengua catalana. Potser es podria indicar a l'arxiu .festivalrc ( http://www.math.ias.edu/doc/festival-1.4.2/festival_6.html#SEC15 )

3. Trobar alguna eina gràfica - a més de l'Orca - que fes servir les veus en català, pels que ho prefereixen a fer servir la consola, com ara eSpeak o KSayit.

4. Determinar les condicions del problema o trobar una solució per convertir arxius de text en format UTF-8 (Veieu 9.2 Problemes coneguts). (Hi estem treballant).

=== Referències ===

Fòrum: http://ubuntuforums.org/showthread.php?t=806060 (ha servit per començar aquest document)

Síntesi de veu a Ubuntu amb Festival: https://help.ubuntu.com/community/TextToSpeech (en anglès)

Festival: http://www.cstr.ed.ac.uk/projects/festival/ <nowiki>[[http://www.cstr.ed.ac.uk/cgi-bin/cstr/lists.cgi?config=festival_faq|FAQ]]</nowiki> (en anglès)

Festcat: http://gps-tsc.upc.es/veu/festcat/ (veus catalanes)

Festcat a launchpad: https://launchpad.net/~zeehio/+archive/festcat

Configuració de só alsa / oss <nowiki>[[https://help.ubuntu.com/community/TextToSpeech|TextToSpeech]]</nowiki>. (en anglès)

SIOD: http://www.cs.indiana.edu/scheme-repository/imp/siod.html (en anglès)

ReadText: http://extensions.services.openoffice.org/node/2649 (en anglès

Gestor d'extensión de l'OpenOffice: http://wiki.services.openoffice.org/wiki/Documentation/Administration_Guide/Using_Package_Manager (en anglès

<nowiki>[[http://ubuntuforums.org/showthread.php?t=751169|HOWTO: Make festival TTS use better voices (MBROLA / CMU / HTS)]]</nowiki>

Crèdits: <nowiki>[[http://gps-tsc.upc.es/veu/personal/antonio/index.php3|Antonio Bonafonte]]</nowiki>, <nowiki>[[https://launchpad.net/~zeehio|Sergi Oller]]</nowiki>, <nowiki>[[http://pacoriviere.cat/|PacoRivière]]</nowiki> http://galindaines.blogspot.com/
----
CategoryTutorialsEnCatala
