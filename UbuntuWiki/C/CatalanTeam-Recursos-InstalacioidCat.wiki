{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

Aquest tutorial pretén ser una guia bàsica que com instal·lar el <nowiki>[[http://www.idcat.net|clauer idCAT]]</nowiki> a <nowiki>[[http://ubuntu.cat|Ubuntu]]</nowiki>. Ja que per Internet hi han molts tutorials, però
almenys els que jo he revisat o estan desfasats per a Natty i Oneiric o bé
son un pèl ambigús.

Aquest tutorial esta comprovat a Natty i a Oneiric, la cual cosa pot
significar que en altres versions immediatament anteriors i posteriors
pot anar bé. Per versions bastant més antigues o noves, s'haura de
comprovar.

Primer de tot, el de sempre, actualitzeu tant el repositori de paquets,
com les versions de paquets instal·lats.

<pre>
</pre>

Una vegada fet això, inseriu el vostre Clauer idCAT en un port USB i
comproveu que la llumeta roja del Clauer parpellege. Si no parpellege,
mal rollo en principi.

 <pre>
$ lsusb
ID 0204:6025 Chipsbank Microelectronics Co., Ltd CBM2080 Flash drive controller
</pre>

Entre altres dispositius USB que tingueu connectats, us ha de sortir el
següent d'aquí dalt.

Bé, ara ja ho tenim tot llest per a començar la feina.
Del programari propi que porte el Clauer, ni ens el mirarem, ens
baixarem el de l'enllaç [1] i l'instal·larem de la web del idCAT.

<pre>
$ wget --no-check-certificate -c https://www.idcat.net/idcat/jsp/bin/clauer/linux/ClauerLinux-3.0.4.tar
$ md5sum ClauerLinux-3.0.4.tar
6299af2b8167a6c7e5be58667b9f3395  ClauerLinux-3.0.4.tar
$ tar xvf ClauerLinux-3.0.4.tar
</pre>

Ara ens mirarem el fitxer README, no ens diu que necessiti cap paquet
adicional per al seu funcionament, per tant, seguirem els passos
d'instal·lació:

 <code>$ ./configure</code>

Però el `./configure` ens diu que necesssite un munt de programari per a
funcionar ... :

<pre>
checking for working aclocal-1.4... missing
checking for working autoconf... missing
checking for working automake-1.4... missing
checking for working autoheader... missing
checking for working makeinfo... missing
checking for g++... no
checking for c++... no
checking for gpp... no
checking for aCC... no
checking for CC... no
checking for cxx... no
checking for cc++... no
checking for cl.exe... no
checking for FCC... no
checking for KCC... no
checking for RCC... no
checking for xlC_r... no
checking for xlC... no
checking whether the C++ compiler works... no
configure: error: in `/home/xxavi/Baixades/ClauerLinux-3.0.6':
configure: error: C++ compiler cannot create executables
See `config.log' for more details
</pre>

... Gràcies gent de idCAT per el vostre detallat README.

Doncs bé, li donarem al programari del Clauer, <nowiki>[[http://packages.ubuntu.com/search?keywords=automake&searchon=names&suite=natty&section=all|el menjar que necessite]]</nowiki>:

 <code># apt-get install automake1.4 automake1.9 automake1.9-doc</code>

Com que això és un tutorial, anirem pas a pas, per explicar cada pas.
Tornem a fer ara un `./configure`, per veure si ha variat alguna cosa:

<pre>
checking for working aclocal-1.4... found
checking for working autoconf... found
checking for working automake-1.4... found
checking for working autoheader... found
checking for working makeinfo... missing
checking for g++... no
checking for c++... no
checking for gpp... no
checking for aCC... no
checking for CC... no
checking for cxx... no
checking for cc++... no
checking for cl.exe... no
checking for FCC... no
checking for KCC... no
checking for RCC... no
checking for xlC_r... no
checking for xlC... no
checking whether the C++ compiler works... no
configure: error: in `/home/xxavi/Baixades/ClauerLinux-3.0.6':
configure: error: C++ compiler cannot create executables
See `config.log' for more details
</pre>

Bé, ja en tenim quatre de trobats, que abans no els teníem! Ja és un
gran èxit, ara anem a per els altres:

 <code># apt-get install texinfo texinfo-doc-nonfree</code>

Tornem a fer el `./configure` i veiem el següent:

<pre>
$ ./configure | grep makeinfo...
checking for working makeinfo... found
</pre>

Bé, ara ja tenim els cinc de dalt, anem a per els altres:

 <code># apt-get install libconfig++8 libconfig++8-dev libpng++-dev</code>

Tornem a fer el `./configure` i veiem el següent, que va fent durant una
estoneta i s'atura amb:

<pre>
checking for RSA_sign in -lcrypto... no
configure: WARNING: We can't links against the ssl library
configure: error: Perhaps you need to use the --with-ssl-libraries directive
</pre>

Però el que m'interessave veure ara, ere si havie instal·lat correctament
el g++, veiem-ho:

<pre>
$ ./configure | grep g++
checking for g++... g++
checking whether g++ accepts -g... yes
checking whether g++ accepts -g... (cached) yes
checking how to run the C++ preprocessor... g++ -E
checking for ld used by g++... /usr/bin/ld
checking whether the g++ linker (/usr/bin/ld) supports shared libraries... yes
checking for g++ option to produce PIC... -fPIC -DPIC
checking if g++ PIC flag -fPIC -DPIC works... yes
checking if g++ static flag -static works... yes
checking if g++ supports -c -o file.o... yes
checking if g++ supports -c -o file.o... (cached) yes
checking whether the g++ linker (/usr/bin/ld) supports shared libraries... yes
</pre>

Es veu que si !

Ara fixem-nos què vol per a postre el Clauer:

<pre>
configure: WARNING: We can't links against the ssl library
configure: error: Perhaps you need to use the --with-ssl-libraries directive
</pre>

Com ja va sent habitual en aquest tutorial, tornem al cercador de
paquets de l'Ubuntu, <nowiki>[[http://packages.ubuntu.com/search?keywords=ssl&searchon=names&suite=natty&section=all|aviam què trobem]]</nowiki>:

I instal·lem els següents:

 <code># apt-get install ssl-cert ssldump sslh sslscan sslsniff</code>

Tornem a fer el `./configure`, ja habitual i:

<pre>
checking for RSA_sign in -lcrypto... no
configure: WARNING: We can't links against the ssl library
configure: error: Perhaps you need to use the --with-ssl-libraries directive
</pre>

Ens diu el mateix, i es que el cercador web de paquets[3] de l'Ubuntu
no es massa bo que diguem ...

Fem una cerca per Internet i veiem que el que vol és <nowiki>[[http://packages.ubuntu.com/search?keywords=libssl&searchon=names&suite=natty&section=all|el següent]]</nowiki>:

 <code># apt-get install libssl-dev libssl-ocaml libssl-ocaml-dev</code>

Bé, ara tornem a executar l'ordre `./configure` i veiem que no es queixe
de res, senyal que ha quedat tip i satisfet, ara li farem fer el rotet, amb
un `make`, tal i com ens diu el README. I ara ens transformem amb
super usuari, és a dir, entrem al sistema com a root, mitjançant l'ordre
`su` i fem l'oportú `make install`. Sembla ser que tot a anat bé, i ara ens
fixe'm amb el que ens diu el README:

- He aprofitat i he instal·lat algun programari de més ( paquets ),
d'aquesta forma ja els tindre per a altres usos. -

 <code>$ less -N README</code>

Fixem-nos en les línies 35 a 37, per fer això, entrarem a l'entorn gràfic i
des de un interpret d'ordres d'allà, executarem l'ordre que ens diu amb
el Firefox tancat.

En aquest pas es on hi ha una mica de problemes i confusió, m'explicaré
el millor que sabre, però amb l'advertiment que no sóc cap expert en el
tema.

En primer lloc comentar que, quan ens baixem la versió:

<pre>
$ md5sum ClauerLinux-3.0.4.tar
6299af2b8167a6c7e5be58667b9f3395  ClauerLinux-3.0.4.tar
</pre>

Aquesta versió en realitat no és la 3.0.4 del Clauer. Sinó la 3.0.6 ho
podem veure en el numero de directori que cree al descomprimir:

 <code>ClauerLinux-3.0.6</code>

I que com a mínim han modificat el fitxer `pkcs11/firefox-installpkcs11.sh`
que conté aquest programari per a que s'instal·li correctament
en versions anteriors a la 6 del Firefox, sigui arrel d'<nowiki>[[http://llistes.cpl.upc.edu/pipermail/ubuntucat-info/2011-August/015952.html|aquesta queixa]]</nowiki>
o per casualitat.

Però ara que aquesta aparent versió 3.0.6 del Clauer funcione a Natty
( gràcies ), per Oneiric, què !?

A Oneiric, tenim de serie el Firefox 6:

<pre>
$ firefox -v
Mozilla Firefox 6.0
</pre>

Al executar el `firefox-install-pkcs11.sh` tal i com ens diu el README, el
Firefox ens diu:

 <code>Instal-lador de mȯdul criptogrȧfic del Clauer per a Mozilla could not be installed because it is not compatible with Firefox 6.0.</code>

És a dir, que volen fer-nos la vida mes còmoda, amb el connector XPI
( `clauerPK11inst.xpi` ) a Oneiric ens troben exactament en la mateixa
situació que a Natty amb la versió 3.0.4 del Clauer i és la següent:

Això val per a Oneiric amb qualsevol versió moderna del programari del
Clauer i per a Natty amb versions anteriors del Clauer a la 3.0.6, és a
dir, la 3.0.4 i anteriors:

Ens identifiquem com a super usuari i ens col·loquem al directori arrel i
cerquem el fitxer següent:

 <code># find -name libclauerpkcs11.so ./usr/lib/libclauerpkcs11.so</code>

Ens anotem la situació del fitxer per entrar-la al menú del '''Firefox ->
Editar -> Preferencies -> Avançat -> Dispositius de seguretat ->
Carrega'''

Aquí posem el nom que vulgueu per al nou dispositiu com per exemple
«Clauer idCAT» i anem a '''Navega''' i naveguem pels directoris fins a
localitzar el `/usr/lib/libclauerpkcs11.so`, una vegada localitzat polsem
'''D'acord''' i '''D'acord''', dos cops i si tot a anat bé, ja tenim el controlador del
Clauer idCAT carregat al Firefox, provem-ho!: Polsant al boto '''Inicia
una sessió''', ens demanara la contrasenya que se'ns ha proporcionat en
el full adjunt a l'entrega del Clauer idCAT.

Com a comentari, comentar que jo l'he provat per exemple a la web del
ministeri oportú que emet els informes de Vida Laboral español i
funcione correctament. En canvi m'he trobat que en altres ministeris
espanyols que teòricament accepten el idCAT no em funciona però amb
el DNIe si ...

Com que aquest tutorial només pretén ser un tutorial d'instal·lació, no
m'estendré més.

 . [1] <nowiki>[[http://www.idcat.net]]</nowiki>

Aquest tutorial l'he fet pas a pas, ja que va dirigit a usuaris novells en
* IX.

Qualsevol errada, comentari, etc. agrairia que me'l féssiu arribar a
xxavidCAT@gmail.com.

Aquest tutorial està sota la <nowiki>[[http://www.freebsd.org/copyright/freebsd-doc-license.html|Llicencia FreeBSD Documentation License]]</nowiki>

L'autor d'aquest tutorial respon al pseudònim de xxavi a Internet.
