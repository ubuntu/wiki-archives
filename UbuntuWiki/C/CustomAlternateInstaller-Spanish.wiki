{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

== Creación de un CD de instalación Alternate personalizado ==

Nota: Esta página esta en construcción. Cuando esté terminada voy a intentar traducirla al ingles.

== Armado del CD Personalizado de Intaslación de Ubuntu Feisty Fawn ==
=== Características de la personalización ===
La personalización consiste en tres aspectos fundamentales. Se puede:
* Modificar el initrd que carga por defecto (osea el SO linux que carga donde esta el instalador)
* Imponer un '''archivo preseed''' de configuraciones previas
* Modificar paquetes udeb del CD
* Agregar o quitar paquetes del repositorio

=== Procedimiento ===
==== Copiar el CD actual ====
Montar el CD
<pre>
mkdir -p original
mount -o loop ubuntu-7.04-alternate-i386.iso original
</pre>
Copiar el contenido
<pre>
cp -a original nuevo
</pre>
==== Modificar paquetes ====
Al levantar el sistema de instalación se instalan en este algunos paquetes .udeb que son utilizados por el propio sistema de instalación y cumplen diversas funciones. Entre ellas, por ejemplo, configurar los repositorios:
{{{ 
./pool/main/a/apt-setup/apt-mirror-setup_0.16ubuntu4_all.udeb
./pool/main/a/apt-setup/apt-cdrom-setup_0.16ubuntu4_all.udeb
./pool/main/a/apt-setup/apt-setup-udeb_0.16ubuntu4_all.udeb
}}}
Si se necesitan cambiar la ''forma en que se configuarn los repositorios'' se pueden editar estos archivos. Por ejemplo, si tenemos copia local de los repositorios binarios de ubuntu, pero no de los src por cuestion de espacio, podríamos querer modificar la forma en que se crea el /etc/apt/source.list rearmando estos paquetes a nuestra medida.

<code> apt-mirror-setup_0.16ubuntu4_all.udeb </code>

Desarmamos el paquete:
{{{ 
mkdir apt-mirror-setup
cd apt-mirror-setup
ar xf ../apt-mirror-setup_0.16ubuntu4_all.udeb
mkdir data
cd data
tar -xzf ../data.tar.gz
}}} 

Editas lo que necesitas. Yo comenté las lineas deb-src del archivo
{{{ 
vim usr/lib/apt-setup/generators/50mirror.ubuntu
}}} 
Rearmamos el paquete:
<pre>
tar -czf ../data.tar.gz .
cd ..
ar r apt-mirror-setup_0.16ubuntu4_all.udeb data.tar.gz control.tar.gz debian-binary
</pre>

Luego hay que colocar el paquete en el CD en reemplazo del original
<code>cp apt-mirror-setup_0.16ubuntu4_all.udeb nuevo/pool/main/a/apt-setup/apt-mirror-setup_0.16ubuntu4_all.udeb</code>
Al reemplazar archivos en el cd es necesario actualizar el hash md5 en el repositorio.
Por ejemplo, este paquete pertenece al repositorio de instalacion cuyo archivo de control es: <code>nuevo/dists/feisty/main/debian-installer/binary-i386/Packages</code>
Hay que editarlo y buscar el paquete en cuestion:

<pre>
Package: apt-mirror-setup
Priority: extra
Section: debian-installer
Installed-Size: 276
Maintainer: Ubuntu Installer Team <ubuntu-installer@lists.ubuntu.com>
Architecture: all
Source: apt-setup
Version: 1:0.16ubuntu4
Depends: choose-mirror-bin, cdebconf-udeb
Filename: pool/main/a/apt-setup/apt-mirror-setup_0.16ubuntu4_all.udeb
Size: 81356
MD5sum: 735e91942f687cad7ad3dc91248d8be3
 Description: set up a mirror in sources.list
 Original-Maintainer: Debian Install System Team <debian-boot@lists.debian.org>
</pre>

hay que cambiar el campo '''MD5sum''' por lo que tire el comando:
<pre>
md5sum nuevo/pool/main/a/apt-setup/apt-mirror-setup_0.16ubuntu4_all.udeb
</pre>
y luego guardar tambien una copia comprimida del archivo Packages modificado:
<pre>
cat nuevo/dists/feisty/main/debian-installer/binary-i386/Packages| gzip > nuevo/dists/feisty/main/debian-installer/binary-i386/Packages.gz
</pre>
En un repositorio VALIDADO el archivo Packages debería estar firmado por GPG con la clave del distribuidor.
Como no poseemos dicha clave quedan dos opciones. O se arma el repositorio con los propios keys de GPG alterando el instalador y haciendo varias modificaciones de las que no tengo mucho conocimiento, o especificar en el archivo '''preseed''' que NO VALIDE LOS REPOSITORIOS

==== Modificar preseed ====
falta completar

==== Crear el CD ====
Primero rearmamos el archivo de comprobación md5sum.txt
 cd nuevo
 mv md5sum.txt md5
 cat md5 |cut -d ' ' -f 3 | xargs md5sum > md5sum.txt
 rm md5

Luego creamos la ISO
<pre>
mkisofs \
   -o ubuntu-7.04-Ludix-alternate-i386.iso \
   -b isolinux/isolinux.bin \
   -c isolinux/boot.cat \
   -no-emul-boot \
   -boot-load-size 4 \
   -boot-info-table \
   -r \
   -V "Ludix Ubuntu Feisty Fawn" \
   -cache-inodes  \
   -J \
   -l \
   nuevo
</pre>
