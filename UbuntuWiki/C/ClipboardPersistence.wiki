{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


Clipboard persistence is a bug that affects many programs under Ubuntu and other X11-based operating systems. Fixing it is a Google Summer of Code 2010 project. Wikipedia has a good <nowiki>[[http://en.wikipedia.org/wiki/Clipboard_manager|overview]]</nowiki> of the issue. If you want to fix as a user, you can install <nowiki>[[http://parcellite.sourceforge.net/?page_id=16|Parcellite]]</nowiki> or another clipboard manager. If you want to fix it as a programmer, you can modify your program to conform to <nowiki>[[http://freedesktop.org/wiki/ClipboardManager|the ClipboardManager specification]]</nowiki>. 

=== The problem: data loss on quit ===

If you copy something from an affected application and then close it, you'll have an empty clipboard.

=== Workaround: Clipboard Managers ===

If you want to fix this problem on your machine, you can install a clipboard manager that should solve it. I recommend <nowiki>[[http://parcellite.sourceforge.net/?page_id=16|Parcellite]]</nowiki>. It's available in the universe repositories, and you can install it with:

<code> sudo apt-get install parcellite </code>

When you restart your computer or run it manually from Programs>Accessories>Parcellite, you'll have a panel applet that quietly saves a history of all your copies. You won't have to go look at the history to resurrect your copied text. Copy, quit, paste should just work.

Parcellite is also <nowiki>[[http://parcellite.sourceforge.net/?page_id=10|available]]</nowiki> for other distributions.

Similar programs include
* Klipper, a part of KDE
* Glipper, an alternative for the Gnome environment
* Clipman, for XFCE

== Development ==

=== Why does this happen? ===

The problem happens because Xorg takes a conservative approach to copying. It copies only a reference to the original data when the user performs a select or copy. It doesn't go and retrieve the actual data from the source program until the user requests a paste. It saves a lot of unneeded transfer of data this way, at the expense of having no way of retrieving data from a closed program that hasn't saved its clipboard somewhere else. 

=== How to test it ===

* Maintaining the selection buffer after quit is optional. Some developers think that since the selection is not visible after quit, the clipboard buffer should not be available either. Try both buffer (select and ctrl-C) before you report a bug.
* Many applications are fixed for simpler situations like entry boxes in preference dialogs but broken for main text input fields. Make sure you're clear about which aspect of the user interface you're testing.
* Some applications treat rightclick->copy differently from ctrl-C copy. Most notably, a terminal emulator such as gnome-terminal will intercept mouse clicks but not ctrl-C. This means that all console applications run in gnome-terminal are fixed for mouse copy/paste, no matter what their behaviour for system clipboard access through the keyboard. Make sure you test them both.

=== How to fix it: the ClipboardManager spec ===

<nowiki>[[http://freedesktop.org/wiki/ClipboardManager|Freedesktop's ClipboardManager specification]]</nowiki> comes to the rescue. Gnome settings daemon, the component of Ubuntu that handles all copying and pasting by default, conforms by allowing applications to explicitly request to save their clipboard contents in a safe place. Applications conform by requesting a save before they exit. Everything gets squared away before a quit and we don't lose any data.

==== GTK+ ====

Pure Gnome applications that use standard features like !TextViews are automatically supported.

Applications that use GTK+ features can provide persistence by
* setting <nowiki>[[http://library.gnome.org/devel/gtk/stable/gtk-Clipboards.html#gtk-clipboard-set-can-store|set_can_store]]</nowiki> on clipboard contents whenever they gain ownership of the clipboard
* saving clipboard contents on quit with <nowiki>[[http://library.gnome.org/devel/gtk/stable/gtk-Clipboards.html#gtk-clipboard-store|gtk_clipboard_store]]</nowiki>

There's room for improvement in support for this specification, and there's a bug filed against it <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=510230|here]]</nowiki>.

==== Xlib ====

Xlib provides a variety of selection management functions that <nowiki>[[http://old.nabble.com/CLIPBOARD-selection-doesn't-save-content-td28122974.html|can be used]]</nowiki> to store clipboard data. <nowiki>[[http://michael.toren.net/mirrors/doc/X-copy+paste.txt|Here]]</nowiki>'s a great introduction to Xlib clipboard functions, but be aware that the document is twelve years old and written before the existence of the !ClipboardManager specification.

=== The state of things ===

There are very few applications that conform to the !ClipboardManager standard, and we believe that few developers are even aware of the problem. It has notably been fixed, however, in Firefox, most Gnome applications, Evolution, and Pidgin.

==== SoC ====
There is currently (2010) a Summer of Code project for Ubuntu devoted to fixing the problem. Please contact SarahStrong for updates.

==== Fixed Applications ====

* Firefox ( and Thunderbird, other Xulrunner apps): <nowiki>[[https://bugzilla.mozilla.org/show_bug.cgi?id=311340|Report]]</nowiki>, <nowiki>[[http://hg.mozilla.org/mozilla-central/rev/270a70535807|Patch]]</nowiki>. The fix is not yet released as a part of any of the above applications' default installation in Ubuntu Lucid.
* Evolution: <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=258374|Report]]</nowiki>, <nowiki>[[http://bugzilla-attachments.gnome.org/attachment.cgi?id=94407|Patch]]</nowiki>. Note: fixed in 2.29, but current version in Lucid is 2.28.3
* Pidgin: <nowiki>[[http://developer.pidgin.im/ticket/391|Report]]</nowiki>, <nowiki>[[http://developer.pidgin.im/viewmtn/revision/info/4ced433906d17bb2758a2b010ce264314d17fe04|Patch]]</nowiki>. Note: this fixes only the case of making clipboard contents available after you've closed the chat window, not after closing the entire program.
* Webkit, including Empathy, Epiphany, and Gwibber <nowiki>[[https://bugs.webkit.org/show_bug.cgi?id=27411|Patch accepted as part of GSOC]]</nowiki>
* Bluefish <nowiki>[[http://www.mail-archive.com/debian-bugs-closed@lists.debian.org/msg13556.html|Confirmed fixed]]</nowiki>

==== Broken Applications ====

* Tomboy <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=622049|Patch submitted as part of GSOC]]</nowiki>
* Chromium: <nowiki>[[http://code.google.com/p/chromium/issues/detail?id=32291|Report]]</nowiki>: may be a wontfix, <nowiki>[[http://src.chromium.org/svn/trunk/src/app/clipboard/clipboard_linux.cc|Relevant section]]</nowiki>
* !OpenOffice.org: <nowiki>[[http://www.openoffice.org/issues/show_bug.cgi?id=63092|Confirmed]]</nowiki>
* !GnuCash: <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=510205|Confirmed]]</nowiki>
* GIMP: <nowiki>[[https://bugzilla.gnome.org/show_bug.cgi?id=510204|Confirmed]]</nowiki> for text, works for graphics
* Eclipse: <nowiki>[[https://bugs.eclipse.org/bugs/show_bug.cgi?id=317255|Confirmed]]</nowiki>
* Abiword : <nowiki>[[http://bugzilla.abisource.com/show_bug.cgi?id=12748|Confirmed]]</nowiki>
* Inkscape
* Planner
* xCHM
* Chmsee
* Coq
* Eric
* !MonoDevelop
* Netbeans
* Vim
* IDLE
* Pyshell
* Midori

==== Working Applications ====

Here's a list of applications that are working but with no evidence that someone explicitly worked on a fix. They may never have needed fixing on their own because the developers involved were aware of the ClipboardManager specification, or they may be fixed by merit of using GTK+ elements such as TextBuffers that take care of clipboard management without extra developer involvement.

* Gnome terminal
* Gedit
* Geany 
* Evince
* Gnumeric
* Gedit - note that the initial implementation of GSD-clipboard-manager was designed to target gedit
* Getting Things Gnome
* Okular
* Homebank
* Pyroom
* Gnote
* Mousepad
* Leafpad
* Xchat and Xchat Gnome
* Balsa
* Claws
