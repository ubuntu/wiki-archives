{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

This is a draft step-by-step instruction about how to create a permanent pbuilder chroot. The permanent chroot does not need to be unpacked, thus using it speeds up your pbuilder builds. However: consider the result a ''dirty'' environment to do some quick builds in: in the end you will need to test build in a normal, clean pbuilder chroot.

The general idea is to force pbuilder into not cleaning up the chroot by generating an error. The error is generated with an update hook. After that you can use the chroot with the <code>--buildplace</code> option. For details about pbuilder hooks and the options used below: see the pbuilder(1) manual page.

This is a first draft. Please ''do'' send me your feedback. My contact info is on https://launchpad.net/~mouz.

If you have not done so already, create a normal pbuilder chroot: 
<pre>
$ sudo pbuilder create
</pre>

Create a script that generates an error (replace <code>/path/to/hooks</code> with some convenient path):
<pre>
$ mkdir -p /path/to/hooks/disabled/
$ cat > /path/to/hooks/disabled/error
echo
echo ERROR IS DELIBERATE.
exit 127
^D
$ chmod +x /path/to/hooks/disabled/error
</pre>

Create a symbolic link to make it an update hook:
<pre>
$ cd /path/to/hooks/
$ ln -s ./disabled/error E00error
</pre>

Make sure there are no other symlinks or scripts in <code>/path/to/hooks/</code>.
Then use the script as a pbuilder hook:
<pre>
$ sudo pbuilder update \
   --hookdir /path/to/hooks/ \
   --debug
...
++ basename /var/cache/pbuilder/build//54321/tmp/hooks/E00error
+ chroot /var/cache/pbuilder/build//54321 tmp/hooks/E00error

ERROR IS DELIBERATE.
$ 
</pre>

Pbuilder will not clean up the unpacked environment (which is what you want). Make a note of its location, ex. <code>/var/cache/pbuilder/build/54321/</code>.

Unmount the mounts left behind:
<pre>
$ sudo umount /var/cache/pbuilder/build/54321/proc
$ sudo umount /var/cache/pbuilder/build/54321/dev/pts
</pre>

Remove the symbolic link to disable the update hook:
<pre>
$ rm /path/to/hooks/E00error
</pre>

You can build in this environment using the <code>--no-targz</code> option:
<pre>
$ sudo pbuilder build \
	--no-targz \
	--buildplace /var/cache/pbuilder/build/54321 \
        <foo-1.2-3ubuntu4>.dsc
</pre>

The build result can be found in <code>/var/cache/pbuilder/build/54321/tmp/buildd/</code>. Any Build-Depends installed and anything else you do in this chroot will be preserved, which is an important reason to consider this chroot 'quick and dirty'.

====== see also ======
* pbuilder setup and usage: PbuilderHowto
* pbuilder user manual: http://www.netfort.gr.jp/~dancer/software/pbuilder-doc/pbuilder-doc.html
* manual page: pbuilder(1)
* alternative permanent chroot setup: DebootstrapChroot
