{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

<pre>

set -e

winroot=
docroot=
sysroot=
winuser=
tempbookmarks=
bookmarks=$HOME/.mozilla/firefox/*.default/bookmarks.html

import_bookmark_level() {
# Loop through subdirectories first
	find "$1" -maxdepth 1 -mindepth 1 -type d | \
	while read i
	do
		echo "<DT><H3>`basename "$i"`</H3>" >> $tempbookmarks
		echo "<DL><p>" >> $tempbookmarks
		import_bookmark_level "$i/"
		echo "</DL><p>" >> $tempbookmarks
	done

# Loop through .url files (where IE stores bookmarks)
	find "$1" -maxdepth 1 -name "*.url" | \
	while read i
	do
		bmhref=`grep "^URL=" "$i" | sed 's|URL=||' | sed 's/.$//'`
		bmname=`basename "$i" .url`
		echo "<DT><A HREF=\"$bmhref\">$bmname</A>" >> $tempbookmarks
	done
}

import_bookmarks() {
	if <nowiki>[[ -n "`ps -A | grep firefox`" ]]</nowiki>
	then
		zenity --error --text 'Firefox is open! Please close it and restart this program!'
		exit 1
	else
## Inserts our imported bookmarks into Firefox's bookmark file
		tempbookmarks=`mktemp`
		
## Takes everything but the last line
		cat $bookmarks | sed '$d' > $tempbookmarks
		
## Inserts new bookmarks
		echo "<DT><H3>Imported IE Favorites</H3>" >> $tempbookmarks
		echo "<DL><p>" >> $tempbookmarks
		import_bookmark_level "$docroot/$winuser/Favorites/"
		echo "</DL><p>" >> $tempbookmarks
		
## Finish it off
		echo "</DL><p>" >> $tempbookmarks
		
## Atomic baby
		mv $tempbookmarks $bookmarks
	fi
}

import_firefox_bookmarks() {
	if <nowiki>[[ -n "`ps -A | grep firefox`" ]]</nowiki>
	then
		zenity --error --text 'Firefox is open! Please close it and restart this program!'
		exit 1
	else
## Inserts our imported bookmarks into Firefox's bookmark file
		tempbookmarks=`mktemp`
		profile=`cat "$docroot/$winuser/Application Data/Mozilla/Firefox/profiles.ini" | grep Path= | sed 's/Path=//' | sed 's/.$//'`

## Takes evverything but the last line
		cat $bookmarks | sed '$d' > $tempbookmarks
		
## Inserts new bookmarks
		cat "$docroot/$winuser/Application Data/Mozilla/Firefox/$profile/bookmarks.html" | sed '1,/<TITLE>/d' | sed '1 s/Bookmarks/Imported Firefox Bookmarks/' | sed '1 s/H1/H3/g' | sed 's/ID="*"//' | sed 's/PERSONAL_TOOLBAR_FOLDER="true"//' >> $tempbookmarks
		
## Finish it off
		echo "</DL><p>" >> $tempbookmarks
		
## Atomic baby
		mv $tempbookmarks $bookmarks
	fi	
}

ask_import() {
	zenity --list --checklist --column Import? --column Settings --text "Choose settings to import:" TRUE "IE Favorites" TRUE "Firefox Bookmarks" TRUE Wallpaper
}

ask_user() {
	while <nowiki>[[ -z "$winuser" ]]</nowiki>
	do
		winuser=`ls "$docroot" | sed '/All Users\|Default User\|LocalService\|NetworkService/d' | zenity --list --column User --text "Migration Wizard has found these users. Select one:"`
		if <nowiki>[[ -n `echo "$winuser" | grep '|'` || -z "$winuser" ]]</nowiki>
		then
			zenity --error --text 'Please select -one- user!'
			unset winuser
		fi
	done
}

find_winroot() {
	for i in /media/*
	do
		tmp=`find $i -maxdepth 1 -iname "documents and settings"`
		if <nowiki>[[ -n "$tmp" ]]</nowiki>
		then
			winroot=$i
			docroot=$tmp
			sysroot=`find $i -maxdepth 1 -iname "windows"`
			echo "Found Windows drive at $winroot..."
		fi
	done
}

find_winroot

ask_user

import=`ask_import`

if <nowiki>[[ -n `echo $import | grep "IE Favorites"` ]]</nowiki>
then
	import_bookmarks
fi

if <nowiki>[[ -n `echo $import | grep "Firefox Bookmarks"` ]]</nowiki>
then
	import_firefox_bookmarks
fi

if <nowiki>[[ -n `echo $import | grep Wallpaper` ]]</nowiki>
then
	mkdir -p "$HOME/Pictures/Wallpapers/"
	cp "$docroot/$winuser/Local Settings/Application Data/Microsoft/Wallpaper1.bmp" "$HOME/Pictures/Wallpapers/Imported.bmp"
	gconftool-2 --type string --set /desktop/gnome/background/picture_filename "$HOME/Pictures/Wallpapers/Imported.bmp"
fi
</pre>
