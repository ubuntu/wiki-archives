{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

=== The script ===

 xpi2upstream XPI-FILE UPSTREAM-TREE-PATH TARGET-DIR

xpi2upstream takes three arguments:
* XPI-FILE - path to the .xpi file that should be transformed to the upstream source tree structure
* UPSTREAM-TREE-DIR - path to a full (auxilliary) checkout of the upstream branch the translation is targetting
* TARGET-DIR - path to the directory where the upstream source tree structure should be created

=== Algorithm ===

Upstream does not use a tree structure directly matching the tree structure found in .xpi files. So we need to do some smart guessing.

# for each chrome_manifest_line starting with "locale .." in chrome.manifest of the translation xpi, find the matching local_component_jarmn:
## parse locale component: <pre>
locale_component=`echo $chrome_manifest_line | sed -e 's/locale \([a-zA-Z]*\) .*$/\1//'` </pre>
1. find locale_component_jarmn: <pre>
find $UPSTREAM_TREE_PATH/ -name jar.mn | xargs grep '^%locale $locale_component' </pre>
1. parse the top_level_component from the locale_component_jarmn, like: <pre>
echo $locale_component_jarmn | sed -e 's/^[^a-zA-Z]\([a-zA-Z]*\)\/.*$/\1/' </pre>
# for each xpi_file in the .xpi that is matched by the chrome_manifest_line, find the matching_jarmn_line in locale_component_jarmn
## parse the path in brackets from the matching_jarmn_line and remember it as upstream_sub_path
## copy the xpi_file to $TARGET_DIR/$top_level_component/$upstream_sub_path

=== Testfiles ===

Test xpis for pt-BR for the mozilla 1.9 branch are available at http://people.ubuntu.com/~asac/po2xpi
