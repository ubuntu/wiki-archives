{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

=== App Developer Week -- Qt Quick: Extend with C++ -- jryannel -- Fri, Apr 15th, 2011 ===
{{{#!irc
[17:00] <dpm> Ok everyone, welcome to the last day of an Ubuntu App Developer Week packed with interesting content and speakers!
[17:00] <dpm> Let's welcome jryannel once more, who is going to talk about how to extend Qt Quick with C++
=== ChanServ changed the topic of #ubuntu-classroom to: Welcome to the Ubuntu Classroom - https://wiki.ubuntu.com/Classroom || Support in #ubuntu || Upcoming Schedule: http://is.gd/8rtIi || Questions in #ubuntu-classroom-chat || Event: Ubuntu App Developer Week - Current Session: Qt Quick: Extend with C++ - Instructors: jryannel
[17:01] <ClassBot> Logs for this session will be available at http://irclogs.ubuntu.com/2011/04/15/%23ubuntu-classroom.html following the conclusion of the session.
[17:01] <jryannel> Hi, I'm from QtDF my name is Juergen Bocklage-Ryannel
[17:02] <jryannel> I'm mainly doing training and training material
[17:02] <jryannel> today I would like to talk about Qt Quick and how you can extend it with c++
[17:02] <jryannel> For all of you who don't know Qt Quick...
[17:03] <jryannel> it's a declarative language build on top of Qt C++ to create great user interfaces
[17:03] <jryannel> I prepared a small project for today
[17:03] <jryannel> please download it from: https://github.com/jryannel/ubuntu-qtquick-webinar
[17:04] <jryannel> I will try to guide you through the project. While you are downloading I will tell you something about Qt Quick and C++
[17:04] <jryannel> Don't worry if you can't download you will also understand without
[17:05] <jryannel> Qt Quick is based on a Qt module called QtDeclarative
[17:05] <ClassBot> saimanoj asked: how to download the project?
[17:05] <jryannel> Please go to: https://github.com/jryannel/ubuntu-qtquick-webinar
[17:05] <jryannel> you need to have git installed
[17:06] <jryannel> or grab the zip file under downloads
[17:06] <jryannel> QtDeclarative uses our graphicsview (a 2.5d canvas based on graphics items)
[17:08] <jryannel> QtDeclarative is a ui runtime
[17:08] <jryannel> it contains an QtDeclarativeEngine which will interpret your qml file
[17:08] <jryannel> and a QtDeclarativeView which will paint the items
[17:09] <jryannel> If you open the project (QtCreator ->Open Project) QmlCppExample.pro in
[17:09] <jryannel> ubuntu-qtquick-webinar/QmlCppExample source tree
[17:10] <jryannel> You will see the project files.
[17:10] <jryannel> Please open the QmlCppExample.pro file
[17:10] <jryannel> in the .pro file I added "QT += gui declarative"
[17:11] <jryannel> This is to make the project aware we want to use the QtDeclarative modue
[17:12] <jryannel> Now we can use the module in the main.cpp
[17:12] <jryannel> Please open the main.cpp file
[17:12] <jryannel> There we create a view "QDeclarativeView view;" and set the
[17:12] <jryannel> qml source with "view.setSource(QUrl::fromLocalFile("main.qml"));"
[17:13] <jryannel> As usual in qt you need also call show " view.show();"
[17:13] <jryannel> You will find the main.qml file in "Other Files" in Qt Creator
[17:14] <jryannel> It's a simple Rectangle with a blue color and a MoouseArea, which doesn't do anything currently
[17:14] <jryannel> Just try to run the project
[17:14] <jryannel> for people which don't use qt creator...
[17:15] <jryannel> qmake; make; ./QmlExampleCpp
[17:15] <jryannel> You need to have Qt 4.7 installed and in you rpath
[17:15] <jryannel> If you get an error running the project in creator, you need to uncheck the shadow build
[17:16] <jryannel> This is on the side-bar under the Projects tab
[17:16] <jryannel> Just uncheck there "Shadow build"
[17:16] <jryannel> If you run the project, you see a blue window, which is our blue Rectangle
[17:17] <jryannel> In our project we would like now to change the color from c++ side
[17:18] <jryannel> You need to uncomment the code between  //1{ ... //1} markers
[17:18] <jryannel> in main.cpp and main.qml
[17:18] <jryannel> Also comment the code between //{0 markers in qml
[17:18] <jryannel> in main.cpp the line "view.rootContext()->setContextProperty("value", QColor("green"));"
[17:19] <jryannel> pushes a property "value" into our rectangle with the value of the color green
[17:20] <jryannel> We access the value in our qml file with "color: value"
[17:20] <jryannel> This right side value actually comes form the c++ side.
[17:20] <jryannel> So far so easy
[17:21] <jryannel> Now we want to push something more complicated into our declarative environment,
[17:21] <jryannel> a QObject which has a value, which again is a color.
[17:22] <jryannel> Please comment the code between //{1 markers and uncomment the //{2 markers
[17:22] <jryannel> in main.cpp and main.qml
[17:22] <jryannel> We have a class derived from QObject called ValueObject which contains a value property
[17:23] <jryannel> If you look up the valueobject.h file you can see how you declare properties for qml
[17:23] <jryannel> You have a setValue(...) a value() method and
[17:24] <jryannel> a valueChanged() signal
[17:24] <jryannel> all 3 are required for a read/write property
[17:24] <jryannel> We make them aware to the object as property with...
[17:24] <jryannel> Q_PROPERTY(QColor value READ value WRITE setValue NOTIFY valueChanged)
[17:24] <jryannel> This says, make a property of type QColor named color ...
[17:25] <jryannel> the read method is the value() method,
[17:25] <jryannel> the write method is the setValue(...) method
[17:25] <jryannel> and to notify qml about changes use the valueChanged() signal
[17:26] <jryannel> All methods are pretty simple, the only one worth mentioning is... setValue(...)
[17:26] <jryannel> Please have a look in the valueobject.cpp file for the setValue implementation
[17:26] <jryannel>     if(_value != value) {
[17:26] <jryannel>         _value = value;
[17:26] <jryannel>         emit valueChanged();
[17:26] <jryannel>     }
[17:27] <jryannel> The if ( ... ) is a guard to avoid loops.
[17:28] <jryannel> Only if the value has really changed you should emit the changed signal. You need to obey this rule, otherwise you can get infinite change loops
[17:28] <jryannel> So now we have q ValueObject with a value property ready to be used in qml
[17:28] <jryannel> In main.cpp we create a object of this value with: "ValueObject* value = new ValueObject(QApplication::instance());"
[17:29] <jryannel> and push it into qml with "view.rootContext()->setContextProperty("valueObject", value);"
[17:29] <jryannel> This says, make our value object known to qml as "valueObject"
[17:30] <jryannel> So we can use it now in our main.qml file
[17:30] <jryannel> "color: valueObject.value"
[17:31] <jryannel> You should see a blue rectangle. You can change the color simple by changing the color in valueobject.cpp (look for  _value(Qt::blue)
[17:31] <jryannel> Another way to change it is inside qml. Here we use the mouse area
[17:32] <jryannel> "onClicked: valueObject.value = "yellow"" will make our valueObject color property change to yellow
[17:32] <jryannel> This change is cascaded to our rectangle
[17:32] <jryannel> remember we have our rectangles color bound to "color: valueObject.value"
[17:33] <jryannel> So when you click on the rectangle the onClicked handler is called and the color should change to yellow
[17:33] <jryannel> I hope you can still follow me :)
[17:33] <jryannel> Next case would be we would instead of a simple property, we want to create a new qml element.
[17:34] <jryannel> We want to have a ValueObject element in qml, where we can get the color value from.
[17:34] <jryannel> For this please comment the //{2 marker code and uncomment the //3{ markers code
[17:35] <jryannel> So instead to push an object, we want to register a new type to qml.
[17:35] <jryannel> Look in the main.cpp file...
[17:35] <jryannel> Here we find: "qmlRegisterType<ValueObject>("Application", 1, 0, "ValueElement");"
[17:36] <jryannel> This line says, register the type ValueObject under the module name "Application" in version 1.0 as ValueElement element
[17:37] <jryannel> So now we have in a module Application a new qml element calles ValueElement
[17:37] <jryannel> Let's see how we can use it: open the main.qml file
[17:37] <jryannel> The line "import Application 1.0" imports our new module
[17:38] <jryannel> which we registered with the qmlRegisterType from c++ code
[17:38] <jryannel> Sure you can have many elements inside one module.
[17:38] <jryannel> We use the new element with "ValueElement { id: valueElement }"
[17:39] <jryannel> Our new element is now accessible under the id: valueElement.
[17:39] <jryannel> As this is a new element you can create as many of them as you want
[17:39] <jryannel> with "color: valueElement.value" we access the color of our new element, by the id
[17:40] <jryannel> and in our mouse area we can change the color using "onClicked: valueElement.value = "red""
[17:40] <jryannel> I hope you get the idea
[17:40] <jryannel> Jus to recap...
[17:41] <jryannel> You can push simple properties into qml, complex properties (e.g. objects)
[17:41] <jryannel> and also new elements.
[17:41] <jryannel> But this is just the start...
[17:42] <jryannel> You can create own elements which can paint, for example an ellipse
[17:43] <jryannel> For this you would need to derive a class from QDeclarativeItem
[17:44] <jryannel> But I think we are running out of time to show this here...
[17:44] <jryannel> So I post some links with comments
[17:44] <jryannel> have a look at :http://qt.nokia.com/developer/learning/online/training/materials/qt-essentials-qt-quick-edition for the "Training Module Integrating QML with C++ from"
[17:45] <jryannel> This explains how to create a simple ellipse item and adds on this more complicated stuff, e.g creating other types, using enums, ...
[17:45] <jryannel> You you want to learn more about what we did currently please read: Qt Declarative Binding
[17:45] <jryannel> http://doc.qt.nokia.com/4.7-snapshot/qtbinding.html
[17:45] <jryannel> and Extending QML Functionalities using C++
[17:45] <jryannel> http://doc.qt.nokia.com/4.7-snapshot/qml-extending.html
[17:46] <jryannel> You can also create qml modules as plugins
[17:46] <jryannel> This is explained in the training module, but also in QDeclarativeExtensionPlugin Class Reference
[17:46] <jryannel> http://doc.qt.nokia.com/4.7-snapshot/qdeclarativeextensionplugin.html#details
[17:46] <jryannel> If you want to mix traditional widget code and qml please look at: Integrating QML Code with Existing Qt UI Code
[17:47] <jryannel> http://doc.qt.nokia.com/4.7-snapshot/qml-integration.html
[17:47] <jryannel> If you want to see how the Qt developers have written their declarative items, checkout the qt source code and navigate to: /src/declarative/graphicsitems/
[17:48] <jryannel> There you find the code for the Item qml element in "qdeclarativeitem.h"
[17:48] <jryannel> And for the Rectangle element in "qdeclarativerectangle_p.h"
[17:49] <jryannel> Please note the rectangle has a _p in the name, which declares it as private. So you can't derive from it in c++.
[17:49] <jryannel> Only the QDeclarativeItem class is meant to be derived
[17:49] <jryannel> I would recommend you checkout the Example: Minehunt
[17:49] <jryannel> http://doc.qt.nokia.com/4.7-snapshot/demos-declarative-minehunt.html
[17:50] <jryannel> This shows how to make a minehunt game in qml, where the game logic is in C++
[17:50] <jryannel> You find other examples at: More Examples:
[17:50] <jryannel> http://doc.qt.nokia.com/4.7-snapshot/qdeclarativeexamples.html
[17:51] <jryannel> From the DevDays 2010 in Munich we have also a video, which explains QtQuick and C++ very nicely: TechTalk Developer Days 2010
[17:51] <jryannel> http://qt.nokia.com/developer/learning/online/talks/developerdays2010/tech-talks/qt-quick-for-c-developers
[17:51] <jryannel> This closes my talk on Extending Qt Quick with C++.
[17:52] <jryannel> I hope some of you where able to compile the example and get an idea about how qml and C++ can work together.
[17:52] <jryannel> Remember you can use JavaScript in QML, but you should not make to much use of it for performance reasons.
[17:53] <jryannel> But this truly depends where you run your code.
[17:53] <jryannel> A tip at the end, you can also embed qml files as resource files in your executable.
[17:53] <jryannel> By this deployment get's much easier
[17:54] <jryannel> I would like to see how someone uses Qt Quick with a WebFramework like Rails or Django
[17:55] <jryannel> QtQuick is network transparent so you can load qml files form a server or let them dynamically generate by a webframework :)
[17:55] <jryannel> Okay take care and I leave the stage for the next session. Bye!
}}}
