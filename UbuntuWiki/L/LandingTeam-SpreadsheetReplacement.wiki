{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

==== Goals ====

* Be as simple as possible (but no simpler), 
*** to minimize maintenance burden,
*** to minimize dev time expended so that we don't cry over wasted effort when this is eventually replaced by the mythical CI Airline.
* Be a "temporary" fix, where "temporary" is defined as "lasting as long as the Train does", eg it should not be necessary to replace this before the CI Airline replaces the entire Train system all at once.

==== Needs ====

* Be able to assign silos from landing requests, which is achieved by generating HTTP GET request with key/value pairs, for example (this is a real URL generated by current spreadsheet):

https://ci-train.example.com/securityRealm/commenceLogin?from=/job/prepare-silo/parambuild%3FREQUEST_ID%3D1429021347079%26DEST%3D%26RECONFIGURE_SILO%3Dtrue%26DISTRIBUTION%3Dubuntu%26SERIES%3Dtrusty%26LANDERS%3Drobru%26MERGE_PROPOSALS%3D%26SOURCES%3Dpython-launchpadlib%2520%26SYNC_REQUEST%3D&delay=0sec

* Be flexible enough that it's not horrible to add/remove keys in the future, eg, let's not define keys as hard-coded spreadsheet column numbers.

* Hide behind SSO so only ~ci-train-users can add or edit landing requests

* Expose JSONP interface so that data can be displayed in existing dashboard.

* Display a global status message so that we can inform landers whether or not landing gates are open

* Necessary keys:

** Landing description: Free-form text often including bug references
** Landers: list of IRC nicks to ping when action from landers is required.
** Comments (optional): Free-form text for landing team to discuss status of landing
** Test plans: Free-form text for lander to explain to QA how to verify the silo contents
** Merge proposals (optional): space-separated list of MP URLs for the silo to build.
** Download links (optional): space-separated list of files to download; eg device tarballs, clicks. no silo is required if anything is specified here.
** Sync source (optional): name of ubuntu archive/series (like "ubuntu,vivid") to potentially sync packages from
** Source packages (optional): space-separated list of source packages that the silo should contain but that aren't built from MPs (either uploaded manually or synced)
** Target distribution: like "ubuntu/vivid", defines what distro/series we build for (but not necessarily publish to)
** Destination PPA (optional): if blank, then the silo will publish to the main archive defined by the target distribution, if not blank, contains a PPA to publish to, like "ci-train-ppa-service/ubuntu/stable-phone-overlay"
** QA signoff needed: can be "N/A", "Required", or "Granted"
** Ready for a silo: boolean, indicates that lander really wants silo now
** Testing pass? Allows lander to indicate who tested the silo, against which phone image
** RequestID: Unix timestamp defined at request-creation time
** "published versions": commitlog generation scripts depend on this info; this is still necessary as this is the only Train-Landing -> Package-Version binding we have. But as per discussion, this time jenkins should 'push' the info to the new database, not poll unnecessarily

 
* Current spreadsheet columns that should go away:

** Assigned silo field: This should be displayed in the dashboard; the spreadsheet replacement shouldn't have any need to know this
** "raw status" and "computed status": These are displayed in the dashboard and are redundant to the spreadsheet replacement

==== Audit of Existing Code ====

The following is an audit of the code (formulas / javascripts) that are embedded in the spreadsheet:

* main.gs: this is a big pile of spreadsheet-specific fluff that can just go away. Eg it creates a menu in the spreadsheet, it listens to edits in the spreadsheet and updates certain values. This is the kid of stuff we just get for free by having a real data store and a custom web frontend.

* silos.gs: A few things here:
** hard-codes spreadsheet column numbers as data keys, which we get for free by using a real key/value data store
** has a bunch of logic for updating status cells, which should all go away because I think we should just rely on the status in the dashboard, not in the spreadsheet.
** has code for converting spreadsheet cells into urlencoded HTTP GET url, this is one of the few necessary features of the spreadsheet
** generates the requestid, which is just the current time as a unix timestamp.

* syncstatus.gs: This is where the jenkins status is polled and stored in memory. Totally unnecessary as the dashboard should display the statuses, not the spreadsheet replacement.

* assignrequest.html: This defines the modal popup that gets displayed when you want to assign/reconfigure a silo. it's purpose is to confirm that you've selected the correct spreadsheet row to assign/reconfigure, and then display the HTTP GET url that you need to click in order to trigger the assign/reconfigure. this code uses google's specific HTML templating syntax so it probably isn't salvageable, but something similar will be necessary in the replacement.

* archive.gs: This moves old landings from the pending tab to the archive tab, which is not especially necessary as we won't have spreadsheet tabs. we will need a mechanism to hide old requests from the spreadsheet replacement, either time-based or perhaps manually marking landings as no longer relevant to display in the list.

==== Questions ====

1. In one iteration of the spreadsheet, the archived landings tab grew to 40,000 rows. Does this information actually need to be retained for any reason? Does there exist a stakeholder who needs that information retained? Or perhaps can we just delete landing requests once the silo has landed?

* sil2100: it's required by commitlog generation. We need to know the history of landings for that and have the landing -> package binding with versioning. It's also good to see the history of landings for each team

2. commitlog generation. Currently, the commitlogs (the list of what packages landed in a new image build) are created by querying the spreadsheet, which is created by polling jenkins to learn what package versions were published from a silo. This has been very error prone, due to spreadsheet losing data, or even some cases where a silo gets published, gets stuck in proposed, and published again (eg, the list of "what was published" doesn't always correspond to "what was in distro". I'd really like to see the commitlog generation happen by diffing a manifest of what package versions *actually exist* in the given images. 

* sil2100: it was unreliable because we had to do it on the spreadsheet side, since jenkins had no means of pushing this info to the spreadsheet. Now we can do it proper by jenkins pushing the right information to the database whenever the publishing is successful, as the train knows best of where the package is in the given moment of time.
