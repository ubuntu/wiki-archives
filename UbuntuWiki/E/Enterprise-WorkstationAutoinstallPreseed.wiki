{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

== Workstation Autoinstall Preseed ==

This is a full Preseed file that will install a Ubuntu Desktop. It's the actual preseed we use, with some specifics removed.

There are two additional scripts used for the final stages. You can find them here: <nowiki>[[Enterprise-WorkstationAutoinstallScripts]]</nowiki>

Here's how to integrate use Cobbler for installation over the network: <nowiki>[[Enterprise-Cobbler]]</nowiki>

=== Notes ===
* It's localised for Switzerland
* You need to adapt it and fill in some blanks 
* It's designed so it doesn't ask any questions. It will wipe the entire disk.
* The disk is fully encrypted with a temporary password that is replaced in the final script
* It is based on the official <nowiki>[[https://help.ubuntu.com/12.04/installation-guide/example-preseed.txt|example-preseed]]</nowiki>

=== Explanation ===
The Setup is designed as a one-time setup. Without configuration management.

There are two scripts. 

Script 1: Additional System Confguration:

This script is executed directly after installation, before shutdown. There I add some additional software and sources.
If an nvidia-graphics card is detected, I install the proprietary driver (nvidia-current-updates), by default Ubuntu installs the open source nouveau driver and on first login asks for installation of additional drivers.

Skript 2: User-setup:

Script 2 is a interactive script which runs in a X screen where I use zenity for user Input.
It is started by a custom upstart job which hooks in on "starting-dm" i.e. before lightdm (login-screen) is started.
The script then launches the X Server, and a gnome-terminal on the X screen, which launches the same script again with "stage2" as parameter, that's the part with the graphical queries.

Disk Encryption:

The Preseed file sets a temporary password. And in the User Setup script, a Sys-Admin has to enter the default password, which is veryfied by the hash. Then the temporary password is replaced with the default admin password and the users password is added as an additional passphrase. 
Like that we have the same admin password on every machine (for emergency access or whatever). 

=== Preseed File ===
<pre>

d-i debian-installer/locale string de_CH.UTF-8

d-i localechooser/supported-locales multiselect de_CH.UTF-8, C.UTF-8, en_US.UTF-8

d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/layoutcode string ch

d-i netcfg/choose_interface select auto

d-i netcfg/get_hostname string host234
d-i netcfg/get_domain string example.com

d-i netcfg/wireless_wep string

d-i mirror/country string manual
d-i mirror/http/hostname string archive.ubuntu.com
d-i mirror/http/directory string /ubuntu
d-i mirror/http/proxy string

d-i mirror/http/mirror select ch.archive.ubuntu.com

d-i clock-setup/utc boolean true

d-i time/zone string Europe/Zurich

d-i clock-setup/ntp boolean true

d-i partman-auto/method string crypto
d-i partman-crypto/passphrase password temporarypassword
d-i partman-crypto/passphrase-again password temporarypassword

d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true #NOTE: This was missing in the example preseed

d-i partman-auto-lvm/guided_size string max
 
d-i partman-auto-lvm/new_vg_name string vg-workstation

d-i partman-auto/choose_recipe select custom-lvm

d-i partman-auto/expert_recipe string                         \
      custom-lvm ::                                           \
        250 250 250 ext4 $primary{ } $bootable{ }             \
        mountpoint{ /boot }                                   \
        method{ format }                                      \
        format{ }                                             \
        use_filesystem{ }                                     \
        filesystem{ ext4 }                                    \
        .                                                     \
        10240 20480 40960 ext4 $lvmok{ }                      \
        mountpoint{ / }                                       \
        lv_name{ root }                                       \
        in_vg { vg-workstation }                              \
        method{ format }                                      \
        format{ }                                             \
        use_filesystem{ }                                     \
        filesystem{ ext4 }                                    \
        .                                                     \
        10240 40960 1000000 ext4 $lvmok{ }                    \
        mountpoint{ /home }                                   \
        lv_name{ home }                                       \
        in_vg { vg-workstation }                              \
        method{ format }                                      \
        format{ }                                             \
        use_filesystem{ }                                     \
        filesystem{ ext4 }                                    \
        .                                                     \
        4096 8192 200% linux-swap $lvmok{ }                   \
        lv_name{ swap }                                       \
        in_vg { vg-workstation }                              \
        method{ swap }                                        \
        format{ }                                             \
        .

d-i partman/default_filesystem string ext4

d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

d-i passwd/root-login boolean true
d-i passwd/make-user boolean false

d-i passwd/root-password-crypted password #add hash

d-i user-setup/encrypt-home boolean false

d-i pkgsel/update-policy select none

popularity-contest popularity-contest/participate boolean false

d-i pkgsel/updatedb boolean true

d-i grub-installer/only_debian boolean true

d-i grub-installer/with_other_os boolean true

d-i apt-setup/restricted boolean true
d-i apt-setup/universe boolean true
d-i apt-setup/multiverse boolean true
d-i apt-setup/partner boolean true
d-i apt-setup/extras boolean true
d-i apt-setup/non-free boolean true
d-i apt-setup/backports boolean false

d-i apt-setup/local0/repository string \
       http://apt.example.ch/ precise-example main

d-i apt-setup/local0/key string http://apt.example.ch/example-apt.gpg

ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula boolean true

acroread-common acroread-common/default-viewer boolean false

davfs2 davfs2/suid_file boolean true

tasksel tasksel/first multiselect ubuntu-desktop, virt-host

d-i pkgsel/include string openssh-server \
  language-pack-de \
  language-pack-gnome-de \
  language-pack-en \
  language-pack-gnome-en \
  wngerman \
  wogerman \
  wamerican \
  wbritish \
  wswiss \
  firefox-locale-de \
  thunderbird-locale-de \
  libreoffice \
  libreoffice-l10n-de \
  libreoffice-help-de \
  hyphen-de \
  hyphen-en-us \
  mythes-de-ch \
  mythes-de \
  mythes-en-us \
  hunspell-de-de \
  hunspell-de-ch \
  hunspell-en-us \
  poppler-data \
  myspell-en-gb \
  acroread \
  apt-file \
  autofs \
  build-essential \
  byobu \
  chromium-browser \
  cifs-utils \
  console-common \
  davfs2 \
  eclipse \
  eclipse-egit \
  enigmail \
  filezilla \
  gedit-plugins \
  git \
  gitg \
  gnupg \
  gnupg-agent \
  gpm \
  htop \
  inkscape \
  libcrack2 \
  libreoffice-presenter-console \
  lightning-extension \
  meld \
  nautilus-compare \
  nautilus-filename-repairer \
  nautilus-image-converter \
  nautilus-open-terminal \
  network-manager-openvpn \
  network-manager-openvpn-gnome \
  nmap \
  regexxer \
  rdesktop \
  retext \
  ruby \
  shutter \
  skype \
  synaptic \
  terminator \
  traceroute \
  ubuntu-restricted-extras \
  vim \
  virt-manager \
  vlc \
  wine \
  wireshark \
  zenity

d-i pkgsel/upgrade select full-upgrade

d-i pkgsel/language-packs multiselect de, en

pkgsel/ignore-incomplete-language-support boolean true

d-i pkgsel/update-policy select none

popularity-contest popularity-contest/participate boolean false

d-i pkgsel/updatedb boolean true

d-i finish-install/reboot_in_progress note

d-i debian-installer/exit/poweroff boolean true

xserver-xorg xserver-xorg/autodetect_monitor boolean true
xserver-xorg xserver-xorg/config/monitor/selection-method \
       select medium
xserver-xorg xserver-xorg/config/monitor/mode-list \
       select 1024x768 @ 60 Hz

d-i preseed/late_command string \
  in-target wget -O /root/desktop-bootstrap.sh "http://example.com/ubuntu-desktop-bootstrap.sh"; \
  in-target chmod +x /root/desktop-bootstrap.sh; \
  in-target /root/desktop-bootstrap.sh; \
  cp /var/log/syslog /target/root/log/install-syslog;

</pre>
----
<nowiki>[[CategoryEnterprise]]</nowiki>
