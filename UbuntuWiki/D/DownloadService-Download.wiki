{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

{| class="wikitable"
|-
| <tablebgcolor="#f1f1ed" tablewidth="35%" tablestyle="margin:0pt 0pt 1em 1em;float:right;font-size:0.9em; "style="padding:0.5em;">
|}

== Rationale ==

A Download represents a single url to be downloaded by the <nowiki>[[DownloadService-DownloadManager|ubuntu download manager]]</nowiki>.
 
== Interface ==

The following defines the public interface exposed by the !DownloadManager.

 '''!ObjectPath:''' Most be provided by the <nowiki>[[DownloadService-DownloadManager| download manager]]</nowiki>.

 '''Interface:''' com.canonical.applications.Download

=== Methods ===

'''totalSize(OUT UInt64 size)'''
 Returns the total size of the download. There are cases where the server does not return the download size correctly, in those cases the value returned is 0.
  ''Arguments''
** '''''OUT UInt64 size:''''' The size of the download.

'''progress(OUT UInt64 received)'''
 Returns the amount of data that has been downloaded so far from the server.
  ''Arguments''
** '''''OUT UInt64 received:''''' The amount of that downloaded so far and that it is in memory or disk.

'''metadata(OUT Dict<String, Variant> metadata)'''
 Returns the metadata that was passed to the download when it was created.
  ''Arguments''
** '''''arg:''''' The metadata associated with the download.

'''setThrottle(IN UInt64 speed)'''
 Allows to set the throttle to be used in the download so that not all the available bandwidth is used.
  ''Arguments''
** '''''IN UInt64 speed:''''' The throttle to be used.

'''throttle(OUT UInt64 speed)'''
 The throttle that has been set to be using with the download.
  ''Arguments''
** '''''OUT UInt64 speed:''''' The throttle currently used with the download.

'''allowGSMDownload(IN Bool isAllowed)'''
 Set the download to be allowed to use a GSM connection to perform the download.
  ''Arguments''
** '''''IN Bool isAllowed:''''' If the download can be performed over a GSM connection.

'''isGSMDownloadAllowed(OUT Bool isAllowed)'''
 Returns if the current download is allowed to use a GSM connection to perform the download.
  ''Arguments''
** '''''OUT Bool isAllowed:''''' Bool stating if the download can be currently performed over a GSM connection.

'''start'''
 Notifies the <nowiki>[[DownloadService-DownloadManager|download manager]]</nowiki> that the download can be performed. There is no guarantee that the data will start immediately to be downloaded but that it will be queued to be performed in the near future. Once the download is started the signals will be emitted (progress, error, canceled, finished..)

'''pause'''
 Notifies the <nowiki>[[DownloadService-DownloadManager|download manager]]</nowiki> that the download has been paused. When a download is paused all partial download information/data is stored so that the download can be resumed at the same point as the download was paused.

'''resume'''
 Notifies the <nowiki>[[DownloadService-DownloadManager|download manager]]</nowiki> that the download can be resumed. There is no guarantee that the data will start immediately to be downloaded but that it will be queued in the near future.

'''cancel'''
 Notifies the download manager that the download has been canceled. Once a download has been canceled the download manager will clean all resources and all finished downloads will be removed from the system.

=== Signals ===

'''started(OUT Bool started)'''
 Emitted when the download was started. This does not mean that the download is being performed but that the download has been placed in the <nowiki>[[DownloadService-DownloadManager|download manager]]</nowiki> queue of downloads to be performed. After this signal is emitted, signals such as progress will be emitted.
  ''Arguments''
** '''''OUT Bool started:''''' Bool indicating if the download was correctly set to be started..

'''paused(OUT Bool paused)'''
 Emitted when the download was paused. This signal means that the download will not be performed and that all temp data downloaded will be stored so that the download can be started at the same point that it was paused.
  ''Arguments''
** '''''OUT Bool paused:''''' Bool indicating if the download was correctly paused..

'''resumed(OUT Bool resumed)'''
 Emitted when the download was resumed. This does not mean that the download is being performed but that the download has been placed in the <nowiki>[[DownloadService-DownloadManager|download manager]]</nowiki> queue of downloads to be performed at the same point that it was paused, that is, already downloaded data will NOT be redownloaded.
  ''Arguments''
** '''''OUT Bool resumed:''''' Bool indicating if the download was correctly resumed..

'''canceled(OUT Bool canceled)'''
 Emitted when the download or one of its children was canceled.
  ''Arguments''
** '''''OUT Bool canceled:''''' Bool indicating if the download or one of its children was canceled..

'''hashing(OUT String localPath)'''
 Emitted when the download finished and the download manager is checking its checksum. The signal has an out parameter because when performing the download there is no guarantee that a file is already present in the file system and therefore the download manager might have prepended an integer at the end of the local file.
  ''Arguments''
** '''''OUT String localPath:''''' The local path in where the download was performed.

'''processing(OUT String localPath)'''
 Emitted when the download finished and the download manager is executing a post processing command that might have been passed. The signal has an out parameter because when performing the download there is no guarantee that a file is already present in the file system and therefore the download manager might have prepended an integer at the end of the local file.
  ''Arguments''
** '''''OUT String localPath:''''' The local path in where the download was performed.

'''finished(OUT String localPath)'''
 Emitted when the download finished and correct. If a hash and hash algorithm was provided the signals implies that the hash was also checked and the client does not need to do it. The signal has an out parameter because when performing the download there is no guarantee that a file is already present in the file system and therefore the download manager might have prepended an integer at the end of the local file.
  ''Arguments''
** '''''OUT String localPath:''''' The local path in where the download was performed.

'''error(OUT String errorMsg)'''
 Emitted when there was an error performing the download. This signal is emitted when one or more of the children downloads of the group had an error.
  ''Arguments''
** '''''OUT String errorMsg:''''' The reason of the error..

'''progress(OUT UInt64 received, OUT UInt64 total)'''
 Emitted every time the progress of the download is updated. There are some cases in witch the total cannot be calculated due to an error in the server side, for those cases the received value and the total value are the same yet the finished signal is not emitted.
  ''Arguments''
** '''''OUT UInt64 received:''''' Total data received so far.
** '''''OUT UInt64 total:''''' Total data received so far.

== DBus API XML Definition ==
The following is an XML definition of the DBus interface that can be used to generate adapters in different languages:

{{{#!highlight xml
<node>
  <interface name="com.canonical.applications.Download">

    <method name="totalSize">
        <arg name="total" type="t" direction="out"/>
    </method>

    <method name="progress">
        <arg name="received" type="t" direction="out"/>
    </method>

    <method name="metadata">
        <arg name="data" type="a{sv}" direction="out" />
    </method>

    <method name="setThrottle">
        <arg name="speed" type="t" direction="in"/>
    </method>

    <method name="throttle">
        <arg name="speed" type="t" direction="out"/>
    </method>

    <method name="allowGSMDownload">
        <arg name="allowed" type="b" direction="in"/>
    </method>

    <method name="isGSMDownloadAllowed">
        <arg name="allowed" type="b" direction="out"/>
    </method>

    <method name="start" />
    <method name="pause" />
    <method name="resume" />
    <method name="cancel" />

    <signal name="started">
        <arg name="success" type="b" direction="out"/>
    </signal>

    <signal name="paused">
        <arg name="success" type="b" direction="out"/>
    </signal>

    <signal name="resumed">
        <arg name="success" type="b" direction="out"/>
    </signal>

    <signal name="canceled">
        <arg name="success" type="b" direction="out"/>
    </signal>

    <signal name="hashing">
        <arg name="path" type="s" direction="out"/>
    </signal>

    <signal name="processing">
        <arg name="path" type="s" direction="out"/>
    </signal>

    <signal name="finished">
        <arg name="path" type="s" direction="out"/>
    </signal>

    <signal name="error">
        <arg name="error" type="s" direction="out"/>
    </signal>

    <signal name="progress">
        <arg name="received" type="t" direction="out"/>
        <arg name="total" type="t" direction="out"/>
    </signal>

 </interface>
</node>

}}}

== Code Examples ==

=== Python ===

Small script that shows how to use the !DownloadManager to create a single download, track its process and finish the script.

{{{#!highlight python
import gobject
import dbus
from dbus.mainloop.glib import DBusGMainLoop

DBusGMainLoop(set_as_default=True)

MANAGER_PATH = '/'
MANAGER_IFACE = 'com.canonical.applications.DownloaderManager'
DOWNLOAD_IFACE = 'com.canonical.applications.Download'
IMAGE_FILE = 'http://i.imgur.com/y51njgu.jpg'

def download_created(path):
    """Deal with the download created signal."""
    print 'Download created in %s' % path

def finished_callback(path, loop):
    """Deal with the finis signal."""
    print 'Download performed in "%s"' % path
    loop.quit()

def progress_callback(total, progress):
    """Deal with the progress signals."""
    print 'Progress is %s/%s' % (progress, total)

if __name__ == '__main__':

    bus = dbus.SessionBus()
    loop = gobject.MainLoop()
    manager = bus.get_object('com.canonical.applications.Downloader',
            MANAGER_PATH)
    manager_dev_iface = dbus.Interface(manager, dbus_interface=MANAGER_IFACE)

### ensure that download created works
    manager_dev_iface.connect_to_signal('downloadCreated', download_created)

    down_path = manager_dev_iface.createDownload((IMAGE_FILE, "", "", {}, {}))

    download = bus.get_object('com.canonical.applications.Downloader',
            down_path)

    download_dev_iface = dbus.Interface(download, dbus_interface=DOWNLOAD_IFACE)

### connect to signals
    download_dev_iface.connect_to_signal('progress', progress_callback)
    download_dev_iface.connect_to_signal('finished',
            lambda path: finished_callback(path, loop))

    download_dev_iface.start()

    loop.run()
}}}
