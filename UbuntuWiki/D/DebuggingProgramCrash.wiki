{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

Available languages: <nowiki>[[https://wiki.ubuntu.com/DebuggingProgramCrash_it| Italiano]]</nowiki>,

== Introduction ==

This document describes how to install debug packages on Ubuntu releases that do not support <nowiki>[[https://debuginfod.ubuntu.com|debuginfod]]</nowiki> out of the box, allowing one to provide information regarding providing detailed information when manually performing:
# A <nowiki>[[Backtrace]]</nowiki>.
# A <nowiki>[[Valgrind]]</nowiki>, if the program crashes with a "Segmentation fault" or "Bus error".
# An <nowiki>[[Strace]]</nowiki>.

== Using debuginfod ==

If you are on Ubuntu Jammy (22.04) or later, you do '''not''' need to worry about installing debug symbol packages anymore.  The Ubuntu project maintains a <nowiki>[[https://debuginfod.ubuntu.com|Debuginfod]]</nowiki> server, and GDB and other debuginfo-consumer applications support it out of the box.  For more information about it, please refer to <nowiki>[[https://ubuntu.com/server/docs/service-debuginfod|this page]]</nowiki>.

== Using apport-retrace ==

If you want to debug a crash in packaged Ubuntu software, <nowiki>[[https://wiki.ubuntu.com/Apport|Apport]]</nowiki> will usually pick it up, create a `.crash` report in `/var/crash/` and report the crashed program. From there it is easiest to use <nowiki>[[http://manpages.ubuntu.com/apport-retrace|apport-retrace]]</nowiki>.

`apport-retrace` regenerates  the  stack  traces  (both the simple and the threaded one) from an apport crash report from the included core dump, or gives you a Terminal window with gdb in an environment with debugging symbols, reproducing the situation of the crash through the core dump. For this it figures out the set of necessary packages  and their accompanying debug symbol packages, so that the regenerated stack trace will be fully symbolic and thus become much more useful for developers to fix the problem.

`apport-retrace` has two modes: By default it will just regenerate traces based on the packages  which are  currently  installed  in  the system, i. e. it assumes that all necessary debug symbols for the report are installed (see the next paragraph for this). When specifying the `-S` option, it creates a temporary "sandbox" and  downloads and installs all necessary packages and debug symbols there. It will not do any changes to your system and does not require any special privileges.

Please see the <nowiki>[[http://manpages.ubuntu.com/apport-retrace|apport-retrace manpage]]</nowiki> for details and some examples how to run it.

You can also invoke this directly from the Apport crash notification, by clicking the "Examine locally" button:

 <nowiki>[[File:apport-examine-locally.png]]</nowiki>

This will collect some package information and then ask you in which mode you want to run `apport-retrace`:

 <nowiki>[[File:apport-retrace-gui.png]]</nowiki>

Normally you want to keep the first option, which will get you in a gdb session
in the sandbox:

 <nowiki>[[File:apport-retrace-gdb.png]]</nowiki>

If you do not want an interactive gdb session but just want it to update the already existing `.crash` file with fully symbolic stack traces, you can select the third option.

== Installing debug symbols manually ==

If you want to debug a crash from an application provided by Ubuntu, you are developing yourself, provided by a third-party, or need the debug symbols for particular libraries very often, it is helpful to install the relevant debugging packages.

=== Built-in debug symbol packages (*-dbg) ===

For many, but not all, packages, one can simply add a -dbg suffix to the package name to install it. For example:<pre>
sudo apt-get install xserver-xorg-core-dbg
</pre>

=== Non-built-in debug symbol packages (*-dbgsym) ===

For additional debug symbols that are not built-in, one must add an additional repository. /!\ Please take care to not install both debug symbols for a given package name, as this may cause problems. Your package manager will not check for this overlap and prevent it from happening. For example:<pre>
libprotobuf-c1-dbg
libprotobuf-c1-dbgsym
</pre> Here are the steps to add this repository:
1. Create an `/etc/apt/sources.list.d/ddebs.list` by running the following line at a terminal:<pre>
echo "deb http://ddebs.ubuntu.com $(lsb_release -cs) main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list.d/ddebs.list
</pre>
1. Stable releases (not development, alphas, or betas) require two more lines adding to the same file, which is done by the following terminal command:<pre>
echo -e "deb http://ddebs.ubuntu.com $(lsb_release -cs)-updates main restricted universe multiverse\ndeb http://ddebs.ubuntu.com $(lsb_release -cs)-proposed main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list.d/ddebs.list
</pre> You may also add these lines using the Synaptic Package Manager:
* Choose ''Synaptic'' via the ''System > Administration'' menu.
* Choose ''Software Sources'' or ''Repositories'' via the ''Settings'' menu, and click on the ''Third-Party Software'' tab.
* Click the ''Add'' button and enter each ''deb ...'' line as above one by one and click the ''Add Source'' button (you will have to add these lines one at a time).
1. Import the debug symbol archive signing key.  On Ubuntu 18.04 and later:<pre>
sudo apt install ubuntu-dbgsym-keyring
</pre>
 On earlier releases of Ubuntu:<pre>
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys F2EDC64DC5AEE1F6B9C621F0C8CAB6595FDFF622
</pre>
    Note: The GPG key expired on 2021-03-21 and may need updating by either upgrading the ubuntu-dbgsym-keyring package or re-running the apt-key command. Please see <nowiki>[[https://bugs.launchpad.net/ubuntu/+source/ubuntu-keyring/+bug/1920640|Bug #1920640]]</nowiki> for workaround details if that does not work.
1. Then run:<pre>
sudo apt-get update
</pre> to update your package list or click the ''Reload'' button if you used the Synaptic Package Manager.
1. The debug symbol packages have the '-dbgsym' suffix attached, so to install the debug symbols for the yelp package, you first run:<pre>
apt-cache policy yelp
</pre> This will show you the version number currently installed (we'll use 2.22.1-0ubuntu2.8.04.1 in this example). '''NOTE:''' yelp (which is the package name of "Help and Support" located under the 'System' menu) is just an example, and would have to be replaced by the name of the package you want to debug.
1. Install the debug symbols:<pre>
sudo apt-get install yelp-dbgsym=2.22.1-0ubuntu2.8.04.1
</pre> You can also use the Synaptic Package Manager to search for yelp-dbgsym and install it from there.

==== Installing dbgsym packages from a PPA ====

If you are debugging a PPA package, have no fear!  You can still install `-dbgsym` packages for them.  Where normally you would have a line like:

<pre>
 deb http://ppa.launchpad.net/TEAM/PPA/ubuntu RELEASE main
 </pre>

Simply add '''`main/debug`''' at the end, like so:

 <pre>
 deb http://ppa.launchpad.net/TEAM/PPA/ubuntu RELEASE main main/debug
 </pre>

Then `apt update` and `apt install` the `-dbgsym` packages you want.

=== Manually finding required debug symbols ===

The above procedure will install the debug symbol package for yelp only. For many packages, they use libraries shared between different packages. Hence, in order to obtain a readable/more readable stacktrace, or perform other debugging tasks, one must find the debug symbols for these shared libraries. For example, if one had attached gdb to an application and got the following output:<pre>
Reading symbols from /usr/lib/x86_64-linux-gnu/libffi.so.6...(no debugging symbols found)...done.
Loaded symbols for /usr/lib/x86_64-linux-gnu/libffi.so.6
</pre> This would indicate that the relevant debug symbols are not installed. However, this by itself wouldn't necessarily be enough information to know which package exactly needs the debug symbols. Hence, one may go to <nowiki>[[http://packages.ubuntu.com/]]</nowiki> and paste into the "Search the contents of packages" keyword box:<pre>
x86_64-linux-gnu/libffi.so.6
</pre> choose the appropriate Distribution from the drop down, and click Search. This would reveal that the package is libffi6. A check in Synaptic reveals the debug package libffi6-dbg.

=== Automatically installing all debug symbols ===

You can use the 'find-dbgsym-packages' command from the 'debian-goodies' package to find debug symbols for a core file, running PID or binary path.

For a binary path it only finds debug symbols for the actual binary itself, and not any dynamically linked library dependencies or other libraries loaded at runtime. For that functionality to work you need to use either a core file or running PID which is the preferred method.

This tool will find both "-dbg" and "-dbgsym" style packages. However it only finds debug symbols for apt repositories that are currently enabled and updated, so you need to ensure that you enable at least the "ddebs.ubuntu.com" archive as described elsewhere on this page and for a Launchpad PPA or the Ubuntu Cloud Archive you need to add another source line with the component changed from "main" to "main/debug".

<pre>
apt install debian-goodies
find-dbgsym-packages [core_path|running_pid|binary_path]
</pre>

If the above tool is not working for you, there is an older shell script that attempts to do this by parsing the gdb output instead however often does not work correctly.

You can download the following <nowiki>[[attachment:list-symbols-packages-v2.1.sh |shell script (list-symbols-packages-v2.1.sh)]]</nowiki> to resolve all the dependencies. Attaching a debugger to an already running process may require elevated privileges even if you own the process. The following invocation will print out the list of files to install.
<pre>
sudo bash ./list-symbols-packages-v2.sh -p $(pidof yelp)
</pre> To automatically install them apt can be called with the input from the script. The script is invoked with <code>-t</code> for a terse output without the descriptions of the packages and error messages are suppressed:<pre>
sudo bash ./list-symbols-packages-v2.sh -t -p $(pidof yelp) 2>/dev/null | xargs -d $'\n' sudo apt-get install </pre> /!\ Version 2 of this script makes it compatible with the newer GDB (which no longer loads all libraries at startup by default). -v2 currently only works if you run it against a currently-executing binary (i.e., with '-p $(pidof <whatever>'). The <nowiki>[[attachment:list-symbols-packages.sh|older version]]</nowiki> of the script is also available.

== Uninstalling all debug symbols ==

You can remove all debug symbol packages and the ddebs repositories with the following commands:<pre>
sudo apt-get remove \.*-dbgsym \.*-dbg
sudo rm /etc/apt/sources.list.d/ddebs.list
sudo apt-get update
</pre>

== The Xorg server ==

Depending on the circumstances, X server will trap its own crashes and dump a stack trace in /var/log/Xorg.0.log. However, this stack trace is modified by the signal handler itself. If apport is not catching the crash, add this to your /etc/X11/xorg.conf:<pre>
Section "ServerFlags"
        Option "NoTrapSignals" "true"
EndSection
</pre> Please see <nowiki>[[X-Debugging]]</nowiki> for how to debug Xorg server crashes.

== Info for the BugSquad ==

If you're trying to apport-retrace a crash report from a bug that didn't happen on the same Ubuntu release as the one you're running, it would be easiest to just virtualize the environment it is reproducible in. However, if this would not be available to you, one may perform the following example. Say that you're running Trusty and the crash happened on Precise:
0. This will create a minimal Precise system:<pre>
sudo mkdir -p /chroots/precise
sudo debootstrap precise /chroots/precise/
</pre>
0. Now change into this minimal precise system:<pre>
sudo chroot /chroots/precise
</pre>
# Edit /etc/apt/sources/list and add all the repositories you need, including the ddeb repository.
# Execute the following in a terminal:<pre>
sudo apt-get update; sudo apt-get install gdb apport
</pre>
0. use apport-retrace as you're used to.

For more information on dealing with bug reports <nowiki>[[Apport]]</nowiki> see <nowiki>[[Bugs-ApportRetraces]]</nowiki>.

----
CategoryBugSquad CategoryDebugging
