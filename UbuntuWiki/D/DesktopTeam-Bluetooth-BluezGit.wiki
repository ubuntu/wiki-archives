{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


== The process for managing BlueZ in Git ==

=== Goals and benefits ===

* Everything is in git. Everything has history and version control.
* git log shows history going back to the master branch upstream changes.
* The debian/ directory lives inside the source tree natively. It not only has history but is always ready for packaging in-tree.
* Human-readable branches and tags that are very easy to work with. For example:
 focal:: refers to the code (a branch) that is going into focal next, as well as containing history of what has been in focal archive.
 5.53-tar:: refers to the __exact__ contents of the upstream release tarball.
* No custom tools or commands. Just regular git.

As far as I know, no other approach achieves all of these.

=== Caveat ===

Ubuntu branches directly from upstream BlueZ and not from Debian versions. This is inherited  technical debt caused by:
* Debian often being slower to release new upstream versions than Ubuntu; and
* Ubuntu already being significantly branched from Debian before this new git process was designed. We are slowly shrinking the diff to minimize the differences between Debian and Ubuntu releases.

=== Initial setup ===

 1. Join the team: <nowiki>[[https://launchpad.net/~bluetooth]]</nowiki><<BR>>
 And while waiting for approval, get familiar and comfortable with git.

 2. Bookmark (and optionally read): <nowiki>[[https://git.launchpad.net/~bluetooth/bluez]]</nowiki>

 3. Make a local git repository:
 <code>$ git clone git://git.kernel.org/pub/scm/bluetooth/bluez.git</code><<BR>>
 <code>$ cd bluez</code><<BR>>
 <code>$ git remote add launchpad git+ssh://USERNAME@git.launchpad.net/~bluetooth/bluez</code><<BR>>
 <code>$ git fetch launchpad</code><<BR>>

=== Updating to a newer upstream version ===

 1. Download the official release tarball from <nowiki>[[http://www.bluez.org/]]</nowiki> or <nowiki>[[https://mirrors.edge.kernel.org/pub/linux/bluetooth/]]</nowiki>

 2. Verify your git contains a tag for the release you'll be working against:
 <code>$ git fetch origin</code><<BR>>
 <code>$ git tag -l 5.41</code><<BR>>
 If the tag doesn't exist then do not continue until it does.

 3. Create an intermediate branch for the release. This serves as a parent branch for the distro branch. An intermediate branch is required because the bluez release tarballs contain different files to the actual tag    contents in git. The purpose of the intermediate branch is to make a __perfect__ copy of the release tarball with near-perfect git history.<<BR>>
 <code>$ git branch 5.41-tarball 5.41</code>

 4. Make the intermediate branch into a perfect copy of the release tarball:<<BR>>
 <code>$ git checkout 5.41-tarball</code><<BR>>
 <code>$ rm -rf .gitignore .checkpatch.conf .gitlint .mailmap .b4-config *   # (yes, really)</code><<BR>>
 <code>$ tar xJvf ~/Downloads/bluez-5.41.tar.xz</code><<BR>>
 <code>$ mv bluez-5.41/* .</code><<BR>>
 <code>$ rmdir bluez-5.41</code><<BR>>
 <code>$ git add .</code><<BR>>
 <code>$ git commit -m "Mirror the contents of bluez-5.41.tar.xz"</code><<BR>>
 <code>$ git tag 5.41-tar</code><<BR>>

 5. Choose which Ubuntu distro to target:<<BR>>
 <code>$ git checkout artful</code><<BR>>
 If you had to create a new branch for a new Ubuntu series then please also change the ''Default branch'' at https://code.launchpad.net/~bluetooth/bluez/+git/bluez/+edit

 6. Merge the new BlueZ release into your distro branch:<<BR>>
 <code>$ git merge -s recursive -X theirs 5.45-tarball</code><<BR>>
 And complete the merge.

 7. Update debian/changelog with the new version:<<BR>>
 <code>$ dch -i</code>

 8. Save your work before testing packaging works (which will leave a mess):<<BR>>
 <code>$ git commit</code>

 9. Test Debian packaging works in the current directory, and iterate until it does work.<<BR>>

 10. Now the git branch 'artful' contains the exact tree we want to release to archive (plus a .git directory which will be ignored). You can build source packages and test binary packages directly in your git directory, with clean diffs. Nothing unexpected can creep in to a deb release unless it was introduced by a git commit (which is fully traceable).

=== Housekeeping ===

Since the <code>-tarball</code> branches will never need to be referred to by name after each major release is completed, they can be hidden somewhat by converting them to tags:

  <code>git tag 5.41-tar 5.41-tarball</code><<BR>>
  <code>git push --tags launchpad</code><<BR>>
  <code>git push -d launchpad 5.41-tarball</code><<BR>>

Also, each cycle the default branch should be changed at https://code.launchpad.net/~bluetooth/bluez/+git/bluez/+edit to point to the latest series branch name.
