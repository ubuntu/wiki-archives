{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

== Dapper - translation of the Firefox start page ==

Firefox starts with an ''About Ubuntu'' page. In hoary and breezy this
is always displayed in English. For dapper, there are some plans to
change the default start page: BrowserDefaults. Whatever the default
firefox page ends up as, we can do the following to make it show up
translated where available.

== Overview (basic, untranslated situation) ==

By default, firefox looks in
<code>/usr/share/ubuntu-artwork/home/index.html</code>.  The location used is
controlled by the firefox .deb, and comes from our Ubuntu-specific
patches to firefox.

This file is managed by update-alternatives with a <code>name</code> of
<code>firefox-homepage</code>.  The usual alternative is
<code>/usr/share/ubuntu-artwork/home/firefox-index.html</code> which is
provided by the ubuntu-docs package; kubuntu-docs, xubuntu-docs and
edubuntu-artwork provide other variants.

(The filename reflects the file's previous incarnation in the
ubuntu-artwork package, but has not changed with the move of the
content to ubuntu-docs).

== Translation ==

There is a never-shrinking list of translation-possible locales (see
below).  A locale is in this list if there is now a translation of the
start page, or if it is plausible that such a translation might become
available.  Locales in the list are henceforth called Translatable
locales.

The translated start pages live in an alternatives-managed directory,
slaved to the main start page, with
<code>update-alternatives ... --slave /usr/share/ubuntu/artwork/home/locales firefox-homepage-locales ...</code>

Every package which provides a firefox-homepage alternative must also
provide a corresponding alternative slave directory.  Inside each such
alternative directory <code>ALTDIR</code>, the binary package will provide,
for each translateable locale <code>LOCALE</code>, a file
<code>ALTDIR/index-LOCALE.html</code>.  This file will always exist and be
the best available translation for that LOCALE. If the translation is
not actually available in any particular release of ubuntu-docs, then
the providing package will still provide the file as a symlink to
another actually available translation, or to the default English
version of the start page.

For example, ubuntu-docs provides the alternative slave directory
<code>/usr/share/ubuntu-artwork/home/locales-ubuntu</code>, containing
amongst other things
<code>/usr/share/ubuntu-artwork/home/locales-ubuntu/index-en_GB.html</code>.

The mozilla-firefox-locale-all source package generates
mozilla-firefox-locale-LOCALE binary packages for various locales,
including both Translatable and un-Translatable ones.  These binary
packages contain, amongst other things,
/usr/lib/mozilla-firefox/extensions/GUID/LOCALE.jar, which itself
contains locale/browser-region/region.properties, which contains an
overriding value for the default start location.

In each m-f-l-LOCALE, in the locale-specific jar, the default start
location will be changed to
<code>/usr/share/ubuntu-artwork/home/locales/index-TRANSLOCALE.html</code>
where TRANSLOCALE is the most appropriate Translatable locale, or to
set it to <code>/usr/share/ubuntu-artwork/home/index.html</code> (the US
English version) if there is no suitable Translateable locale.

This is handled by a <code>prepare-firefox-startpage-translations</code>
script shipped by ubuntu-docs in <code>/usr/share/ubuntu-docs/common</code>.
This script contains embedded in it the master list of translateable
locales.

== Notes ==

It would also be nice for these files to be supplied by the langpack machinery, but at present we have no idea whether this is an option or not.

Epiphany has a more featureful and sensible behaviour: it will attempt to use <code>/usr/share/ubuntu-artwork/home/locales/index-LOCALE.html</code> and fall back to <code>index-C.html</code> if the former doesn't exist.  So for epiphany's benefit, p-f-s-t will arrange for each alternative to contain <code>index-C.html</code> as a symlink to the default fallback page, <code>/usr/share/ubuntu-artwork/home/index.html</code>, or the relevant translation.

== Adding new locales ==

The translateable locale list is at the top of
<code>prepare-firefox-startpage-translations</code> in ubuntu-docs.

This list may grow but it may never shrink, and ideally the
translateable locale list for any release should remain constant after
the release, to avoid trouble if a user does a partial update.

'''Note''' that this procedure ''must'' be done in order and once started ''must'' be completed.

To extend the list:

 1. Add the new locale(s) to the script in ubuntu-docs and rebuild and upload ubuntu-docs.

 2. Rebuild edubuntu-artwork, xubuntu-docs and kubuntu-docs against the new ubuntu-docs, and upload them.  If new Ubuntu derivatives arrive which also have different Firefox start pages, the corresponding packages must be rebuilt and uploaded too.

 3. Rebuild mozilla-firefox-locale-all against the new ubuntu-docs, and test that the new locale works, but ''do not upload'' yet.

 4. Wait for the docs package uploads to be accepted and published.  Note that if you upload m-f-l-all straight away, users who get version skew will find the Firefox start page is missing.

 5. Upload the new mozilla-firefox-locale-all.

Unfortunately our dependency system isn't able to
represent the actual dependency in this case.  The real dependency is
that whichever package has the highest priority firefox homepage
alternative must be recent enough that its list is at least as long as
the one in the m-f-l-*, for every m-f-l-* that is installed.

Because the process for changing this list is somewhat tedious and
causes a certain fragility, it is best if it is done in batches of
several locales at once.
