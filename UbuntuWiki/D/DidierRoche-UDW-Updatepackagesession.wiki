{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

<pre>
20:00   didrocks        DING DONG, it's classroom time :)
20:00   didrocks        just to know a little about the audience, who is ready to update some packages? :)
20:02   didrocks        great, some people there! For those who don't know the basics/can't practice, there will be a lot of copy/paste in pastebin so that you can follow the lesson :)
20:02   didrocks        Pollywog: appart for last part, no, you can use your intrepid box
20:02   didrocks        hardy has well be fine :)
20:02   didrocks        as*
20:02   didrocks        First and before the introduction, if not done yet, install theses packages :
20:03   didrocks        sudo apt-get install build-essential devscripts ubuntu-dev-tools debhelper diff patch quilt fakeroot lintian libtool gnome-common gnome-doc-utils gtk-doc-tools.
20:03   didrocks        (without the final dot, of course)
20:03   didrocks        You should also have "deb-src http://archive.ubuntu.com/ubuntu/ jaunty main restricted" in your /etc/apt/sources.list (and then sudo apt-get update).
20:03   didrocks        tell me when I can begin my introduction during the download :)
20:04   didrocks        (and yes, that's a bunch of packages ;))
20:05   didrocks        I will begin with a very generalist introduction so that people can follow what will be in this lesson
20:05   didrocks        As most of user want to live on the edge about what best the Open Source community has to offer, we are going to see how to update a package to offer the very last release to all ubuntu users.
20:05   didrocks        First, be warned that once a release is out and for all supported releases (jaunty soon!), we never update a package to a new software version (appart from backports repository and ppa, when requested).
20:05   didrocks        We only cherrypick bug and security fixes from a new release to adapt it an older version. This is intended to have as little breakage as possible.
20:06   didrocks        So don't expect to have OpenOffice 3 in intrepid from the casual repositories, it will never happen. Jaunty, on the contrary, has it!
20:07   didrocks        Pollywog: I'm more a GNOME packager than a KDE one. If a major bug in kmail happens, yes, report it
20:07   didrocks        (it's an extra bonus point if it's still happens in the last release)
20:07   didrocks        but, it only concerns major crash/unusable version. If it's a major issue, no, it will not be updated
20:08   didrocks        blfgomes: minor issues
20:08   didrocks        for instance
20:08   didrocks        ICQ has changed its protocol recentely
20:08   didrocks        making it unusable fo pidgin
20:08   didrocks        with*
20:08   didrocks        so, we reported the patch in pidgin for every supported version
20:08   didrocks        that is to say, dapper, gutsy, hardy, intrepid and jaunty :)
20:09   didrocks        that's a lot of work, even for a minor patch
20:09   didrocks        that's why only major bugs are handled for stable releases
20:09   didrocks        blfgomes: does this answer your question?
20:10   didrocks        slytherin: yes, but we will have one more unstable version, so, no change for us :)
20:10   didrocks        Today, we are going to update gnome-terminal. We will see quickly what are the different steps we have to handle generally to update packages, but the best is, of course, to practice!
20:10   didrocks        Even if I use bzr-buildpackage now to work on, we will not use it today. The Unstoppable James Westby has given a great rocking introduction on this last week
20:11   didrocks        Also, this lesson is not intended to teach you how to package. For this, see the corresponding courses in last developpers week session (https://wiki.ubuntu.com/UbuntuDeveloperWeek). Don't forget also the excellent packaginguide: https://wiki.ubuntu.com/PackagingGuide.
20:11   didrocks        Well, ready? Let's download the old version: mkdir gnome-terminal && cd gnome-terminal && apt-get source gnome-terminal
20:11   didrocks        This will download the last release present in jaunty, which is 2.26.0.
20:11   didrocks        tell me when it's ok :)
20:12   didrocks        Remember that you can interrupt the course at any level: even if you feel lost, we will find you! :-)
20:13   didrocks        (let's wait for few seconds too ;))
20:14   didrocks        ok, let's say that the others are too shy :) Let's get into the source package: cd gnome-terminal-2.26.0
20:14   didrocks        To check if new release is available, if a debian/watch file is present, we just have to use: uscan --report --verbose.
20:14   didrocks        The output should be something like this: http://paste.ubuntu.com/262929/. You can see there that a new version is available and corresponds to 2.27.91.
20:15   didrocks        everyone has something similar to the pastebin?
20:16   didrocks        Excited by this new version? \o/ Let's get the new upstream code using uscan! This command just download the new archive, and extract its contents, whith the debian/ubuntu changes applied!
20:16   didrocks        so, just executes uscan this time, with no option :)
20:17   didrocks        The output of the command is telling us that we have to do a "cd ../gnome-terminal-2.26.1" to get into the new package, let's do it (http://paste.ubuntu.com/262930/).
20:17   didrocks        (yes, you can see that I updated the lesson today ;))
20:18   didrocks        Easy, isn't it? Well, when the debian diff doesn't apply because of inline patch, it's getting more difficult, but most of packages are in good shape and every debian difference from vanilla version are
20:19   didrocks        blfgomes: it's downloading the vanilla tar file,
20:19   didrocks        then, trying to apply ../gnome-terminal_2.26.0-0ubuntu2.diff.gz diff file
20:19   didrocks        (this file contains the debian diff)
20:20   didrocks        it's also adding a new entry to debian/changelog
20:20   didrocks        we will see that later :)
20:20   didrocks        Now begins the real packager work. We have to see what changed in upstream release reading the NEWS files (less NEWS and q to exit): http://paste.ubuntu.com/262931/
20:22   didrocks        This is mostly a bugfix release. We will see later what have been fixed. Now, let's discover what changed in configure.{ac,in} file: diff -Nup ../gnome-terminal-2.26.0/configure.ac configure.ac
20:22   didrocks        You will get http://paste.ubuntu.com/262933/
20:22   didrocks        here are the changes from previous version to the last release
20:22   didrocks        What is important in it? gt_version_minor and gt_version_micro changed to tell that a new version is available. That's just tell that upstream does a good job.
20:23   didrocks        If it's not present, there is for librairies something like SHVER for library that you have to change in debian/rules. In every cases, it's good to give a look at debian/rules to see if the version number is
20:23   didrocks        Ok for everyone?
20:25   didrocks        What is most important here is the GTK_REQUIRED and VTE_REQUIRED change. That means that we have to bump the dependencies version request of the package (it will request now 2.14.0 for gtk and 0.20.0 for
20:26   didrocks        You can edit it with your prefered tool (vim ROCKS \o/) and change libgtk2.0-dev (>= 2.13.6) and libvte-dev (>= 1:0.19.1) to libgtk2.0-dev (>= 2.14.0) and libvte-dev (>= 1:0.20.0).
20:28   didrocks        So then, as there is a debian/control.in file, we have to generate a new debian/control file from it. This is proceed by executing: DEB_AUTO_UPDATE_DEBIAN_CONTROL=yes fakeroot debian/rules clean
20:31   didrocks        Finally, inform of your change! dch -a and add to the file so that it will look like: http://paste.ubuntu.com/262934/. You see that the so kind uscan command has automatically created "gnome-terminal 2.27.91"
20:31   didrocks        tell me when it's done :)
20:33   didrocks        (this diff files between old and new configure.in files can also tell us from added/removed dependencies btw. There is no black magic there :D)
20:34   didrocks        Ok, now that build dependencies are ok, we have to see if ubuntu/debian patches still apply to the new version. The what-patch commands tells us that this package use cdbs. Let's try using cdbs-edit-patch debian/patches/99_autoreconf.patch (last patch of the list)
20:34   didrocks        We exited in error in the debian/patches/30_honour_point_pixel_sizes.patch (http://paste.ubuntu.com/151427/).
20:35   didrocks        That can mean two things: either upstream has integrated the patch (or we took previously the patch from upstream svn), or that the code has been slightely modified and we can't apply it easily.
20:35   didrocks        Looking at debian/changelog has to be the first thing to do: http://paste.ubuntu.com/151431/
20:36   didrocks        In this case, we see a bug report LP: #345189 associated to the patch. Looking at it (https://bugs.launchpad.net/bugs/345189), we deduce that the change is present upstream, looking at the Fix Released
20:36   didrocks        Consequently, we can safely remove the patch, "rm debian/patches/30_honour_point_pixel_sizes.patch".
20:39   didrocks        So, here, patch is integrated upstream. That's why we removed it. If it wasn't the case and the cause was that upstream changed slightely its code, we had to cdbs ....patch and adapt it to make it apply
20:39   didrocks        That's why we have always to report our patch upstream (appart from specific ubuntu ones) :)
20:40   didrocks        it's good for them, less work for us, everyone wins \o/
20:40   didrocks        Ok, bring this information to debian/changelog: dch -a and report the change to make it look like that: http://paste.ubuntu.com/262937/
20:40   didrocks        tell me when it's ok :)
20:42   didrocks        Ok! Let's go on with next patch: $ cdbs-edit-patch debian/patches/99_autoreconf.patch again.
20:42   didrocks        The last patch doesn't apply /o\
20:43   didrocks        That's pretty normal: autotools/autoconf/autoreconf patch are different from others patches. They basically consist of generating configure scripts from configure.in, makefile.in one (like
20:43   didrocks        We have to exit first, without updating the patch: "exit 1"
20:44   didrocks        fenris-: yes, that's why I told it failed
20:44   didrocks        Pollywog: cdbs-edit-patch basically copy your files and drop you in a subshell
20:45   didrocks        when exiting, it will diff /tmp/old /tmp/new > patch
20:45   didrocks        (exiting with 0, if you exit in error, like exit 1, it will change nothing)
20:46   didrocks        a good introduction about patch system is there: https://wiki.ubuntu.com/MeetingLogs/devweek0809/PackagePatches
20:47   didrocks        we will regenerate the patch from scratch
20:48   didrocks        so, what you can do, is to remove the patch: "rm debian/patches/99_autoreconf.patch"
20:48   didrocks        Finally, $ "cdbs-edit-patch debian/patches/99_autoreconf.patch"
20:48   didrocks        (it again drop you to a subshell)
20:48   didrocks        and to generate the configure and makefiles: autoreconf
20:49   didrocks        so, this takes Makefile.in to create Makfile, configure.in to create configure, and so on.
20:49   didrocks        Once done (ignore the warnings), exit 0 to refresh the patch and document the change: dch -a to get http://paste.ubuntu.com/262940/
20:50   didrocks        We have almost finished: every patches applies and build-dependencies are ok. Normally, you testbuild at this stage, but we won't do it as we are running out of time and not everybody has been abled to do
20:50   didrocks        Once done, a good practice is to put changes from the upstream NEWS file in the changelog. So, get the changes following the given link in the NEWS file and report it to the changelog. Extra bonus point
20:51   didrocks        If this time-consuming work is well done, you will get this: http://paste.ubuntu.com/151454/
20:51   didrocks        You can take a breath now! You have your new package updated! Think about testing it throughly and everything will be all right.
Last thing to note is to check which bugs are fixed in current upstream release, find them on launchpad to be able to close them as well. This can sometimes take a lot of times.
20:51   didrocks        Now, rooms for remaining questions , just fire up! :)

</pre>
https://wiki.ubuntu.com/Packaging/Training/Logs/2009-04-16
