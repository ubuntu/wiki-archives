{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


* '''Launchpad Entry''': <nowiki>[[https://blueprints.edge.launchpad.net/ubuntu/+spec/desktop-karmic-integrating-with-ubuntu-one|Integrating with Ubuntu One]]</nowiki>
* '''Created''': 2009-06-17
* '''Contributors''': <nowiki>[[https://edge.launchpad.net/~joshuahoover|Joshua Hoover]]</nowiki>, <nowiki>[[https://edge.launchpad.net/~stevea|Steve Alexander]]</nowiki>, <nowiki>[[https://edge.launchpad.net/~statik|Elliot Murphy]]</nowiki>, <nowiki>[[https://edge.launchpad.net/~lucio.torre|Lucio Torre]]</nowiki>
* '''Packages affected''': python-contacts-api, dbus-contacts-api, erlang-base, erlang-inets, erlang-xmerl, couchdb, couchdb-bin, ubuntu-couchdb, couchdb-oauth, couchdb-history, ubuntuone-sync-ui, evolution-couchdb, akonadi-couchdb, firefox, bookmarks-couchdb, python-couchdb, couchdb-glib, dbus-couchdb, python-couchdb-records-api, dbus-couchdb-records-api, icontool, ubuntuone-client, ubuntuone-storage-protocol, python-oauth, ubuntuone-screensharing, gwibber-couchdb, python-configglue, python-pyinotify

=== Summary ===

Ubuntu One provides capabilities for the Ubuntu desktop as well as extended capabilities via optional online services. Integrating Ubuntu One capabilities with the Ubuntu desktop will provide storage sharing & synchronization (using the Ubuntu One online service), screen sharing, and data (contacts, notes, Firefox bookmarks) sharing & synchronization via CouchDB.

=== Release Note ===

TBD...

=== User stories ===

==== Data Sharing & Synchronization ====
* '''Synchronize & Share CouchDB Databases Across LAN''' - Jacko has two desktop computers at home running Ubuntu but is not an Ubuntu One subscriber. One of the computers is in his kitchen connected to a local wifi network. He has developed an application to store recipes in a CouchDB database and would like to sync the data between his two computers. Jacko opens the CouchDB Data Sync application. Jacko clicks the button in the app to make the computer in his home office visible for synchronization for a limited amount of time (minutes). Jacko then goes to the computer in the kitchen and sees a dialog asking him if he's like to link his kitchen computer to his home office one. Jacko clicks OK and the CouchDB recipes database is transferred to the kitchen computer.
** Jacko updates a recipe on his kitchen computer. The kitchen computer synchronizes the CouchDB recipes database with the home office computer. 

===== Contacts =====
* '''Store Contacts Online''' - Tom has a list of contacts in his Evolution Address Book that is pulled from the local CouchDB contacts database on his desktop computer. He subscribes to Ubuntu One. Tom's contacts database is synchronized to the cloud. Tom can use a web browser to view and edit his contacts, in addition to being able to modify them in Evolution. Any changes he makes in the web browser are synchronized with his desktop computer and vice versa.

* '''Synchronize Contacts Across Computers With Ubuntu One Service''' - Tom has multiple computers and he wants to configure his netbook to synchronize his contacts with Ubuntu One. Tom authenticates his second computer with his Ubuntu One subscription. The netbook pulls down any contacts from the cloud and adds them to his local contacts database. Tom can now access his synchronized contacts using the Evolution Address Book backed by CouchDB.
** Tom makes a change to a phone number on his netbook. That changed is copied to the cloud. Tom signs into his desktop computer and changes are pulled from the cloud and synchronized with his desktop computer. 

* '''Synchronize Contacts Across LAN''' - Tom cancels his Ubuntu One subscription. Using Evolution, he makes a change to his contacts on his desktop. Tom's signs into his netbook. His desktop database synchronizes any changes with his netbook contacts database. New contact information is now available to Tom using Evolution on his desktop computer.

===== Bookmarks (Firefox) =====
* '''Synchronize Bookmarks Across Computers With Ubuntu One Service''' - Sarah is an Ubuntu One subscriber. She is using Firefox on her netbook while on a business trip. She bookmarks several sites. Her bookmarks are saved in a CouchDB databases through a Firefox CouchDB Sync plugin that was enabled by default. Sarah is back at home and using her main laptop. Sarah opens Firefox and the Firefox CouchDB Sync plugin checks with the Ubuntu One service to see if there is a need to synchronize and there is. The Firfox CouchDB plugin triggers a sync with the Ubuntu One service. Bookmarks are synchronized and Sarah selects one of the bookmarks from her netbook.

==== File Sharing & Synchronization ====
* '''Ubuntu One Account, Subscription & Computer Setup''' - Jacko is running Ubuntu 9.10 on his desktop. He establishes an Ubuntu One account using his Launchpad ID and subscribes to the paid 10GB plan using his credit card. Jacko launches Ubuntu One on his desktop from the Applications->Internet->Ubuntu One menu. A browser window appears and asks him to authenticate his computer with his Ubuntu One subscription. Jacko completes this process. Any folders in his ~/Ubuntu One directory will be copied and stored in the cloud.

* '''Add A Computer To Use Ubuntu One Service''' - Jacko has multiple computers and he wants to configure his netbook to synchronize folders with Ubuntu One. Jacko launches the Ubuntu One Sync Client on his netbook. A browser window appears and asks him to authenticate his second computer with his Ubuntu One subscription. Jacko completes this process. The netbook will pull down any folders from the cloud and add them to ~/Ubuntu One. Jack adds a folder of music files to his ~/Ubuntu One directory. This folder is synchronized with the cloud. Jacko logs into his desktop computer. New files are pulled down from the cloud and his desktop is in sync with his netbook. 

* '''Share Files Using Ubuntu One Service''' - Share Folders Using Jacko uses Nautilus to browse to a directory of photo files within ~/Ubuntu One. Jacko right-clicks on the directory and chooses to Share on Ubuntu One with his friend Ben. A window appears and he types Ben's email address and clicks to not allow Ben to edit this folder. This setting is pushed to the cloud and a sharing invitation is sent to Ben. Ben receives an email notification that Jacko has shared a folder with him. Ben already has an Ubuntu One subscription. He logs into his computer and the Ubuntu One Sync Client on Ben's computer pulls the folder of pictures from the cloud. Ben opens ~/Ubuntu One and he can view the shared folder of photos from Jacko. 
** Ben is away from his computer but wants to see the photos. Ben can log into the Ubuntu One website and browse to Jacko's shared folder of photos.
** Jacko wants to stop sharing the folder of photos with Ben. Jacko logs into the Ubuntu One website and browses to the folder. He clicks the sharing tab and cancels the share with Ben. Ben logs into his computer and the Ubuntu One Sync Client removes the photos from Ben's ~/Ubuntu One folder.

==== Screen Sharing ====
* '''No Ubuntu One Accounts''' - Jacko and Fiona do not have Ubuntu One online accounts. Jacko opens Empathy and connects to a Jabber (XMPP) server. Jacko right-clicks on Fiona's name in his Empathy buddy list and chooses "Share my screen". Fiona has Empathy open and receives a notification in Empathy that Bob wants to share his screen. Fiona selects OK. A screen sharing session is started using Telepathy to negotiate the best connection. Vino launches on Jacko's computer and Vinagre starts up on Fiona's computer. Jacko sees the message, "Fiona's looking at your desktop" and Fiona sees Jacko's desktop.

* '''Ubuntu One Subscribers''' - Tom and Ben have Ubuntu One subscriptions which includes a Jabber user account on an Ubuntu One Jabber (XMPP) server. They both have Empathy running on their computers. Tom right-clicks on Ben's name in his Empathy buddy list and chooses "Share my screen". Ben sees a notification in Empathy that Tom wants to share his screen. Ben selects OK. A screen sharing session is created using Telepathy and an Ubuntu One connection manager. The connection manager verifies that Tom or Ben has an Ubuntu One subscription and finds the best way to connect using an Ubuntu One proxy server. Vino launches on Tom's computer and Vinagre starts up on Ben's computer. Tom sees the message, "Ben's looking at your desktop" and Ben sees Tom's desktop.

=== Design ===

==== File Sharing & Synchronization ====
File sharing and syncronization allows users to share and synchronize files using an Ubuntu One online service. Sharing across a users LAN is not planned for Karmic.

The Ubuntu One client will no longer use a client applet (as is the case with the current beta). Instead, the client will use downloads, FUSA, and standard Ubuntu messaging indicators.

'''Packages:'''
* icontool (Main)
* ubuntuone-client (Install CD)
* ubuntuone-storage-protocol (Install CD)

==== Screen Sharing ====
Provides screen sharing between two desktops using Empathy, Telepathy. The "Share My Desktop" dialog will be unaffected. An optional Ubuntu One service will provide a proxy (utilizing ejabberd on the server) to allow users to more easily share their screens across the Internet.

'''Packages:'''
* ubuntuone-screensharing (Install CD)

==== Data Sharing & Synchronization ====

===== CouchDB =====
'''Overview''': <nowiki>[[http://couchdb.apache.org/|Apache CouchDB]]</nowiki> is a distributed, fault-tolerant and schema-free document-oriented database accessible via a RESTful HTTP/JSON API. CouchDB is the database for Ubuntu One data sharing and synchronization capabilities.

Erlang is the language and runtime environment for CouchDB. Work will be done to trim the Erlang package so that it is as small as possible to run CouchDB and other applications dependent on the Erlang runtime.

Each user will run their own instance of CouchDB, which is different than the standard install of the current CouchDB package. There is also a need to setup various CouchDB configuration files, design docs, and triggers. Additional capabilities will be added to CouchDB, including <nowiki>[[http://oauth.net/|OAuth]]</nowiki> support and document history.

In order for developers to more easily use CouchDB in their applications, we will provide libraries for a variety of languages and environments, including Python, DBUS, and GTK (GLib).

A new desktop application will be developed to allow users to easily share and synchronize their data (contacts, notes, bookmarks, etc.) stored in CouchDB between Ubuntu computers on their local network.

'''Packages:'''
* erlang-base (Install CD)
* erlang-inets (Install CD)
* erlang-xmerl (Install CD)
* couchdb (Main)
* couchdb-bin (Install CD)
* ubuntu-couchdb (Install CD)
* couchdb-oauth (Install CD)
* couchdb-history (Install CD)
* python-couchdb (Install CD)
* couchdb-glib (Install CD)
* dbus-couchdb (Install CD)
* python-couchdb-records-api (Install CD)
* dbus-couchdb-records-api (Install CD)
* ubuntuone-sync-ui (Install CD)

===== Contacts =====
Providing a CouchDB contacts database that all Ubuntu applications can use is one of the key applications of the Ubuntu One data sharing and synchronization capability. Integration with Evolution and Akonadi will provide the ability to store contacts in CouchDB. By default, Evolution and Akonadi will continue to use their current contact data store. Users will be able to choose to store their Evolution or Akonadi contacts in CouchDB. There will also be a contacts API for Python and DBUS, which will allow developers to use the CouchDB contacts database without worrying about the underlying details of CouchDB and the contacts schema. 

'''Packages:'''
* evolution-couchdb (Install CD)
* akonadi-couchdb (Universe)
* python-contacts-api (Main)
* dbus-contacts-api (Main - Possibly Install)
* gwibber-couchdb (Main)

===== Bookmarks (Firefox) =====
A Firefox bookmarks synchronization and sharing extension will store Firefox bookmarks in CouchDB, which will provide sharing and synchronization capabilities.

'''Packages:'''
* firefox-bookmarks-couchdb (Install CD)

==== Misc ====
The packages below include the Python OAuth library and a tool for managing Ubuntu One configurations.

'''Packages:'''
* python-oauth (Install CD)
* python-configglue (Install CD)

=== Implementation ===

==== Code Changes ====
* '''ubuntuone-client'''
** Provides file sharing/syncing capabilities
** Contains Nautilus extension that provides:
** Ribbon for connecting/disconnecting from Ubuntu One FS service within the "Ubuntu One" folder
** Displaying different icons on files in the "Ubuntu One" folder based on sync status
** Potentially provide the ability to configure Ubuntu One client
** Extend FUSA to provide option to connect/disconnect from Ubuntu One FS service
* '''couchdb'''
** Breaks down into the following binary packages
** couchdb-bin
*** couchdb package without starting a system-wide instance
** ubuntu-couchdb
*** Start up an individual CouchDB server for each user and setup triggers, etc.
*** D-Bus daemon will start via D-Bus activation on the user's session bus & announce the port CouchDB is running on
** couchdb-oauth
*** OAuth support for CouchDB
* '''erlang'''
** Reducing the size of the runtime in order to include in Karmic installer
* '''evolution-couchdb'''
** Provides the option to store contacts in CouchDB
** Will install with Evolution as an optional contacts store
* '''akonadi-couchdb'''
** Provides the option to store contacts in CouchDB
** Will install with Akonadi as an optional contacts store
* '''ubuntuone-sync-ui'''
** Daemon will be created to mediate the linking process between CouchDB's running on the LAN
* '''firefox-bookmarks-couchdb'''
** Firefox extension to store bookmarks in CouchDB
** Will install with Firefox as default bookmarks store

=== Test/Demo Plan ===

TBD

=== Unresolved issues ===

This should highlight any issues that should be addressed in further specifications, and not problems with the specification itself; since any specification with problems cannot be approved.

=== BoF agenda and discussion ===

* ubuntu-one uses the couchDB database

* couchDB supports replication, it's very simple, open and uses structured data

* ubuntuone provides an API to couchDB

* couchDB has good upstream support, and we need to get it into main for karmic

* the service in front of couch supports http, which simplifies access for the API

* lazr.restful, a python api originally developed for launchpad

* couchDB needs erlang
** erlang is about 45M installed size
** maybe we can strip down erlang to make it fit more easily fit the single live CD

* the application only needs to know how to handle the structured data with couchDB, not worry about things like sync, replication, etc

* one use case, having a syncronized addressbook
** evolution-data-server directly queries ubuntuone (locally)
** the contact database from ubuntuone does sync locally, so e-d-s doesn't directly query the server just the local sync of the service

* for the contact storage, what is the upgrade path?

* start time is something to consider, the syncdaemon runs continuously, but it is in the background
** perhaps defer the rescan to speed up login time

* working with the design team to work out the details of what to do with the applet
** it might go away when idle

* other uses:
** screen sharing
** for now sticking with current technology, vino and vnc
** bookmark syncing
** trademark issues with customizing firefox
** perhaps weave integration
** modifications would be made in ubufox
** tomboy sync
** sync notes to u1 instead of snowy
** should we consider gnotes?
** backing up a usb drive when plugged in

* What KDE apps should integration with u1?
** system wide storage called akonadi using mysql

* ultimately all configuration should be done in the applications, but we might use a common u1 control panel to configure various aspects of u1 until we get that level of integration

* we need to work on the MIR for the u1 client and deps (including erlang) for karmic

* before doing the MIR we should figure out how we can split erlang into smaller chunks for CD size constraints. See:
** https://launchpad.net/bugs/385104 (done)
** https://launchpad.net/bugs/385120
** https://launchpad.net/bugs/385095
** https://launchpad.net/bugs/385093

----
CategorySpec
