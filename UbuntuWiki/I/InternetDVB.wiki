{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


This information about HOWTO setup DVB PCI Card for internet (tested with b2c2 chipset) using Ubuntu 5.10 Breezy Badger and Ubuntu 6.06 Dapper Drake. 

=== Requirement ===

* Processor Clock 800 Mhz 
* HDD 
* Memory 256Mb
* Ethernet Card
* DVB PCI Card   (i used b2c2 from technisat <nowiki>[[http://www.technisat.com]]</nowiki>)

=== Fresh New Server ===

We need fresh server from ubuntu, so we have to install ubuntu in server mode. For detail instructions howto install in server mode see <nowiki>[[http://www.howtoforge.com/perfect_setup_ubuntu_5.10]]</nowiki>

if you don't like to be root, choose sudo or fakeroot !

i like to be root <nowiki>[[https://help.ubuntu.com/community/RootSudo]]</nowiki>

<pre>
$ sudo passwd
$ su
</pre> 

put Ubuntu Install CD back into CDROM drive 

as root 
<pre>
apt-get install build-essential
</pre>

=== DVB Packages ===

get the packages from linuxtv.org <nowiki>[[http://www.linuxtv.org/downloads/linuxtv-dvb-apps-1.1.1.tar.gz]]</nowiki>

<pre>
tar -zxvf linuxtv-dvb-apps-1.1.1.tar.gz
</pre>

make it simple 
<pre>
mv linuxtv-dvb-apps-1.1.1 linuxtv
</pre>

i have made my own '''patch''' for better display.  <nowiki>[[http://software.prima-info.com/linuxtv-dvb-apps-dvbnet.patch]]</nowiki>

patch and compile them all.
<pre>
cd linuxtv
patch -p0 <linuxtv-dvb-apps-dvbnet.patch
make
</pre>

if no error report 
copy all off them to /usr/local/bin

<pre>
cp util/dvbnet/dvbnet /usr/local/bin
cp util/dvbtraffic/dvbtraffic /usr/local/bin
cp util/scan/scan /usr/local/bin
cp util/szap/szap /usr/local/bin
cp util/szap/femon /usr/local/bin
cp util/dvbdate/dvbdate /usr/local/bin
</pre>

=== Testing ===

before we do some testing, we need this informations from satellite internet provider (DVB-S) :
* Satellite band freq (c-band, ku-band) 
* Polarization
* Frequency
* Symbol rate
* FEC 
* PID

my configurations is
* Satellite Band freq = C-BAND
* Frequency = 3680 Mhz
* Polarization = Horizontal
* Symbolrate = 26666 ksym/s
* FEC = 3/4
* PID = 4004

<pre>
mkdir /root/.szap
cd /root/.szap
</pre>

==== Testing : dvbnet ====

what we need here is PID (from dvb internet provider). for example our pid is 4004 (decimal)

<pre>
dvbnet -p 4004
</pre> 

now you can see your new adapter dvb0_0

<pre>
ifconfig dvb0_0
</pre>

if you didn't see correct MAC address
<pre>
ifconfig dvb0_0 hw ether "$YOUR_MAC_ADDRESS" 
</pre>

==== Testing : scan ====

we are ready to scan the transponder now
i assume that satellite dish is on the right pointing 

<pre>
cd /root/.szap
echo S 3680000 H 26666000 3/4 > sat.conf
scan -l c-band sat.conf
</pre>

this will ok if no error message.

==== Testing : szap ====

this session will create our channels configuration (this is my configuration).

<pre>
cd /root/.szap
echo myprovidername:3680:h:0:26666:0:0:7 > channels.conf
</pre>

we will tune it now !!
<pre>
szap -l c-band -n 1 
</pre>

if you see '''"FE_HAS_LOCK"''' ... dvb card is tuned fine !

CTRL+C to stop it !

make it run as daemon

<pre>
start-stop-daemon --start -q -b -x /usr/loca/bin/szap -- -l c-band -n 1  
</pre>

from now, you can only check it by using femon

<pre>
femon
</pre>

==== Testing : dvbtraffic ====

testing data capability 

{{{ 
dvbtraffic
}}}

you can also monitor internet packet at dvb0_0  
<pre>
tcpdump -i dvb0_0
</pre>

you can also using iptraf 

=== rc.d "init_dvb" ===

we will make it start automatic every times our pc is re-boot. 

we need this script '''init_dvb''' or get it from <nowiki>[[http://software.prima-info.com/init_dvb]]</nowiki>

and put it on /etc/init.d

<pre>

DEV_NAME=dvb0_0

IP_ADDR=169.254.255.29
NETMASK=255.255.0.0
BROADCAST=169.254.255.255
SZAP=/usr/local/bin/szap
DVBNET=/usr/local/bin/dvbnet

PID=4004

MAC_ADDR= 

. /lib/lsb/init-functions
chk=`$DVBNET -l | grep dvb0_0`
hk=`ps ax | grep szap | grep -v grep | awk '{print $1}'`

load_szap () {
   sleep 1
   start-stop-daemon --start -q -b -x $SZAP -- -l c-band -n 1 -c /root/.szap/channels.conf
}

load_pid () {
  $DVBNET -p $PID 
  RET=$?
  sleep 1
  if [ "$RET" -gt 0 ] ; then 
  	log_end_msg $RET
  	echo   "   Error: Unable to create dvb0_0 ...!"
	exit 1;
  fi
}

unload_dvb () {
	ifconfig dvb0_0 down
	sleep 1
	$DVBNET -d 0 
	sleep 1
}

case "$1" in
start) 
	if [ -n "$chk" ] ; then
		log_begin_msg "Re-starting dvb..."
		unload_dvb
		load_pid
	fi

	if [ -z "$chk" ] ; then 
		log_begin_msg "Starting dvb..."
		load_pid
	fi

	if [ -z "$MAC_ADDR" ]; then
		ifconfig $DEV_NAME $IP_ADDR netmask $NETMASK broadcast $BROADCAST up
	else
		ifconfig $DEV_NAME $IP_ADDR netmask $NETMASK broadcast $BROADCAST hw ether $MAC_ADDR up
	fi

	if [ -n "$hk" ] ; then

		kill "$hk"
		load_szap
	fi
	if [ -z "$hk" ] ; then
		load_szap
	fi
		log_end_msg $?

;;
stop) log_begin_msg "Stopping dvb..."
   sleep 1
	if [ -n "$chk" ] ; then
		ifconfig dvb0_0 down
		unload_dvb
		sleep 1
	else 
		log_end_msg 1
                echo  "   Error: no such interface dvb0_0 ...!"
		exit 1

	fi

	if [ -n "$hk" ] ; then
		kill "$hk"
	fi

		log_end_msg $?

	;;

* )  log_success_msg "****************************** *"
    log_success_msg "                               *"
    log_success_msg "  Usage: init_dvb start|stop   *"
    log_success_msg "                               *"
    log_success_msg "****************************** *"
  exit 1
;;
esac

</pre>

make it stay on '''rc.d''' then '''reboot'''
<pre>
update-rc.d init_dvb defaults
reboot
</pre>

=== Links ===

* linux dvb application <nowiki>[[http://linuxtv.org]]</nowiki>
* patch & script <nowiki>[[http://software.prima-info.com]]</nowiki> 
* my dvb pci card <nowiki>[[http://www.technisat.com]]</nowiki> 
* Installation tutorial <nowiki>[[http://www.howtoforge.com/perfect_setup_ubuntu_5.10]]</nowiki>
----
CategoryDocumentation
