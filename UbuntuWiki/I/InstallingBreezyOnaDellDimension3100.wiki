{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

== How to Install Ubuntu 5.10 "Breezy" On Dell Dimension 3100 Workstations ==

Breezy won't install on the Dimension 3100 due to incomplete/lacking USB driver support in linux kernel 2.6.12.  It hangs completely on install, and even if it didnt hang, the USB keyboard wouldn't work anyway so you wouldn't get anywhere.

After much effort, I have the been able to complete the install by booting off the latest Knoppix live-CD (4.0.2).  Knoppix uses kernel 2.6.12 as well but it seems to work with the USB controller; I have no idea why.  This article is based on the method I used and documented on my internal "Trac" wiki at work.

(brief note: the lastest version of Ubuntu 6.06 LT boots Ok on my dell 3100, keyboard,  mouse, sound video ok, haven't tried installing it yet - Laffoley July 07)

The following briefly describes the install procedure - utilising debootstrap, chroot, downloading a 2.6.15 kernel source tarball and building it on your bare system, and then installing your new kernel package.

* First and foremost,  the Dell USB Keyboard '''does not seem to work''' with Knoppix.  You'll have to get another USB keyboard.  Plug the machine into the network as well.

* Insert the Knoppix cd.  Boot from the cd. Open a console window.

* Change to root. ("su").  Partition /dev/sda using "cfdisk".  I chose to keep the Dell utility partition (/dev/sda1) so my main partition is /dev/sda2.  Make a swap file of around 2GB.

* Format the linux partition (eg sda2, if you kept the Dell utility partition).  "<code>mkfs.ext3 /dev/sda2</code>"

* Format the swap partition. "<code>mkswap /dev/sda5</code>" (use the correct partition!)

* Now it's time to configure the networking.  If you are plugged into a DHCP enabled network you should automatically have a an ip address, default gateway, and DNS set up.  Check with "/sbin/ifconfig" to make sure.  If you have no ip address for eth0 do the following:

<pre>
}}}

* Edit /etc/resolv.conf with your favorite editor and add the following line: "<code>nameserver "xxx.xxx.xxx.xxx"</code>" (substitute with your local nameserver address.)   If all goes well you should be able to ping www.google.com.

* Now it's time to install the Ubuntu system.  First mount the new partition. "<code>mount -t ext3 /dev/sda2 /mnt</code>".

* We will use the "debootstrap" program to install the new system from the network.  Unfortunately, Knoppix doesnt have a breezy install script for debootstrap, but it does have a hoary one, so we can apt-get dist-upgrade later :)

* Time to do debootstrap.  Run "<code>debootstrap hoary /mnt/ http://archive.ubuntu.com/ubuntu/</code>".  This will install a basic Hoary system at /mnt

* We will copy the other important files on to the system now, including the new kernel. Do the following:

{{{
</pre>

* It's a good time to edit <code>/mnt/etc/fstab</code>, <code>/mnt/etc/network/interfaces</code>, <code>/mnt/etc/hostname</code> and <code>/mnt/etc/hosts</code> on the new filesystem (mounted under /mnt) and change the values there to something sensible.  What to put in is beyond the scope of this document with my limited time (my apologies for the faint of heart).  Normally these files can be configured through the excellent Gnome or KDE "settings" tools but unfortunately we need to do these manually in this case.  Look at similar files from an existing Ubuntu install if you have access to one.

* Last thing before we chroot to the breezy partition:  Run "<code>modprobe dm_mod</code>".  This is required for installing the kernel image package that you will make.

* Chroot to new filesystem. "<code>chroot /mnt</code>".  You are now in the new system!  Of course nothing is running from there.

* Create new devices in /dev so that base-config won't terminate prematurely.  I assume these will be created automatically if we can boot successfully into the system but for now we will use "mknod":

<pre>
}}}

* Every good linux box needs a "procfs" filesystem.  Utilities that work with interfaces, monitor processes, and read/change kernel parameters use it.  So we need to mount it.

{{{
</pre>

* Run "base-config".  Choose http as the apt-method... we will use the Breezy cdrom once we have rebooted successfully to install the desktop system. Create a user.

* About this time you may want to edit /etc/apt/sources.list and change your dist to breezy.  Then "<code>apt-get update;  apt-get dist-upgrade</code>".  Or you may be happy with a Hoary system.  Choice is a great thing!

* Install the bootloader: 
<pre>
apt-get install grub
mkdir /boot/grub
</pre>

* Install kernel headers for 2.6.12-9 (only found in Breezy, so subsitute an appropriate version for hoary).  This is needed for the config file, so all the right modules are installed.  <code> apt-get install linux-headers-2.6.12-9 </code>.  For some reason the config is not in the 2.6.12-10 package, which is too bad, because the linux-image-xx.xx.xx-x packages are so much bigger, and also contain the config.

* Untar the kernel image (2.6.15) at /usr/src.  Change to the kernel directory.  Run the following: <code>gunzip -c /usr/share/doc/linux-headers-2.6.12-9/config-2.6.12-9.gz > .config</code>.  This will give us an Ubuntu compatible kernel (hey, it works for me at least!).

* Run "<code>make oldconfig</code>".   Just hit <enter> for any new kernel features that you are asked about.  Thats what I did :).

* Follow the instructions in KernelCompileHowto.  Download the build tool packages.  Make sure you use the <code>--initrd</code> option for <code>make-kpkg</code>.

* Install the kernel image you made: "<code>dpkg -i /usr/src/linux-image-2.6.15_<your release>_i386.deb</code>". Answer the questions sensibly.  Yes you want to install the initrd, etc.

* Run "update-grub".  It will ask if it can generate the  <code>/boot/grub/menu.lst</code> file. You definitely want this.

* Now we must edit the /etc/grub/menu.lst file.  Look for line starting with "<code># groot=(hd0,0)</code>" and change it to (hd0,1) if your /boot is in the sda2 partition, or leave it as (hd0,0) if it is sda1.  Next look for the line "<code># kopt=root=/dev/sda1 ro quiet</code>" and put the correct root partition in.  Do not uncomment those lines, they are used by "update-grub"

* Run update-grub again. It will apply the changes we just made to the entries in /boot/grub/menu.lst.  It sure is a nice program.

* Now "grub-install /dev/sda" to write the new master boot record!

* Thats it! Now reboot!  Hopefully everything should boot ok and you can log in as the user you just created. You can plug the Dell keyboard in and play around with it, too.

* To finish the install, we can use the Breezy install cd if it is handy, this will save bandwidth.  Just pop it into the cd tray, and run "<code>sudo apt-cdrom add</code>".  After that we run "<code>apt-get install ubuntu-standard ubuntu-desktop</code>".  You should have a working system once that completes, or one that needs only minor configuration.  You may need to restart gdm with "<code>sudo /etc/init.d/gdm restart</code>" to get a graphical desktop.

* It is convient to comment out the cdrom entry from /etc/apt/sources.list, if you want to apt-get new packages from the ubuntu archive.

Disclaimer: hopefully I haven't forgotten any step, but if I have, and you figure out what it is, please edit this page and add it!  Hope this helps.

OndrejBaudys
----
CategoryHardware CategoryCleanup
