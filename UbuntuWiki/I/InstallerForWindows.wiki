{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


''This specification is marked as Approved in Launchpad.  Please contact the Assignee or another knowledgeable person before making changes.''

* '''Launchpad Entry''': UbuntuSpec:installer-for-windows
* '''Packages affected''': <nowiki>[[Ubiquity]]</nowiki>, <nowiki>[[Casper]]</nowiki>, <nowiki>[[Winfoss]]</nowiki>, <nowiki>[[Wubi]]</nowiki>

=== Summary ===

A loop-mounted Ubuntu install initiated in Windows. The installer asks fewer questions and does not partition or format drives. The installer behaves like a normal application installer, allowing users to uninstall Ubuntu via the control panel, yet provides a dual boot setup. 

=== Release Note ===

Installing Ubuntu is now even easier for Windows users! The small installer program will copy a fully-functional Ubuntu system into a directory on your Windows drive (this includes a USB keydrive), which you can then boot in a "dual-boot" configuration.  This is a great way to try out Ubuntu over a period of time, with no re-partitioning or formatting required.  For long-term use, we recommend migrating to a native disk install.

Please note that suspend functionality may be disabled when using this Ubuntu configuration.

=== Rationale ===

Windows users are often more comfortable downloading and running a small ubuntu-setup.exe file than downloading and burning an ISO.  This also avoids the requirement of booting from the CD, which can be troublesome as some laptops do not have a CD drive and many systems are configured to boot from the hard disk first.

===== Advantages =====

* No disk resizing or partitioning required
* No CD burning required, works on laptops without CD drives
* Easy to remove Ubuntu from the system, restoring the system to its previous state
* The bootloader is not replaced, an additional boot option is addded to it
* Ubuntu is installed/uninstalled as any other Windows application, which is comfortable for the user
* Runs at near-native speeds using all system resources (provided the loop mounting is efficient)
* Uses all available hardware as a normal install would (in like a virtualbox install)
* It can install Ubuntu in a USB keydrive (and optionally add a bootloader in the keydrive)

=== Use Cases ===

* Sindre wants to give Linux a try but uses his only computer for work and does not want to repartition his drive, worried that something will break. The Live CD he received guides him through installing Ubuntu in a file on his widows system, which he then boots into.
* Hellena writes tech reviews for on-line journals. She has tested various Linux distros in the past using VMware, but this does not quite yield a native experience. On the Ubuntu website she finds a small download that runs in Windows and produces a loop mounted install. After testing and reviewing she can delete it easily.

=== Design ===

==== Bundled LiveCD Version ====

A small executable that can be included on the CD which does the following: 

* If an Ubuntu CD is not present in a CD drive, locates the ISO on your system or downloads it via <nowiki>[[http://hampus.vox.nu/metadl/|metadl]]</nowiki> (which can be taught to perform mirror selection)
* Asks for a user name and password
* Gathers information from Windows for the remaining install settings
* Creates a 5GB image file in a user-defined location, <code>C:\ubuntu</code> by default
* Creates a pre-seed file for the install
* Adds Ubuntu entry to the Windows bootloader
* Reboots to start an install process (non-interactive)
** if a CD is present in a drive, uses that; otherwise loop-mounts an ISO image from the Windows drive
** loop-mounts disk image from the Windows drive
* Uses a pre-seed enabled version of ubiquity
* Reboot again to start Ubuntu (or Windows)
* Allows simple removal of Ubuntu if desired, via a Windows-based uninstaller in add/remove programs
* Installer can be launched from the WinFOSS browser

==== Standalone Version ====

Prominent download location on the Ubuntu website providing a standalone version of Wubi as an installation option for Windows users. Some of the advantages of this approach:
 
* No CD burning
* The installer itself is less than 1MB, it takes more bandwidth to send a picture of Ubuntu to a friend... => Easy to "pass it around"
* Built-in advanced download manager with automatic mirror selection, segmented downloads (not yet available), (partial) checksums, and download resume => No nee to ask about a mirror.
* Automatic architecture detection => No need to ask about the architecture.
* Allows to choose any member of the Ubuntu family with a single installer. => More exposure for other flavors

==== CD Boot Version ====

* Asks for confirmation then allows to boot from a physical CD even if the BIOS tries to boot from hard disk, thus allowing users to boot the CD without having to edit their BIOS. Already in Gutsy, a confirmation dialog will be added for Hardy.

=== Implementation ===

* The installer will be based on the Wubi installer
* The installer will ship with early Hardy builds to ensure extensive testing
* Wubi is written in NSIS with various plug-ins (metadl, hashing, isoburner, isoextractor, image creation...)
* Gradually merge upstream the patches now in lupin-support and wubi/override_files 
* While there will be only a single installer, it will detect which distro is in use from metadata on the detected CD or ISO image, and select artwork and kernel boot parameters (preseed files, etc.) appropriately. Hence different versions for Ubuntu, Edubuntu, Kubuntu and Xubuntu, will be provided where only the artwork and ISO differ.
  
==== Outstanding Issues ====

* Unmounting of userspace filesystems should be improved upstream (sendsigs)
* Unmounting of host filesystems should be improved upstream (umountfs)
* Fix update-grub/grub-installer to take into account loopinstallations
* Fsck in ntfs-3g (ntfs-3g, Szaka)
* Image generation: support fallocate in ntfs-3g and vfat to generate preallocated disk images quickly (or support windows-side diskimage creation) (ntfs-3g , Szaka + kernel devs for VFAT)
* Improve on syctl hacks, check whether there is a better way to improve journal robustness in nested filesystems
** check power manager issues with sysctl seetings
** Add alt+sysrq+rsub shortcut to Ubuntu and document for Wubi
* Allow suspend-to-ram with fuse filesystems (Matthew Garrett may look into this)
* Proper external override hooks for installation ISO are very useful, they hopefully will not be needed for wubi-8.04, but they should be improved and generalized (ubuntu-installer), documentation on those should be improved
* Official isolist/metalink support ([WWW] https://bugs.launchpad.net/ubuntu-cdimage/+bug/140458)
* Better detection of existing settings (active screen readers, other accessibility tools, sys/inf files for screen resolution and other hardware settings, propietary fonts?, codecs? wireless drivers?).
* Make Ubiquity aware of existing loop-installations
* Improved downloader with segmented downloads
* Proper build scripts.

==== What installation types should be supported? ====

Wubi can support different type of installations: loopinstallations, r/o ISO booting, physiscal CD booting, netboot (debian-style), hdmedia-style (install from predownloaded ISO saved on hard disk, requires online resizing). The following methods will be provided:

* Loopinstallations (4+ GB)
* Boot CD. If a physical CD is detected the option to simply boot it will be offered (cannot extract ISO because of online partitioning issues)
* Boot from ISO on HD in r/o mode (provided only if free space is less than 4GB, so that users can still experience Ubuntu)
* Burn & Boot: Built-in CD Burner, we are evaluating the possibility of bundling an ISO burner. Cdrtools would be a good match but the license is an issue. A mingw build of cdrkit might be a good solution (if possible).

==== Interface changes ====

* Generic flag icon
* Customized artwork (artwork team)
* Installation size -> Installation type? Or get rid of it.
* Simplification, 1-click: remove language selector, postpone username/password selector to first reboot?

==== Optional features ====

* Online resizing to support hd-media type installations (unlikely, but there is always hope!)
* Netboot support (via alternate initrd, alternative to hdmedia-like installations). Mixing ubiquity interface and d-i interface might be confusing.
* Allow suspend-to-disk with swap on file (kernel devs, unlikely for hardy)
* Bittorrent client
* Expandable images: using hybrid images zeroed for the first 4-5GB (via fallocate) and sparse for n GB more. It depends on how well new version of ntfs-3g can cope with that, alternatively can use LVM with several files of 2GB.
* Better post-install management features. A control panel running in windows that lets you resize disks, make backups, select between different installed systems.
* See Also the <nowiki>[[CommunityGutsyIdeas/Installation]]</nowiki> for more windows-friendly installation methods
* Tighten the graphical design with a nice NSIS skin and suitable ubuntu graphics (Ngompa: look at ExperienceUI)

=== Test/Demo Plan ===

* Ship Wubi with early builds of Hardy
* Widespread community testing
* Test the install procedure on a range of hardware and Windows versions

=== Comments ===

==== With the emergence of new technologies that provide the same advantages, is there even a need anymore for officially supporting loopmounted-installs? ====
With Windows Vista's new dynamic partitions and ability to safely resize its own partitions while running, the partitioning phase can be done in the initial installation phase itself via the Windows Vista Drive Management API, while still running in Windows.
* The dangers and inconveniences of drive partitioning, which the loopmounted-install approach was meant to alleviate, are thus eliminated. Although this will only be compatible with Windows Vista and newer, Vista market share is rapidly rising and is expected to be the dominant OS by the release of Ubuntu 8.04 LTS, or soon afterwards. Users of older OSes can always use the traditional CD install or a (third-party) netboot-based solution such as <nowiki>[[http://lubi.sourceforge.net/unetbootin.html|UNetbootin]]</nowiki>.

The CD iso can be placed on the existing NTFS drive, the installer can be run from the iso, and the installation can be automatically targeted towards the free space that was created while running Windows by shrinking the existing NTFS partition using the Windows Drive Management API, to be used as the root partition for Ubuntu.
* The other advantage, the no-CD install and automated-install, can thus also be retained while avoiding the problems of a loopmounted-install. The clean-uninstallation advantage will also be retained, as the Windows Vista bootloader recovery utilities can be used to re-install the Vista bootloader while running the uninstaller (thus removing GRUB) and the Drive Management API can be used to delete the Ubuntu ext3 partition and expand the Windows NTFS partition to claim the unused space, thus allowing for a clean uninstallation.

Is the 2-step process for installation (first to loopmounted partition, then to dedicated partition) too complicated? Would it be better to simply go for a dedicated-partition install the first way around, using an approach like to the one above, thus eliminating the need for LVPM? 

Are the trivial (if any) advantages provided by a loopmounted installation over a dedicated-partition install, which are not provided by the approach above, worth the extra work of officially maintaining and supporting both the modified loopmounted-booting patches and the LVPM tool?

The above assumes a wide market penetration of Vista, and with Vista struggling to reach 5%, I doubt it will be a viable option for the coming years. It is also arguable that using the Windows partitioning tool as opposed to the Linux one will make users any more comfortable with the idea of changing their partitions. -- Ago
* <nowiki>[[http://www.xbitlabs.com/news/other/display/20071002235454.html|Estimates]]</nowiki> put Vista market penetration as of October 2007 at over 7%; most other neutral sources generally range between 6-9%. Given that basically all new PCs come pre-installed with Vista, this will only increase drastically over time; it's not "struggling". As for the changing of partitions via Windows, since it's handled by official drive management tools not reverse-engineered utilities, there's essentially no chance of data loss; if data corruption or other partition errors are detected, Vista will simply refuse to resize the drive. The rest can be done automatically and transparently to the user (due to the flexibility of the Vista drive-management APIs, a custom, simpler interface may be written and used instead of the official Vista Drive Management GUI), much like how Ubuntu's partitioner currently works; the user simply selects the percent of space to split between Ubuntu and Windows, and the rest of the partitioning is all done automatically; that's just as easy, safe, and transparent as Wubi's approach is currently. Most users' fears of partitioning result not from the interface, but from the risk of data loss; using Vista's dynamic partition features eliminates that risk.
* Also note that even if the adoption of Windows Vista is slower than expected, and it will only be on the majority of PCs within 1.5 or 2 years, rather than the predicted 12-14 months, this approach is still better in the long term. Work, support, and resources should not go into a temporary approach that will be made obsolete within 2 years, especially since 8.04 is an LTS release that will have to be supported for 3 years, and thus, stability, security and resilience, which a loopmounted install lacks compared to a dedicated-partition install, should be the priorities.

==== Security Concerns ====

Any windows based installer potentially subjects the Ubuntu install to corruption by malware running in MS Windows, during the installation process. Hypotheticly, Microsoft could even write an ubuntu virus into MS Windows, that causes the user to have a "bad ubuntu experience" and give up on  it because they think it's unstable or "not ready for the desktop".
* This situation is extremely unlikely (MS would rather avoid the potential uproar from consumer-rights groups if such code were ever embedded into Windows, therefore they would never do it), so that portion of speculation is unwarranted. However, it is indeed true that a loopmounted-install is more vulnerable, at least to a certain degree, to being damaged by malware than a standard, dedicated-partition install is, as any modern antivirus or security application would raise alarms and block the action if malware attempted delete the Ubuntu ext3 partition, but the deletion of the loopmounted disk image files in C:\ubuntu, thus wiping out the Wubi-generated install, will simply be looked upon as a simple file deletion, and therefore may not be detected or blocked by security applications due to the lower level of scrutiny applied to file deletion than partition or MBR modification.
* However, this increased vulnerability to malware is only applicable to loopmounted installs and not "any windows based installer" in general, as with the approach proposed in the "With the emergence of new technologies that provide the same advantages, is there even a need anymore for officially supporting loopmounted-installs?" section, as well as other direct-to-partition install approaches, Windows is only needed for resizing its own partitions and launching the main installer, and the bootloader modifications are undone the next reboot, therefore a dedicated-partition install approach initiated from Windows is no more vulnerable to malware than a standard Ubuntu install would be.
----
CategorySpec
