{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


=== Launchpad ===
Project page for keeping track of feature requests, development, and bug reports.

* https://launchpad.net/opencompute
* https://launchpad.net/opencompute/checkbox
* https://launchpad.net/~opencompute-developers

=== Disposable Operating System (OCP DOS) ===

The OCP DOS is a cloud-init based bootable operating system that includes OCP specific

TODO. Links to download OCP DOS.  (usb, iso, pxe)

TODO. Instructions for creating the OCP DOS. (may go on the OCP Wiki).  To do this under Ubuntu consider using the small cloud image (small and has cloud-init) w/ the kernel/initrd from the maas image (has bare metal drivers).

=== Running the Open Compute Ready Self Testing Scripts (Draft) ===
The Open Compute testing tool is comprised of modules that are run by "checkbox".  Checkbox has the ability to run a list of tests, collect data from those tests, and submit those tests for review.  OCP has two levels of testing: "Ready" and "Certified".  Ready testing is designed to be "self-testing" with little stress testing, little interoperability testing, and requiring limited infastructure for testing.  Ready testing should be easy to do single unit testing.  Certified testing will be done by a certified lab and include more rigerous and manual testing.  When testing for either Ready and Certified status you will run checkbox on the local machine (SUT) via the Disposable Operating System and on a remote machine to test the SUT.

Overview/Comparison of Ubuntu Checkbox and OCP Checkbox test: http://www.opencompute.org/wiki/index.php/Compliance_and_Interoperability/CheckboxWhitelists

==== High Level Overview (Draft) ====

You will need the following before you begin:

1. System under test (the OCP system being tested)
  a. Running a Disposable Operating System compliant OS
# Remote system capable of running checkbox
# Ready self testing documentation
# Misc. hardware for testing connectivity and perephrials
  a. All NICs cabled
  a. USB storage plugged in

The high level procedure is:

# Fill out the OCP Ready self testing documentation
# Install a Disposable Operating System to the SUT
# Boot the SUT and execute the "ocp-ready-local" tests with checkbox
   a. this will collect system data and run local tests
# After the local testing has completed, run the "ocp-ready-remote" tests from a remote system
# Submit the OCP Ready self testing application with results from local and remote testing to the OCP

==== Running the self testing tool (Draft) ====

TODO. Possible content:
* Running it from getting the repo on an existing OS
* Running it from cloud-init
* Running it from the DOS

=== Developing Additional OCP Tests ===

Checkbox is fully open source and anyone can create branches and propose merge requests.  Additional tests can be written and included to checkbox.  Metadata is created that describe the test and any dependencies the test has.  "Whitelists" can be created for running different sets of test.  For example, two whitelists were created for the OCP Ready to run local or remote tests.  In the future new whitelists may be created for "Certified" level of testing or different types of functional testing beyound compute testing.  (For example, a sub set of tests for a storage box, motherboard, memory, flash, etc.).

Example of developing a new test for ipmi: <nowiki>[[OpenCompute-Testing-IPMI|Writing a new IPMI test for checkbox]]</nowiki>

Example of using cloud-init to run checkbox: <nowiki>[[OpenCompute-Testing-CloudInit|Testing with Checkbox in Cloud-init]]</nowiki>

Development Quick Start video: <nowiki>[[http://youtu.be/uudjmYQmawc|quick_start_video]]</nowiki>

Development Quick Start presentation: <nowiki>[[https://docs.google.com/a/canonical.com/presentation/d/1-RxsLFi0bArU879nvJ3gvV_kJpHaGd8lhHQyPkUPZEA/edit#slide=id.gf454ff13_0142|presentation]]</nowiki>

=== SoL (Serial over LAN) ===
This document shows how to configure Ubuntu 12.04.2 Server on Open Compute v2 (Windmill) platform to support IPMI SoL. This procedure was developed using the Serial Console HOWTO (see "External links" below), and adapted to apply specifically to Ubuntu 12.04.2 Server and Open Compute v2 platform. If you find any issues, please file bug reports on the Ubuntu <nowiki>[[https://launchpad.net/opencompute|OpenCompute Launchpad]]</nowiki> page.

==== Ubuntu 12.04.2 System Setup ====
 A. Identify the serial port for the BMC from dmesg
 <pre>
 $ dmesg |grep tty
 [    0.000000] console [tty0] enabled
 [    1.073325] serial8250: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
 [    1.094732] 00:03: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
 [    1.115064] 0000:00:16.3: ttyS4 at I/O 0x9080 (irq = 17) is a 16550A
 </pre>
 ttyS'''4''' is for the BMC.
 A. Find out the console port speed from the BIOS. For the particular platform, the port speed is '''57600'''.
 A. Configuring the console login process
1. Create a file called /etc/init/ttyS4.conf containing the following:
  <pre>
## ttyS4 - getty
## 
## This service maintains a getty on ttyS4 from the point the system is
## started until it is shut down again.

  start on stopped rc or RUNLEVEL=[2345]
  stop on runlevel [!2345]

  respawn
  exec /sbin/getty -L 57600 ttyS4 vt102
  </pre>
1. Ask upstart to start the getty
  <pre>
  sudo start ttyS4
  </pre>
1. Restart init
  <pre>
  sudo /sbin/telinit q
  </pre>
1. Check: On another system that supports IPMI v2, run
  <pre>
## ipmitool -I lanplus -H <System's BMC IP address> -U <userid> -P <password> sol activate
  </pre>
  The console login prompt should appear.
 A. Configuring grub
1. Edit /etc/default/grub
  <pre>
## If you change this file, run 'update-grub' afterwards to update
## /boot/grub/grub.cfg.

  GRUB_DEFAULT=0
  GRUB_TIMEOUT=1
  GRUB_DISTRIBUTOR=`lsb_release -i -s 2> /dev/null || echo Debian`
  GRUB_CMDLINE_LINUX="console=tty0 console=ttyS4,57600n8"

## Uncomment to disable graphical terminal (grub-pc only)
  GRUB_TERMINAL=serial
  GRUB_SERIAL_COMMAND="serial --speed=57600 --unit=1 --word=8 --parity=no --stop=1"

## The resolution used on graphical terminal
## note that you can use only modes which your graphic card supports via VBE
## you can see them in real GRUB with the command `vbeinfo'
## GRUB_GFXMODE=640x480

## Uncomment if you don't want GRUB to pass "root=UUID=xxx" parameter to Linux
## GRUB_DISABLE_LINUX_UUID=true
  </pre>
  Note: Comment GRUB_HIDDEN_TIMEOUT=0 and GRUB_HIDDEN_TIMEOUT_QUIET=true if they are in the original grub.cfg.
1. update grub
  <pre>
  update-grub
  </pre>
1. Check: On another system that supports IPMI v2, run
  <pre>
## ipmitool -I lanplus -H <System's BMC IP address> -U <userid> -P <password> sol activate
  </pre>
  Reboot the Ubuntu 12.04.2 system. The output of the grub should appear on the remote system when pressing the shift key during the boot process.
 A. Configuring BIOS
## Go to BIOS setup to enable serial console redirection.
## Check: On another system that supports IPMI v2, run
  <pre>
## ipmitool -I lanplus -H <System's BMC IP address> -U <userid> -P <password> sol activate
  </pre>
  Reboot the Ubuntu 12.04.2 system. The BIOS menu should appear on the remote system and BIOS setup should be accessed successfully.

=== Out-of-Band Management ===
==== Out-of-band management for Open Compute v2 (Windmill) platform ====
It's not a problem to use ipmitool to do remote out-of-band management. Note: Add -C3 to the ipmitool command when v1.8.12 is used. <nowiki>[[https://bugs.launchpad.net/opencompute/+bug/1176202|Bug 1176202]]</nowiki>.
==== In-band management for Open Compute v2 (Windmill) platform ====
A particular set of kernel modules and user space application are required to get in-band access working on this platform:
* kernel module dcmi v 2.1.6.28.MEI
* kernel module mei v7.1.21.4.S
* user space app dcmitool that has idc-hi plugin. This plugin is required to support in-band.

Follow the directions on the <nowiki>[[https://launchpad.net/~opencompute-developers/+archive/ocp-certification-tools-ppa | Open Compute Developer's PPA]]</nowiki> to install dcmi-dkms, mei-dkms, and dcmitool.

==== Manual Installation of DCMI drivers and tools ====

If you have used the OCP Developers PPA you should not need to do the following steps.

<nowiki>[[https://bugs.launchpad.net/opencompute/+bug/1156667/+attachment/3683163/+files/Intel_driver_and_dcmitool.zip| Download dcmi and mei source and dcmitool, use 'quanta' to unzip]]</nowiki>, For details, see <nowiki>[[https://bugs.launchpad.net/opencompute/+bug/1156667| bug 1156667]]</nowiki>.

===== Compile and load dcmi and mei modules =====
1. Make sure all ipmi modules are not loaded. 'sudo modprobe -r'
2. Run 'sudo make install' to compile and install mei.
3. For dcmi, edit Makefile (see <nowiki>[[https://bugs.launchpad.net/opencompute/+bug/1156667/+attachment/3678658/+files/Makefile.diff|Makefile.diff]]</nowiki>) then 'sudo make install'.
4. Run 'sudo depmod', 'sudo modprobe dcmi', 'sudo modprobe mei'.
===== dcmitool =====
5. Make the dcmitool file executable, 'sudo chmod 755 dcmitool'.
6. Running dcmitool gives 'error while loading shared libraries: libreadline.so.5'. Install libreadline5 'sudo apt-get install libreadline5'.
7. Running dcmitool again gives 'error while loading shared libraries: libcypto.so.6'. Install libssl-dev 'sudo apt-get install libssl-dev'.
8. Locate libcrypto.so and rename it to libcrypto.so.6
  <pre>
rorke@ocpr0s11l:/$ sudo find | grep libcrypto.so
./usr/lib/x86_64-linux-gnu/libcrypto.so
./lib/x86_64-linux-gnu/libcrypto.so.1.0.0
rorke@ocpr0s11l:/$ ls -al /usr/lib/x86_64-linux-gnu/ |grep libcrypto
-rw-r--r-- 1 root root 4050576 Mar 19 14:25 libcrypto.a
lrwxrwxrwx 1 root root 40 Mar 19 14:25 libcrypto.so -> /lib/x86_64-linux-gnu/libcrypto.so.1.0.0
rorke@ocpr0s11l:/$
rorke@ocpr0s11l:/$ sudo mv /usr/lib/x86_64-linux-gnu/libcrypto.so /usr/lib/x86_64-linux-gnu/libcrypto.so.6
  </pre>
9. Run dcmitool
  <pre>
rorke@ocpr0s11l:~/dcmi-mei-from-quanta$ sudo ./dcmitool power status
Chassis Power is on
  </pre>

=== External Links ===
1. <nowiki>[[https://help.ubuntu.com/community/SerialConsoleHowto|Serial Console Howto]]</nowiki>
2. <nowiki>[[http://wiki.adamsweet.org/doku.php?id=ipmi_on_linux|Running IPMI on Linux]]</nowiki>
3. <nowiki>[[http://wiki.ubuntu.com/Testing/Automation/Checkbox|Checkbox documentation]]</nowiki>
