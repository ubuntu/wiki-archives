{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

These are notes taken during the first months of work in the QA team. Feel free to comment, correct or add your own.

== Public ==

=== Development release ===

You can change the release to devel in /etc/apt/sources.list in order to have a rolling development release (similar to debian's sid). Use with care! :)

=== Bootstrapping the development environment ===

This is my list of pkgs to begin with:

<pre> 
$ sudo add-apt-repository -y ppa:elopio/uci
$ sudo add-apt-repository -y ppa:thomir/trv
$ sudo apt-get update
$ sudo apt-get install -y -q bzr git autopkgtest phablet-tools python-virtualenv unrar ubuntu-sdk python3-flake8 qbzr subunit python3-uci-config python3-uci-tests trv sbuild ubuntu-dev-tools 
</pre>

=== Autopilot ===

<nowiki>[[https://code.launchpad.net/autopilot|The source code]]</nowiki>

<nowiki>[[https://developer.ubuntu.com/api/devel/ubuntu-14.10/python/autopilot/|The docs]]</nowiki>

<nowiki>[[https://developer.ubuntu.com/api/autopilot/python/1.5.0/|More docs]]</nowiki>

=== Source code repositories ===

<nowiki>[[http://anonscm.debian.org/cgit/autopkgtest/autopkgtest.git|Autopkgtest]]</nowiki>

<nowiki>[[https://launchpad.net/ubuntu/+source/autopkgtest|Autopkgtest in Launchpad (useful for bugs, VERY responsive and nice :))]]</nowiki>

<nowiki>[[https://code.launchpad.net/ubuntu-sanity-tests|Ubuntu Sanity Tests]]</nowiki>

<nowiki>[[https://code.launchpad.net/ubuntu-ota-tests|Ubuntu OTA Tests]]</nowiki>

<nowiki>[[https://code.launchpad.net/ubuntu-power-tests|Ubuntu Power Tests]]</nowiki>

<nowiki>[[https://code.launchpad.net/unity8|Unity8]]</nowiki>

<nowiki>[[https://code.launchpad.net/ubuntu/+source/android-tools|Android tools]]</nowiki>

<nowiki>[[https://code.launchpad.net/goget-ubuntu-touch|Ubuntu Touch Cli Tools]]</nowiki>

<nowiki>[[https://code.launchpad.net/~phablet-team/phablet-tools|Phablet Tools]]</nowiki>

<nowiki>[[https://code.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/trunk|Ubuntu UI Toolkit]]</nowiki>

<nowiki>[[https://code.launchpad.net/ubuntu-system-settings|Ubuntu System Settings]]</nowiki>

<nowiki>[[https://code.launchpad.net/ubuntu-system-image|Ubuntu System Image]]</nowiki>

<nowiki>[[https://code.launchpad.net/~unity-greeter-team/unity-greeter/trunk|Unity Greeter]]</nowiki>

<nowiki>[[https://code.launchpad.net/~phablet-team/webbrowser-app/trunk|Webbrowser app]]</nowiki>

<nowiki>[[https://launchpad.net/address-book-app|Address Book app]]</nowiki>

<nowiki>[[https://code.launchpad.net/qakit|QAKit]]</nowiki>

=== Packaging and building ===

<nowiki>[[https://wiki.debian.org/Packaging|Debian]]</nowiki>

<nowiki>[[http://packaging.ubuntu.com/html/index.html|Ubuntu]]</nowiki>

<nowiki>[[https://help.launchpad.net/Packaging/PPA|PPAs]]</nowiki>

<nowiki>[[https://wiki.ubuntu.com/CrossBuilding|Cross Building]]</nowiki>

=== Testbeds ===

=== First steps with the device ===

Set up developer mode (Apps -> System Settings -> About this phone -> Developer mode)

Make sure that the developer mode is kept when the screen is turned off:
<pre>
    phablet-shell

    sudo touch /userdata/.adb_onlock # root password is 0000
</pre>

==== Phone management commands ====

Get a list of connected devices with serial numbers: adb devices

The following commands are can be used when a single device is connected, if not the serial numbers obtained before can be used.

Rebooting: adb reboot

Opening a shell: phablet-shell (the default root password is 0000)

Network provision: phablet-network -n /etc/NetworkManager/system-connections/<connection-file>

Make the image writable: phablet-config writable-image (or from a device shell, sudo mount -o remount,rw /)

==== Using the emulator ====

<nowiki>[[https://docs.google.com/document/d/16R8GqEYatrmtqfcadMpxkYUAw1dpuhvXMKh9jKIyltg/edit#heading=h.k1ydkbwnfj0z|Documentation]]</nowiki>

=== Executing the sanity suite (or part of it) in the testbed ===

==== Method 1: readonly image ====

In order to get quick feedback from tests run in the device is usually better to execute the desired tests from inside the testbed instead of launching them from the host (and preventing then all the provisioning steps taken by adt-run).

For getting an environment as close as possible to the one created by the sanity suite we will run adt-run with a --shell option, which at the end of the test keeps a shell open. This shell is not very useful and the logged user is root, but all the temporary directories used for the test run are not removed. With this shell open we access the device from another shell, navigate to the temp directories and then execute the tests.

These are the required steps:

Flash the device:

<pre>
    $ ubuntu-device-flash touch --developer-mode --password 0000 --channel="ubuntu-touch/devel-proposed" --wipe
</pre>

Provision the network in the device:

<pre>
    $ phablet-network -n /etc/NetworkManager/system-connections/<connection-file></pre>

Modify the sanity configuration to execute only one test, this way we can get the first device shell earlier. To accomplish this, edit ~/.config/ubuntu-sanity-tests.conf and modify the tests_to_run line:

<pre>
    tests_to_run = ubuntu_sanity_tests.tests.test_add_contact
</pre>

From sanity's source root in the host execute adt-run:

<pre>
    $ adt-run --timeout-short=600 -B --unbuilt-tree=$PWD --output-dir ~/workspace/ust --copy ~/.config/ubuntu-sanity-tests.conf:/home/phablet/.config/ubuntu-sanity-tests.conf --setup-commands 'mount -o remount,rw /' --setup-commands 'apt-add-repository -y ppa:canonical-platform-qa/selenium' --setup-commands 'apt-get --no-list-cleanup update -o Dir::Etc::SourceList=/dev/null' --setup-commands 'sync; sleep 2; mount -o remount,ro /' --shell --- ssh -s adb -- -p 0000
</pre>

After finishing the execution, there's an open shell with a prompt like: 

<pre>
    root@ubuntu-phablet:/tmp/adt-run.l5qRDX/build.pvJ/real-tree#
</pre>

We will use that /tmp/adt-run.l5qRDX/build.pvJ/real-tree path later, the source code is in that directory and in /tmp/adt-run.l5qRDX is all that is required to execute the tests. Open another shell to the device from the host:

<pre>
    $ phablet-shell
</pre>

And we can execute the tests in the device from the temporary directory with:

<pre>
    $ cd /tmp/adt-run.l5qRDX/build.pvJ/real-tree
    $ PYTHONPATH=.:../../deps/usr/lib/python3/dist-packages/ ADT_ARTIFACTS=~/ust-out/ debian/tests/sanity
</pre>

==== Method 2: writable image ====

In this case we are going to work with the image in writable mode, but with the dependencies installed preventing the upgrade of existing packages. The environment is not so similar to the one setup by adt-run, but the process is perhaps simpler, although a complete run on a recently flashed device after the changes are pulled is always required, to verify that all will work in the real environment. It doesn't hurt to do this also with the previous approach, but the results are more likely to be the same.

With the device connected and from the source code branch, these would be the steps to take:

Flash the device:

<pre>
    $ ubuntu-device-flash touch --developer-mode --password 0000 --channel="ubuntu-touch/devel-proposed" --wipe
</pre>

Push the sanity suite code to the device:

<pre>
    $ adb push . /home/phablet/ust</pre>

Provision the network in the device:

<pre>
    $ phablet-network -n /etc/NetworkManager/system-connections/<connection-file></pre>

Log into the device

<pre>
    $ phablet-shell</pre>

From this point on all the commands should be executed from the device shell. 

Put the image in writable mode:

<pre>
    $ sudo mount -o remount,rw /</pre>

Install the required dependencies:

<pre>
    $ sudo apt-add-repository -y ppa:canonical-platform-qa/selenium
    $ sudo apt-get install -y grep-dctrl
    $ grep-dctrl Depends -s Depends -n ./debian/tests/control | sed ':a;N;$!ba;s/\n/ /g' | sed 's/,\s*/ /g' | sed -r 's/ \(>=([a-z0-9\+\-].?)*\) / /g' | sed -r 's/ \| ([a-z0-9\.\-])* / /' | xargs sudo apt-get install -y --no-upgrade
</pre>

Execute the tests:

<pre>
    $ cd /home/phablet/ust 
    $ PYTHONPATH=. ADT_ARTIFACTS=~/ust-out/ debian/tests/sanity</pre>

* IMPORTANT* Remember to execute the full suite from the host after making your changes to verify that all goes fine running the tests through the adt-run wrapper with the image in readonly mode, from the host:

<pre>
    $ python3 -m ubuntu_sanity_tests.command_line
</pre>

=== Executing generic autopilot suites in the testbed ===

For example, we want to execute the address-book-app autopilot tests in the device. From the project source we push the files to the device:

<pre>
    adb push . /home/phablet/address-book-app
</pre>

Open a shell in the device:

<pre>
    phablet-shell
</pre>

Make the image writable

<pre>
    sudo mount -o remount,rw /
</pre>

Install the dependencies. This is done installing the related package, if the dependencies are changed in source then the new dependencies should be installed manually:

<pre>
    sudo apt-get install address-book-app-autopilot python3-evdev
</pre>

Execute the tests, in this case before actually executing the tests you should have the phone unlocked:
<pre>
    cd /home/phablet/address-book-app/tests/autopilot && autopilot3 run address_book_app
</pre>

=== Landing ===

<nowiki>[[https://wiki.ubuntu.com/LandingTeam/|Team page]]</nowiki>

<nowiki>[[https://wiki.ubuntu.com/citrain/LandingProcess|Process - CI Train]]</nowiki>

=== DBus ===

<nowiki>[[http://dbus.freedesktop.org/doc/dbus-tutorial.html|Documentation]]</nowiki>

<nowiki>[[http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html|Python tutorial]]</nowiki>

== Private ==

=== IRC Channels ===

==== Canonical ====

<pre>

</pre>

==== Freenode ====

<pre>

</pre>

=== IRC Highlighting ===

Some keywords to start with:

* ubuntu-qa

* project-team

* projects-team

* qa-team

=== Paste utilities ===

There are http://paste.ubuntu.com and http://paste.canonical.com, the latter for sensible data

=== Setting up the VPN ===

This is the <nowiki>[[https://wiki.canonical.com/InformationInfrastructure/IS/HowTo/CompanyOpenVPN|wiki page]]</nowiki>, always is useful to contact IS through rt@admin.canonical.com
