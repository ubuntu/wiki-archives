{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


== Introduction ==

A backtrace shows a listing of which program functions are still active. Since functions are nested when they are called, the program must record where it left one function, to jump into an inner one. It does this on the stack, which we dump for the backtrace.

By getting a backtrace at the point of a bug, a developer may be able to isolate where that bug is, because it will narrow down to the function, or even the line, that caused the erroneous behaviour.

== Prepare your environment to gather a backtrace ==

By default, a program called <nowiki>[[https://wiki.ubuntu.com/Apport|apport]]</nowiki> is enabled and running, which preempts gdb. However, to gather a backtrace manually, apport needs to be disabled first. One may do this via a terminal: <pre>
sudo nano /etc/default/apport </pre>

and change: <pre>
enabled=1 </pre>

to: <pre>
enabled=0 </pre>

save, close, and restart.

=== Kubuntu ===

When using KDE, the KDE Crash Handler will intercept debugging information. However, it is possible to disable the KDE Crash Handler when you are launching an application by passing the --nocrashhandler argument to the application. For example, running the program from a terminal via: <pre>
kget --nocrashhandler

== Applications using Mono ==

To obtain a backtrace from a Mono application such as Beagle or F-Spot, use Mono's <code>--debug</code> option, e.g.<pre>
mono --debug /usr/lib/f-spot/f-spot.exe </pre>

== Generation ==
# If you are on Ubuntu Jammy (22.04) or later, you do '''not''' need to worry about installing debug symbol packages anymore.  The Ubuntu project maintains a <nowiki>[[https://debuginfod.ubuntu.com|Debuginfod]]</nowiki> server, and GDB and other debuginfo-consumer applications support it out of the box.  For more information about it, please refer to <nowiki>[[https://ubuntu.com/server/docs/service-debuginfod|this page]]</nowiki>.  Otherwise, if you are on an older Ubuntu release (pre-Jammy), please ensure you have packages with debug symbols installed. You can do this by following the instructions at DebuggingProgramCrash.
# Make sure the GNU Debugger is installed. <pre>
sudo apt-get install gdb </pre>
1. Start the program under control of `gdb` via a terminal (some programs run as root, so one would use <code>sudo gdb</code> instead of just <code>gdb</code> below): <pre>
gdb <program> 2>&1 | tee ~/gdb-<program>.txt
(gdb) handle SIG33 pass nostop noprint
(gdb) set pagination 0
(gdb) run <arguments, if any>
</pre>
# The program will start. Perform any actions necessary to reproduce the crash. If the program hangs but doesn't crash you can press ctrl+c in gdb while the program is frozen and then continue with the next step.
# Retrieve a backtrace: <pre>
(gdb) backtrace full
(gdb) info registers
(gdb) x/16i $pc
(gdb) thread apply all backtrace
(gdb) quit </pre>
1. Attach the complete output from GDB, contained in gdb-<program>.txt, in your bug report. You will find the file in your home directory /home/<username>/.

== Already running programs ==

You can ask GDB to attach to a program that's already running. This is useful for debugging things that start up, but crash when you perform a particular task.

1. Make sure the GNU Debugger is installed. <pre>
sudo apt-get install gdb </pre>

1. Find the process ID of <program>: <pre>
pidof <program> </pre>

1. Start `gdb` (some programs run as root, so one would use <code>sudo gdb</code> instead of just <code>gdb</code> below): <pre>
gdb 2>&1 | tee gdb-<program>.txt
(gdb) handle SIG33 pass nostop noprint
(gdb) set pagination 0
(gdb) attach <PID> </pre>

1. Continue the <program>: <pre>
(gdb) continue </pre>

1. The program will continue running. Perform any actions necessary to reproduce the crash. If the program hangs but doesn't crash you can press ctrl+c in gdb while the program is frozen and then continue with the next step.

1. Retrieve a backtrace: <pre>
(gdb) backtrace full
(gdb) info registers
(gdb) x/16i $pc
(gdb) thread apply all backtrace
(gdb) quit </pre>

1. Attach the complete output from GDB, contained in gdb-<program>.txt, in your bug report.

Note that you can also set logging to a file like this: <pre>
(gdb) set logging file gdb-<program>.txt
(gdb) set logging on </pre>

== Core Files ==

You are also able to retrace a core file if you have one produced (I believe these are disabled by default).

1. Load the core file into the debugger <pre>
 gdb -c <corefile> 2>&1 | tee gdb-<program>.txt </pre>

2. Retrieve a backtrace of the crash: <pre>
(gdb) backtrace full
(gdb) info registers
(gdb) x/16i $pc
(gdb) thread apply all backtrace
(gdb) quit </pre>

3. Attach the complete output from GDB, contained in gdb-<program>.txt, in your bug report. You will find the file in your home directory /home/<username>/.

== Other resources ==

* <nowiki>[[http://live.gnome.org/GettingTraces|Another useful how-to]]</nowiki>

== Summary in script form ==

You can automate backtrace collection <nowiki>[[#generation|as described above]]</nowiki> using this Bourne shell script:
** save it somewhere in your $PATH
** make it executable <pre>
usage() {
    cat<<EOF
Usage: ${0} program_name [program_args]

Trace a given program using gdb.

EOF
}

log() {
    echo "${*}" 1>&2
}

die() {
    usage
    log 'error:' ${*}'.'
    exit 1
}
test "x${*}" = "x" && die 'no process given'

LOG="/tmp/gdb-`basename ${1}`.txt"
log "outputting trace to '${LOG}'"

exec gdb -batch-silent \
    -ex 'set logging overwrite on' \
    -ex "set logging file ${LOG}" \
    -ex 'set logging on' \
    -ex 'handle SIG33 pass nostop noprint' \
    -ex 'set pagination 0' \
    -ex 'run' \
    -ex 'backtrace full' \
    -ex 'info registers' \
    -ex 'x/16i $pc' \
    -ex 'thread apply all backtrace' \
    -ex 'quit' \
    --args ${*} \
    < /dev/null
</pre>
----
CategoryBugSquad CategoryDebugging
