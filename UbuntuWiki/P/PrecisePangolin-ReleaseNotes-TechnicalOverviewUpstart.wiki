{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


This page summarizes the changes to Upstart between the following releases:

* lucid to precise
* oneiric to precise

For full details, please refer to the following:

* <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man5/init.5|init (5)]]</nowiki>
* <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man8/init.8|init (8)]]</nowiki>
* <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man8/initctl.8|initctl (8)]]</nowiki>
* <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man7/upstart-events.7.html|upstart-events (7)]]</nowiki>
* <nowiki>[[http://upstart.ubuntu.com/cookbook/|The Upstart Cookbook]]</nowiki>

==== Change Summary ====

{| class="wikitable"
|-
| '''Added Since Release'''
| '''New Stanzas'''
| '''New init Options'''
| '''New initctl Commands'''
| '''New Commands'''
|-
| <|6> lucid
| <nowiki>[[#console log|console log]]</nowiki>
| <nowiki>[[#init--confdir|--confdir]]</nowiki>
| <nowiki>[[#check-config|initctl check-config]]</nowiki>
| <nowiki>[[#init-checkconf|init-checkconf]]</nowiki>
|-
| <nowiki>[[#kill-signal|kill signal]]</nowiki>
| <nowiki>[[#init--logdir|--logdir]]</nowiki>
| <nowiki>[[#notify-disk-writeable|notify-disk-writeable]]</nowiki>
| <nowiki>[[#initctl2dot|initctl2dot]]</nowiki>
|-
| <nowiki>[[#manual|manual]]</nowiki>
| <nowiki>[[#init--no-log|--no-log]]</nowiki>
| <nowiki>[[#show-config|show-config]]</nowiki>
| 
|-
| <nowiki>[[#setgid|setgid]]</nowiki>
| <nowiki>[[#init--default-console|--default-console]]</nowiki>
| <nowiki>[[#initctl-usage|usage]]</nowiki>
| 
|-
| <nowiki>[[#setuid|setuid]]</nowiki>
| <nowiki>[[#init--no-sessions|--no-sessions]]</nowiki>
| 
| 
|-
| <nowiki>[[#usage|usage]]</nowiki>
| 
| 
| 
|-
| <|4> oneiric
| <nowiki>[[#console log|console log]]</nowiki>
| <nowiki>[[#init--confdir|--confdir]]</nowiki>
| <nowiki>[[#notify-disk-writeable|notify-disk-writeable]]</nowiki>
| 
|-
| <nowiki>[[#setgid|setgid]]</nowiki>
| <nowiki>[[#init--logdir|--logdir]]</nowiki>
| <nowiki>[[#initctl-usage|usage]]</nowiki>
| 
|-
| <nowiki>[[#setuid|setuid]]</nowiki>
| <nowiki>[[#init--no-log|--no-log]]</nowiki>
| 
| 
|-
| <nowiki>[[#usage|usage]]</nowiki>
| <nowiki>[[#init--default-console|--default-console]]</nowiki>
| 
| 
|}

===== New Stanzas and Stanza Values =====

====== console log ======

As of Upstart 1.4, the new default value for the `console` stanza is
`log`. This means all job output written to standard output and standard
error will be logged to file `/var/log/upstart/${job}.log` (or
`/var/log/upstart/${job}-${instance}.log` if the job specifies the
`instance` stanza).

To revert to the old default behaviour where job output is discarded,
use the <nowiki>[[#init--no-log|--no-log]]</nowiki> option.

To modify the value of `console` for jobs which do not explicitly
specify it, use the <nowiki>[[#init--default-console|--default-console]]</nowiki> option.

To change the location where log files are written to, use the
<nowiki>[[#init--logdir|--logdir]]</nowiki> option. If you specify this advanced option, you
should also update the logrotate script `/etc/logrotate.d/upstart`.

====== kill signal ======

Specifies the stopping signal (`SIGTERM` by default) that a job's main process
will receive when stopping the running job.

Usage:
<pre>
  kill signal <signal_name>
</pre>

Example:
<pre>
    kill signal INT
</pre>

====== manual ======

Specifying the "`manual`" stanza removes ''any previously defined''
"start on" stanza for job so that the job can only be started with
"`initctl start`" or "`start`". This is most useful when used in
combination with Override files.

====== setgid ======

Usage:
<pre>
  setgid <group_name>
</pre>

Run the job under the specified group.

If this stanza is unspecified, the primary group of the user specified
in the `setuid` block is used for all job processes. If neither `setuid`
nor `setgid` are specified, all job processes will run with its group ID
set to 0 in the case of system jobs, and as the primary group of the
user in the case of User Jobs.

====== setuid ======

Usage:
<pre>
  setuid <user_name>
</pre>

Run the job under as the specified user.

If this stanza is unspecified, all job processes will run as root in the
case of system jobs, and as the user in the case of user jobs.

Note that system jobs using the `setuid` stanza are still system jobs,
and can not be controlled by an unprivileged user, even if the `setuid`
stanza specifies that user.

====== usage ======

Brief message explaining how to start the job in question. Most useful
for `instance` jobs which require environment variable parameters to be
specified before they can be started.

Syntax:

<pre>
  usage <string>
</pre>

Example:

<pre>
  instance $DB
  usage "DB - name of database instance"
</pre>

If a job specifies the `usage` stanza, attempting to start the job without
specifying the correct variables will display the usage statement.
Additionally, the usage can be queried using the `initctl`
<nowiki>[[#initctl-usage|usage]]</nowiki> command.

===== New Commands =====

====== init-checkconf ======

Performs checks on a job configuration file prior to installing it in
`/etc/init/`. The script must be run as a non-root user.

By default checks both Upstart stanzas and script sections for validity.

Usage:
<pre>
  $ init-checkconf myjob.conf
File myjob.conf: syntax ok
</pre>

See <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man8/init-checkconf.8.html|init-checkconf (8)]]</nowiki>
for full details.

====== initctl2dot ======

Basic visualization tool which which converts the output of the
`initctl` <nowiki>[[#show-config|show-config]]</nowiki> command to GraphViz format. By
default, all job configuration files are considered and the links
between jobs and events are displayed graphically. Additionally, it is
possible to list a set of jobs to graph.

See <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man8/initctl2dot.8.html|initctl2dot(8)]]</nowiki>
for full details.

===== New initctl Commands =====

====== check-config ======

The `check-config` command is useful for System Adminstrators and
tooling to ensure that all jobs are theoretically startable/stoppable.
For example, if a job configuration file specified the following complex
condition:

<pre>
  start on (A and (B or (starting C or (starting D or starting E))))
</pre>

The `check-config` command would flag an error if for example none of
the jobs 'C', 'D' or 'E' were available since that would indicate
the job in question could never be automatically started (since the
start on condition could never be true). Similar checks are performed on
events, so if jobs 'C', 'D' and 'E' are available but events 'A' and 'B'
are not advertised as being emitted by any job, 'check-config' will
generate an error. If no errors are detected, `check-config` displays no
output and returns zero. If errors are detected for a job, each
condition that is unsatisfiable is displayed with a message.

====== notify-disk-writeable ======

Command that is used to notify Upstart that the log disk is writeable,
which is required for job logging. This command is called automatically
by `/etc/init/flush-early-job-log.conf` job.

====== show-config ======

The `show-config` command displays core job configuration details,
namely the `start on`, `stop on` and `emits` stanza information. This is
useful since it allows users to see how Upstart has parsed the job
configuration files. Additionally, the `show-config` command accepts an
optional `--enumerate` option which makes it easy to see which elements
of complex conditions are jobs, which are events and which are
environment details. This option forms the basis of the Visualisation
feature above.

====== usage ======

Display the usage for a job:

<pre>
  $ initctl usage <job>
</pre>

Note that if a job is specified which does not use the `usage` stanza, no usage will be displayed.

===== New init options =====

WARNING: Under normal conditions, you should not need to specify any
command-line options to Upstart. A number of these options were added
specifically for testing Upstart itself and if used without due care can
stop your system from booting.

====== --confdir ======

Specify alternate configuration directory (default: `/etc/init/`).

====== --default-console ======

Specify default value for jobs not specifying "`console`". See 
<nowiki>[[http://manpages.ubuntu.com/manpages/precise/man5/init.5|init (5)]]</nowiki> for
permissible values.

====== --logdir ======

Specify alternate log directory (default: `/var/log/upstart/`).

====== --no-log ======

Disable job logging (all job output will be discarded).

====== --no-sessions ======

Disable user jobs and chroot support. See <nowiki>[[#chroot-support|Chroot Support]]</nowiki>.

==== New Features ====

===== Chroot support =====

Upstart is now "chroot-aware". If `initctl` is run as the `root` user
from within a chroot the Upstart `/sbin/init` daemon (''outside'' the
chroot) will honour requests from within the chroot to manipulate jobs
within the chroot.

Notes:

* Within the chroot, only jobs within the chroot can be manipulated.
* It is only possible to control such chroot jobs from within the chroot. That is to say, the "outer" system cannot manipulate jobs within the chroot.
* Due to the design of this feature, Upstart will '''not''' be able to detect changes to job configuration files within the chroot ''until a process within the chroot has either manipulated a job, or listed one or more jobs''.
* Chroot support can be disabled at boot by passing the "`--no-sessions`" option on the kernel command-line. If chroots are disabled, running Upstart commands within a chroot will affect jobs outside the chroot only.
* If a job is run in a chroot environment (such as provided by schroot(1)), exiting the chroot will kill the job.

===== Override files =====

Override files are files ending in "`.override`" which if placed into
the job configuration directory ("`/etc/init/`") are able to modify the
way in which a job configuration file behaves. They could be used by
System Administrators or tooling to change the behaviour of a job
without modifying a packages configuration files directly.

Override files support the same syntax as the existing job configuration
(".conf") files.

For example, to ensure that a service is never automatically started:

<pre>
  echo manual >> /etc/init/myjob.override
</pre>

To allow the original behaviour, simply delete the Override file.

Another example: to change the start on condition for a job:

<pre>
  echo "start on (starting job-A or event-B)" >> /etc/init/myjob.override
</pre>

Note that Override files have no effect unless there is a corresponding
job configuration file (a file with the same prefix name).

The effect of deleting an override file is to revert the job (immediately)
back to its original configuration.

===== D-Bus service activation =====

D-Bus version 1.4.1-0ubuntu2 and higher allow D-Bus services to be activated via Upstart. To convert an existing D-Bus service to be activated by Upstart:

# Add the keyword, "`UpstartJob=true`" to the "`.service`" file.
# Create a corresponding Upstart job configuration file with a `start on` condition specifying the new "`dbus-activation`" event, followed by the service name (such as "<code>start on dbus-activation com.ubuntu.NattyService</code>").
# Ensure that "`dbus-daemon`" is invoked with the "`--activation=upstart`" option.

===== Socket bridge =====

Upstart now provides a socket bridge (`upstart-socket-bridge`) which is
a daemon started early in the boot process that allows jobs to be
started when socket connections are made. Jobs register their desire to
be started by a socket connection by requiring the new "`socket`" event
in their `start on` (or `stop on`) stanza(s):

<pre>
## Internet sockets
  start on socket PROTO=PROTO PORT=PORT ADDR=ADDR

## Local and Abstract sockets
  socket PROTO=PROTO PATH=PATH
</pre>

For example, to have a web server only start when the first client
connection is received, its job configuration file might specify:

<pre>
  start on socket PROTO=inet PORT=80
</pre>

Notes:

* It is necessary for daemons which wish to make use of this facility to be modified to understand the facility, specifically how to handle the `UPSTART_FDS` environment variable.

See the manual pages for further details:

* <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man7/socket-event.7.html|socket-event (7)]]</nowiki>
* <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man8/upstart-socket-bridge.8.html|upstart-socket-bridge (8)]]</nowiki>

===== Miscellaneous =====

* A new manual page, <nowiki>[[http://manpages.ubuntu.com/manpages/precise/man7/upstart-events.7.html|upstart-events (7)]]</nowiki> summarising well-known Upstart events. This should be used when creating new jobs to identify appropriate `start on` and `stop on` conditions.
* A Bash completion script has been included for `initctl`.
* The <nowiki>[[http://www.vim.org|Vim]]</nowiki> package "<code>vim-runtime</code>" now includes syntax support for Upstart job configuration files.
