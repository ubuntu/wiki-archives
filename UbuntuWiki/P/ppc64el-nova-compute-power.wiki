{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


This page is a draft

== Deploying Openstack Nova Compute on PowerKVM using Juju charms ==

It is possible to deploy Openstack nova-compute to PowerKVM on POWER8 using a Juju charm called <nowiki>[[https://jujucharms.com/u/james-page/nova-compute-power/|nova compute power]]</nowiki>.
<<BR>>
What is described in this page was extracted from the charm's page or was noted during a test deployment.

This was tested with PowerKVM 2.1.1 and Openstack Kilo.

== Install Juju ==

On Ubuntu machine:
 {{{#!highlight sh
$ sudo apt-get install python-software-properties
$ sudo apt-get install software-properties-common
$ sudo add-apt-repository ppa:juju/stable
$ sudo apt-get install juju-quickstart juju-core juju-local
$ ssh-keygen
}}}

== Set up the PowerKVM node ==

On PowerKVM:

To generate .ssh directory
 {{{#!highlight sh
}}}
Edit /etc/ssh/sshd_config

Check if line below is in the file:

PermitRootLogin yes

Then:
 {{{#!highlight sh
}}}

== Download and configure the charm ==

On Ubuntu machine:
 {{{#!highlight sh
$ ssh-copy-id power-user@PowerKVM
$ juju switch local
$ juju bootstrap
$ cd ~
$ mkdir -p charms/trusty
$ cd charms/trusty
$ bzr branch lp:~james-page/charms/trusty/nova-compute-power/trunk nova-compute-power
}}}

Before actually deploying the charm, one should configure it.

Edit nova-compute-power/config.yaml

Attention to the lines:

openstack-release:
OpenStack release to use for configuration of POWER hypervisor.
It is advisable to use the same version all across the services, so there will be no compatibility problems.
In other words, use the same Openstack version here and on the controller node.

power-user:
The user that will be used to install rpms on the PowerKVM machine

power-key:
The name of the file that will contain the ssh key

power-repo:
RPM repository of OpenStack packages to deploy to POWER hypervisors.

power-hosts:
POWER hosts that will be managed; space delimited.

power-password:
sudo password on POWER hypervisor

== Deploy ==

 {{{#!highlight sh
$ juju deploy --repository=~/charms local:trusty/nova-compute-power
}}}

Doing so will create a log file (it might take a while) into /var/log/juju-local

The default file is /var/log/juju-local/unit-nova-compute-power-0.log

On the PowerKVM machine:

 {{{#!highlight sh
}}}

Keep in mind that it will probably be necessary to update the file /etc/nova/nova.conf.

The charm itself contains a file nova.conf within templates directory that might be worth updating. That way it would even be possible to deploy the charm without having to configure the compute node afterwards.

Of course, the above is valid for a local deployment. It is possible to set a non-local environment, such as Openstack or MAAS.
