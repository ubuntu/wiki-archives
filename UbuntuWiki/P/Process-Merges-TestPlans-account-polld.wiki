{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


* '''Test plan for component''': account-polld
* '''Component Checklist''': https://wiki.ubuntu.com/Process/Merges/Checklists/Common
* '''Trunk URL''': lp:account-polld
* '''Ubuntu Package URL (LP)''': http://launchpad.net/ubuntu/+source/account-polld

=== Dependents/Clients ===

* ubuntu-push-client
* online accounts

=== Test Plan ===

==== Definitions ====

 SUT:: System Under Test

==== Prereqs ====

* Account on twitter and gmail.
* Webapps for twitter and gmail installed

==== Plan ====

* Install image on '''SUT''': <code>ubuntu-device-flash --channel ubuntu-touch/devel-proposed</code>
* Run <code>citrain device-upgrade [silo]</code>

The scope of responsibility for account-polld is to limit itself to the enabled accounts from online accounts (the accounts with the '''Notifications''' toggle set).

{i} Notifications from before account-poll starts for twitter are not shown, only the ones since daemon start.

{i} Notifications are not displayed if Unity8 marks the target application as '''in focus'''. For account-polld's responsibility; if the webapp is closed, it '''shall''' trigger notification; if the target webapp is open and it is of dubios consideration if the notifiction should be triggered, check with the '''ubuntu-push-client'''.

===== Enable =====

* '''twitter''':
** Ensure the twitter app has access to the twitter account in online accounts.
** Mentions and direct messages should be notified (polling is usually 5 minutes)
* '''gmail''':
** Ensure the gmail app has access to the gmail account in online accounts.
** Unread messages falling into gmail's inbox in '''category personal''' from a span of ~24hs will be collected and notified.
** token can be overriden by setting the <code> ACCOUNT_POLLD_TOKEN_GMAIL </code> session environment variable and restarting <code> account-polld </code>.
* '''google calendar''':
** Ensure the calendar app has access to the gmail account in online accounts.
** Create a new event on your main calendar using the google web interface
** Check if the changes are synced with your local calendar (polling is usually 5 minutes)

===== Bug #1496773 regression test =====

https://bugs.launchpad.net/canonical-devices-system-image/+bug/1496773

(Preferably you have a Google test account for this.)

# Add a Google account, enable Gmail access.
# Ensure it works.
# Change the password on the account.
# Monitor <code>$HOME/.cache/upstart/account-polld.log</code> and make sure there's account-poll does not enter an endless, battery obliterating loop when it discovers the expired token.

==== Additional information ====

* Monitor <code>$HOME/.cache/upstart/account-polld.log</code> for additional information. If there are no logs, it probably means no accounts were enabled.
* <code> dbus-monitor --session interface=com.ubuntu.Postal </code> to verify that messages are indeed sent to the <code> ubuntu-push-client </code> which is the scope of responsibility of <code> account-polld </code>.
* The push client calls the account-polld dbus interface to poll, the same can be accomplished manually by issueing <code> gdbus call --session -d com.ubuntu.AccountPolld -o /com/ubuntu/AccountPolld -m com.ubuntu.AccountPolld.Poll </code> a <code> Done </code> signal should be sent once the pollling is done.
