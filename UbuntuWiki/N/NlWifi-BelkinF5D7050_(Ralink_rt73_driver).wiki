{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

== F5D7050 ver 3000 - USB ID 050d:705a - Ralink rt73 Driver Installatie ==

Deze handleiding is voor het grootste deel gebaseerd op de Engelse documentatie: https://help.ubuntu.com/community/WifiDocs/Device/Belkin_F5D7050_ver_3000_%28Ralink_rt73_driver%29

De oplossing die beschreven wordt is getest met Ubuntu 7.10 en werkt stabiel.

De Belkin Wireless USB adapter F5D7050 ver 3000 werkt met de rt73 driver. Het snelst controleer je dat door het Belkin installatie-schijfje in de computer te leggen en onder “Drivers” te kijken.

In Ubuntu 7.10 is de rt73 driver geïntegreerd, maar hij werkt niet goed. Om toch tot een wat breder toepasbare oplossing te komen is op de site van Ralink een compileerbare driver te downloaden, die dan geschikt is te maken voor meerdere USB adapters.

Door in de file rtmp_def.h het gewenste type in te vullen, kun je de rt73 driver geschikt maken voor o.a. de volgende USB adapters:

Linksys WUSB54GC USB Device 13b1:0020

D-Link DWL-G122 Rev B1 USB Device 2001:3c00

D-Link DWL-G122 Rev C1 USB Device 07d1:3c03

D-Link DWA-111         USB Device 07d1:3c06 of 07d1:3c07

Conceptronic C54RU'''v2'''  USB Device 14b2:3c22

We gaan ervan uit dat je de nieuwe driver ontwikkelt in de Home directory.

De test is uitgevoerd met WPA-PSK encryptie en vermelding van het MAC nummer van de adapter in de MAC-list van het accesspoint.

Voor je begint is het handig als je eerst wat gegevens van je accesspoint precies noteert:

DHCP of Statische IP nrs

Kanaal nummer

SSID naam

WPA of WEP encryptie en de sleutels (heel precies)

MAC-list

MAC nummer van je adapter

Voor de nu volgende stappen kun je het beste de Kopiëren/Plakken methode gebruiken, of je moet erg handig zijn met de terminal en de commando's goed kennen.

Probeer op een gunstige manier deze handleiding en een terminal venster tegelijk op je scherm te krijgen.

LET OP: kopieer alleen het deel na het $-teken en “plak” dat in de terminal. Geef na elke regel een ENTER.

=== Stap 1 - De oude driver op non-actief zetten. ===

Blacklist de bestaande rt73 driver, die werkt niet goed.

<pre>
user@ubuntu:~$ gksudo gedit /etc/modprobe.d/blacklist
</pre>

en typ de volgende 3 regels aan het eind van de file.

<pre>
blacklist rt73usb
blacklist rt2570
</pre>

SAVE de file. Het ge-blackliste module zal niet meer geladen worden. In de volgende stappen gaan we een nieuwe rt73 maken.

Om te voorkomen dat de nieuwe rt73 na een reboot weer “geblacklist” wordt, moet je de regel: blacklist rt73usb na Stap 7 weer verwijderen. Het wordt bij Stap 7 nog eens aangegeven.

=== Stap 2 - De Linux omgeving inrichten ===

Om de driver te kunnen compileren moeten de benodigde files worden geinstalleerd.
<pre>
user@ubuntu:~$ sudo apt-get update 
user@ubuntu:~$ sudo apt-get install build-essential
</pre>

Installeer de juiste headers voor jouw versie van Ubuntu (tot 6.10): (Geen probleem als gemeld wordt dat de jouwe up to date zijn.)
<pre>
user@ubuntu:~$ sudo apt-get install linux-headers-`uname -r` 
user@ubuntu:~$ sudo ln -s /usr/src/linux-headers-`uname -r` /lib/modules/`uname -r`/build
</pre>

Installeer de todos en fromdos utilities om files te converteren van DOS/Windows tekst naar UNIX tekst (die zijn later nodig bij het ontwikkelen):
<pre>
user@ubuntu:~$ sudo apt-get install tofrodos
</pre>

=== Stap 3 - Download de laatste versie van de Ralink rt73 driver.(Ralink Part Number RT2501USB versie 1.1.0.0) ===

De driver vind je op:
http://www.ralinktech.com/ralink/Home/Support/Linux.html
(Ralink Part Number RT2501USB(RT73: enz, enz))

De nieuwste op het moment dat dit werd geschreven was:
http://www.ralink.com.tw/data/2008_0117_RT73_Linux_STA_Drv1.1.0.0.tar.bz2
Plaats de file in je Persoonlijke map.

Lastig downloaden als je (nog) geen internet hebt, maar de file moet op één of andere manier op je computer komen. Vraag iemand anders, of verbind je computer tijdelijk d.m.v. een kabel met het Internet.

=== Stap 4 - File uitpakken en bewerken ===

Met tar kun je de opgeslagen driver uitpakken, met cd kom je in de juiste directory.
Opmerking: dit is de "Module" sub-directory van de uitgepakte file.
<pre>
user@ubuntu:~$ tar xjvf 2008_0117_RT73_Linux_STA_Drv1.1.0.0.tar.bz2
user@ubuntu:~$ cd 2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ 
</pre>

De permissies (attributes) zijn niet correct van deze files, dus verander ze in 775 met chmod:

Let op: Kopieren/Plakken alleen het deel achter het $-teken.
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ chmod -R 775 *
</pre>

Verander alle files naar het UNIX-tekst type:
<pre>
user@ubuntu:~$ fromdos *
</pre>

Kopieer de Makefile.6 naar de Makefile om de file geschikt te maken voor een 2.6 Linux kernel opbouw:
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ cp Makefile.6 Makefile
</pre>

Met gedit gaan we nu in de file rtm_def.h het type van je adapter invullen, in dit geval de F5D7050 ver 3000. Het eerdere chmod commando diende om deze files read/write te maken.
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ gedit rtmp_def.h
</pre>

Nu moet je het USB ID van de Belkin (de hele regel) direct achter de backslash op de eerste regel plakken. Noteer het USB ID van de Belkin voor eventuele latere controle met de informatie via het commando lsusb.
(Opmerking: Onder de Belkin F5D7050 ver 3000 staan nog een aantal andere adapters, die ook met de rt73 driver werken)
<pre>
 {USB_DEVICE(0x050d,0x705a)}, /* Belkin F5D7050 ver 3000 */      \
 {USB_DEVICE(0x13b1,0x0020)}, /* Linksys WUSB54GC */             \
 {USB_DEVICE(0x2001,0x3c00)}, /* D-LINK DWL-G122 Rev: B1  */     \
 {USB_DEVICE(0x07d1,0x3c03)}, /* D-LINK DWL-G122 Rev: C1  */     \
 {USB_DEVICE(0x07d1,0x3c06)}, /* D-LINK DWA-111   */             \
 {USB_DEVICE(0x07d1,0x3c07)}, /* D-LINK DWA-111   */             \
 {USB_DEVICE(0x148f,0x2573)}, /* Ralink */      \
</pre>
SAVE de file.

=== Stap 5 - Met het Make commando de driver maken en installeren ===

Maken met:
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ make clean
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ make
</pre>

Dit kan even duren. Er kunnen wat waarschuwingen verschijnen, maar er kunnen geen fouten optreden waardoor de opbouw kan  stoppen.
Opmerking: Als je gedurende het maken een error ziet ''get_wireless_stats'', open file rtmp_main.c met gedit en zoek naar regel '''#if WIRELESS_EXT >=11''' (op ca. 70 % van bovenaf), en maak van de volgende regel commentaar door er een "#" voor te plaatsen, zoals:
<pre>
net_dev->wireless_handlers = (struct iw_handler_def *) &rt7_iw_handler_def;
</pre>

Vergeet niet om de file te "saven" als je iets hebt gewijzigd.

Met de volgende regel installeer je de complete driver in de "extra" directory van de kernel modules.
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ sudo make install
</pre>
(Let op, alleen het gedeelte achter het $-teken kopieren/plakken)

Controleer of de driver correct is geinstallerd met het volgende commando:
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ ls /lib/modules/`uname -r`/extra
</pre>

Als het goed is zie je dan file rt73.ko

Om de firmware van de driver op te slaan zijn nog wat directories nodig:
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ sudo mkdir -p /etc/Wireless/RT73STA
</pre>

Kopieer de rt73.bin en de rt73sta.dat files naar de nieuwe firmware directory.
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ sudo cp rt73.bin /etc/Wireless/RT73STA
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ sudo cp rt73sta.dat /etc/Wireless/RT73STA
</pre>

=== Stap 6 - Het netwerk instellen voor de rt73 USB adapter ===

Het “ip link set rausb0 up” commando is nodig om de adapter te kunnen configureren vanuit de grafische omgeving met het NM-applet. Het NM-applet voorziet niet in deze functie, dus moet je dit eenmalig realiseren door met gedit de file /etc/network/interfaces zelf te bewerken. Als de file klaar is, dan kun je verder met het NM-applet de verbinding aan of af zetten, of andere netwerken zichtbaar maken.

Met gedit kun je de interfaces file veranderen zodat de adapter correct zal opstarten: 
<pre>
user@ubuntu:~/2008_0117_RT73_Linux_STA_Drv1.1.0.0/Module$ gksudo gedit /etc/network/interfaces
</pre>

Voeg deze data toe aan het eind van de file voor gebruik met DHCP; vul je netwerknaam in; kies voor een sleutel, hex of ASCII, maar niet allebei, inplaats van: XXXXX, door het #-teken voor de regel weg te halen. (zg. uncomment) Deze data moeten wel overeenkomen met de instellingen van je accesspoint.

<pre>
iface rausb0 inet dhcp
pre-up ip link set rausb0 up
wireless-essid MY_ESSID
auto rausb0
</pre>

Speciaal de 2e, 3e en laatste regel moeten nauwkeurig gelijk zijn aan de afbeelding.

SAVE de file.

Voor de inrichting van een voorbeeld met statische IP adressen moet de file /etc/network/interfaces er min of meer als volgt uitzien.

<pre>
iface rausb0 inet static
pre-up ip link set rausb0 up
wireless-essid MY_ESSID
address XXX.XXX.XXX.XXX
netmask XXX.XXX.XXX.XXX
network XXX.XXX.XXX.XXX
broadcast XXX.XXX.XXX.XXX
gateway XXX.XXX.XXX.XXX
auto rausb0
</pre>

Opgelet: als de "pre-up ip link set rausb0 up" regel niet correct wordt ingevoerd zal de adapter niet “plug and play” zijn. Dit is een essentieel verschil tussen de rt73 adapters en de meeste andere wireless apparaten.

=== Stap 7 - Installeren van het Module ===

<pre>
sudo modprobe rt73
</pre>
Controleer of je computer weet dat de adapter bestaat:
<pre>
user@ubuntu:~$ iwconfig
</pre>
Als rausb0 wordt herkend kun je proberen om verbinding met het internet te maken via het NM-applet.(Netwerk-icoontje rechtsboven in het paneel)

De output rausb0 moet er ongeveer als volgt uitzien:
<pre>
rausb0    RT73 WLAN  ESSID:"MY_ESSID"  
          Mode:Managed  Frequency=1 MHz  Access Point:  00:08:74:02:01:FC
          Bit Rate=54 Mb/s   
          RTS thr:off   Fragment thr:off
          Link Quality=100/100  Signal level:-28 dBm  Noise level:-79 dBm
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0
</pre>

Vergeet niet om voor de volgende reboot, dus nu, om blacklist rt73usb uit de file /etc/modprobe.d/blacklist te verwijderen, want anders werkt de adapter de volgende keer niet meer. (Zie Stap 1)

=== Stap 8 - Instellen m.b.v. het NM-applet ===

Via de terminal kun je de adapter aan- en afzetten met ifup en ifdown: 
<pre>
user@ubuntu:~$ sudo ifdown rausb0
user@ubuntu:~$ sudo ifup rausb0
</pre>

Door op het netwerk icoontje rechtsboven te klikken kun je de draadloze netwerken zichtbaar maken en je eigen netwerk activeren. Het vereist enig experimenteren, maar de bediening is vrij simpel. Soms verschijnt een formuliertje waarop je het netwerk of je sleutel moet invullen, maar over het algemeen komt de verbinding met internet probleemloos tot stand en werkt zeer stabiel. Het in bedrijf komen van de adapter en de driver kost ongeveer 10 tot 20 seconden.

Met dank aan:

Ralink – voor het beschikbaar stellen van een stabiele driver rt73 onder GPL voorwaarden.

Yawnster, FrodoB en Qc_nz die de Engelse uitgave hebben ontwikkeld en bewerkt.

Johanvd die mij behulpzaam was bij het plaatsen op de Ontwerp Wiki.

Vertaald en laatst bewerkt 18-02-2008 door Petervdw.
