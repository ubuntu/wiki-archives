{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__



== Xubuntu Automatische Standby ==

In Xubuntu 7.04 is er standaard geen mogelijkheid om bij inactiviteit de computer in standby te zetten. De enige mogelijkheid is om een screensaver te activeren, of om het scherm uit te zetten. Gnome-powermanager werkt ook niet altijd naar behoren in Xubuntu. Deze wiki geeft meer informatie over hoe je automatische standby toch kan laten werken als suspend op je computer werkt.

Deze wiki is gebaseerd op:
[http://www.thinkwiki.org/wiki/Installing_Debian_Lenny_on_a_ThinkPad_T60#automated_sleep

Om deze wiki te kunnen gebruiken is het nodig dat suspend werkt. Dit kan je testen door in een terminal het volgende te toetsen:

<pre>
$ sudo /etc/acpi/sleep.sh
</pre>

Als dat niet werkt, dan kan je proberen om /etc/default/acpi-support aan te passen. Verander in de volgende tekst ¨¨¨mem¨¨¨ in ¨¨¨standby¨¨¨:
<pre>
ACPI_SLEEP_MODE=standby}}}

type dan in een terminal:

{{{
$ sudo /etc/init.d/acpid restart
</pre>

Probeer nu nogmaals of suspend werkt. Werkt het dan kan je deze wiki gebruiken.

== De installatie ==
Er zijn twee manieren:

=== Methode 1: zonder script, inactiviteit bepaald door afwezigheid toets en muis(pad) gebruik, geen pop-up window met cancelmogelijkheid ===
stappen:
 1. installeren sleepd en xosview pakketjes
 2. zoek de irq van je muis(pad) en toetsenbord
 3. toevoegen regel aan rc.local
 4. opnieuw opstarten

==== Stap 1: installeren sleepd en xosview pakketjes ====
type in een terminal:
<pre>
$ sudo apt-get install sleepd xosview
</pre>
==== Stap 2: irq muis(pad) en toetsenbord ====
type in een terminal:
<pre>
$ xosview
</pre>
Je kan nu in een schermpje zien welke plek (0-15) geactiveerd wordt bij muis(pad) of toetsengebruik. Onthoudt deze nummers, die zijn later nodig bij het commando sleepd. 
==== Stap 3: toevoegen regel aan rc.local ====
type in een terminal:
<pre>
$ sudo nano /etc/rc.local
</pre>
voeg de volgende regel toe aan het einde voor het commando exit:
<pre>
sleepd -U 900 -u 180 -s /etc/acpi/sleep.sh -i 1 -i 11 -i 12
</pre>
Dit is het commando waarbij de tijd tot standby na inactiviteit bij gebruik van netstroom 900 seconden is, bij batterijgebruik van je laptop 180 seconden. De irq's van het toetsenbord, de muis en de touchpad zijn in dit voorbeeld 1, 11 en 12. Deze waarden dienen dus aangepast te worden aan de eigen computer en wensen.

Mijn rc.local ziet er zo uit:
<pre>
sleepd -U 900 -u 180 -s /etc/acpi/sleep.sh -i 1 -i 11 -i 12
exit 0
</pre>

==== Stap 4: start je computer opnieuw op ====
Geen probleem toch.. Nu zou de automatische stanby functie moeten werken.

=== Methode 2: met script, deze methode kijkt ook naar schijf-, netwerk- en cpu gebruik, en of er iemand op afstand is ingelogd op de computer, tevens een pop up venster met cancel mogelijkheid: ===
stappen:
 1. installeren pakketjes sleepd, xosview, sysstat en zenity
 2. achterhalen irq's
 3. opslaan script als /etc/acpi/autosleep.sh en rechten aanpassen met chmod
 4. lijn toevoegen aan rc.local zodat sleepd bij opstarten wordt geactiveerd en het script aanstuurd.
 5. opnieuw opstarten

==== Stap 1: installeren pakketjes ====
<pre>
$ sudo apt-get install sleepd xosview sysstat zenity
</pre>
==== Stap 2: irq muis(pad) en toetsenbord ====
type in een terminal:
<pre>
$ xosview
</pre>
Je kan nu in een schermpje zien welke plek (0-15) geactiveerd wordt bij muis(pad) of toetsengebruik. Onthoudt deze nummers, die zijn later nodig bij het commando sleepd. 
==== Stap 3: opslaan script ====
type in een terminal:
<pre>
$ sudo nano /etc/acpi/autosleep.sh
</pre>
met de muis het volgende script selecteren, en met rechtermuisklik in nano plakken.

script:
<pre>

CPUTHRESH=5        # in percent 
DISKTHRESH=500     # in blocks/sec (the sar manpage says blocks are 512 bytes in normal cases) 
NETTHRESH=10       # in kB/s

CPUTIME=1   
DISKTIME=2  
NETTIME=2 

CPU=`sar $CPUTIME 1 | awk '/Average/ { printf "%d\n",100-$8}'`
echo "CPU = $CPU%"
if [ $CPUTHRESH -lt $CPU ];then
    echo CPU is working, not sleeping
    exit;
fi

DISK=`sar -b $DISKTIME 1 | awk '/Average:/ { printf "%d",$5 + $6 }'`
echo "DISK = $DISK"
if [ $DISKTHRESH -lt $DISK ];then
    echo Disk is working, not sleeping
    exit;
fi

NET=`sar -n DEV $NETTIME 1 | awk '/Average:/ && $2 !~ /(IFACE|wifi0)/ { SUM += $5 + $6 } END { printf ("%d\n",SUM)}'`
echo "NETWORK = $NET"
if [ $NETTHRESH -lt $NET ]; then
    echo Network is in use, not sleeping
    exit;
fi

REMOTELOGIN=`last | head | grep "pts/.*still logged in"`
if [ -n "$REMOTELOGIN" ];then
    echo Remote login active:
    echo $REMOTELOGIN
    echo Not sleeping
    exit;
fi

(for ((i=0;i<100;i+=1)) ; do echo $i ; sleep 0.1; done) | zenity --progress --auto-close --title='' --text='Deze computer gaat binnen 10 sec. in standby!'

test=$?

if [ $test -eq "1" ]; then
  exit;
fi  

. /etc/acpi/sleep.sh
</pre>

Nu in nano het bestand bewaren en afsluiten. Met het volgende commando zorg je ervoor dat het scriptje executable wordt:
<pre>
$ sudo chmod ugo+x /etc/acpi/autosleep.sh
</pre>

==== Stap 4: toevoegen regel aan rc.local ====
type in een terminal:
<pre>
$ sudo nano /etc/rc.local
</pre>
voeg de volgende regel toe aan het einde voor het commando exit:
<pre>
sleepd -U 900 -u 180 -s /etc/acpi/autosleep.sh -i 1 -i 11 -i 12
</pre>
Dit is het commando waarbij de tijd tot standby na inactiviteit bij gebruik van netstroom 900 seconden is, bij batterijgebruik van je laptop 180 seconden. De irq's van het toetsenbord, de muis en de touchpad zijn in dit voorbeeld 1, 11 en 12. Deze waarden dienen dus aangepast te worden aan de eigen computer en wensen. Vervolgens kijkt dit script dus of er net-activiteit is, de cpu actief is, of de harde schijf. Als dat zo is dan gaat de computer niet in standby.

Mijn rc.local is:
<pre>
sleepd -U 900 -u 180 -s /etc/acpi/autosleep.sh -i 1 -i 11 -i 12
exit 0
</pre>

==== Stap 5: Start je computer opnieuw op ====
en dan werkt het als het goed is.
