{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

''Feel free to edit the '''Background''' and '''Desired behavior''' sections, for the case you think that changes or additions are motivated.<<BR>>
Please insert possible comments at the bottom of the page.''

------

=== Background ===

<nowiki>[[http://packages.ubuntu.com/source/maverick/gdm|GDM]]</nowiki> and <nowiki>[[http://packages.ubuntu.com/source/maverick/language-selector|LanguageSelector]]</nowiki> do currently not work quite well together.

 Variable inconsistency::
 The !LanguageSelector GUI distinguishes between language for translation purposes on one hand, and non-translation locale settings on the other hand. In the tab for language it sets the <code>LANGUAGE</code> environment variable, while the <code>LANG</code> variable is set in the tab for non-translation locale settings.
 :: The GDM login screen provides a tool for setting the translation language only. However, the variable that GDM sets is <code>LANG</code>.

 Not all applications recognize the LANGUAGE variable::
 When the gettext specific variable <code>LANGUAGE</code> is set, it's given preference over <code>LANG</code> for the purpose of translation. However, some applications do not recognize <code>LANGUAGE</code>, and fall back to <code>LANG</code> when translating menus and messages.

For those reasons, one by one or together, users run into various variants of locale related unexpected behavior, and bug reports such as these are submitted:

* https://bugs.launchpad.net/ubuntu/+source/gdm/+bug/553162
* https://bugs.launchpad.net/ubuntu/+source/firefox/+bug/550222

=== Desired behavior ===

1. As the !LanguageSelector UI already indicates, users should be able to set translation language respective other locales independently of each other, without any risk that those settings are mixed up.
2. Applications that don't recognize the <code>LANGUAGE</code> variable should display menus and messages in the primary language, even if they cannot benefit from the <nowiki>[[http://www.gnu.org/software/gettext/manual/gettext.html#The-LANGUAGE-variable|priority list feature]]</nowiki> that <code>LANGUAGE</code> provides.

------

=== Suggested solution ===

(by GunnarHj 2010-10-05)

This solution suggests changes to a few !LanguageSelector files and one GDM file (<code>Xsession.in</code>).

==== LanguageSelector ====

When setting the variable for non-translation locales, i.e. <code>LANG</code>, !LanguageSelector updates the <code>Language</code> value in <code>~/.dmrc</code> and <code>/var/cache/gdm/$USER/dmrc</code>. However, GDM uses the dmrc <code>Language</code> value to determine the pre-selected language in the list box at the login screen for selecting the user language. Therefore the !LanguageSelector code should be changed, so that the dmrc update instead happens when the translation language variable, i.e. <code>LANGUAGE</code>, is set.

==== GDM ====

* The chosen language is assigned to the <code>LANG</code> variable. Instead the priority list, both in the <code>LANGUAGE</code> variable and in <code>~/.profile</code>, should be updated, so that
** <code>LANGUAGE</code> aware applications use the correct list,
** the correct list is displayed next time the user opens the language tab in !LanguageSelector, and
** the chosen language does not interfere with the non-translation locales.
* The chosen language should also be assigned to the <code>LC_MESSAGES</code> environment variable, so those applications that don't recognize <code>LANGUAGE</code> will still use the correct language for translation.

==== Patches and PPA for testing ====

Two patches with this solution have been attached to <nowiki>[[https://bugs.launchpad.net/ubuntu/+source/gdm/+bug/553162|bug report #553162]]</nowiki>.

I have also created the PPA <nowiki>[[https://launchpad.net/~gunnarhj/+archive/locale-test|Test of code for setting locales]]</nowiki> and uploaded versions of GDM and !LanguageSelector with the suggested changes. It means that you can test the solution by just installing the binary files, provided that you upgrade to Ubuntu 10.10. Example:

<pre>
    sudo dpkg -i language-selector_0.6.6localefix6_all.deb
</pre>

----
CategoryDesktopTeam
CategoryTranslations
