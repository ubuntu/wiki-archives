{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

=== Semana del desarrollador ===

Miercoles 1 de Febrero del 2012 - Como actualizar paquetes - coolbhavi

<pre>
10:01 < chilicuil> y ahora llega coolbhavi que nos hablara sobre como actualizar una aplicacion que ya este
en los repositorios de Ubuntu
10:02 < chilicuil> asegurense de tener el paquete  packaging-dev para seguir la sesion
10:02 < chilicuil> actualizar un paquete, la mayor parte de veces es traer la ultima version estable
de upstream a ubuntu
10:03 < chilicuil> normalmente hacemos esto con un merge o una sincronizacion con los repositorios de Debian
10:03 < chilicuil> pero hay casos donde no podemos, por ejemplo, cuando debian se encuentra en etapa
'freeze' o cuando el paquete no tiene mantenedor
10:04 < chilicuil> o tal vez, solo necesitemos la ultima version para arreglar un error critico
10:04 < chilicuil> en ese caso podemos obtenerlo en ubuntu y despues enviarlo a Debian
10:04 < chilicuil> asumiendo que hemos entendido este proceso comenzaremos la charla
10:04 < chilicuil> lo primero que tenemos que hacer es obtener la ultima version de upstream
10:05 < chilicuil> esto tal vez nos de un paquete .tar 
10:05 < chilicuil> en caso de que tengamos correctamente definido el archivo debian/watch, podemos usar
el comando "uscan" para obtener la ultima version
10:05 < chilicuil> mas sobre este procedimiento aqui: http://wiki.debian.org/debian/watch
10:06 < chilicuil> uscan manda a llamar a uupdate, recomiendo que tambien vean su manual $ man uupdate
10:07 < chilicuil> tambien podemos tener una regla en debian/rules, si la tiene podriamos obtener la
ultima version si corremos $ make -f debian/rules get-orig-source
10:07 < chilicuil> aunque eso depende de paquete en paquete
10:07 < chilicuil> no olviden leer el changelog (debian/changelog) para ver si existe algun otro metodo
para obtener la ultima version del programa
10:08 < chilicuil> bien, una vez que tengamos la ultima version, debemos renombrarlo conforme a la politica
de empaquetamiento
10:08 < chilicuil> por ejemplo si tenemos foo-1.1.tar.gz lo renombraremos a foo_1.1.orig.tar.gz
10:10 < chilicuil> en el caso mas simple, donde no haya cambios en el empaquetamiento, descompriremos
el archivo, copiaremos el archivo debian, agregaremos el nuevo cambio en el changelog, sobre la actualizacion
y crearemos el binario
10:10 < chilicuil> me gustaria que todas las actualizaciones fueran asi de simples =)
10:13 < chilicuil> anteriormente a la version 3.0 de dpkg-source, si el empaquetador hacia sus cambios sobre
el programa upstream, en lugar de usar un sistema de parches (podias checar estos si veias el diff.gz
anterior), hacer cambios dentro del directorio debian no era suficiente, tenias que volver a aplicar el
parche sobre el programa, y entonces ocasionalmente te encontrabas con que ya no era compatible, o
tenia algunos errores de acoplamiento
10:13 < chilicuil> tenias que correr $ date ../foo_2.orig.tar.gz en la version anterior para automatizar
el proceso
10:14 < chilicuil> pero ahora, gracias a la version 3.0 de dpkg-source, que genera automaticamente un
archivo debian-changes-* si encuentra cambios fuera del directorio debian es mucho mas facil
10:14 < chilicuil> ademas lintian tambien envia warnings =)
10:14 < chilicuil> pueden encontrar mas informacion sobre la nueva version de dpkg-source aqui:
http://wiki.debian.org/Projects/DebSrc3.0
10:15 < chilicuil> un escenario mas complejo, pero tambien mas real, involucraria revisar las licencias
de todos los archivos, para ver si se ha agregado alguna nueva (licensecheck -r --copyright)
10:16 < chilicuil> verificar si todos los parches de la version anterior aun sirven para esta, o si se
han integrado
10:17 < chilicuil> ver si el paquete requiere nuevas dependencias (algunas veces se reporta en los
changelogs del programa, pero otras tantas hay que encontrarlas revisando los autoconf y los archivos Make)
10:18 < chilicuil> asegurarse que el paquete contiene manual (pagina man), lanzador (archivo .desktop)
y si tiene verificar si es valido (desktop-file-validate)
10:18 < chilicuil> algunas veces los autores cambian algunas cosas que requiren que se agreguen banderas
de compilacion
10:18 < chilicuil> en especial si se trata de una libreria, entonces debemos tener cuidado con eso
10:19 < chilicuil> hay que verificar si los cambios en la API/ABI se reflejan en SONAME/version (para
saber que es soname, ver: http://en.wikipedia.org/wiki/Soname)
10:19 < chilicuil> check-symbols te puede ayudar con esa tarea
10:20 < chilicuil> algunas veces se necesitara compilar muchos paquetes en los repositorios, si
estamos actualizando una libreria de la que dependen muchos programas
10:20 < chilicuil> ahora usaremos un ejemplo, para que todo quede mas claro
10:21 < chilicuil> espero que no este llendo demasiado rapido, si tienen cualquier pregunta, no duden
en interrumpir
10:21 < chilicuil> #tambien, si desean que les ayudemos a hacer su pregunta, no duden en hacerla
10:22 < chilicuil> regresando.., el paquete que usare como ejemplo es un paquete que yo mismo he creado
10:22 < chilicuil> mobile-broadband-provider-info (que por cierto, no he actualizado ultimamente, porque
he estado liado con otros asuntos)
10:22 < chilicuil> escribiremos en una terminal $ mkdir m-b-p-i && cd m-b-p-i &&  dget -x
https://launchpad.net/ubuntu/+archive/primary/+files/mobile-broadband-provider-info_20111113-1ubuntu1.dsc
10:23 < chilicuil> que descargara la ultima version del paquete fuente de debian, de launchpad
10:24 < chilicuil> vean que no estoy usando apt-get source mobile-broadband-provider-info dado que
eso descargaria la version de oneiric,natty,maverick or lucid), una cosa util solo si se desea hacer un SRU
10:24 < chilicuil> obounaim menciona que esta teniendo un error de validacion
10:24 < chilicuil> coolbhavi ha pedido que haga $  gpg --recv-keys ID_de_la_llave_con_la_que_tiene_problemas
10:25 < chilicuil> y que vuelva a intentar descargarlo $ dget -x
https://launchpad.net/ubuntu/+archive/primary/+files/mobile-broadband-provider-info_20111113-1ubuntu1.dsc
10:25 < chilicuil> tambien se puede descargar de esta forma $ pull-lp-source  mobile-broadband-provider-info
10:26 < chilicuil> #me pregunto si sera lo mismo que hacer $ bzr branch
lp:ubuntu/mobile-broadband-provider-info ...
10:27 < chilicuil> ahora que tengan el directorio mobile-broadband-provider-info-20111113/ hay que entrar a
el y buscar el directorio debian
10:28 < chilicuil> una vez dentro de debian/ veran los archivos +changelog, +control,
+mobile-broadband-provider-info.docs, +copyright, +rules, etc
10:29 < chilicuil> bueno, han contestado a mi pregunta diciendo que funcionaria, pero que ahora no esta
explicando el metodo distribuido
10:30 < chilicuil> sino el metodo clasico
10:31 < chilicuil> obounaim ha mencionado que no encuentra el directorio
mobile-broadband-provider-info-20111113/
10:33 < chilicuil> coolbhavi le ha pedido que verifique si ha extraido el codigo fuente correctamente,
puede hacerse de esta manera $ dpkg-source -x mobile-broadband-provider-info_20111113-1ubuntu1.dsc
10:34 < Marverick> lo chilicuil
10:34 < chilicuil> continuando, una vez dentro del directorio debian/ veran un archivo llamado +format
10:35 < chilicuil> o/ Marverick, bienvenido =)
10:35 < Marverick> gracias
10:35 < chilicuil> dentro de el encontraremos una cadena llamada "3.0 (quilt)"
10:35 < chilicuil> que especifica la version de dpkg-source 
10:35 < chilicuil> ahora, si ven el archivo +watch
10:36 < chilicuil> observaran que realmente no contiene nada, solo lo hice para satisfacer las politicas
de empaquetamiento, lintian debio haber mostrado la falta del archivo
10:36 < chilicuil> Marverick: tal vez tambien quieras entrar a #ubuntu-classroom, ahi es donde todo esta
pasando, esto solo es una interpretacion de aquello
10:37 < Marverick> si
10:37 < Marverick> you sÃ©
10:37 < Marverick> yo
10:37 < chilicuil> ahora que hemos visto que no podemos usar el archivo watch, podemos hechar un vistaso
al archivo debia/rules
10:37 < chilicuil> veran que he definido una regla llamada get-orig-source
10:38 < chilicuil> el archivo debian/rules es en realidad un archivo Makefile con un nombre distinto ;)
10:38 < chilicuil> si ven un poco mas la regla get-orig-source notaran que requiere tener instalados
los programas automake y git-core
10:39 < chilicuil> asi que pueden instalarlos, si desean seguir con el ejemplo
10:39 < chilicuil> suponiendo que no hay dudas hasta aqui, continuaremos
10:42 < chilicuil> asi que, si tienen esos programas pueden obtener la ultima version del paquete haciendo: 
10:42 < chilicuil> $ make -f debian/rules get-orig-source
10:43 < chilicuil> esto descargara la ultima version en git-head y lo comprimira en un tar
10:44 < chilicuil> despues lo descomprimira en el directorio mobile-broadband-provider-info-20120201/
10:44 < chilicuil> pueden ver todo lo que hace, si revisan los comandos que aplican para la regla
get-orig-source en debian/rules
10:45 < chilicuil> ahora, dado que no hay cambios, ni parches fuera del directorio debian, copiamos
ese directorio de mobile-broadband-provider-info-20111113/ a mobile-broadband-provider-info-20120201/
10:45 < chilicuil> una vez completado, entraremos al directorio debian de
mobile-broadband-provider-info-20120201/
10:45 < chilicuil> y utilizaremos $ dch -i para describir nuestros cambios
10:46 < chilicuil> le cambiaremos la version a la 20120201-0ubuntu1 (usaremos -0ubuntu1 dado que esta
version no esta en Debian), y le pondremos que es para 'precise'
10:47 < chilicuil> ahora deberia verse mas o menos asi: mobile-broadband-provider-info
(20120201-0ubuntu1) precise; urgency=low
10:47 < chilicuil> tambien agregaremos la leyenda, en ingles: * Merging upstream version 20120201 from git
and make a list
10:47 < chilicuil> of upstream changes
10:48 < chilicuil> tambien listaremos los bugs que esten relacionados, con los errores que corriga
la actualizacion, de esta manera una vez que se suba a los repositorios, cerran cerrados automaticamente
10:48 < chilicuil> maÃ±ana hablare un poco mas sobre el formato que debe tener el changelog
10:49 < chilicuil> jincreator1 pregunta que ha escuchado hablar sobre fakeroot.
10:49 < chilicuil> y se pregunta cual es la diferencia entre $ fakeroot debian/rules y make -f debian/rules
10:52 < chilicuil> coolbhavi ha contestado que make -f usa el comando make en tu entorno, mientras que
fakeroot crea un entorno temporal, donde se le hace creer a make que se esta ejecutando con permisos
de administrador
10:52 < chilicuil> regresando al tema
10:53 < chilicuil> una vez hechos los cambios y guardado el changelog, escribiremos $  debuild -S -sa
para obtener el paquete fuente
10:54 < chilicuil> una vez que el archivo .dsc y changes se hayan generado, podemos seguir pasos
adicionales, para ganar puntos extra
10:54 < chilicuil> como usar pbuilder para probar si se generan correctamente binarios en base al nuevo
archivo .dsc que tenemos
10:55 < chilicuil> tendremos una sesion especifica sobre pbuilder maÃ±ana con tumbleweed =)
10:57 < chilicuil> tambien podemos hacer un diff entre los directorios, y subirlos a launchpad junto con el
tar del codigo fuente (mi forma preferida de revisar parches) #nota del interprete, aunque es su forma
preferida, Ubuntu como distribucion y muchos otros desarrolladores prefieren usar el metodo distribuido
(bzr+lp)
10:57 < chilicuil> para hacer un diff de este ejemplo corremos: 
10:57 < chilicuil> $  diff -Nurb mobile-broadband-provider-info-20111113 
mobile-broadband-provider-info-20120201 >  m-b-p-i.diff
10:58 < chilicuil> una vez que hayan subido sus cambios, suscriban al equipo ubuntu-sponsors para que los vea
10:58 < chilicuil> si sus cambios son correctos, la nueva version del programa estara disponible en los
repositorios de Ubuntu
10:58 < chilicuil> tenemos mas preguntas?
10:59 < chilicuil> gracias a todos, eso es todo de mi parte, espero poder verlos en #ubuntu-motu o en
11:00 < chilicuil> tambien pueden contactarme por email en  bhavi@ubuntu.com o en fb facebook.com/bshankar
11:00 < chilicuil> con eso termina la sesion de coolbhavi =)
</pre>
