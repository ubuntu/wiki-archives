{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

== Toshiba Portege M700 Tablet ==

'''An ultimate guide to set up everything (mostly) to work in Ubuntu (Hardy, Intrepid, Jaunty, and Karmic Final)'''

* Hardy Contact: vlandi at gmail dot com
* Intrepid/Jaunty/Karmic Contact: rfestag at gmail dot com
* Make: Toshiba
* Brand: Portege
* Model: M700-S7008X
* Website:

== Current Issues ==

* Tablet (bezel) buttons don't work OTB - solution below
* Fingerprint reader doesn't work OTB - solution below

== System Info ==
TOSHIBA 
PORTEGE M700 
PPM70U-0T901J 

== Hardware details ==

=== Screen ===

Screen detected with 1200x800 resolution @57Hz which is OK
Note that in the base install of Jaunty, Desktop Effects are disabled, but the kernel updates fix this issue.

=== Network ===

Both WiFi and NIC work without any problems. Note however that there are known issues with the wireless card causing Jaunty to hang on reboot. This problem can be fixed by installing the backports package:
<pre>
sudo apt-get install linux-backports-modules-jaunty
</pre>

=== CD/DVD writer ===

Works OTB

=== Sound ===
As of Karmic Koala (9.10), Sound works OTB. For older versions, you can download <code>linux-backports-modules-hardy</code> or <code>linux-backports-modules-intrepid</code>, whichever applies to your version (You no longer need the backports in Jaunty). So, for Hardy, you can do the following:
<pre>
sudo apt-get install linux-backports-modules-hardy
</pre>
Regardless of the version, you must also add the line
<pre>
options snd-hda-intel model=toshiba
</pre>
at the end of <code>/etc/modprobe.d/alsa-base</code> and restart (This must be done for all versions, including Jaunty).

Mic & headphones also works fine after that.

'''Hint''' - for other linux systems - this model uses Realtek ALS268 the same as Toshiba R400, so you can google how they resolve it in your distribution for that model.

=== Multimedia and Fn-buttons ===

Most of standard buttons (volume, brightness, sleep etc. work OTB)

About bezel buttons - below

=== ACPI, suspend, sleep ===

Works OTB

=== Build in camera ===

Works OTB (you can quickly check it with Ekiga softphone)

=== Touchscreen ===
The touchscreen (both active and passive digitizers) work OTB in Karmic. For older versions, see below.

==== To get stylus working in Hardy ====

Toshiba uses serial port 0x338 for a touch input, so first you have to install setserial
<pre>
sudo apt-get install setserial
</pre>
and add line:
<pre>
/bin/setserial /dev/ttyS0 port 0x338 irq 4 autoconfig
</pre>
at the end of <code>/etc/rc.local</code>

Next install <code>xserver-xorg-input-wacom</code> and <code>wacom-tools</code>
<pre>
sudo apt get install xserver-xorg-input-wacom wacom-tools
</pre>
and edit /etc/X11/xorg.conf file and add lines: 
<pre>
Section "InputDevice"
        Identifier      "stylus"
        Driver          "wacom"
        Option          "Device"        "/dev/ttyS0"
        Option          "Type"          "stylus"
        Option          "ForceDevice"   "ISDV4"
        Option          "Mode"          "absolute"
        Option          "SendCoreEvents"        "true"
        Option		"Button2"	"3"
EndSection

Section "InputDevice"
        Identifier      "eraser"
        Driver          "wacom"
        Option          "Device"        "/dev/ttyS0"
        Option          "Type"          "eraser"
        Option          "ForceDevice"   "ISDV4"
        Option          "Mode"          "absolute"
        Option          "SendCoreEvents"        "true"
        Option		"Button2"	"3"
EndSection
</pre>

and 

<pre>
        
        InputDevice     "stylus"        "SendCoreEvents"
        InputDevice     "eraser"        "SendCoreEvents"
        InputDevice     "cursor"        "SendCoreEvents"
</pre>

in section <code>ServerLayout</code> at the end of the same file

Restart and you should be able to use stylus

==== Finger touchscreen (Hardy Only. For Intrepid, see stylus instructions below) ====

This is unfortunately more complicated. Current wacom driver doesn't support this model. 
Thanks to <nowiki>[[http://docs.google.com/View?docid=dg8nknth_3hs868qhh|Rene vanPaassen]]</nowiki> there is a patch
to the source code to make it work (you can omit this section if you're happy only with stylus)

'''Easy way'''

Download linuxwacom patched driver from <nowiki>[[http://eire.ie.eu.org/toshiba/wacom_drv.so|here]]</nowiki>
and replace original driver in <code>/usr/lib/xorg/modules/input/</code> . 
<pre>
cd <directory with downloaded driver>
sudo mv /usr/lib/xorg/modules/input/wacom_drv.so /usr/lib/xorg/modules/input/wacom_drv.so.backup
sudo cp wacom_drv.so /usr/lib/xorg/modules/input/
</pre>

Restart and your finger touchscreen should work.

'''Hard way'''

Download the <code>isdv4.patch</code> from <nowiki>[[http://docs.google.com/View?docid=dg8nknth_3hs868qhh|here]]</nowiki> or <nowiki>[[http://eire.ie.eu.org/toshiba/isdv4.patch|here]]</nowiki>

Download the obsolete linuxwacom-0.7.9-7 sources from repositories (google for linuxwacom-0.7.9-7.tar.bz2) or from <nowiki>[[http://eire.ie.eu.org/toshiba/linuxwacom-0.7.9-7.tar.bz2|here]]</nowiki>

Download build-essential if you don't have it, along with tk,tk-dev and patch. Unpack sources, patch, make and install
<pre>
cd <directory with patch and sources>
sudo apt-get install build-essential tk tk-dev patch
tar xvjf linuxwacom-0.7.9-7.tar.bz2
cd linuxwacom-0.7.9-7
patch -p1 <../isdv4.patch
./configure
make
sudo make install
</pre>

If everything went fine, you should have a new driver in <code>/usr/lib/xorg/modules/input</code>

==== To get stylus and touch screen working in Intrepid ====

Just as above, you will need to install setserial and configure it to set up the tablet on boot.
<pre>
sudo apt-get install setserial
</pre>
and add line:
<pre>
/bin/setserial /dev/ttyS0 port 0x338 irq 4 autoconfig
</pre>
at the end of <code>/etc/rc.local</code>

Unfortunately, the current versions of <code>xserver-xorg-input-wacom</code> and <code>wacom-tools</code> in the repositories have a bug that makes the touch screen erratic and unusable, and causes problems with Compiz when the screen is rotated. First, make sure they are uninstalled
<pre>
sudo apt-get remove xserver-org-input-wacom wacom-tools
</pre>

Then we can download, compile, and install a working driver (at least 0.8.2 from linuxwacom.sourceforge.net)
<pre>
sudo apt-get install build-essential
sudo apt-get build-dep wacom-tools
wget http://prdownloads.sourceforge.net/linuxwacom/linuxwacom-0.8.2.tar.bz2
tar -xjvf linuxwacom-0.8.2.tar.bz2 
cd linuxwacom-0.8.2
./configure --enable-wacom --prefix=/usr
make
sudo make uninstall
sudo make install
</pre>

Make sure there were no errors before continuing. For reference, these instructions were derived from https://bugs.launchpad.net/ubuntu/+source/wacom-tools/+bug/300980 and https://help.ubuntu.com/community/Wacom/LatestDriver, which may be useful for troubleshooting.

Finally, backup your current xorg.conf, and replace it with the following:
<pre>
Section "Monitor"
	Identifier	"Configured Monitor"
EndSection

Section "Screen"
	Identifier	"Default Screen"
	Monitor		"Configured Monitor"
	Device		"Configured Video Device"
EndSection

Section "InputDevice"
	Identifier      "stylus"
	Driver          "wacom"
	Option          "Device"        "/dev/ttyS0"
	Option          "Type"          "stylus"
	Option          "ForceDevice"   "ISDV4"
	Option          "Mode"          "absolute"
	Option          "SendCoreEvents"        "true"
	Option		"Button2"	"3"
EndSection

Section "InputDevice"
	Identifier      "eraser"
	Driver          "wacom"
	Option          "Device"        "/dev/ttyS0"
	Option          "Type"          "eraser"
	Option          "ForceDevice"   "ISDV4"
	Option          "Mode"          "absolute"
	Option          "SendCoreEvents"        "true"
	Option		"Button1"	"2"
EndSection

Section "InputDevice"
	Identifier      "touch"
	Driver          "wacom"
	Option          "Device"        "/dev/ttyS0"
	Option          "Type"          "touch"
	Option          "ForceDevice"   "ISDV4"
	Option          "Mode"          "absolute"
	Option          "SendCoreEvents"        "true"
EndSection

Section "ServerLayout"
	Identifier	"Default Layout"
	Screen		"Default Screen"
	InputDevice     "stylus"        "SendCoreEvents"
	InputDevice     "eraser"        "SendCoreEvents"
	InputDevice     "touch"        "SendCoreEvents"
EndSection

Section "Device"
	Identifier	"Configured Video Device"
	Option		"RandRRotation"	"true"
EndSection
</pre>

Restart and you should have access to the stylus and the touch screen. You will also be able to send right-clicks by pressing the side button. Additionally, the eraser now acts as Button3, which is useful in some applications (like Xournal) for actually acting like an eraser.

==== To get stylus and touch screen working in Jaunty ====

Just as above, you will need to install setserial and configure it to set up the tablet on boot.
<pre>
sudo apt-get install setserial
</pre>
and add line:
<pre>
/bin/setserial /dev/ttyS0 port 0x338 irq 4 autoconfig
</pre>
at the end of <code>/etc/rc.local</code>

The latest versions of <code>xserver-xorg-input-wacom</code> and <code>wacom-tools</code> in the repositories do work, so simply install them.
<pre>
sudo apt-get install xserver-xorg-input wacom wacom-tools
</pre>
We can use the <code>xorg.conf</code> file shown above for Intrepid to configure X11 for Jaunty. After you reboot, you should have full access to both the touch screen and the stylus. 

=== Screen Rotation ===
==== Screen Rotate in Karmic ====
For reference, these instructions were derived from <nowiki>[[http://ubuntuforums.org/showthread.php?p=6546012#post6546012|this]]</nowiki> thread.

First, backup your 10-linuxwacom.fdi file.
<pre>
sudo cp /usr/share/hal/fdi/policy/20thirdparty/10-linuxwacom.fdi ~/Desktop/10-linuxwacom.bak
</pre>

Then run the following command to edit the file.
<pre>
gksudo gedit /usr/share/hal/fdi/policy/20thirdparty/10-linuxwacom.fdi
</pre>

Delete the contents of it, and replace it with the following. This will allow left and right clicks, and allow for the eraser end of the stylus to be used as an eraser in Xournal:
<pre>
<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- Wacom:  tablets, tablet pc's, and touch screen laptops -->
<deviceinfo version="0.2">
  <!-- for all Wacom USB tablets -->
  <device>
    <match key="input.originating_device" contains="if0">
      <match key="info.product" contains="Wacom">
	<merge key="input.x11_driver" type="string">wacom</merge>
	<merge key="input.x11_options.Type" type="string">stylus</merge>
	<append key="info.callouts.add" type="strlist">hal-setup-wacom</append>
	<append key="wacom.types" type="strlist">eraser</append>
	<append key="wacom.types" type="strlist">cursor</append>
	<append key="wacom.types" type="strlist">pad</append>
        <!-- for HP dv3-2250 multi-touch laptop -->
        <match key="info.udi" contains="e2">
          <merge key="input.x11_options.Type" type="string">touch</merge>
        </match>
      </match>
    </match>
  </device>
  <!-- for most Wacom USB tablets with touch -->
  <device>
    <match key="input.originating_device" contains="if1">
      <match key="info.product" contains="Wacom">
        <merge key="input.x11_driver" type="string">wacom</merge>
        <merge key="input.x11_options.Type" type="string">touch</merge>
        <!-- for Bamboo Pen & Touch tablets -->
	<append key="info.callouts.add" type="strlist">hal-setup-wacom</append>
	<append key="wacom.types" type="strlist">pad</append>
      </match>
    </match>
  </device>
  <!-- for Wacom Serial tablets -->
  <device>
    <match key="info.capabilities" contains="serial">
      <match key="@info.parent:pnp.id" contains_outof="WACf;FUJ02e5;FUJ02e7">
	<append key="info.capabilities" type="strlist">input</append>
	<merge key="input.x11_driver" type="string">wacom</merge>
	<merge key="input.x11_options.Type" type="string">stylus</merge>
	<merge key="input.x11_options.ForceDevice" type="string">ISDV4</merge>
	<merge key="input.device" type="copy_property">serial.device</merge>
	<append key="info.callouts.add" type="strlist">hal-setup-wacom</append>
	<append key="wacom.types" type="strlist">eraser</append>
	<append key="wacom.types" type="strlist">cursor</append>
	<!-- Serial tablets with touch capabilities -->
        <match key="@info.parent:pnp.id" contains_outof="WACf008;WACf009;WACf010;WACf008A;WACf00B;WACf00C;WACf00D;WACf00E;FUJ02e7">
	  <append key="wacom.types" type="strlist">touch</append>
	</match>
        <!-- Serial tablets that operate at higher baud rate -->
        <match key="@info.parent:pnp.id" contains_outof="WACf008">
          <merge key="input.x11_options.BaudRate" type="string">38400</merge>
        </match>
      </match>
    </match>
  </device>
  <!-- Match the Wacom Bluetooth A5 pen tablet -->
  <device>
    <match key="info.capabilities" contains="input.mouse">
      <match key="info.product" contains="WACOM">
        <match key="info.product" contains="Tablet">
          <merge key="input.x11_driver" type="string">wacom</merge>
          <merge key="input.x11_options.Type" type="string">stylus</merge>
	  <append key="info.callouts.add" type="strlist">hal-setup-wacom</append>
	  <append key="wacom.types" type="strlist">eraser</append>
	  <append key="wacom.types" type="strlist">cursor</append>
        </match>
      </match>
    </match>
  </device>
  <!-- Wacom names "parser" -->
  <device>
    <match key="info.udi" contains_not="subdev_0">
    <match key="info.udi" contains_not="subdev_1">
    <match key="info.udi" contains_not="subdev_2">
      <match key="input.x11_options.Type" contains="stylus">
        <merge key="info.product" type="string">stylus</merge>
	<merge key="input.x11_options.Button2" type="string">3</merge>
      </match>
      <match key="input.x11_options.Type" contains="eraser">
        <merge key="info.product" type="string">eraser</merge>
	<merge key="input.x11_options.Button1" type="string">2</merge>
      </match>
      <match key="input.x11_options.Type" contains="cursor">
        <merge key="info.product" type="string">cursor</merge>
      </match>
      <match key="input.x11_options.Type" contains="pad">
        <merge key="info.product" type="string">pad</merge>
      </match>
      <match key="input.x11_options.Type" contains="touch">
        <merge key="info.product" type="string">touch</merge>
      </match>
    </match>
    </match>
    </match>
  </device>
</deviceinfo>
</pre>

Now, create a new init.d script to replace the default input device names with the names xsetwacom expects:

<pre>
gksudo gedit /etc/init.d/wacom-names
</pre>

Place the following contents into the file:
<pre>
for udi in `hal-find-by-property --key input.x11_driver --string wacom`
do
   type=`hal-get-property --udi $udi --key input.x11_options.Type`
   echo $type

## # rewrite the names that the Xserver will use
   hal-set-property --udi $udi --key info.product --string $type
done
</pre>

Make the new script executable:
<pre>
sudo chmod +x /etc/init.d/wacom-names
</pre>

Finally, set it to run at boot as follows:
<pre>
sudo update-rc.d wacom-names start 27 2 3 4 5 .
</pre>

Reboot the system. When it comes back up, you can install wacom-tools:
<pre>
sudo apt-get install wacom wacom-tools
</pre>

You should now be able to run the xsetwacom command to rotate the input. You can use the following script to rotate the screen and inputs at the same time:
<pre>

if [ -f /tmp/rotated ]; then
        xrandr -o normal
        xsetwacom set "stylus" Rotate none
        xsetwacom set "cursor" Rotate none
        xsetwacom set "eraser" Rotate none
        rm -f /tmp/rotated && exit 0
else
        xrandr -o right
        xsetwacom set "stylus" Rotate CW
        xsetwacom set "cursor" Rotate CW
        xsetwacom set "eraser" Rotate CW
        echo 1 > /tmp/rotated && exit 0
fi
</pre>

Save this script /usr/local/bin/toshiba-rotate, and make it executable
<pre>
sudo chmod 755 /usr/local/bin/toshiba-rotate
</pre>

You can now either use the xbindkeys method described later for mapping bezel keys, or you can change the gnome key bindings:
<pre>
System -> Preferences -> Keyboard Shortcuts
</pre>

Click "Add", and enter a name (Rotate) and the command (/usr/local/bin/toshiba-rotate).
Locate the new entry (Rotate) in the list, click "Disabled" under the "Shortcut" column, and press the button you want to map to that.

A nice solution for arbitrary re-orientation is the create a separate script for rotating left, right, halfway, and normal, and mapping each of the four directions on the switch button on the bezel to one of those directions, using the same basic instructions above.

==== Screen Rotate in pre-Karmic releases ====
First you have to enable resolution and rotation in X by putting the following line:
<pre>
        Option          "RandRRotation" "true"
</pre>
into the <code>Device</code> section describing your graphic card in <code>/etc/X11/xorg.conf</code> and
Restart X

I put simple script to rotate and restore screen to landscape. 

'''NOTE''' - In Hardy, you will have to disable compiz <code>System->Preferences->Appearence->VisualEffects->None</code> to make rotation work. This is no longer an issue in Intrepid.

Save script:
<pre>

if [ -f /tmp/rotated ]; then
        xrandr -o normal
        xsetwacom set "stylus" Rotate none
        xsetwacom set "cursor" Rotate none
        xsetwacom set "eraser" Rotate none
        rm -f /tmp/rotated && exit 0
else
        xrandr -o right
        xsetwacom set "stylus" Rotate CW
        xsetwacom set "cursor" Rotate CW
        xsetwacom set "eraser" Rotate CW
        echo 1 > /tmp/rotated && exit 0
fi
</pre>

as for example <code>/usr/local/bin/toshiba-rotate</code> and make it executable
<pre>
sudo chmod 755 /usr/local/bin/toshiba-rotate
</pre>
Then everytime you run the script it will rotate screen right and back to landscape.
On how to assign this script to a button in next section.

=== Bezel buttons ===

There is no easy way of assigning a meta-buttons function, so I used <code>xbindkeys</code> and <code>xte</code> from <code>xautomation</code> package
<pre>
sudo apt-get install xbindkeys xbindkeys-config xautomation
</pre>
Next create a default configuration file and run <code>xbindkeys-config</code>
<pre>
cd ~
xbindkeys --defaults >./.xbindkeysrc
xbindkeys-config
</pre>
GUI should open and you can edit/add new key assignments. 

For example to add screen rotation click "New", then in Edit section enter the name you like, click "Get Key" and press bezel button. Something like "Mod4 + 6|m0x40+c:15" should appear. Then in "Action" enter "/usr/local/bin/toshiba-rotate" then click "Save&Apply&Exit".

Now if you run <code>xbindkeys</code> you should be able to rotate your screen using bezel button. Remeber, you have to add <code>xbindkeys</code> to your session startup scripts in <code>System->Preferences->Sessions</code>

'''Hint''': if you want to assing a keypress to bezel button (for example pagedown) use command below as "Action" in GUI
<pre>
/usr/bin/xte "key Page_Down"
</pre>
For more keys - look at xte manual (<code>man xte</code>)

'''NOTE''' - You may want to disable the pre-defined key bindings that refer to xterm, or uninstall xterm. Otherwise, when you press ctrl+f to search (say, in Firefox), it will open a terminal instead.

=== Fingerprint reader ===

Toshiba uses Authentec device, which is NOT supported by <code>thinkfinger</code> package.
Instead look at <code>fprint</code> project <nowiki>[[http://www.reactivated.net/fprint/wiki/Main_Page|here]]</nowiki> and <nowiki>[[http://www.madman2k.net/comments/105|here]]</nowiki>

'''Quick way''' (if you're lazy :)

Add this line at the end of sources list:
<pre>
deb http://ppa.launchpad.net/madman2k/ubuntu hardy main restricted universe multiverse 
</pre>
update, sources and install all fprint packages:
<pre>
sudo apt-get update && sudo apt-get install libfprint fprint-demo libpam-fprint
</pre>
Then you can use 
<pre>
sudo fprint-demo
</pre>
To enroll and play a bit. 

To use it as authentication method insert to <code>/etc/pam.d/common-auth</code>:
<pre>
auth    sufficient    pam_fprint.so
auth    required      pam_unix.so nullok_secure
</pre>

NOTE - this is funny to play, but is not supported by many applications using gksu etc. I found it crashed a few times, so I think I will just wait for more mature version.

=== Media card reader ===

Unfortunately tifm driver reads only SD (and some MMC) cards will work albeit slowly.
Unless someone will start developing the driver again there is no chance to get other cards working.

=== Bluetooth ===
Bluetooth only works OTB with Jaunty.

=== Unchecked so far ===

* Modem - who uses it anyway today ?? ;-)
* Firewire 

=== Some useful applications ===
If you're new using tablets in Linux - there are some great programs to play with:
* <nowiki>[[http://risujin.org/cellwriter/|Cellwriter]]</nowiki> - handwriting recognition software with onscreen keyboard
* <nowiki>[[http://xournal.sourceforge.net/|Xournal]]</nowiki> - similar to M$ onenote
* <nowiki>[[http://www.adebenham.com/gournal/|Gournal]]</nowiki> - another pen journal
* <nowiki>[[http://www.dklevine.com/general/software/tc1000/jarnal.htm|Jarnal]]</nowiki> - Java based journal
* <nowiki>[[http://memoranda.sourceforge.net/|Memoranda]]</nowiki> - another Java based journal

----
CategoryLaptop CategoryLaptop CategoryLaptop
