{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

Ubuntu Linux for IBM z Systems and LinuxONE in IBM z/VM Installation
This document describes step-by-step the installation of Ubuntu Linux on IBM z Systems or LinuxONE as IBM z/VM guest (aka virtual machine).

1. Load installer files from ports.ubuntu.com to CMS
`Ready; T=0.01/0.01 10:42:15` <<BR>>
''' `acc 592 t` ''' <<BR>>
`DMSACP723I T (592) R/O` <<BR>>
`Ready; T=0.01/0.01 10:42:34` <<BR>>
''' `ftp ports.ubuntu.com` ''' <<BR>>
`VM TCP/IP FTP Level 630` <<BR>>
`Connecting to 91.189.88.151, port 21` <<BR>>
`220 Ubuntu ISV Image FTP server (vsftpd)` <<BR>>
`USER (identify yourself to the host):` <<BR>>
''' `anonymous` ''' <<BR>>
`>>>USER anonymous` <<BR>>
`331 Please specify the password.` <<BR>>
`Password:` <<BR>>
''[In case of anonymous FTP enter at least one character!]'' <<BR>>
`>>>PASS ********` <<BR>>
`230 Login successful.` <<BR>>
`Command:` <<BR>>
''' `cd ubuntu-ports/dists/xenial/main/installer-s390x/current` ''' <<BR>>
`>>>CWD ubuntu-ports/dists/xenial/main/installer-s390x/current` <<BR>>
`250 Directory successfully changed.` <<BR>>
''[see also section 4.8]'' <<BR>>
`Command:` <<BR>>
''' `cd images/generic` ''' <<BR>>
`>>>CWD images/generic` <<BR>>
`250 Directory successfully changed.` <<BR>>
`Command:` <<BR>>
''' `get ubuntu.exec (repl` ''' <<BR>>
`>>>EPRT |1|9.152.162.15|1172|` <<BR>>
`200 PORT command successful` <<BR>>
`>>>RETR ubuntu.exec` <<BR>>
`150 Connecting to port 1172` <<BR>>
`226-File successfully transferred` <<BR>>
`226 0.000 seconds (measured here), 10.46 Mbytes per second` <<BR>>
`351 bytes transferred in 0.001 seconds. Transfer rate 351.00 Kbytes/sec.` <<BR>>
`Command:` <<BR>>
''' `get parmfile.ubuntu (repl` ''' <<BR>>
`>>>EPRT |1|9.152.162.15|1173|` <<BR>>
`200 PORT command successful` <<BR>>
`>>>RETR parmfile.ubuntu` <<BR>>
`150 Connecting to port 1173` <<BR>>
`226-File successfully transferred` <<BR>>
`226 0.000 seconds (measured here), 46.55 Kbytes per second` <<BR>>
`10 bytes transferred in 0.001 seconds. Transfer rate 10.00 Kbytes/sec.` <<BR>>
`Command:` <<BR>>
''' `bin` ''' <<BR>>
''[This command is important, otherwise the binary is not going to work anymore!]'' <<BR>>
`>>>TYPE i` <<BR>>
`200 TYPE is now 8-bit binary` <<BR>>
`Command:` <<BR>>
''' `locsite fix 80` ''' <<BR>>
''[This command is important, otherwise the binary is not going to work anymore!]'' <<BR>>
`Command:` <<BR>>
''' `get kernel.ubuntu (repl` ''' <<BR>>
`>>>EPRT |1|9.152.162.15|1174|` <<BR>>
`200 PORT command successful` <<BR>>
`>>>RETR kernel.ubuntu` <<BR>>
`150-Connecting to port 1174` <<BR>>
`150 13129.0 kbytes to download` <<BR>>
`226-File successfully transferred` <<BR>>
`226 0.462 seconds (measured here), 27.75 Mbytes per second` <<BR>>
`13444160 bytes transferred in 0.467 seconds. Transfer rate 28788.35 Kbytes/sec.` <<BR>>
Command:` <<BR>>
''' `get initrd.ubuntu (repl` ''' <<BR>>
`>>>EPRT |1|9.152.162.15|1175|` <<BR>>
`200 PORT command successful` <<BR>>
`>>>RETR initrd.ubuntu` <<BR>>
`150-Connecting to port 1175` <<BR>>
`150 5789.9 kbytes to download` <<BR>>
`226-File successfully transferred` <<BR>>
`226 0.177 seconds (measured here), 31.94 Mbytes per second` <<BR>>
`5928960 bytes transferred in 0.181 seconds. Transfer rate 32756.69 Kbytes/sec.` <<BR>>
`Command:` <<BR>>
''' `quit` ''' <<BR>>
`>>>QUIT` <<BR>>
`221-Goodbye. You uploaded 0 and downloaded 18920 kbytes.` <<BR>>
`221 Logout.
`Ready; T=0.02/0.03 10:44:52` <<BR>>

You should now see the following four files on your a disk:
('kernel ubuntu', 'initrd ubuntu', 'parmfile ubuntu' and 'ubuntu exec'; the file sizes may vary)
`INITRD   UBUNTU   A1 F         80      74112       1448  1/26/16 10:44:48` <<BR>>
`KERNEL   UBUNTU   A1 F         80     168052       3001  1/26/16 10:44:41` <<BR>>
`PARMFILE UBUNTU   A1 V          1          1          1  1/26/16 10:43:40` <<BR>>
`UBUNTU   EXEC     A1 V         40         11          1  1/26/16 10:43:28` <<BR>>

2. Start ubuntu exec in z/VM CMS:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm1.png}}

3. Interactively answer questions regarding Network, DASD, etc.
Please see this example input:

`Configure the network device ` <<BR>>
`- - - - - - - - - - - - - - -` <<BR>>
`Please choose the type of your primary network interface that you will need for` <<BR>>
`installing the Ubuntu system (via NFS or HTTP). Only the listed devices are supported.` <<BR>>
`Network device type:` <<BR>>
`  1: ctc: Channel to Channel (CTC) or ESCON connection,` <<BR>>
`  2: qeth: OSA-Express in QDIO mode / HiperSockets,` <<BR>>
`  3: iucv: Inter-User Communication Vehicle - available for VM guests only,` <<BR>>
`  4: virtio: KVM VirtIO,` <<BR>>
`Prompt: '?' for help>` <<BR>>
''' `2` ''' <<BR>>
<<BR>>
`Please select the OSA-Express QDIO / HiperSockets device.` <<BR>>
`Device:` <<BR>>
`  1: 0.0.f5f0-0.0.f5f1-0.0.f5f2,` <<BR>>
`Prompt: '?' for help, default=1>` <<BR>>
''' `1` ''' <<BR>>

`By default OSA-Express cards use layer3 mode. In that mode LLC headers are` <<BR>>
`removed from incoming IPv4 packets. Using the card in layer2 mode will make it` <<BR>>
`keep the MAC addresses of IPv4 packets.` <<BR>>
`Use this device in layer2 mode?` <<BR>>
`  1: Yes Ý*¨  2: No` <<BR>>
`Prompt: '?' for help, default=1>` <<BR>>
''' `1` ''' <<BR>>

`Configure a network using static addressing` <<BR>>
`- - - - - - - - - - - - - - - - - - - - - -` <<BR>>
`The IP address is unique to your computer and may be:` <<BR>>

` * four numbers separated by periods (IPv4);` <<BR>>
` * blocks of hexadecimal characters separated by colons (IPv6).` <<BR>>
<<BR>>
`You can also optionally append a CIDR netmask (such as "/24").` <<BR>>
<<BR>>
`If you don't know what to use here, consult your network administrator.` <<BR>>
`IP address:` <<BR>>
`Prompt: '?' for help, default=9.152.162./22>` <<BR>>
''' `9.152.162.104/22` ''' <<BR>>
<<BR>>
`The gateway is an IP address (four numbers separated by periods) that indicates` <<BR>>
`the gateway router, also known as the default router.  All traffic that goes` <<BR>>
`outside your LAN (for instance, to the Internet) is sent through this router.` <<BR>>
`In rare circumstances, you may have no router; in that case, you can leave this` <<BR>>
`blank.  If you don't know the proper answer to this question, consult your` <<BR>>
`network administrator.` <<BR>>
`Gateway:` <<BR>>
`Prompt: '?' for help, default=9.152.160.1>` <<BR>>
''[To accept the default in z/VM CMS, press 'Enter' twice!]'' <<BR>>
<<BR>>
`The name servers are used to look up host names on the network. Please enter` <<BR>>
`the IP addresses (not host names) of up to 3 name servers, separated by spaces.` <<BR>>
`Do not use commas. The first name server in the list will be the first to be` <<BR>>
`queried. If you don't want to use any name server, just leave this field blank.` <<BR>>
`Name server addresses:` <<BR>>
`Prompt: '?' for help, default=9.152.160.1>` <<BR>>
''' `9.152.120.241` ''' <<BR>>
`Detecting link on enccw0.0.f5f0; please wait...` <<BR>>
`Please enter the hostname for this system.` <<BR>>
<<BR>>
`The hostname is a single word that identifies your system to the network.` <<BR>>
`If you don't know what your hostname should be, consult your network` <<BR>>
`administrator. If you are setting up your own home network, you can make` <<BR>>
`something up here.` <<BR>>
`Hostname:` <<BR>>
`Prompt: '?' for help, default=s8315004>` <<BR>>
''[To accept the default in z/VM CMS, press 'Enter' twice!]'' <<BR>>
<<BR>>
`The domain name is the part of your Internet address to the right of your host` <<BR>>
`name.  It is often something that ends in .com, .net, .edu, or .org.  If you` <<BR>>
`are setting up a home network, you can make something up, but make sure you use` <<BR>>
`the same domain name on all your computers.` <<BR>>
`Domain name:` <<BR>>
`Prompt: '?' for help, default=yourdomain.com>` <<BR>>
''[To accept the default in z/VM CMS, press 'Enter' twice!]'' <<BR>>
<<BR>>
`Generating SSH host key` <<BR>>
`- - - - - - - - - - - - -` <<BR>>
`You need to set a password for remote access to the Debian installer.` <<BR>>
`A malicious or unqualified user with access to the installer can have disastrous` <<BR>>
`results, so you should take care to choose a password that is not easy to` <<BR>>
`guess. It should not be a word found in the dictionary, or a word that could be` <<BR>>
`easily associated with you, like your middle name.` <<BR>>
<<BR>>
`This password is used only by the Debian installer, and will be discarded once` <<BR>>
`you finish the installation.` <<BR>>
`Remote installation password:` <<BR>>
''' `xxxxxxxx` '''
<<BR>>
`Please enter the same remote installation password again to verify that you` <<BR>>
`have typed it correctly.` <<BR>>
`Re-enter password to verify:` <<BR>>
''' `xxxxxxxx` '''
<<BR>>
`Start SSH` <<BR>>
<<BR>>
`To continue the installation, please use an SSH client to connect to the IP` <<BR>>
`address 9.152.162.104 and log in as the "installer" user. For example:` <<BR>>
<<BR>>
`   ssh installer@9.152.162.104` <<BR>>
<<BR>>
`The fingerprint of this SSH server's host key is:` <<BR>>
`SHA256:nsRZcYhf2hetIkup+Q4tuavZnacsJ4m4rVynsdsIWCc` <<BR>>
<<BR>>
`Please check this carefully against the fingerprint reported by your SSH client.` <<BR>>
`"Press enter to continue"` <<BR>>
<<BR>> 
Note: <<BR>> 
Do NOT continue here, but proceed with ssh to the installation system now!
You may leave the z/VM console window open in the background!
<<BR>> 

4. SSH with user 'installer' to the installation system 
Now ssh with the temporary user 'installer' to your system.
You can specify either the hostname or the IP address:

```ssh installer@9.152.162.104 ```

Users of a non-Linux operating system at their workstation may need to use a different ssh client, like for example 'Putty'.

4.1 Start installer
In case a modified parmfile is used, it's recommended to use the option "expert mode"):

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm2.png}}

4.2 Choose language: English
(adjust according to your needs)

4.3 Choose country: other (scroll down) -> Europe -> Germany
(adjust according to your needs)

4.4 Configure locale: en_US.UTF-8
(adjust according to your needs)

4.5 Choose mirror: <enter information manually>

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm3.png}}

4.6 Mirror's hostname: ports.ubuntu.com
(this is the default)

4.7 Enter directory (on ports.ubuntu.com it's just the root directory):

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm4.png}}

4.8 If ports.ubuntu.com is only reachable via a proxy, a proxy needs to be specified here.
Start the entry with `http://` and end with the port number, e.g. ':3128' <<BR>> 

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm5.png}}

<<BR>> 

Note: <<BR>> 
If the following message occurs: <<BR>> 
{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm6.png}} <<BR>> 
the installer kernel does not fit to the set of files located on the mirror. <<BR>> 
<<BR>> 
In this case, you need to restart the installation, using the files from ports.ubuntu.com. <<BR>> 
These files can be obtained from: <<BR>> 
ftp://ports.ubuntu.com/ubuntu-ports/dists/xenial/main/installer-s390x/ <<BR>> 
(The latest release version there, is also linked to 'current'.) <<BR>> 

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm7.png}} <<BR>> 
 <<BR>> 
Just grab the kernel, initrd and parmfile from there. <<BR>> 
 <<BR>> 

After some seconds the download of installer components will start and the installation proceeds with the next question:

4.9 Enter the user's full name

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm8.png}}

Since Ubuntu comes by default with a disabled root user account, it is mandatory to setup at least one user.

4.10 And enter a user name (in this sample case it's just 'test').

4.11 Enter password for your user:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm9.png}}

And repeat it a second time.

4.12 Encryption with encryptfs is not yet supported, so select 'No':

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm10.png}}

(wait for some seconds)

4.13 Choose the target disk (in this case the DASD 0.0.ea09) by selecting it and pressing 'Enter'

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm11.png}}

If there are lot's of DASD devices available, the above selection list is not shown, rather that you are asked to specify the DASD device by entering the device number in text form, e.g. '0.0.ea09'.

It's required to format DASD devices at least once. <<BR>>
In case you are sure that the previously selected DASD was already formatted before, you may choose 'No'. <<BR>>
If you are unsure if the previous selected DASD device was ever formatted choose 'Yes' here. <<BR>>
The formatting itself takes some time.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm12.png}}

If no more disks are required, scroll down to 'Finish' and press 'Enter', otherwise repeat the previous step for additional disks.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm13.png}}

4.14 The partition of the disk(s) can be either done in a 'Guided' or in a 'Manual' way. <<BR>>
In this example we follow the 'Manual' way.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm14.png}}

First select any potential partition for deletion and if when done, recreate them as needed.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm15.png}}

Press enter in 'FREE SPACE' row to recreate partitions, for example like:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm16.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm17.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm18.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm19.png}}

Now create a swap partition in a similar way:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm20.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm21.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm22.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm23.png}}

Now scroll down to the bottom and choose 'Finish partitioning and write to disk'.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm24.png}}

Confirm the writing of the changes to the disk with 'Yes':

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm25.png}}

4.15 Now after the new system got configured, the base system installation starts:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm26.png}}

4.16 Choose 'No automatic updates', because this requires a direct internet connection to the update servers:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm27.png}}

4.17 At the 'Software selection' menu, make sure that at least 'Standard system utilities', 'OpenSSH server' and 'Basic Ubuntu server' is selected. You may need to scroll-down the list:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm28.png}}

After this about 150+ packages are going to be installed (the number varies):

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm29.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm30.png}}

After some time you will finally reach the 'Finish the installation' screen:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20zVM?action=AttachFile&do=get&target=zvm31.png}}

By selecting 'Continue' the system will shut down.

5. IPL the target system.
The installed system does not automatically IPL from the target/boot DASD. You have to IPL it manually: <<BR>>
----
<<BR>>
`00: CP I EA09` <<BR>>
`00: zIPL v1.32.0-build-20151214 interactive boot menu` <<BR>>
`00:  0. default (ubuntu)` <<BR>>
`00:` <<BR>>
`00:  1. ubuntu` <<BR>>
`00:  2. old` <<BR>>
`00: Note: VM users please use '#cp vi vmsg (input)' ` <<BR>>
`00: Please choose (default will boot in 10 seconds): ` <<BR>>
`00:Booting default (ubuntu)` <<BR>>
----
<<BR>>
When the system is up and running, you can login with the during the installation configured user id:
----
 <<BR>>
`Ubuntu Xenial Xerus (development branch) s8315004 ttyS0` <<BR>>
<<BR>>
`s8315004 login` <<BR>>
----
 <<BR>>
Do not this console window of a currently running Linux guest !<<BR>>
You just have to disconnect the 3270 terminal session - just enter:<<BR>>
`#CP DISCONNECT` <<BR>>
or just: <<BR>>
`#CP DISC` <<BR>>
With '#CP' you can bypass the Linux operating system and commands are directly executed on the z/VM's CP hypervisor, and 'DISC' disconnects the 3270 terminal window, but let's the Linux OS running in the background.

5.1 After the boot/IPL process is completed, you can login to the system with ssh using your specified non-root user (in this example 'test'). In case root privileges are required, put 'sudo' prior to your command or use 'sudo -i' (in combination with your user's password).
<<BR>>
<<BR>>
'''The system is now ready for use!''' <<BR>>
<<BR>>
