{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

== Ubuntu Linux for IBM z Systems and LinuxONE in LPAR Installation ==

This document describes step-by-step the installation of Ubuntu Linux on IBM z Systems or LinuxONE in a logcal partition (LPAR).

1. Load the installation system into your LPAR

1.1 Connect to the HMC, select your LPAR and choose 'Recovery', then 'Load from Removable Media or Server':

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar1.png}}

Enter the parameters 'Host computer', 'User ID', 'Password' and the file location on the FTP server.
In case an anonymous FTP is used, use 'anonymous' as 'User ID' and any character or string (like 'me' or suchlike) as 'Password'.
The file location that points to the required installation files, like kernel.ubuntu, initrd.ubuntu and Ubuntu.ins.
The path is to long to fit into the window, it is: 'ubuntu-ports/dists/xenial/main/installer-s390x/current/images/generic'

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar2.png}}

Click 'Ok' to proceed.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar3.png}}

Select an appropriate version (in case multiple versions are displayed) and click 'OK'.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar4.png}}

Confirm with 'Yes' that you understand that the task 'Load from Removable Media or Server' will cancel other job.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar5.png}}

Acknowledge again with 'Yes' to proceed with the IPL (Initial Program Load).

2. Connect to the HMC's Operating System Messages Console:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar6.png}}

3. Interactively answer questions regarding to Network, DASD, etc.

This is an example on how to enter the data.
Obtain your network configuration data prior to the installation.

<<BR>>
Configure the network device 
- - - - - - - - - - - - - - -
<<BR>>
`Please choose the type of your primary network interface that you will need for installing <<BR>>
the Debian system (via NFS or HTTP). Only the listed devices are supported.` <<BR>>
`Network device type:`
`  1: ctc: Channel to Channel (CTC) or ESCON connection,    `
`  2: qeth: OSA-Express in QDIO mode / HiperSockets,    `
`  3: iucv: Inter-User Communication Vehicle - available for VM guests only,    `
`  4: virtio: KVM VirtIO,    `
`Prompt: '?' for help> `
<<BR>>
The following picture is an example on how all further parameters have to be entered:
 <<BR>>
{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar7.png}} <<BR>>
'''2''' <<BR>>
(means: Enter '2' and click the 'Send' button) 
 <<BR>> 
`Please select the OSA-Express QDIO / HiperSockets device. `
`Device: `
`  1: 0.0.f500-0.0.f501-0.0.f502 [*], `
`Prompt: '?' for help, default=1> `
'''1''' <<BR>> 
`By default OSA-Express cards use layer3 mode. In that mode LLC headers are `
`removed from incoming IPv4 packets. Using the card in layer2 mode will make it `
`keep the MAC addresses of IPv4 packets. `
`Use this device in layer2 mode? `
`  1: Yes [*]  2: No `
`Prompt: '?' for help, default=1> `
'''1''' <<BR>> 

`Configure a  network using static addressing `
`- - - - - - - - - - - - - - - - - - - - - - `

`The IP address is unique to your computer and may be: `

` * four numbers separated by periods (IPv4); `
` * blocks of hexadecimal characters separated by colons (IPv6). `

`You can also optionally append a CIDR netmask (such as '/24'). `

`If you don't know what to use here, consult your network administrator. `
`IP address: `
`Prompt: '?' for help> `
'''10.245.236.11/24'''

`The gateway is an IP address (four numbers separated by periods) that indicates `
`the gateway router, also known as the default router.  All traffic that goes `
`outside your LAN (for instance, to the Internet) is sent through this router.  `
`In rare circumstances, you may have no router; in that case, you can leave this `
`blank.  If you don't know the proper answer to this question, consult your `
`network administrator. `
`Gateway: `
`Prompt: '?' for help, default=10.245.236.1> `
'''10.245.236.1'''

`The name servers are used to look up host names on the network. Please enter `
`the IP addresses (not host names) of up to 3 name servers, separated by spaces. `
`Do not use commas. The first name server in the list will be the first to be `
`queried. If you don't want to use any name server, just leave this field blank. `
`Name server addresses: `
`Prompt: '?' for help, default=10.245.236.1> `
'''________'''
`[In case no DNS server is available just leave the field blank and 'Continue'] `
`Detecting link on enccw0.0.f500; please wait... `
 
`Please enter the hostname for this system. `
`The hostname is a single word that identifies your system to the network. `
`If you don't know what your hostname should be, consult your network `
`administrator. If you are setting up your own home network, you can make `
`something up here. `
`Hostname: `
`Prompt: '?' for help, default=s83lp55> `
'''s83lp55'''

`The domain name is the part of your Internet address to the right of your host `
`name.  It is often something that ends in .com, .net, .edu, or .org.  If you `
`are setting up a home network, you can make something up, but make sure you use `
`the same domain name on all your computers. `
`Domain name: `
`Prompt: '?' for help, default=yourdomain.com> `
'''yourdomain.com'''

`Generating SSH host key `

`Continue installation remotely using SSH `
`- - - - - - - - - - - - - - - - - - - - - `

`You need to set a password for remote access to the Debian installer. `
`A malicious or unqualified user with access to the installer can have disastrous `
`results, so you should take care to choose a password that is not easy to `
`guess. It should not be a word found in the dictionary, or a word that could be `
`easily associated with you, like your middle name. `

`This password is used only by the Debian installer, and will be discarded once `
`you finish the installation. `
`Remote installation password: `
```xxxxxxxx```

`Please enter the same remote installation password again to verify that you `
`have typed it correctly. `
`Re-enter password to verify: `
```xxxxxxxx```

`Start SSH `

`To continue the installation, please use an SSH client to connect to the IP `
`address 10.245.236.11 and log in as the 'installer' user. For example: `

`   ssh installer@10.245.236.11 `

`The fingerprint of this SSH server's host key is: `
`SHA256:nsRZcYhH2AjtIjoprQ4+une6GftmJ4l4lVwnoqz7uVf `

`Please check this carefully against the fingerprint re"ported by your SSH client. `
`Press enter to continue`

<<BR>> 
Note: <<BR>> 
Do NOT continue here, but proceed with ssh to the installation system now!
You may leave the Operating System Messages window open in the background!
<<BR>> 

4. SSH with user 'installer' to the installation system 
Now ssh with the temporary user 'installer' to your system.
You can specify either the hostname or the IP address:

```ssh installer@10.245.236.11 ```

Users of a non-Linux operating system at their workstation may need to use a different ssh client, like for example 'Putty'.

4.1 Start installer
In case a modified parmfile is used, it's recommended to use the option "expert mode"):

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar8.png}}

4.2 Choose language: English
(adjust according to your needs)

4.3 Choose country: other (scroll down) -> Europe -> Germany
(adjust according to your needs)

4.4 Configure locale: en_US.UTF-8
(adjust according to your needs)

4.5 Choose mirror: <enter information manually>

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar9.png}}

4.6 Mirror's hostname: ports.ubuntu.com
(this is the default)

4.7 Enter directory (on ports.ubuntu.com it's just the root directory):

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar10.png}}

4.8 If ports.ubuntu.com is only reachable via a proxy, a proxy needs to be specified here.
Start the entry with `http://` and end with the port number, e.g. ':3128' <<BR>> 
{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar11.png}}

<<BR>> 
Note: <<BR>> 
If the following message occurs: <<BR>> 
{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar12.png}} <<BR>> 
the installer kernel does not fit to the set of files located on the mirror. <<BR>> 
 <<BR>> 
In this case, you need to restart the installation, using the files from ports.ubuntu.com. <<BR>> 
These files can be obtained from: <<BR>> 
ftp://ports.ubuntu.com/ubuntu-ports/dists/xenial/main/installer-s390x/ <<BR>> 
(The latest release version there, is also linked to 'current'.) <<BR>> 

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar13.png}} <<BR>> 
 <<BR>> 
Just grab the kernel, initrd and parmfile from there. <<BR>> 
 <<BR>> 

After some seconds the download of installer components will start and the installation proceeds with the next question:

4.9 Enter the user's full name

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar14.png}}

Since Ubuntu comes by default with a disabled root user account, it is mandatory to setup at least one user.

4.10 And enter a user name (in this sample case it's just 'test').

4.11 Enter password for your user:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar15.png}}

And repeat it a second time.

4.12 Encryption with encryptfs is not yet supported, so select 'No':

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar16.png}}

(wait for some seconds)

4.13 Choose the target disk (in this case the DASD 0.0.ea09) by selecting it and pressing 'Enter'

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar17.png}}

If there are lot's of DASD devices available, the above selection list is not shown, rather that you are asked to specify the DASD device by entering the device number in text form, e.g. '0.0.ea09'.

It's required to format DASD devices at least once.
In case you are sure that the previously selected DASD was already formatted before, you may choose 'No'.
If you are unsure if the previous selected DASD device was ever formatted choose 'Yes' here.
The formatting itself takes some time.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar18.png}}

If no more disks are required, scroll down to 'Finish' and press 'Enter', otherwise repeat the previous step for additional disks.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar19.png}}

In case the above list of disk devices is not shown (maybe because it's too long), select 'Go back', to reach the 'Ubuntu installer main menu' and choose 'Partition disks' from there.

4.14 The partition of the disk(s) can be either done in a 'Guided' or in a 'Manual' way.
In this example we follow the 'Manual' way.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar20.png}}

First select any potential partition for deletion and if when done, recreate them as needed.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar21.png}}

Press enter in 'FREE SPACE' row to recreate partitions, for example like:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar22.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar23.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar24.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar25.png}}

Now create a swap partition in a similar way:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar26.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar27.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar28.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar29.png}}

Now scroll down to the bottom and choose 'Finish partitioning and write to disk'.

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar30.png}}

Confirm the writing of the changes to the disk with 'Yes':

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar31.png}}

4.15 Now after the new system got configured, the base system installation starts:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar32.png}}

4.16 Choose 'No automatic updates', because this requires a direct internet connection to the update servers:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar33.png}}

4.17 At the 'Software selection' menu, make sure that at least 'Standard system utilities', 'OpenSSH server' and 'Basic Ubuntu server' is selected. You may need to scroll-down the list:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar34.png}}

After this about 150+ packages are going to be installed (the number varies):

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar35.png}}

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar36.png}}

After some time you will finally reach the 'Finish the installation' screen:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar37.png}}

When selecting 'Continue' the system will shut down.

5. IPL the target system.
The new installed Ubuntu Linux system does not automatically boot/IPL from the target and boot DASD.
The boot/IPL is done either manually, or you just specify the required information at the 'Load' task.
Connect to the HMC, select your LPAR (in this case 'S83LP55', then select from the 'Recovery' menu the 'Load' task:

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar38.png}}

At the 'Load' task screen enter the load address of your target and boot DASD.
The address starts with '0', followed by the four digit address, like in this example '0EA09':

{{https://wiki.ubuntu.com/S390X/Installation%20In%20LPAR?action=AttachFile&do=get&target=lpar39.png}}

Click 'OK' on the 'Load' task screen and again 'Ok' two times afterwards to confirm this, like in section 1.

The system will now start to boot/IPL and it will be up and running after some time.
You can watch this process via the HMC's 'Operating System Messages' window.

5.1 After the boot/IPL process is completed, you can login to the system with ssh using your specified non-root user (in this example 'test').
In case root privileges are required, put 'sudo' prior to your command or use 'sudo -i' (in combination with your user's password).

'''The system is now ready for use!'''
