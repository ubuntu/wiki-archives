{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

While handling a <nowiki>[[SecurityTeam-UpdateProcedures|security update]]</nowiki>, one must <nowiki>[[SecurityTeam-UpdatePreparation|prepare]]</nowiki> the upload, then follow these steps to publish.

== Publishing an Update to Launchpad ==

=== Upload/Build/Publish ===
==== Stable releases ====
# If also unembargoing a development release from the <nowiki>[[https://launchpad.net/~ubuntu-security/+archive|Ubuntu Security PPA]]</nowiki>, unembargo the development release first (see below).
# Prepare your <nowiki>[[https://wiki.ubuntu.com/SecurityTeam/UpdatePublication#Local_Configuration|local configuration]]</nowiki>
# Upload the updated source packages via dput to each release's Security PPA target or for ESM, the ESM staging PPA). Notification about failed builds should be automatically sent to `security@ubuntu.com`.
# '''Note for cloud images, LXD images, Ubuntu on Windows images, cloud archive, and/or Ubuntu Core''':
** If the update requires urgently updating the cloud images, LXD images, or Ubuntu on Windows images, email `cpc@canonical.com` to notify the Certified Public Cloud team that an update is coming which requires regenerating the images (specifics are not required so as not to accidentally break embargo) and ask for an acknowledgement of the email. If the email is not acknowledged in a timely fashion, escalate to `rcj`, `Odd_Bloke`, and `gaughen` in #server on Canonical irc. Package manifests can be found in `http://cloud-images.ubuntu.com/releases/<release>/release/*.manifest`
** If the update requires urgently updating the cloud archive, alert `jamespage` that an update is coming that requires a copy from the security pocket to the cloud archive. A list of packages in each cloud archive release can be found at http://reqorts.qa.ubuntu.com/reports/ubuntu-server/cloud-archive/ (Actual repository is located here: http://ubuntu-cloud.archive.canonical.com/ )
** Ubuntu Core stable images/OS and kernel snaps are <nowiki>[[http://forum.snapcraft.io/t/core-snap-delivery-process/314/1|QA'd]]</nowiki> (snapd SRU's have similar <nowiki>[[http://forum.snapcraft.io/t/sru-verification-process/363/1|QA]]</nowiki>) and released on a <nowiki>[[https://lists.canonical.com/mailman/private/canonical-snapcraft/2016-November/003996.html|two-week cadence]]</nowiki> and therefore will bundle security updates every two weeks using a manual process (currently) that is managed by the Ubuntu Core team. Out-of-cadence emergency updates may be performed for urgent issues. If the update requires urgently updating Ubuntu Core, alert `mvo` (cc'ing `cachio`) from the snapd team for the core snap and `sil2100` (cc'ing `mclemenceau`) for the coreNN snaps that an update is coming that requires an emergency update.
0. Set the name of the source package being updated: <pre>
export SRCPKG="srcpkg1 srcpkg2..."
</pre>
0. Wait for the finished builds on all supported architectures to finish and appear at the <nowiki>[[https://launchpad.net/~ubuntu-security/+archive|Ubuntu Security PPA]]</nowiki>: <pre>
$UCT/scripts/sis-changes --action check-build $SRCPKG
</pre>
** '''NOTE:''' if there is a problem with a buildd, ask `webops` in `#is`. Eg: "webops: can you please kill the build for kde4libs 4:4.9.0a-0ubuntu2 on lamiak?". Can see the build farm at https://launchpad.net/builders/.
** '''NOTE:''' For ESM:<pre>
$UCT/scripts/sis-changes --action check-build $SRCPKG --ppa ubuntu-security/esm --include-eol
</pre>
** '''NOTE:''' If you want to check in all ESM and normal Ubuntu (proposed in this example):<pre>
$UCT/scripts/sis-changes --action check-build $SRCPKG --esm-merge-ppa=ubuntu-security/esm --esm-merge-ppa=ubuntu-esm/esm-infra-security-staging --ppa=ubuntu-security-proposed/ppa --include-eol
</pre>
0. Unembargo by copying the packages into the archive accepted queue with: <pre>
$UQT/security-tools/unembargo $SRCPKG
</pre>
** '''NOTE:''' if you are using ```unembargo``` to publish from a non-private PPA (eg, ```ubuntu-security-proposed``` or ```ubuntu-mozilla-security```), you may have to also get an archive admin to adjust overrides (use ```find-bin-overrides``` and give to an archive admin).
** '''NOTE:''' For ESM: skip this step. Instead, use Launchpad to copy the package to 'Extended Security Maintenance [~ubuntu-esm/ubuntu/esm]'. You need to copy the binaries.'Copy existing binaries' radio must be selected.
** Alternatively, instead of using the launchpad web interface, use the copy-package tool from the <nowiki>[[https://code.launchpad.net/~ubuntu-archive/ubuntu-archive-tools/trunk|lp:ubuntu-archive-tools tree]]</nowiki>, like so:
** [precise/esm] <pre>
${UAT}/copy-package --include-binaries --from ~ubuntu-security/ubuntu/esm --from-suite precise --to ~ubuntu-esm/ubuntu/esm --to-suite precise $SRCPKG
</pre>
** [trusty/esm] <pre>
${UAT}/copy-package --include-binaries --from ~ubuntu-esm/ubuntu/esm-infra-security-staging --from-suite trusty --to ~ubuntu-esm/ubuntu/esm-infra-security --to-suite trusty $SRCPKG
</pre>
# If this is a sponsored update (for universe), edit the CVE entries in UCT to reflect the update. Update the <nowiki>[[https://wiki.ubuntu.com/SecurityTeam/Meeting|Security Team Meeting]]</nowiki> page to credit the person who provided the debdiff.
# If this is an embargoed update, mv the CVE entries from `embargoed/` to
 `$UCT/active/`. `bzr ci -m "unembargo $SRCPKG"` in embargoed, `bzr add ; bzr ci -m "unembargo $SRCPKG"` in UCT.

==== Development release ====
In general, security updates are not under embargo and can be uploaded directly to the development release without a USN. For updates that are embargoed in the development release, the process is similar to the above, but different due to LP: #334858.
# Prepare your <nowiki>[[https://wiki.ubuntu.com/SecurityTeam/UpdatePublication#Local%20Configuration|local configuration]]</nowiki>
# Set the name of the source package being updated: <code>export SRCPKG="srcpkg1 srcpkg2..."</code>
# Upload the updated source packages via dput to the development release's Security PPA target. The distribution name should not contain the '-security' suffix. Notification about failed builds should be automatically sent to `security@ubuntu.com`.
# Wait for the finished builds on all supported architectures to finish and appear at the <nowiki>[[https://launchpad.net/~ubuntu-security/+archive|Ubuntu Security PPA]]</nowiki>:<pre>
$UCT/scripts/sis-changes --include-devel -r <development release> --action check-build $SRCPKG
</pre> '''NOTE:''' due to a bug in `sis-changes`, this doesn't actually work so you'll have to check the PPA manually.
0. When the issue is public, ask an archive admin to unembargo the package using $UQT/security-tools/unembargo $SRCPKG. Eg, to unembargo curl on utopic, ask an archive admin to use:<pre>
$ $UQT/security-tools/unembargo --ppa=ubuntu-security -r utopic --pocket=proposed curl
</pre>
 In theory, the copy-package can also be used by an archive admin, followed by any override adjustments (you can use the ```find-bin-overrides``` script from <nowiki>[[https://code.launchpad.net/ubuntu-qa-tools | lp:ubuntu-qa-tools/security-tools]]</nowiki> for a list of overrides). However, this tool may not work with the private ubuntu-security PPA. Eg, to unembargo sudo 1.7.2p7-1ubuntu2 on utopic, you would ask the archive admin to run the following (see ArchiveAdministration for more information):<pre>
$ copy-package -b --ppa=ubuntu-security -s utopic --to-primary --to-suite utopic-proposed -e 1.7.2p7-1ubuntu2 sudo
$ change-override -c universe -s utopic-proposed sudo-ldap
</pre>
** This may need to be done by a someone who is both a member of ```ubuntu-security``` and ```ubuntu-archive```
# Delete SRCPKG from Security PPA for the development release. This should be done '''before''' unembargoing the stable releases to ensure it is copied only to the release pocket, and not the security pocket for the development release. This can be done via the `umt delete` command.
# At this point, the publication for the development release is completed (a USN is not issued for the development release). Proceed to unembargo the stable releases as needed (see above).

==== Partner ====
Occasionally (usually only in the case of an emergency) the Ubuntu Security team may be asked to update or sponsor a package in the Canonical partner archive. After verifying that the <nowiki>[[SecurityTeam-UpdatePreparation#Update_the_packaging_for_partner_packages|source packaging is correct for partner]]</nowiki>, uploading is a simple matter of dputting the package to the Ubuntu archive (the Section specified in the packaging tells Launchpad to put it in partner). Launchpad restricts copies from PPAs to the partner archive, so the packages must be uploaded directly to the archive (requires membership in <nowiki>[[https://launchpad.net/~canonical-partner-dev/+members|canonical-partner-dev]]</nowiki>).

==== Kernel publication ====
Please see <nowiki>[[SecurityTeam-UpdatePublication-Kernel]]</nowiki> for information on the kernel update process and cycle.

# Prepare your <nowiki>[[https://wiki.ubuntu.com/SecurityTeam/UpdatePublication#Local%20Configuration|local configuration]]</nowiki>
# Set the name of the source package being updated, using the <nowiki>[[https://wiki.ubuntu.com/Kernel/Dev/ABIPackages|ABI Packages]]</nowiki> page as a guide (git branches with stars are not handled by the Security Team): <code>export SRCPKG="srcpkg1 srcpkg2..."</code>
# Make sure to check the ABI is consistent: `$UQT/security-tools/kernel-abi-check`
** This will say if the ABI has changed, and what the version was in the last published USN
** Make sure you have the latest USN database: `cd $UCT; ./scripts/fetch-db database.pickle.bz2`
0. Make sure all the packages are in the archive: `$UCT/scripts/sis-changes --action check-build $SRCPKG --ppa ubuntu --pocket Security -r REL`

=== Announce Publication ===

(for main/restricted publications in stable releases)

# If applicable, verify that the Certified Public Cloud, Cloud Archive, and/or Ubuntu Core teams have acknowledged the urgent update notification (see '<nowiki>[[https://wiki.ubuntu.com/SecurityTeam/UpdatePublication#Upload.2BAC8-Build.2BAC8-Publish|Note for cloud images, cloud archive and/or Ubuntu Core]]</nowiki>')
# Assign a USN (format is NNN-S, and the following instructions assume $USN has been set as desired):
## For a new issue, run: <pre>
USN=$(ssh people.canonical.com "~ubuntu-security/bin/get-next-usn" $SRCPKG)
</pre> optionally including any extra information explaining why the USN was issued.
## For an old issue that needs correction or continuation, start with the issue's original USN, keep NNN and increase S. (e.g. original issue was 42-1, updated USN will be 42-'''2'''). Adjust the following command for your USN number: `USN=42-2`
## For a new issue that affects different software with identical CVEs, get a new USN normally for the first source package, and then keep NNN and increase S for each additional source package. (e.g. CVE-2008-1693 affected both poppler and koffice, so 603-1 was used for poppler and 603-2 was used for koffice). If only a few CVEs are shared between the old issue or the new issue, request a new USN instead. Please note that different versions of the same software (e.g. emacs21 and emacs22) should not do this, but instead use a single USN with S=1. The only exception to this last rule is when you are publishing different versions of the same software but at different points in time. In this case you will just increase S for each of them.
## For an ESM issue, if the update has already been published for a current release, use the NNN of the published USN for release updates and increment S (e.g. original issue was 3282-1, ESM USN will be 3282-2).
## If any cases for requesting a -2 apply but the first USN is 6 months old or more, request a new USN.

0. Ensure your DB is up to date: 
** <code>cd $UCT && ./scripts/fetch-db database.pickle.bz2</code>
0. To create the USN template script, run:
** For Ubuntu Archive only (from private PPA): <pre>
$UCT/scripts/sis-changes --download /tmp/pending-$USN $SRCPKG && cd /tmp/pending-$USN && $UCT/scripts/sis-generate-usn $USN *.changes > ~/new-usn-$USN.sh
</pre>
*** From the proposed PPA: <pre>
$UCT/scripts/sis-changes --download /tmp/pending-$USN $SRCPKG --ppa ubuntu-security-proposed/ppa && cd /tmp/pending-$USN && $UCT/scripts/sis-generate-usn $USN *.changes > ~/new-usn-$USN.sh
</pre>
** For ESM infra security staging: <pre>
$UCT/scripts/sis-changes --download /tmp/pending-$USN $SRCPKG --ppa ubuntu-esm/esm-infra-security-staging --include-eol && cd /tmp/pending-$USN && $UCT/scripts/sis-generate-usn --no-new-warn $USN *.changes > ~/new-usn-$USN.sh
</pre>
** For ESM infra legacy security staging: <pre>
$UCT/scripts/sis-changes --download /tmp/pending-$USN $SRCPKG --ppa ubuntu-esm/esm-infra-legacy-security-staging --include-eol && cd /tmp/pending-$USN && $UCT/scripts/sis-generate-usn --no-new-warn $USN *.changes > ~/new-usn-$USN.sh
</pre>
** For ESM and normal releases: <pre>
$UCT/scripts/sis-changes --download /tmp/pending-$USN $SRCPKG --esm-merge-ppa=ubuntu-esm/esm-infra-security-staging --ppa ubuntu-security-proposed/ppa --include-eol && cd /tmp/pending-$USN && $UCT/scripts/sis-generate-usn --no-new-warn $USN *.changes > ~/new-usn-$USN.sh
</pre>
** For ESM infra leagcy, ESM Apps, and normal releases: <pre>
$UCT/scripts/sis-changes --download /tmp/pending-$USN $SRCPKG --esm-merge-ppa=ubuntu-esm/esm-infra-security-staging --esm-merge-ppa=ubuntu-esm/esm-infra-legacy-security-staging --esm-merge-ppa=ubuntu-esm/esm-apps-security-staging --ppa ubuntu-security-proposed/ppa --include-eol && cd /tmp/pending-$USN && $UCT/scripts/sis-generate-usn --no-new-warn $USN *.changes > ~/new-usn-$USN.sh
</pre>

** For announcing kernels, add `--kernel-mode --filter-bins '^linux-image-\d' --no-new-warn` to the `sis-generate-usn` command line to make binary package lists saner. `--no-new-warn` is only necessary when publishing a new source tarball
** For announcing kernels that have been already released, add `--kernel-mode --filter-bins '^linux-image-\d' --no-new-warn --ppa ubuntu --pocket Security -r REL[,REL]` to the `sis-changes` command line. `--no-new-warn` is only necessary when publishing a new source tarball
** For announcing Mozilla updates, see <nowiki>[[https://wiki.ubuntu.com/SecurityTeam/PublicationNotes#Mozilla%20Publishing]]</nowiki>
** When uploading to a PPA, `sis-changes` may report that `INFO: new binary '<pkg>.deb' in release '<release>', is packages_mirror up to date?`, which is safe to ignore.
** If `sis-changes` fails with `error: USN NNN-S not in the database`, run `cd $UCT && ./scripts/fetch-db database.pickle.bz2`. Then, re-run `sis-generate-usn`: `$UCT/scripts/sis-generate-usn <...> $USN *.changes > ~/new-usn-$USN.sh`.
0. Edit `~/new-usn.sh` to include a correct title, summary, action, description, and then limit the binary list to only those affected by the USN .  Leave all URLs as-is.  Have the description proofread by somebody else.
** When announcing kernels, look at the `*source.changes` file that is now in `/tmp/pending` to make sure the CVEs for all the releases since the last USN are present. Make sure no CVE fixes have been reverted and are listed in `~/new-usn.sh` by mistake, and that all the changelog entries since the last update are listed.
** If the update is a regression fix or does not fix CVEs, '''''be sure to create a tracking bug on Launchpad''''' and have `new-usn.sh` reference at least this one bug (eg, something like '`usn.py $DB $USN --cve "https://launchpad.net/bugs/NNNNNNN"`'
** If the update is a regression fix, be sure to replace "vulnerability" with "regression" in the title
** Set the title to the package name and reflect how upstream refers to it. If it affects multiple source packages with the same upstream, the title should only include the one, general upstream name for the package.
** The summary should follow ubuntu source package naming conventions. If it affects multiple source packages, list the packages.
** There is <nowiki>[[https://git.launchpad.net/ubuntu-cve-tracker/tree/README.usn |a guide on writing the description]]</nowiki> in UCT. Updates to the devel release are not included in USNs. 
** Fill in the issue-summary using the upstream name. If there were multiple different CVEs, use the `Several security issues were fixed in <pkg>.`. Otherwise, choose one of the templates or, if it doesn’t match any, write your own but keep it high-level, non-technical, and without deviating too much from the templates.
** Sometimes the "source-description" field in the generated USN is unhelpful or inaccurate. In those situations, you'll need to update package_info_overrides.json with a new description that reflects how the package maintainers describe the package but less verbosely by running `$UCT/scripts/add_meta_info.py <pkg-src-name> <upstream-name> "<desc>"`.
** Under `Reduce to minimum binaries`, you can generally remove the -doc and -udeb lines from the binary list. `umt compare-bin` may be helpful in determing the affected binaries. Remove the -header lines if there weren’t changes to .h files.
** Limit the length of each line in the description text to 75 characters.
0. To populate the USN database with the new USN details and generate the template email (sent to `security@ubuntu.com`), run:<pre>
bash ~/new-usn.sh
</pre>
0. Wait until the packages are actually mirrored to the archive; the publisher runs hourly at :03, and updates should usually appear on `security.ubuntu.com` within 20-40 minutes, depending on the size and number of binary packages (note 0403 UTC publication run is skipped due to the Contents generation job). If it is more than 3 hours before the packages are mirrored, then ask ~is. To verify that the packages have arrived, run:<pre>
ssh people.canonical.com "~ubuntu-security/bin/check-upload $USN"
</pre>
** NOTE: for ESM this will likely return 'No URLs found to check!' since the deb packages are private. However, the ESM repo metadata is public, so you can manually check to see if the packages have been mirrored to esm.ubuntu.com using something like the following (but replace `infra` and `xenial-infra-security` as appropriate): <pre>
curl -s https://esm.ubuntu.com/infra/ubuntu/dists/xenial-infra-security/main/binary-amd64/Packages | grep-dctrl -XS $SRCPKG -
</pre>
  once this returns the expected version info for this update you can be confident the debs are available and can proceed.
0. Once packages are in the archive and you are satisfied with the email text (from new-ush.sh), copy the updated USN database by running:<pre>
ssh people.canonical.com "~ubuntu-security/bin/push-usn-db"
</pre>
** If this returns `/home/ubuntu-security/public_html/usn/database-all.json.new' already exists`, it’s possible someone else is also pushing a USN, wait a bit before trying again.
# Update your local USN database, publish the new USN to the USN website, and track the deployment status by visiting the link printed by the script:
## <pre>
cd $UCT && ./scripts/fetch-db database.pickle.bz2 && ./scripts/publish-usn-to-website -a $USN
</pre>
*** If it fails with `ERROR: Ensure that <USN> is in [...]/database.pickle and try again`, it may be possible that someone else is also publishing simultaneously, ask around and if that is the case wait for them to finish, then retry.
*** If it fails with
<pre>
macaroonbakery.httpbakery._error.InteractionError: cannot start interactive session: cannot get <url>
ERROR: Failed to publish <USN> pickle to website API
</pre>
       if the previous fetch-db step completed successfully, (you see the `Download complete. File saved to 'database.pickle'` line), just try rerunning the publish-usn-to-website script.
*** If it fails with `504 Gateway Time-out or 408 Request Time-out`, make sure your wifi and VPN has IPv6 disabled, close and reopen your browser, and re-run the publish-usn-to-website script. Failing that, keep re-trying every once in a while for an hour or two.
0. Navigate to the linked USN page.

  '''Important''': The script must succeed or the new USN will not be displayed on the website. If the deployment job continues to fail after retrying, you'll need to escalate in order to get a fix. Join `#web-team`, start a message with `@webteam` and describe the problem. If you don't get a response, join `#is` and ping the vanguard listed in the channel topic and be make sure to mention that you don't have any deep knowledge of the publishing architecture and point them at the usn.ubuntu.com architecture document.

  Proceed on with sending the USN email but you '''must''' follow up and ensure that the deployment job eventually succeeds.
0. Once the USN is available on the USN website, send the USN email by:
*** Copying the content of the template email;
*** Pasting it into a newly-composed email;
*** Copying the subject of the template email;
*** Pasting it into the newly-composed email;
*** Signing the email with PGP/MIME; and
*** Adding the following headers (please see <nowiki>[[https://wiki.mozilla.org/Thunderbird:Help_Documentation:Mail-Followup-To_and_Mail-Reply-To|this guide]]</nowiki>):  <pre>
To: ubuntu-security-announce@lists.ubuntu.com
Reply-to: Ubuntu Security <security@ubuntu.com>
Mail-Followup-to: Ubuntu Security <security@ubuntu.com>
</pre>
# Approve the USN mail on <nowiki>[[https://lists.ubuntu.com/mailman/admindb/ubuntu-security-announce]]</nowiki> (NOTE: the <nowiki>[[https://manpages.ubuntu.com/manpages/noble/man1/listadmin.1.html|listadmin]]</nowiki> tool can be used to do this from the command-line). Ensure to reject duplicate mails from you (some list subscribers bounce mails back unmodified). Verify it went through in <nowiki>[[https://lists.ubuntu.com/archives/ubuntu-security-announce/]]</nowiki>.
# Delete SRCPKG from Security PPA. (WARNING! Failure to perform this step may result in tarring and feathering!) This can be done via the `umt delete` command.

# Update the CVE tracker:
## <pre>
cd $UCT && git pull --ff-only && ./scripts/sync-from-usns.py
</pre>
** For any missing CVEs, run `./scripts/active_edit -p PACKAGE -c CVE` for each package and CVE that was fixed by the USN, and fill in the details in `active/`'''CVE''' with an editor.
** Run <pre>
./scripts/sync-from-usns.py -u
</pre> if visual inspection of updates looks correct.
** If visual inspection indicates that unwanted USNs will be synced, run <pre>
./scripts/sync-from-usns.py -u --usn=$USN
</pre>
0. `./scripts/cve_need_retire`
** Run <pre>
./scripts/cve_need_retire -u
</pre> if visual inspection of updates looks correct.
## Run `git status ; git diff` to see what will be checked-in. Check in the changes and push the repo.
# (This step is normally automated now.) To help reduce the load on security.archive.com, new packages in -security should be automatically copied to -updates at :28 and :58. For large updates (OOo, firefox, kernel, kdebase) be sure to verify that they did indeed get copied. If not, ping an <nowiki>[[https://edge.launchpad.net/~ubuntu-archive/+members|archive admin]]</nowiki> about doing a <nowiki>[[ArchiveAdministration#Copying security uploads to updates|pocket-copy from -security to -updates]]</nowiki>. Please note that security fake syncs and any packages with a new source orig.tar.gz will need to be manually copied to -updates by an <nowiki>[[https://edge.launchpad.net/~ubuntu-archive/+members|archive admin]]</nowiki>.
** '''IMPORTANT''': the copier verifies that the new changelog in -security is a direct descendant of what is in -updates if the package currently exists in -updates. This helps ensure that a change in -updates is not reverted by a -security update. If this verification step fails, the package will not be automatically copied and a security team member must verify the changes are ok, and ask an archive admin to copy it manually.
0. Check for any outstanding LP bugs tied to the CVEs that are resolved with the USN.  <nowiki>[[https://bugs.launchpad.net/bugs/cve/YYYY-NNNN]]</nowiki>

=== Media coverage ===
Sometimes a security vulnerability is covered by the media. In an effort to provide accurate information for users, PR and journalists, use the following process if your update has media coverage or is otherwise high profile.

# First and foremost, ensure someone is assigned to perform the update and is working on it
# In parallel to the update preparation, have someone else prepare the knowledgebase article
# Create a <nowiki>[[https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase|KnowledgeBase]]</nowiki> article by navigating to <nowiki>[[https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/MediaCoverageTemplate|MediaCoverageTemplate]]</nowiki> and saving it as https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/<Something>
# Fill in the details of the knowledgebase article using the template
# Get signoff from at least one other member of the security team
# Update https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase#Media_coverage to include a link to your new article (TODO: automate?)
# Send an email to 'pr@canonical.com' and 'support-team@lists.canonical.com', CC'ing 'security@ubuntu.com' and any other relevant individuals
# Update the CVE in UCT to reference the knowledgebase article
# If there is a bug reference for this issue, update the bug to reference the knowledgebase article
# Update the published USN to reference the knowledgebase article in the 'Reference' section (see below)
# Optionally update the /topic in #ubuntu-hardened to include the knowledgebase article

=== Republishing/Editing a Published USN ===
0. Decide which USN you'll be updating, eg 582-2:
 `USN=NNN-S`

0. Update the USN database: <pre>
ssh -t people.canonical.com "~ubuntu-security/bin/edit-usn $USN"
</pre>

0. Copy the updated USN database by running: <pre>
ssh people.canonical.com "~ubuntu-security/bin/push-usn-db"
</pre>
 
0. Update your local USN database, publish the new USN to the USN website, and track the deployment status by visiting the link printed by the script: <pre>
cd $UCT && ./scripts/fetch-db database-all.pickle.bz2 && ./scripts/publish-usn-to-website -u -d ./database-all.pickle $USN
</pre>

=== Removing a Published USN ===
The following commands should be okay to run on lillypilly. However, the export to yaml does take almost 5GB of ram and can take several minutes. It may be preferred to copy the unmodified and modified versions of the database locally to generate the before and after yaml files for verification. The actual deletion takes much less time/ram.

0. On people.canonical.com, create/verify a new database with the USN removed, and copy it into place: <pre>
$ cd ~ubuntu-security/usn
$ cd ~ubuntu-security/usn
$ ../git-pulls/usn-tool/usn.py --export --db=./database-all.pickle > ./orig.yaml
$ ../git-pulls/usn-tool/delete_usn.py --db=./database-all.pickle $USN
$ ../git-pulls/usn-tool/usn.py --export --db=./database-all.pickle > ./verify.yaml
$ diff ./orig.yaml ./verify.yaml    # should have only the USN removed
</pre>
# Copy the updated USN database by running: `ssh people.canonical.com "~ubuntu-security/bin/push-usn-db"`
# Update your local USN database, remove the USN from the USN website, and track the deployment status by visiting the link printed by the script:
 `cd $UCT && ./scripts/fetch-db database-all.pickle.bz2 && ./scripts/publish-usn-to-website -r -d ./database-all.pickle $USN`

=== Local Configuration ===

# Make sure <code>~/.ubuntu-cve-tracker.conf</code> is fully configured (see the u-c-t README), and set the path to the ubuntu-cve-tracker git tree check-out: <code>UCT=/path/to/ubuntu-cve-tracker</code>
# Grab the database.pickle file: <code>cd $UCT; ./scripts/fetch-db database.pickle.bz2</code>
# set UQT to the ubuntu-qa-tools tree check-out: <code>UQT=/path/to/ubuntu-qa-tools</code>
# Set up <code>~/.dput.cf</code> with the appropriate Security PPA upload entries:
<pre>
[security]
fqdn = ppa.launchpad.net
incoming = ~ubuntu-security/ppa/ubuntu/%(security)s
login = anonymous
</pre>
0. Now you can upload with ```dput```. For example:
<pre>
$ dput -s security:lucid ./*_source.changes  # dry run
$ dput security:lucid ./*_source.changes
</pre>

==== Security Proposed PPA ====
This ppa is a public PPA which builds packages with only ```-security```
enabled. It is used to build packages that need wider testing. Packages can
either be tested directly from this PPA, or more often pocket copied into the
```-proposed```. A member of ```ubuntu-archive``` is required to copy
packages from this PPA to ```-proposed```.

To use the security-proposed PPA:
0. Set up <code>~/.dput.cf</code> to have an entry like this for each release:
<pre>
[security-proposed]
fqdn = ppa.launchpad.net
incoming = ~ubuntu-security-proposed/ppa/ubuntu/%(security-proposed)s
login = anonymous
</pre>
0. Then can upload with:
<pre>
$ dput -s security-proposed:lucid ./*_source.changes  # dry run
$ dput security-proposed:lucid ./*_source.changes
$ umt upload -d security-proposed:xenial # if using the umt tool
</pre>

----
CategorySecurityTeam CategoryProcess
