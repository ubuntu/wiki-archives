{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


* '''Launchpad Entry''': UbuntuSpec:arm-m-archive-features
* '''Created''':
* '''Contributors''': Alexander Sack
* '''Packages affected''':

=== Summary ===

This document specifies required improvements to efficiently maintain derived archives in launchpad.

Derived archives are independent from the upstream archive, while providing easy means to sync and merge changes to the upstream archive to the derived archive.

ATM, the only way to maintain a diff against the ubuntu archive in launchpad is to use PPAs as an overlay archive.

However, using PPAs to create to maintain long running derivates has various restrictions as the notion of carrying changes is not existing in this approach. As such overlay archives come with extra maintenance cost for this purpose as they come with two important missing features for doing efficient downstream development and releases, namely:

* changes in downstream packages are not preserved when the ubuntu package are updated.
* automatic propagation of updates in ubuntu archives cannot be prevented.

While this is a general problem unrelated to arm, the ubuntu on arm effort raises the priority on this as we are aiming to enable working groups and downstream distros to easily maintain their changes, while keeping their code continuosly on top of latest development.

=== Design ===

We suggest to add a new archive type called "derived" archives to the launchpad feature set. Operations for downstream archives are:
* create new archives based on the ubuntu archive
** archives can either be full archive copies or just contain a subset of packages defined by seed like mechanism (aka package sets)
** downstream archives can be full archives or lightweight archives
** full archives will rebuild all packages synched and merged from source
** lightweight archives only rebuild merged package updates, while syncs are done by doing binary copies.
* create new archives based on a "derived archive"
** options are identical to the "create new archives based on the ubuntu archive" above
* 

=== Implementation ===

* implement new archive set

==== UI Changes ====

Should cover changes required to the UI, or specific UI that is required to implement this

==== Code Changes ====

Code changes should include an overview of what needs to change, and in some cases even the specific details.

==== Migration ====

Include:
* data migration, if any
* redirects from old URLs to new ones, if any
* how users will be pointed to the new way of doing things, if necessary.

=== Test/Demo Plan ===

It's important that we are able to test new features, and demonstrate them to users.  Use this section to describe a short plan that anybody can follow that demonstrates the feature is working.  This can then be used during testing, and to show off after release. Please add an entry to http://testcases.qa.ubuntu.com/Coverage/NewFeatures for tracking test coverage.

This need not be added or completed until the specification is nearing beta.

=== Unresolved issues ===

This should highlight any issues that should be addressed in further specifications, and not problems with the specification itself; since any specification with problems cannot be approved.

=== BoF agenda and discussion ===

==== Proposed Structure ====
 (main ubuntu archive)
    /\
    | 
 (ubuntu-on-arm archive)
    /\
    |
 (various further archives)
 
Can use the language of branches to talk about archives: the ubuntu-on-arm
archive is like an integration branch for the various arm work, which will in 
part happen in further derived archives.

* Want to maintain an overlay archive over the main archive
* A bit like archive + ppa, but one sources.list entry and no pinning
** why is this a requirement?
* ways to specify which packages are 'part' of the archive
** everything but ..., only ...
* need to control over which changes from parent archive appear in our archive means "overlay" might not be the best term
* similar to the debian -> ubuntu merge process
** runs automatically some of the time, periods where we carefully review
** default behaviour should be to stay in sync
** should be possible to avoid upgrades for particular packages (blacklist)

==== Relationship with Ubuntu ====
** will ubuntu on arm's milestones be synchronized with ubuntu's?
** binary copy archives / source full archive
** there will be derived archives of the ubuntu-on-arm archive
** analagous to testing/unstable relationship?
*** quiet complex and we need to learn first if thats what we want
* want to use same tool to maintain relationship between ubuntu and arm archives
   as between the arm archive and further-derived archives
** unity work for example could have been done in a derived archive

==== Initial Archive Features ====
* do we start with ubuntu on arm being minimal?
** as we may want to rebuild all binaries in the archive with a new toolchain,
     obviously not having to rebuild 16000 packages is a good thing
** but subsetting the archive is hard beyond existing main/universe/multiverse split
** package sets
** if archive is incomplete, updates to ubuntu may introduce or lose a build dependency
** something about resurrecting binaries
* rebuild requirements relate to binNMUs
** launchpad doesn't support binNUMs yet
** for now we can say "don't expire binaries" for the next cycle
* can one add new-to-ubuntu packages to ubuntu-on-arm (derivative) archive?
** yes (well, requires policy thinking ... yes is definitly true for topic archives)
* policy related to taking not-yet upstreamed patches
* usual question of "how built into launchpad?"
** a core api is "how many packages are newer in archive a than archive b"

==== Launchpad Integration ====
What happens in the remote tool:
* manual actions need to go into tools
* automatic work goes into launchpad.
* operations used by launchpad to get the automatic behaviour needs to be made available to the archive tool.
* copying packages in launchpad is cheap
* need:
** to be able to find packages are eligible for syncing
** need something to then every $N hours to do this syncing
** can allow for launchpad and non-launchpad implementations of each building block
* what about people who want to run their own archive
* full archive vs overlay is about not having to follow your parent's timescale
** also toolchain rebuilds

===== Use Cases =====
* use cases:
** debian->ubuntu
** rebuild archives
** start with these!

===== PPA's =====
* can we extend PPAs?
* implementation-wise should we start with a special kind of ppa?
* each archive needs a special flag in the version number to block auto-syncs (e.g. 'ubuntu' for the debian->ubuntu sync)
* not changed packages have the same version that is in ubuntu
* changed packages should not be synched
* need secure upload queue (sftp)

----
CategorySpec
