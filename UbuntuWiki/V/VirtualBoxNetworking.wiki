{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

=== VirtualBox NAT Networking ===

VirtualBox provides 3 main network options:
* NAT
* host networking
* internal network.

The built-in NAT support is very limited and impractical, host networking is only documented with respect to the bridged network setup which doesn't work with NetworkManager.

The purpose of this tutorial is to use a host networking to create a full-featured NAT environment, similar to KVM or VMWare.

==== Required software ====
We will need 2 additional packages: uml-utilites and dnsmasq.
Install them with the following command:
<pre>
sudo apt-get install uml-utilities dnsmasq
</pre>

==== Configuration ====
1.#1 Stop the networking
 <pre>
 sudo /etc/init.d/networking stop
 </pre>

2.#2 Open /etc/network/interfaces in the editor and add the following lines:
 <pre>
 auto vbox0
 iface vbox0 inet static
     address 10.0.0.254
     netmask 255.0.0.0
     pre-up /usr/sbin/tunctl -u USERNAME -t vbox0 >/dev/null
     up /usr/sbin/dnsmasq --interface=vbox0 --except-interface=lo \
          --bind-interfaces --user=nobody \
          --dhcp-range=vbox,10.0.0.100,10.0.0.200,255.0.0.0,10.255.255.255,8h \
	  --domain=vbox.lan --pid-file=/var/run/dnsmasq.pid --conf-file
     up iptables -t nat -A POSTROUTING -o IFACE -j MASQUERADE
     down iptables -t nat -D POSTROUTING -o IFACE -j MASQUERADE
     down kill -9 `cat /var/run/dnsmasq.pid` && rm /var/run/dnsmasq.pid
     post-down /usr/sbin/tunctl -d vbox0 >/dev/null
 </pre>
 Replace '''USERNAME''' with the actual name of the user. (TODO: use groups).

 Replace '''IFACE''' with the name of the interface connected to the Internet or local network, e.g. eth0.

3.#3 Start the networking:
 <pre>
 sudo /etc/init.d/networking start
 </pre>

4.#4 Start VirtualBox application, open virtual machine settings and change the "Attached to:" option to "Host interface". In the "Interface name" field enter "vbox0".

5.#5 If everything is configured properly the guest will get an IP address in the range 10.0.0.100-10.0.0.200 and will be fully accessible from the host without the need to define forwarding rules, just like in VMWare or KVM.
