{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

=== VPN setup in Ubuntu – General introduction ===

VPN (Virtual Private Network) lets you establish a secure connection over the non-secure Internet, e.g. from a notebook to an office server.

Getting a VPN to work requires general knowledge on networks, and it may require some specific knowledge on routers, firewalls and VPN protocols.

In order to use VPN on Ubuntu, you need to make sure that support for the required VPN protocol is installed. Several VPN protocols exist:

==== PPTP (Microsoft VPN) ====

<pre>
sudo apt-get install network-manager-pptp
</pre>

==== Cisco VPN ====

<pre>
sudo apt-get install network-manager-vpnc
</pre>

==== OpenVPN ====
<pre>
sudo apt-get install network-manager-openvpn
</pre>

==== IPSec VPN ====
Not covered on this page, so far

==== Usage ====
* Click on the network-manager in the system tray
* Choose VPN Connections -> Configure VPN
* Click Add
* You might have to restart the network-manager to get the added VPN connection on the list (killall nm-applet; nm-applet &)
* Now the VPN connection should be shown in the network-manager

=== VPN setup in Kubuntu Feisty (7.04) ===
You have to install the additional package
<pre>
network-manager-gnome
</pre>
Please refer to <nowiki>[[WifiDocs-NetworkManager]]</nowiki> under VPN support for more information.

=== VPN setup using the command line ===

Run the following:

<pre>
sudo apt-get install pptp-linux
</pre>

Create file /etc/ppp/peers/YOUR_COMPANY with this content:
<pre>
pty "pptp YOUR_VPN_GATEWAY --nolaunchpppd"
debug
nodetach
logfd 2
noproxyarp
ipparam YOUR_COMPANY
remotename YOUR_COMPANY
name YOUR_DOMAIN_OR_SERVER_NAME\\YOUR_VPN_LOGIN
require-mppe-128
nobsdcomp
nodeflate
lock
noauth
refuse-eap
refuse-chap
refuse-mschap
</pre>

Add to /etc/ppp/chap-secrets:
<pre>
YOUR_DOMAIN_OR_SERVER_NAME\\YOUR_VPN_LOGIN * YOUR_VPN_PASSWORD *
</pre>

Create file /etc/ppp/ip-up.d/add-subnet with content similar to:
<pre>
# !/bin/bash
[ "$PPP_IPPARAM" = "YOUR_COMPANY" ] || exit 0
route add -net 192.168.100.0/24 dev $PPP_IFACE
</pre>

In the above line, adjust subnet values (192.168.100.0/24) if needed

Then run:
<pre>
sudo chmod a+x /etc/ppp/ip-up.d/add-subnet
</pre>

- Connect to VPN:
sudo pon YOUR_COMPANY
To disconnect, press Ctrl+C or close the terminal.

- If you do not want to see VPN connection debug output, in file /etc/ppp/peers/YOUR_COMPANY delete 3 lines:
debug
nodetach
logfd 2

In this case, “pon YOUR_COMPANY” will run as a background process. Use “poff YOUR_COMPANY” to disconnect.

=== VPN setup in Ubuntu 8.10 ===

I stole these instructions written by mgmiller from http://ubuntuforums.org/showpost.php?p=7089396&postcount=196.  This is for connecting to a Microsoft VPN.

 You need to install 2 packages:
** network-manager-pptp
** pptp-linux
 If you do the first, it will install the second as a dependency.

 Open Network Configuration (System, Preferences, Network Configuration).
 Highlight your VPN connection, hit Edit.

 At IPv4 Settings Tab: choose method Automatic (VPN).

 At VPN Tab:
1. input the IP address of the target computer.
2. input your user name. Leave all else blank, unless you are tunneling to a domain, then enter the domain name where indicated.
3. hit Advanced button.

 At Authentication:
1. UNcheck PAP (because PAP means to allow unsecured passage - this is the source of "no shared shared secrets")
2. Check CHAP, MSCHAP and MSCHAPv2.

 At Security and Compression:
1. Check Use Point-to-point encryption (MPPE)
2. Select 128-bit (most secure).
3. Check Allow stateful encryption.

 At Echo: check Allow PPP echo packets.
 Leave all else blank. Hit OK, OK to save and get out.

=== VPN setup in Ubuntu 9.04 ===

I could not get any VPN working on 9.04.  There appears to be some bugs in the configuration tools, you may be able to get things to work via the command line.

=== VPN setup in Ubuntu 9.10 ===

The following instructions were originally written by sweisler at http://ubuntuforums.org/showpost.php?p=8261958&postcount=6.  They have been additionally tested for PPTP to an MS VPN:

 Here's a synopsis of my VPN setups. I have proven this to work on both x86 and x64 for all 3 VPN types.

 Important note/disclaimer: I tested these configurations on VMware Workstation 7 VM's and a Dell Vostro 220. All installations were fresh installs, not upgrades. Also, please notice that I detail what type of firewall/VPN I am connecting to for each VPN type. There are so many variations on these VPN implementations that it is extremely difficult to generalize a known-good configuration for each.

1. Install various VPN components
  a. PPTP
** pptp-linux
** network-manager-pptp
  b. VPNC
** vpnc
** network-manager-vpnc
  c. OpenConnect
** openconnect
** network-manager-openconnect
# Reboot
# PPTP VPN Configuration - This setup works for connecting to ISA 2004/2006 PPTP VPNs. It should work for connecting to MS PPTP VPN implementations in general. I can't speak for other PPTP VPN implementations.
  a. Create new PPTP connection
** VPN Tab Settings
** Set Connection name
** Set Gateway
** Set username (for domain-based user accounts, use domain\username)
** DO NOT SET PASSWORD
** DO NOT SET NT DOMAIN
** PPTP Advanced Options (Advanced button)
** uncheck all auth methods EXCEPT MSCHAPv2
** check "Use Point-to-Point encryption (MPPE)"
*** leave Security set at "All Available (Default)"
*** trying to force encryption level causes this option to become unset
** check "Allow stateful inspection"
** uncheck "Allow BSD Data Compression"
** uncheck "Allow Deflate Data Compression"
** uncheck "Use TCP Header Compression"
** uncheck "Send PPP Echo Packets" (although connection works either checked or unchecked)
** save configuration
  b. Initial Connection attempt
** enter password in login box
** DO NOT check either password save box at this time
** once connection establishes, verify remote connectivity - ping, rdp, ssh, etc.
** disconnect VPN session
  c. 2nd connection attempt
** enter password in login box
** check both password save option boxes
** once again verify remote connectivity
** disconnect VPN session
  d. Subsequent connection attempts
** VPN session should automatically connect using saved auth credentials
1. VPNC VPN Configuration - This setup works connecting to an ASA5510 - software version 8.2(1). I didn't have any other Cisco devices to test against.
  a. Create new VPNC connection
** set connection name
** set Gateway
** set Group Name
** set User Password to "Saved" and enter password
** set Group Password to "Saved" and enter password
** set username
** set domain (if applicable)
** leave Encryption Method at "Secure (Default)"
** set NAT traversal to "NAT-T"
** save configuration
  b. Initial Connection attempt
** open VPNC connection
** if prompted, select "Always Allow" if you want connection to be automatic
** verify remote connectivity - ping, rdp, ssh, etc.
** disconnect VPN session
  c. Subsequent connection attempts
** open VPNC connection - session should automatically connect
1. OpenConnect VPN Configuration - This setup works connecting to an ASA5510 - software version 8.2(1). I didn't have any other Cisco devices to test against.
  a. Create new OpenConnect connection
** set connection name
** set Gateway
** set Authentication type to "Password/SecurID"
** no need to set username, OpenConnect won't store it yet
** save configuration
  b. Initial connection attempt
** open VPN connection
** check "Automatically start connecting next time"
** click Close
** you will get the "No Valid VPN Secrets" VPN failure message
  c. 2nd connection attempt
** open VPN connection
** accept certificate (if prompted)
** change Group (if necessary)
** enter username (may need to be domain\username)
** enter password
** click Login
** if VPN connection fails, see note below
** verify remote connectivity - ping, rdp, ssh, etc.
** disconnect session
  d. Subsequent connection attempts
** open VPN connection
** enter password
** session should connect

 Note: If you get the "Login Failed" message, cancel and wait 15-30 minutes before attempting to connect again. Also, I ended up having to use the NT style domain\username pair for authentication, even though a Cisco AnyConnect client connecting to the same ASA only requires username.

 More Detail: OpenConnect has been brutal to get connected. I got failed attempt after failed attempt. When I checked the NPS (IAS) log and the Security Event log on the W2K8 domain controller, I could see my user account authenticating properly via RADIUS from the ASA. Yet the OpenConnect client came back with a "Login Failed" message. I'm not an ASA expert, so I have no idea what to check in the ASA configuration to troubleshoot this problem, other than the basic AAA configuration. But I believe the problem lies in the ASA configuration because when I get the OpenConnect "Login Failed" message, the AnyConnect client from my Windows laptop fails as well. I think it may be a ridiculously short timeout or max failure setting. Whatever the issue is, I have to wait for some length of time (~15-30 minutes) for whatever the problem is to reset.

 However, once I finally get the OpenConnect client to successfully connect, it worked from then on. (Just don't mess with the connection configuration, or you will get to go thru this whole process again.)

=== VPN setup in Ubuntu 10.04 ===

Ubuntu 10.04 comes preinstalled with VPN support. 

This features is available under the networks connections tab. 
