{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__

=== Introduction ===
This page described the current installation issues with the package ttf-mscorefonts-installer.

=== Description ===
We have received 150 reports about this package since the release of Karmic on Oct. 29th. This is a critical issue from a user experience point of view.
So, I reviewed 345 installation failures of this package in Ubuntu (1 log file may contain many failures). Here are the results:

# DNS Timout : 160 (46.36%)<<BR>>According to the comments, removing the option "--dns-timeout=10" and leaving the system defaults in update-ms-fonts seems to help.
# Proxy URL http://:8080/: Invalid host name : 76 (22.03%)<<BR>>This is Ubuntu specific and reported here only for completness. This happens when the gconf key use_http_proxy = true and the user left the default values for the keys "host" and "port".<<BR>>The solution could be to unset http_proxy if the proxy address is invalid or prompting the user with msttcorefonts/http_proxy
# Connection timed out : 39 (11.30%)<<BR>>Same category of issue as 1 but when connecting to the server. Removing the option "--connect-timeout=5" in update-ms-fonts and leave the system default value seems to help too.
# Name or service not known : 15 (4.35%)<<BR>>Faulty DNS, badly configured local DNS or IPv6 enabled network. Not much to do here.
# Checksum mismatch : 14 (4.06%)<<BR>>Some mirrors are sometimes returning partial content or HTML content (for instance biznetworks.dl.sourceforge.net)
# The remaining errors are
** HTTP Error : 13 (3.77%)
** Various System Errors : 12 (3.48%)
** Network error : 8 (2.32%)
** User Interrupt : 8 (2.32%)

Fixing 1,2 & 3 would avoid a large part of the failures.

I've also check the dependencies on this package:
<pre>
xubuntu-restricted-extras : Recommends
ubuntu-restricted-extras : Recommends
playonlinux : Suggests
kubuntu-restricted-extras : Recommends
wine1.2 : Recommends
wine : Recommends
user-he : Suggests
libphp-jpgraph : Depends
latexdraw : Suggests
jclic : Suggests
freevo : Suggests
eeepc-acpi-scripts : Suggests
openoffice.org : Recommends
gnumeric : Suggests
</pre>

There is only 1 package that really depends on msttcorefonts.
Furthermore, it will '''only''' result in bad rendering for some apps if the fonts are not installed. That's far from unusable.

=== Fix proposal ===
1. We could mimic the behaviour of flashplugin-installer. The function fp_exit_with_error notifies the user of the failure, set some debconf values, and exit with 0 but it doesn't fails the whole upgrade. <<BR>>In this case the fonts are not installed but do we expect from ttf-mscorefonts-installer to install the fonts or to install the installer ? In the latter the installation succeeded even if the installation of the fonts didn't.

1. When a mirror fails and a font fail to download from all mirrors, then the others fonts are not downloaded and a failed mirror is not retried. Switching the 2 nested loops will fix it

1. The proxy is stored in a debconf variable. If it is wrongly set we never give a chance to the user to change it. First step is to check for a valid proxy address, the second step will be to remove this setting and rely on the system's configuration. 
