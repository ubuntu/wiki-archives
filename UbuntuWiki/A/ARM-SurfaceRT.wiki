{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

Wiki about running Ubuntu on the ARM (32-bit) Microsoft Surface RT/Surface 2 and related Windows RT devices.

For more info see:  <nowiki>[[https://openrt.gitbook.io/open-surfacert/|The Open Surface RT Home]]</nowiki>

== Download ==
Your options are:
* The only official and supported Ubuntu armhf (32-bit) media are the <nowiki>[[https://ubuntu.com/download/raspberry-pi|images for the Raspberry Pi]]</nowiki>.  Much of the Raspberry Pi Ubuntu Server <nowiki>[[https://ubuntu.com/tutorials/how-to-install-ubuntu-on-your-raspberry-pi#1-overview|documentation]]</nowiki> applies to the Surface RT/Surface 2.

* For 20.04 (<nowiki>[[http://cdimages.ubuntu.com/netboot/|and earlier]]</nowiki>) there is also still the <nowiki>[[http://ports.ubuntu.com/dists/focal/main/installer-armhf/current/legacy-images/|netboot installer]]</nowiki>.  A general (and hugely over-detailed) installation guide for this can be found <nowiki>[[https://help.ubuntu.com/lts/installation-guide/armhf/index.html|here]]</nowiki>.

* You may find community builds such as the <nowiki>[[https://ubuntu-mate.org/download/armhf/|Ubuntu MATE Raspberry Pi images]]</nowiki>.

* Back in the day Ubuntu used to produce an <nowiki>[[http://old-releases.ubuntu.com/releases/raring/|image for the Nexus 7]]</nowiki>.  Although now very old this potentially could have hardware accelerated graphics with the Tegra 3 Surface RT.

* <nowiki>[[https://developer.nvidia.com/embedded/jetson-linux-archive|Linux for Tegra]]</nowiki> provides a number of Ubuntu based sample filesystems.  There are releases for the <nowiki>[[https://developer.nvidia.com/linux-tegra-rel-16|Tegra 3]]</nowiki> and <nowiki>[[https://developer.nvidia.com/linux-tegra-rel-17|Tegra 4]]</nowiki>.

* The Linux for Tegra drivers can also be used with the armhf (<nowiki>[[https://wiki.ubuntu.com/ARM/TEGRA/AC100|ac100]]</nowiki>) version of <nowiki>[[https://phillw.net/isos/lubuntu/raring/|Lubuntu 13.04]]</nowiki>.  Installation is similar to the Nexus 7 image.

Although it is technically possible to install the full Ubuntu Desktop via Ubuntu Server/netboot, it is highly recommended that you install one of the lighter desktops such as Lubuntu, Xubuntu or MATE.

The above media need to be adapted for Windows RT devices and this is described below.

== Surface Models ==
Many Surface 2 owners are unaware they have a Surface 2 because both machines are labelled with 'Surface/Windows RT' under the kickstand!  If your device has a black rear then you have the Tegra 3 (T30) based Surface RT, but if it is silver grey then you have the Tegra 4 (T114) based Surface 2.  It is important you know your model so that you can use the correct Device Tree Blob (DTB).  This page makes a distinction between the two machines as they boot Linux differently, so follow the instructions for your device.

* Surface RT - black
* Surface 2 - silver

More information on hardware including touch/type covers can be found <nowiki>[[https://openrt.gitbook.io/open-surface-wiki/|here]]</nowiki>.

== Secure Boot ==
There is no doubt that secure boot has been a major hurdle in putting Linux on Windows RT devices.  Thankfully we now have a number of workarounds available to us:

* For Tegra 3 based devices there is the USB tethered Fusée Gelée exploit.  This removes all the restrictions of the UEFI firmware.  Also known as APX booting.

* Golden keys has been available since late 2016.  It allows a self-signed Windows boot manager app to run and in turn an UEFI app such as GRUB 2.  Secure boot and memory !TrustZone are still active.

* Yahallo is a new (2020) Tegra exploit that effectively turns off secure boot permanently.  It can be applied with the help of golden keys.  !TrustZone is still active, but recent changes to the Linux kernel (~5.11) allowed this to be automatically avoided.

* Work continues on an UEFI privilege escalation to disable !TrustZone memory protection and consequently gain full control of the hardware.  As of February 2023 'the exploit' can load U-boot (and subsequently the linux/Android kernel) on the Surface RT, but is limited to one CPU core.

Consequently, the Surface RT has two boot options: APX or UEFI.  APX currently offers considerably better performance, but it has the disadvantage of always needing "jump leads".  Due to its added complexity it is discussed at the end of this page.  The Surface 2 can only use UEFI.  For UEFI booting it is recommended to install yahallo.

Microsoft patched the golden keys exploit, but fortunately for Tegra devices this can be reversed.  The easiest way is to download and install the <nowiki>[[https://support.microsoft.com/en-us/surface-recovery-image|official 8.1 recovery image]]</nowiki> for you device as these pre date the patch. You must download an image as the recovery partition will not work for this.  Be warned, now that Windows 8.1 is EOL, <nowiki>[[https://support.microsoft.com/en-us/windows/windows-8-1-support-ended-on-january-10-2023-3cfd4cde-f611-496a-8057-923fba401e93|the store no longer works]]</nowiki> and cannot be used to reinstall apps.

Once you have a completely fresh install (or have wiped the eMMC) you can use the <nowiki>[[https://openrt.gitbook.io/open-surfacert/common/boot-sequence/uefi/secure-boot/surface-rt-and-surface-2-jailbreak-usb|jailbreak usb]]</nowiki> to install golden keys and then run yahallo.  Finally, remove golden keys if you intend to dual boot Windows or <nowiki>[[https://jwa4.gitbook.io/windows/|install Windows]]</nowiki> at a later date.  

== Custom Kernel ==

Ubuntu's generic kernel can be booted with APX when paired with a suitable DTB.  However, a custom kernel gives greater hardware support (e.g. the touch/type covers).  UEFI booting requires a custom kernel.

For kernel source, compiling and pre-built binaries please see <nowiki>[[https://openrt.gitbook.io/open-surfacert/surface-rt/linux/kernel|here]]</nowiki> with the latest kernel binaries usually to be found <nowiki>[[https://files.penguins.win/Linux-Kernel-Download/|here]]</nowiki>.  

Pre-built binaries usually come in three parts: the kernel image called zImage or vmlinuz, a zipped folder containing extra kernel modules (e.g. for wifi), and a Device Tree Blob that exactly matches your model and boot method:

* Surface RT booted via APX - tegra30-microsoft-surface-rt.dtb
* Surface RT booted via UEFI - tegra30-microsoft-surface-rt-efi.dtb
* Surface 2 - tegra114-microsoft-surface-2.dtb

Please ensure you download image, modules and dtb from the same kernel version number/date.

The 3.x Surface RT Android based kernels do not use a dtb.  With a small modification these can be used with older versions of Ubuntu. 

== UEFI Booting ==
UEFI bootloaders need to be placed on the internal eMMC or USB drive.  The root filesystem can be placed on eMMC, USB or microSD card.

=== Surface RT ===
The Surface RT can use <nowiki>[[https://github.com/coherixmatts/grub-2.04|GRUB 2]]</nowiki> or <nowiki>[[https://github.com/tianocore/edk2/tree/UDK2018/ShellBinPkg/UefiShell/Arm|UEFI shell]]</nowiki> as a bootloader.  Pre-built '.efi' binaries are available by following the links.  These are usually stored in an efi folder on the boot partition of a drive.  On a USB drive they are normally given the name /EFI/Boot/bootarm.efi as this is the fallback file loaded by UEFI.

Unfortunately a bug with the Surface RT's UEFI implementation stops the display from working with most efi applications unless specifically patched (or the <nowiki>[[https://github.com/Open-Surface-RT/EfiApps|EfiFileChainloader]]</nowiki> is used).  Touch and Type Covers also do not work on the Surface RT in these applications.  Consequently, configuration files are used to automate booting and pass kernel command line parameters:
* grub.cfg (GRUB 2)
* startup.nsh (UEFI shell)

Sadly Ubuntu's version of GRUB 2 has an additional problem (fails to boot Linux) and should be avoided [bug report needed].

Putting the custom kernel and bootloader files together, the following files need to be added to installation media to boot on the Surface RT:
<pre>
.
├── EFI
│   └── Boot
│       └── bootarm.efi
├── grub.cfg or startup.nsh
├── tegra30-microsoft-surface-rt-efi.dtb
└── zImage
</pre>

For booting Ubuntu Server from a USB drive a simple grub.cfg may look like this (this won't print anything to the screen, please see the dual-booting section below for that):
<pre>
linux /zImage root=/dev/sda2 cpuidle.off=1 net.ifnames=0 rootwait
initrd /initrd.img
devicetree /tegra30-microsoft-surface-rt-efi.dtb
boot
</pre>

A startup.nsh may look like this:
<pre>
fs0:
zImage dtb=tegra30-microsoft-surface-rt-efi.dtb root=/dev/sda2 cpuidle.off=1 net.ifnames=0 rootwait initrd=initrd.img

reset -s
</pre>

=== Surface 2 ===
'''NOTE: Booting Linux on the Surface 2 is still a work in progress.'''

The display and type/touch covers work as expected in GRUB 2/shell on the Surface 2, but there are new issues:
* '''BUG#1''' in Surface 2's UEFI firmware: !BootServices->!LoadImage causes a 7 minute wait when you want to load an EFI file that was compiled with anything other than edk2.

* '''BUG#2''' You can't shutdown the device with an UEFI call. This doesn't have to be implemented in the UEFI firmware, but it's a downgrade from the Surface RT which supports shutting down with a UEFI !RuntimeServices call. (Surface 2 only supports reboot)
 
Unfortunately booting the Linux kernel through GRUB 2/shell incurs this 7 minute delay.  However, we can avoid this delay if we boot the Linux kernel using the golden key test files.  Something needs to give the kernel command line parameters and for this the Surface 2 kernel has recently been patched to read cmdline.txt.

Users maybe familiar with cmdline.txt from the Raspberry Pi.  It performs a similar role for the Surface 2, but unlike the Pi the dtb and initrd (if required) are also specified in cmdline.txt.

You may already have the necessary golden key test files, but if you don't then download grub.zip from <nowiki>[[https://forum.xda-developers.com/t/wip-secure-boot-and-linux-for-surface-rt.3653848/|the XDA forum]]</nowiki>.  The version of GRUB is very old and not particularly useful, but we can make use of the other files in the zip.

1. From the zip put the efi folder and test.efi onto a USB drive.

2. Download a Surface 2 kernel and Device Tree Blob. Put these also on the USB drive. Rename zImage to boot.efi

3. If you are using an initrd then put that on the USB drive.

4. Create a text file called cmdline.txt (watch out in Windows you don't end up with a file called cmdline.txt.txt!).  In this put your command line parameters.  For example for netboot: 
<pre>
dtb=tegra114-microsoft-surface-2.dtb cpuidle.off=1 initrd=initrd-with-wifi.gz 
</pre>

The Surface 2 will happily boot from a usb drive, but currently looses usb power after the initrd and kernel are loaded. You can get around this if you have a usb hub that provides back power.   Alternatively, place the root filesystem on a SD card (note, early Surface 2 kernels had the SD card slot configured to act as a serial port).  The cmdline.txt will need to be adjusted for this, e.g. for Ubuntu Server:
<pre>
dtb=tegra114-microsoft-surface-2.dtb  root=/dev/mmcblk1p2 cpuidle.off=1 net.ifnames=0 initrd=initrd.img rootwait 
</pre>

The eMMC, touch/type covers, speakers and touchscreen work.  !WiFi works when you copy the kernel modules across to your rootfs.  Something goes wrong with the screen on around a third to a half of boots.  When this occurs you won't see boot messages and unless you've installed a desktop, you'll end up with a blank screen.  If this happens press the power button to initiate power down and then after a few seconds hold the power button down to force power off. The Raspberry Pi OS desktop with its fbturbo driver seems to always work.

The Surface 2's eMMC only seems to work with a GPT partition table (it is blank on a reboot when formatted as MBR).  This means you cannot directly copy a whole raspberry pi image to eMMC.  

== Ubuntu Server ==
Write the Ubuntu Server image to a USB drive following standard Raspberry Pi instructions.  Copy the appropriate kernel zImage and dtb to the first (called "system-boot") partition on the USB drive.  Add the appropriate bootloader/efi files to the same partition.  

The default Raspberry Pi cmdline.txt uses net.ifnames=0 so add that to the surface kernel command line (list of kernel parameters).  

The server image expects a working network on first boot, so setup as described <nowiki>[[https://ubuntu.com/tutorials/how-to-install-ubuntu-on-your-raspberry-pi#3-wifi-or-ethernet|here]]</nowiki>.  Comment out or delete the ethernet stanza in the network-config file and use "mlan0" instead of "wlan0" for the built-in wireless.

<pre>
version: 2
wifis:
  mlan0:
    dhcp4: true
    optional: true
    access-points:
      "your-wifi-name":
        password: "your-wifi-password"
</pre>

Unzip the kernel lib folder and copy the modules to the second (called "writable") partition:
<pre>
sudo cp -r lib/modules /media/YOUR-USER-NAME/writable/lib/
</pre>

== Netboot ==
The netboot or <nowiki>[[https://help.ubuntu.com/community/Installation/MinimalCD|mini iso]]</nowiki> installer is a small text based installer.  It essentially consists of a kernel image and an initrd file that is loaded into ram on boot.  Users have complete control of where and how the system is installed.  You will be given a choice of desktops to install (or just a command line interface if preferred).

The initrd contains the kernel modules for Ubuntu's generic kernel, but we can add wifi modules and firmware for our custom kernels:
(this assumes you've unzipped the lib folder holding the kernel modules)
<pre>
wget http://ports.ubuntu.com/dists/focal/main/installer-armhf/current/legacy-images/generic/netboot/initrd.gz
mkdir /tmp/d-i_wifi
cp -r lib /tmp/d-i_wifi
cd /tmp/d-i_wifi
mkdir lib/firmware
cp -r /lib/firmware/mrvl lib/firmware
pax -x sv4cpio -w lib | gzip -c >wifi.cpio.gz
cd -
cat initrd.gz /tmp/d-i_wifi/wifi.cpio.gz > initrd-with-wifi.gz
</pre>

The built in marvell wifi doesn't seem to get recognised as wifi by the installer ('unknown interface').  To get the internal wifi working you need to drop to a shell in the installer (use the 'Go back' option until you hit a menu with this option) and setup /etc/wpa_supplicant.conf (see <nowiki>[[https://askubuntu.com/questions/138472/how-do-i-connect-to-a-wpa-wifi-network-using-the-command-line|here]]</nowiki>) and then run:
<pre>
wpa_supplicant -B -i mlan0 -c /etc/wpa_supplicant.conf -D nl80211
</pre>
Exit and select mlan0 at the network stage.  You should have network.  /etc/netplan/01-netcfg.yaml seems to think it is ethernet.  You will have to edit this on the target system to have wifi. Make sure the target system has wpasupplicant as a cli only install may not have this.

You will have to choose the manual partitioning option.  Do not use the automatic partitioning scheme as this will use a MBR partition table when the disk is cleared. There is no option to select a GPT partition table except through preseeding.
<pre>
d-i partman-partitioning/default_label select gpt
</pre> 

The bootloader install will fail as the installer knows nothing about Windows RT devices.  You will have to do this manually.  flash-kernel-installer disables initramfs so you will have to reverse this if you want one.

== Nexus 7 (2012 "grouper") image ==
This could be an interesting image to be used with the Surface RT as they both use the Tegra 3.  The <nowiki>[[https://wiki.ubuntu.com/Nexus7|old wiki project page]]</nowiki> gives information about the image with a separate page for <nowiki>[[https://wiki.ubuntu.com/Nexus7/Kernel|the Nexus 7 android kernel]]</nowiki>.  

The image should be booted with a modified Surface RT android kernel.

Extracting the root filesystem from the downloaded nexus image is a somewhat convoluted affair.  First you need to unzip it and convert it to a 'proper' img before it can be mounted (this creates a non-sparse 6GB image):
<pre>
sudo apt install android-sdk-libsparse-utils
gunzip ubuntu-13.04-preinstalled-desktop-armhf+nexus7.img.gz
simg2img ubuntu-13.04-preinstalled-desktop-armhf+nexus7.img nexus-tmp.img
mkdir img-mnt
sudo mount -o loop nexus-tmp.img img-mnt
</pre>

Format a partition on the SD card as ext4 (replacing /dev/partition as necessary, e.g. /dev/sdX2 or /dev/mmcblkXp2):
<pre>
sudo mkfs.ext4 -O ^metadata_csum,^64bit /dev/partition
</pre>
To make this usable with the android kernel it needs to be 32 bit and have the metadata_csum removed. This can also be achieved with tune2fs and resize2fs.  In the example below the journal is also removed:
<pre>
sudo e2fsck -f /dev/partition
sudo resize2fs -s /dev/partition
sudo tune2fs -O ^metadata_csum /dev/partition
sudo tune2fs -O ^has_journal /dev/partition
</pre>

Mount the partition and extract the root filesystem:
<pre>
mkdir raring-mnt
sudo mount /dev/partition raring-mnt
sudo tar --same-owner --numeric-owner -pxf img-mnt/rootfs.tar.gz -C raring-mnt
</pre>
Be careful with the above command as you don't want to override your working linux system!

Once thats done:
<pre>
sudo umount img-mnt
rm nexus-tmp.img
</pre>

To make ubiquity (the installer) start on first boot:
<pre>
sudo touch raring-mnt/var/lib/oem-config/run
</pre>

Create an fstab:
<pre>
echo "none	 /proc 	proc 	nodev,noexec,nosuid 	0 	0"  | sudo tee raring-mnt/etc/fstab
echo "/dev/mmcblk1p2	/	ext4	defaults,noatime,nodiratime		0	1"  | sudo tee -a raring-mnt/etc/fstab
</pre>

Let flash-kernel know about the Surface RT (this is a bit hacky and likely to break on update):
<pre>
echo $'\n'Machine: surface-rt | sudo tee -a raring-mnt/usr/share/flash-kernel/db/all.db
echo Method: nothing | sudo tee -a raring-mnt/usr/share/flash-kernel/db/all.db
</pre>

Finally, unmount:
<pre>
sudo umount raring-mnt
</pre>

We don't need the companion Nexus bootimg, but for those curious it can be downloaded and then extracted with:
<pre>
mkdir bootimg
cd bootimg
sudo apt install abootimg
abootimg -x ../ubuntu-13.04-preinstalled-desktop-armhf+nexus7.bootimg
</pre>
The resulting initrd.img can be further unpacked with the usual tools.  Within this you'll find the <nowiki>[[https://git.launchpad.net/ubuntu/+source/ac100-tarball-installer/tree/installer?h=applied/ubuntu/raring|ac100-tarball-installer script]]</nowiki> that automatically extracts the root tarball, populates fstab and changes the kernel command line for the installed system.  Essentially what we have done above.

Random links that can be trawled for more info are:

https://forum.xda-developers.com/t/how-to-linux-hardware-acceleration-on-linux-help.2419974/

https://ac100.grandou.net/hw_accelerated_video_playback

https://launchpad.net/~ubuntu-nexus7

https://launchpad.net/ubuntu-nexus7

https://launchpad.net/ubuntu/+source/nvidia-graphics-drivers-tegra3/+publishinghistory (looks like 'saucy' was the last)

https://bugs.launchpad.net/mir/+bug/1238695

https://launchpad.net/ubuntu/trusty/+source/linux-grouper

https://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux-meta/+git/utopic/log/?h=grouper

https://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux/+git/utopic/refs/heads?h=grouper

https://wiki.ubuntu.com/Kernel/Dev/AndroidKernel

https://launchpad.net/ubuntu/utopic/+source/linux-grouper

https://wiki.ubuntu.com/SecurityTeam/AppArmorForPhabletKernels

https://code.launchpad.net/~ubuntu-branches/ubuntu/trusty/linux-nexus7/trusty

https://launchpad.net/ubuntu/raring/+source/linux-nexus7

https://bazaar.launchpad.net/~ubuntu-branches/ubuntu/raring/linux-nexus7/raring/files

== Dual Booting ==
=== Making space for Ubuntu ===
If you need to shrink a windows partition to make space for Ubuntu then it is best to do this in Windows.  Just search for 'partition' and open disk partition manager.  From there you can shrink a partition.  In Linux, bitlocker stops this working using the usual tools.

=== Available Boot Managers ===
==== GRUB 2 ====
On the Surface RT you can have a dual-boot setup with GRUB 2 very much like a normal PC.  However, a USB keyboard is normally needed to make a selection or edit entries.  <nowiki>[[https://github.com/makuhlmann/grub-2.04-nokeymod|This]]</nowiki> fork of GRUB 2 changes the timeout behaviour to allow selecting an OS using the volume buttons only.

Before copying GRUB 2 to the eMMC make sure you have a working menu by doing a trial boot from USB.  A sample grub.cfg is below (Ubuntu on microdSD card).  '''For a menu/working display you also need a font file (e.g. font.pf2).'''  This can be found on any Ubuntu ISO or installation with GRUB 2.  

<pre>
if loadfont /font.pf2 ; then
	set gfxmode=auto
	insmod efi_gop
	insmod efi_uga
	insmod gfxterm
	terminal_output gfxterm
fi

set menu_color_normal=white/black
set menu_color_highlight=black/light-gray

set timeout=5
menuentry "Start Linux" {
	set gfxpayload=keep
	linux /zImage root=/dev/mmcblk1p2 cpuidle.off=1
	devicetree /tegra30-microsoft-surface-rt-efi.dtb
}
menuentry "Start Windows" {
	search --no-floppy --label --set SYSTEM
	chainloader /EFI/Microsoft/Boot/bootmgfw.efi
}
menuentry "Boot from next volume" {
	exit
}
menuentry "System restart" {
	echo "System rebooting..."
	reboot
}
menuentry "System shutdown" {
	echo "System shutting down..."
	halt
}
</pre>

The above Windows entry searches for a filesystem with the label "SYSTEM" (which is the efi partition on the Surface RT) and sets root to that partition.  You must set the root before the chainloader command.  If you think SYSTEM is too generic you can instead search for the fs-uuid or the bootmgfw.efi file, or set the root directly:
<pre>
menuentry "Start Windows" {
	set root=(hd0,2)
	chainloader /EFI/Microsoft/Boot/bootmgfw.efi
}
</pre>

Once you are happy that your menu works you can copy GRUB 2 to the eMMC and make it the default boot manager.   In Windows open an Admin command prompt by right clicking on the start menu and selecting the appropriate menu item.  Mount the efi partition with the drive letter b:
<pre>
mountvol b: /s
</pre>
Copy grub.efi, grub.cfg, font.pf2 and any other boot files you might need to the eMMC's efi boot partition.  For example, to copy the files from drive f:
<pre>
copy f:\grub.efi b:
copy f:\grub.cfg b:
copy f:\font.pf2 b: 
</pre>
If your linux filesystem is on the eMMC/USB then the zImage, dtb and initrd doesn't have to be placed on the efi boot partition, but you may wish to put them there for simplicity. If your linux root filesystem is on a microSD card then you will have to copy those files too.  

Once you are finished remove the drive letter mapping:
<pre>
mountvol b: /d
</pre>

With bcdedit (from a Windows Admin command prompt) you could create a new bootmgr entry and change the default, but it is easier to just edit the existing entry:
<pre>
bcdedit /set {bootmgr} path \grub.efi
</pre>
To revert (or if something goes wrong), delete the file grub.efi on the eMMC and the fallback bootarm.efi (which should be the windows boot manager) will be booted.

==== Windows Metro (Touchscreen) Boot Manager ====
Here again we can make use of the golden key's 'test.efi' file.  Unusually, we can actually boot Linux from the Windows boot manager!  This is because test.efi is not an efi application, but a Windows boot manager application.  It chainloads an efi application called 'boot.efi'.  The latter is what we need to call our true efi application and for the Surface 2 this is what zImage needs to be called.

Copy test.efi, boot.efi and any other needed files to the eMMC's efi partition (see above for how to do this from Windows).

Use <nowiki>[[https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/bcd-boot-options-reference|bcdedit]]</nowiki> from a Windows Admin command prompt to add a new entry (the entry must have <nowiki>[[https://www.microsoftpressstore.com/articles/article.aspx?p=2201310#:~:text=crash%20(blue%20screen).-,nointegritychecks,-Boolean|nointegritychecks]]</nowiki>).  If you are not familiar with bcdedit type:
<pre>
bcdedit /?
</pre>
To list all entries:
<pre>
bcdedit /enum all
</pre>

Create a new bootapp entry for Ubuntu:
<pre>
bcdedit /create /d "Ubuntu Server" /application bootapp
bcdedit /set {the-big-long-number-id-you've-been-given} device boot
bcdedit /set {the-big-long-number-id-you've-been-given} path \test.efi
bcdedit /set {the-big-long-number-id-you've-been-given} locale en-GB
bcdedit /set {the-big-long-number-id-you've-been-given} nointegritychecks Yes
</pre>

Now add it to the display order:
<pre>
bcdedit /displayorder {the-big-long-number-id-you've-been-given} /addlast
</pre>

Upon reboot you should be presented with the boot manager.

==== Windows Legacy (Text) Boot Manager ====
This offers a faster boot time.  Unlike the Surface RT, the Surface 2 has working touch/type cover in the legacy boot manager.

From an Windows Admin command prompt run one of the following commands (it doesn't matter which):
<pre>
bcdedit /set {current} bootmenupolicy Legacy
</pre>

or

<pre>
bcdedit /set {bootmgr} displaybootmenu Yes
</pre>

To return it to Metro:
<pre>
bcdedit /set {current} bootmenupolicy Standard
bcdedit /deletevalue {bootmgr} displaybootmenu
</pre>

== Tips and Tricks ==

Please add!

=== Opentegra xorg driver ===
For the Xfce and MATE desktop environments it is recommended to install the opentegra xorg driver.

https://launchpad.net/~grate-driver/+archive/ubuntu/ppa

Note: do not install Mesa from here! (broken desktop)

=== Firefox scrolling ===
Enable Firefox touchscreen scrolling.

=== Flash kernel ===
Add a custom config for Surface RT / 2

=== Create a /boot/efi mount point ===
Unmount /boot/firmware:
<pre>
sudo umount /boot/firmware
</pre>
Delete the now unused folder and create a new /boot/efi folder:
<pre>
sudo rm -r /boot/firmware
sudo mkdir /boot/efi
</pre>
Open /etc/fstab:
<pre>
sudo nano /etc/fstab
</pre>
Replace this line:
<pre>
LABEL=system-boot  /boot/firmware  vfat  defaults    0  1
</pre>
with:
<pre>
LABEL=system-boot  /boot/efi       vfat  umask=0077  0  1
</pre>

== APX/Fusée Gelée ==
APX (perhaps more correctly called USB Recovery Mode "RCM") is starting the Surface RT with the help of another computer linked with a USB cable.  As always further info can be found on the <nowiki>[[https://openrt.gitbook.io/open-surfacert/surface-rt/linux/booting/apx-boot|Open Surface RT wiki]]</nowiki>.

Fusée Gelée is run on a amd64/i386 linux (or WSL) computer with a USB3 port.  On this you need the python3-usb package installed.  On a 64bit Ubuntu machine you also need the libc6 and libstdc++6 i386 packages (to stop a "no such file or directory" error):
<pre>
sudo dpkg --add-architecture i386
sudo apt update
sudo apt install python3-usb
sudo apt install libc6:i386
sudo apt install libstdc++6:i386
</pre>
The necessary pre-built Fusée Gelée binaries can be downloaded from <nowiki>[[https://openrt.gitbook.io/open-surfacert/surface-rt/linux/booting/apx-boot/boot-linux/binarys#fusee-gelee|here]]</nowiki>.  To these you will need to add U-Boot compiled for the Surface RT.  Follow the instructions in the included "read.me".

Connect the Surface RT to the USB3 port of the other computer.  <nowiki>[[https://openrt.gitbook.io/open-surfacert/common/boot-sequence/tegra-soc-boot-process/fusee-gelee/apx-mode-usb-debugging#entering-apx-mode|Enter APX mode]]</nowiki> by pressing the Surface RT's power button with the volume up button also pressed.  The screen will remain blank.  Running "dmesg" on the connected computer you should see:
<pre>
[  423.764974] usb 1-1: new high-speed USB device number 7 using xhci_hcd
[  423.913876] usb 1-1: New USB device found, idVendor=0955, idProduct=7130, bcdDevice= 1.03
[  423.913885] usb 1-1: New USB device strings: Mfr=1, Product=2, SerialNumber=0
[  423.913890] usb 1-1: Product: APX
[  423.913895] usb 1-1: Manufacturer: NVIDIA Corp.
</pre>
For one time only extract the BCT (this can be skipped on subsequent boots):
<pre>
cd surfaceRT_FuseeGeleeTools
sudo ./runGetBCT.sh
</pre>

At the end of the long output you should see:
<pre>
 retrieving bct into: ./bct/surface_rt_bct.BIN
./bct/surface_rt_bct.BIN received successfully
</pre>
Force the Surface RT to power off by holding the power button down for 10 seconds.

Enter APX mode again, but this time runUboot:
<pre>
sudo ./runUboot.sh
</pre>
If all went well you should now see something on the Surface RT display.

Note: The Open Surface RT wiki refers to (in the commands) a payload file "uart_payload_n7.bin" which you can download following the links, but the scripts in the zip (runUboot.sh etc) use the already included payload "disable_security_fuses.bin".

The latest (2023) versions of U-Boot expect to read a configuration file uboot.env placed on the USB/microSD/eMMC, but if you want to go old school, then here is the boot script for netboot:
<pre>
echo 'Linux is booted from boot.scr'

setenv bootargs ---

fatload mmc 1:1 ${fdt_addr_r} tegra30-microsoft-surface-rt.dtb  
fatload mmc 1:1 ${kernel_addr_r} vmlinuz
fatload mmc 1:1 ${ramdisk_addr_r} initrd.gz

bootz ${kernel_addr_r} ${ramdisk_addr_r}:${filesize} ${fdt_addr_r}
</pre>
DO NOT use a dtb file for a different machine as this can cause hardware damage!!!
