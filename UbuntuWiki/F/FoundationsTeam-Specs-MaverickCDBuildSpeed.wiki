{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


* '''Launchpad Entry''': UbuntuSpec:foundations-n-cd-build-speed
* '''Created''': 3 May 2010
* '''Contributors''': LaMontJones, CodySomerville, ColinWatson, ...
* '''Packages affected''': `livecd-rootfs`

=== Summary ===

CD build speed has been creeping back up of late; attack it again.

=== Release Note ===

Not a user-visible feature, so no release note required.

=== Rationale ===

CD build times are a bottleneck in the release process.  We have <nowiki>[[UbuntuSpec:cd-build-process|worked on this before]]</nowiki>, but we build many more images now and the problem has once again become acute.  At the moment, live filesystem build times seem to be the worst offenders.

=== Design ===

==== Primary work ====

To permit future measurements, we will change `livecd-rootfs` to log the total time taken for live filesystem builds, as well as any other intermediate timings which may be useful.

Building on a tmpfs speeds up live filesystem builds substantially (down to 7 minutes on amd64, down from 21 minutes to 16 minutes on i386).  This is only practical for non-DVD builds, but we will do it for other builds.

Early stages of live filesystem builds are common to multiple flavours, particularly the base system `debootstrap` and the desktop element of DVD builds.  We will profile the results of rsyncing this to a safe location along with an archive timestamp, and simply copying it back rather than rebuilding it if the archive timestamp hasn't changed.  If profiling suggests that this is beneficial then we will do it.  (Cody Somerville says that saving the results of `debootstrap` is a net gain for `live-helper`.)

Cody Somerville says that some degree of parallelisation speeds up live filesystem builds for OEM Services.  We will investigate whether this is also true for `livecd-rootfs`, and if so what maximum degree of parallelisation we can allow.

We will add a facility to remove the `/usr/share/doc` report and the `fdupes` run from release builds.

We will add a dpkg option to turn off I/O safety (fsync et al) and use that during live filesystem builds.

==== Secondary work ====

We will evaluate `live-helper` as a replacement for `livecd-rootfs`.  In order to commit to this, we would at minimum need to do a file-by-file comparison of the output and sign off on any differences; a moderate amount of customisation work will almost certainly be required.

=== Test/Demo Plan ===

It's important that we are able to test new features, and demonstrate them to users.  Use this section to describe a short plan that anybody can follow that demonstrates the feature is working.  This can then be used during testing, and to show off after release. Please add an entry to http://testcases.qa.ubuntu.com/Coverage/NewFeatures for tracking test coverage.

This need not be added or completed until the specification is nearing beta.

----
CategorySpec
