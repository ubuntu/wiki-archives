{|
  | '''Warning'''
  * This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
  * '''Images''' and '''attachments''' have been removed to conserve space.
  * '''Links''' may not work and there may be formatting issues.
  * A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__

This document describes the policy for updating the fwupd, and fwupd-efi packages to new upstream versions in a stable, supported distro (including LTS releases).

=== Background ===
fwupd is the firmware updating daemon used for performing updates on a variety of devices.  Updates outside of the OS are performed using UEFI capsules.

fwupd-efi provides the source for the EFI binary used for performing UEFI capsule updates. When a new version is uploaded to Ubuntu, a matching package fwupd-signed is also uploaded for all the signed versions of these binaries which are trusted by the Secure Boot chain. 

The entire firmware update stack is maintained upstream by the fwupd team, primarily Richard Hughes and Mario Limonciello (@superm1).

Due to the nature of the coverage of various UEFI implementations across OEMs it's often difficult or impossible to foreshadow the impacts of a given fix on other OEMs implementations.  OEMs that run into a problem on a particular version of fwupd can place information into the metadata to prevent updates from running on versions of fwupd that have known bugs.

Upstream maintains stable release branches for distros like Ubuntu to pick up when applicable without going to the latest version of fwupd but still adopting fixes.

=== Metadata ===
Due to this, upstream highly recommends distros to not backport individual patches so that OEMs can control only running fwupd updates on safe combinations.

OEMs can for example add the following to their metadata to ensure an update is only applied on fwupd 1.9.13.

<requires>
    <id compare="ge" version="1.9.13">org.freedesktop.fwupd</id>
</requires>

=== Testing ===

Upstream includes a test suite including unit tests, installed tests and emulation tests.  
* Unit tests are available for the daemon and many daemon internal flows.
* Installed tests available in the fwupd-tests package and can test flows an end user may encounter (such as updating firmware)
* Emulation tests include a virtual representation of a device and will test functionality within a plugin that will allow it to respond as though a device was really connected when doing an update.

All of these tests are run upstream as part of CI, and the first two sets of tests also run in Ubuntu's autopkgtest infrastructure.

== What can be SRUed ==

=== fwupd-efi ===
tarball releases only.  No backported individual patches.  If a tarball release isn't available, make upstream release one.  When fwupd-efi is uploaded as it needs to be signed it is suggested that the same release be made available in all supported Ubuntu releases simultaneously instead of signing individually for each release.

The ABI used between fwupd and fwupd-efi for capsule updates is considered stable.  It hasn't changed since the creation of the fwupd-efi project.

=== fwupd ===

Upstream maintains a page <nowiki>[[matrix|https:--github.com-fwupd-fwupd-blob-main-SECURITY.md]]</nowiki> of fwupd versions that are supported which match individual branches.
Upcoming EOL dates for branches are also posted.
As a fwupd release is moved to EOL upstream, any uploads to Ubuntu should follow a newer stable release.

To balance the risk of upgrades causing a regression while still providing support for security updates and hardware compatibility the following process should be followed to perform SRUs into stable releases:

On an Ubuntu release that uses fwupd but not fwupdate (after bionic):

'''fwupd within the same stable release on branch''': For example 1_9_X to 1_9_Y branch.

'''fwupd across stable version after it's branched upstream''': For example, SRU from 1_9_X to 2_0_X branch.

=== Full QA Process across stable releases ===

When a new version of fwupd is uploaded to -proposed, the following verification needs to be done:

* Test that UEFI capsule updates still work properly on an OEM system pulling from LVFS with secure boot enabled.
* Test firmware upgrade or re-install that a system that offers a variety of in OS devices enumerate (example Thunderbolt, NVME)
* Make sure the updated fwupdmgr command line utility is backward compatible:
** fwupdmgr update / install / reinstall sub-command needs to be checked.
** Run the old and new version of fwupdmgr.sh in fwupd-tests deb on the new version of fwupd and review the failure test cases, if any.
* Make sure the dbus interface is compatible:
** New methods or enum values are fine.
** Renaming, removing and changing is not ok.
** Command to dump dbus interface ex: “dbus-send --system --type=method_call --print-reply --dest=org.freedesktop.fwupd / org.freedesktop.DBus.Introspectable.Introspect”
* Test updating firmware from the Ubuntu Software Store, GNOME software and Canonical Firmware Updater.

If all the testing indicates that the image containing the new package is acceptable, verification will be considered to be done and the package can be released from -proposed after the standard aging period.

=== Requesting the SRU ===

The SRU should be done with a single process bug for this stable release exception, instead of individual bug reports for individual bug fixes. However, individual bugs may be referenced in the changelog but each of those bugs will need to be independently verified and commented on for the SRU to be considered complete.
