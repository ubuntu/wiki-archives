{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work and there may be formatting issues.
* A '''compressed''' version with images and the original syntax is in the repo '''Releases'''.
|}

__TOC__


* '''Launchpad Entry''': https://blueprints.launchpad.net/ubuntu/+spec/fakeraid-support
* '''Created''':  by PhillipSusi
* '''Contributors''': PhillipSusi, Kibbled_bits, TormodVolden
* '''Packages affected''': dmraid, grub, debian-installer, (ubiquity), (casper), (gparted)

=== Summary ===
This is a specification for adding support to Ubuntu for serial-ATA fakeraids.
 
=== Rationale ===
A number of common desktop motherboards have entered the market over the last years which support "S-ATA RAID". This is in fact, fake hardware raid, a.k.a. fakeraid or softraid. A number of power users and servers are using such solutions as a cheap raid solution, and Ubuntu should support this out of the box.  

=== Use cases ===
* Tina is a power user and does a lot of video editing. She wants a fast and large disk subsystem so she buys a motherboard with SATA RAID support and two or three SATA drives to use in a RAID-0. She wants to be able to install Ubuntu on this system.  
* Tom is a sysadmin and needs to set up a cheap server with a RAID-1 for fault tolerance. He builds a system using s-ata fakeraid and wants to install Ubuntu. 
* John is a gamer and has a motherboard with on-board fakeraid and has it configured with 2 or more hard drives in RAID-0. He would like to now install Ubuntu on the machine and dual-boot with the already-installed Windows OS.

=== Scope ===
The dmraid package needs to be included on the installer CD. grub and grub-installer needs to be educated about fakeraids. ubiquity and debian-installer must properly handle installation targets on fakeraid.

==== Tested Hardware ====
This specification should cover all the on-board SATA-RAID controllers that are supported by the dmraid package.

=== Design ===
The hardware fakeraid setups use a BIOS utility to configure the raid, which writes some configuration data to the disks.  When the system boots up, the BIOS uses that information to provide ''int 13h'' access to the disk so the boot loader can load. Once the kernel is loaded, it sees the hardware for what it is, which is simply a multi-channel s-ata controller, so it sees the individual disks, not the raid array. The dmraid package contains a user mode utility which recognizes the BIOS parameter block on the disks and configures the kernel device mapper to access the raid array. Since this is also performed in the initramfs, the system can be booted from a fakeraid array.

=== Implementation strategy ===

 0. Include dmraid deb and udeb on the installer CDs
  The dmraid package integrates nicely with the initramfs system and is also available as a udeb package. The package needs to be included in main (see MainInclusionReportDmraid) and to be added to the seeds for the installer CDs.

  This step will already be a milestone, since having all necessary software on the install media greatly simplifies the manual installation.

 0. Educate grub/grub2 and grub-installer about fakeraid
  Currently the installation of grub will fail, since grub doesn't handle the fakeraid installation target (see <nowiki>[[https://bugs.launchpad.net/bugs/73141|bug #73141]]</nowiki>).

 0. Make debian-installer handle fakeraid
  The installation program should detect and present any fakeraid partitions as possible install targets.
** debian-installer currently presents the underlying devices as well, which is confusing and possibly dangerous
** it should be able detect fakeraid devices and automatically run dmraid to set them up, optionally, it should allow the user to say "yes, I have fakeraids, please run dmraid to discover them".

  When we get to this point, we can consider fakeraid as supported, but only via the Alternate install CD.

 0. Make ubiquity handle fakeraid
  Same issues as for debian-installer, in addition we should make sure that any graphical partition tool plays nice.

Independent of the above, these issues should be worked on:

 0. The underlying partitions show up under Places/Computer (until dbus is restarted, a bug?). We should provide hal/gnome-vfs with the necessary rules or attributes to keep these partitions hidden and unmountable for the user.

 0. The RAID-1 mirror functionality (in the kernel module dm-mirror) does not include proper fault tolerance. It only writes all data to both discs. It reads data from the first disk, and when this fails the failure is propagated up to the application. However, error handling can be considered an additional feature, and is not a requirement for the fakeraid support we want to offer.

 
==== Code ====
Patches will be provided for grub and debian-installer.
(July 2007) Upstream work is in progress on <nowiki>[[http://wiki.debian.org/DebianInstaller/SataRaid|debian-installer]]</nowiki>

==== Data preservation and migration ====
All proposed changes will preserve backwards compatibility with previously installed systems.

=== Outstanding issues ===

See ''Implementation Strategy''.

=== BoF agenda and discussion ===

=== Notes ===
* Inclusion of dmraid in main will also ensure it's always working for each release, and avoid regressions like those in the Edgy release.

* If grub2 will replace grub soon, we must think about testing against grub2 as well.

* For an idea of the existing support and issues, see FakeRaidHowto

=== Discussion ===

----
CategorySpec
