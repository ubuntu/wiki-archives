{|
| '''Warning'''
* This is a '''readonly''' and '''text-based''' archive of a deprecated wiki.
* '''Images''' and '''attachments''' have been removed to conserve space.
* '''Links''' may not work.
* A '''full compressed version''' of the wiki is available on archive.org
|}

__TOC__


=== Чтобы создать зеркало репозитория, следуйте этим инструкциям ===

Это не покроет все остальные варианты, но даст возможность поэксперементировать. Чтобы всё прошло успешно, понадобится 8,2 ГБ дискового пространства для основных исходников и бинарных пакетов. Это число со временем возрастёт.

==== Альтернативная точка зрения ====

<nowiki>[[https://wiki.ubuntu.com/RussianDocumentation/CreatingLocalReprositoryHowto|Создание локального репозитария]]</nowiki> - позволит вам создать локальный репозиторий для пакетов, принесенных на флешке или другом носителе, а потом использовать synaptic/kynaptic (или apt-get install package_name).

Если вы желаете скачать все возможные бинарники apt для всех ящиков в один сетевой ящик, то возможно apt-cache или transparent proxy (т.е. <nowiki>[[http://help.ubuntu.com/community/HttpReplicator|http-replicator]]</nowiki>) - то что вам нужно.

Ещё один метод - использование rsync. Страница <nowiki>[[http://help.ubuntu.com/community/Rsyncmirror|Rsyncmirror]]</nowiki>  даёт лучшее детальное представление об этом методе. Rsync может создать полное зеркало сайта и выбирает все файлы без исключения. В свою очередь, Debmirror, более контролируемый метод выбора файлов для зеркала и не так беспощаден к вашему дисковому пространству.

<nowiki>[[http://www.howtoforge.com/local_debian_ubuntu_mirror|apt-mirror]]</nowiki> - Эта инструкция покажет, как создать зеркало Debian/Ubuntu для вашей локальной сети при помощи утилиты apt-mirror.

==== Начало процесса создания зеркала ====

Откройте gnome-terminal кликнув Приложения -> Стандартные -> Терминал.
<<BR>>Если в ваш лист репозитариев включён universe, то следующий шаг пропустите.
<<BR>>Откройте ваш список источников (sudo sensible-editor /etc/apt/sources.list), и добавьте следующую строку
<<BR>>deb http://cc.archive.ubuntu.com/ubuntu/ dapper universe
<<BR>>Затем сохраните и вернитесь к приглашению терминала (prompt).
<<BR>>В вышеуказанном примере, cc - код вашей страны (т.е. lv означает Latvia), а dapper замените на релиз, который вы используете.

Обновите список пакетов (sudo apt-get update), а затем установите debmirror (sudo apt-get install debmirror).
<<BR>> Сейчас мы должны создать папку, куда мы сохраним файлы. Примерный размер зеркала (только i386):
{| class="wikitable"
|-
| feisty
| ~27ГБ
| main, restricted, universe, multiverse
|-
| dapper
| 15ГБ
| main, restricted, universe, multiverse
|}

Пожалуйста, заранее убедитесь, что для пакетов, которые вы собираетесь скачать, достаточно места!
<<BR>>(Если вы продвинутый пользователь, то можете создать разные части зеркала на разных носителях, но в этом путеводителе этот вариант не описывается.)
<<BR>>Своё зеркало мы будем создавать в /home/ при помощи
<pre>
sudo mkdir /home/UbuntuMirror
</pre>

=== Создайте файл `mirrorbuild.sh` ===

Чтобы создать файл `mirrorbuild.sh`
<<BR>>Откройте предпочитаемый вами редактор так
<pre>
sudo sensible-editor /usr/local/bin/mirrorbuild.sh
</pre>

Скопируйте текст из следующего поля в редактор.
<<BR>>Вы можете пропустить строки, начинающиеся с # (NB EXCEPTION  строка, которая начинается с #!/bin/bash должна остаться.)

==== Содержимое скрипта зеркала, пожалуйста адаптируйте его под свои нужды ====
<pre>

arch=i386

section=main,restricted,universe,multiverse

release=dapper,dapper-security,dapper-updates

server=cc.archive.ubuntu.com

inPath=/ubuntu

proto=http

outPath=/home/UbuntuMirror

debmirror	-a $arch \
		--no-source \
		-s $section \
		-h $server \
		-d $release \
		-r $inPath \
		--progress \
		-e $proto \
		--ignore-release-gpg \
		$outPath

</pre>

==== Как использовать файл ====
	Сохраните файл и выйдите из редактора.

* Теперь поменяйте права и владельца зеркала. Имя группы - ваше имя пользователя:
<pre>
sudo chown -R root.username /home/UbuntuMirror
sudo chmod -R 571 /home/UbuntuMirror
</pre>
* И заключительная часть настраивания зеркала - загрузка файлов
<pre>
mirrorbuild.sh
</pre>
Теперь прогуляйтесь. Вашей машине придётся много чего скачать!

=== Установите зеркало ===

Нам нужно установить веб-сервер - Apache2. Вы можете выбрать apache версии 1.3, но это выходит за рамки этого документа.
<<BR>>	Обычно это делается так: `sudo apt-get install apache2`
<<BR>>
<<BR>>	Затем (для простоты) давайте сделаем ссылку из /home/UbuntuMirror на /var/www/ubuntu.
<pre>
ln -s /home/UbuntuMirror /var/www/ubuntu
</pre>
Это означает, что когда вы захотите скачать с вашего зеркала, вы заходите на `http://mirrorbox/ubuntu/`.
<<BR>>
<<BR>>	Отлично! Значит так, у нас есть все пакеты и работающий сервер. Теперь нам нужно настроить клиентов.

=== Создайте cronjob чтобы зеркало обновлялось ===

Чтобы зеркало оставалось актуальным, добавьте скрипт зеркала в cron. Чтобы отредактировать файл crontab пользователя root, выполните: 
<pre>
sudo crontab -e
</pre>

И вставьте эту строку:
<pre>
2 */12 * * * /usr/local/bin/mirrorbuild.sh
</pre>

Она будет запускать скрипт каждые двенадцать часов на второй минуте часа. УБЕДИТЕСЬ что под добавленной строкой есть пустая строка, иначе команда никогда не выполнится. Если вам свойственна педантичность, перезапустите cron:
<pre>
sudo /etc/init.d/cron restart
</pre>

=== Настройте клиенские системы ===

Откройте терминал и введите:
<pre>
cd /etc/apt
sudo mv sources.list sources.list.orig
sudo sensible-editor sources.list
</pre>

Теперь в редакторе наберите следующие строки:
<pre>
deb http://mirrorbox/ubuntu dapper main restricted universe multiverse
deb http://mirrorbox/ubuntu dapper-updates main restricted universe multiverse
deb http://mirrorbox/ubuntu dapper-security main restricted universe multiverse
</pre>

Затем сохраните и закройте файл.
<<BR>>	Если теперь запустить
<pre>
sudo apt-get update
sudo apt-get dist-upgrade
</pre>
, обновления будут загружаться с вашего нового сервера!
----
CategoryDocumentation CategoryNetworking
